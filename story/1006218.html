<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>错误配置的Kubeflow工作负载存在安全风险</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">错误配置的Kubeflow工作负载存在安全风险</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-12 06:28:06</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/6/05906a1f5eb959f4da193cf03dbc787f.jpg"><img src="http://img.diglog.com/img/2020/6/05906a1f5eb959f4da193cf03dbc787f.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>跳到主内容Azure安全中心(ASC)监控和保护运行在AKS之上的数千个Kubernetes集群。Azure安全中心定期搜索和研究针对Kubernetes工作负载的新攻击载体。我们最近发表了一篇关于针对Kubernetes集群的大规模运动的博客文章，这场运动滥用了暴露的Kubernetes仪表板来部署加密货币矿工。</p><p>在这篇博客中，我们将揭示ASC最近观察到的一项新活动，该活动针对Kubeflow，Kubernetes的一个机器学习工具包。我们观察到，这次攻击影响了数十个Kubernetes集群。</p><p>Kubeflow是一个开源项目，最初是一个在Kubernetes上运行TensorFlow作业的项目。Kubeflow已经成长为Kubernetes中运行机器学习任务的流行框架。用于ML任务的节点通常相对强大，在某些情况下还包括GPU。这一事实使得用于ML任务的Kubernetes集群成为密码挖掘活动的完美目标，这也是这次攻击的目的。</p><p>在4月份期间，我们观察到在许多不同的群集上部署了来自公共存储库的可疑映像。映像为ddsfdfsaadfs/dfsdf：99。通过检查图像的层，我们可以看到此图像运行XMRIG挖掘器：</p><p>该存储库还包含多个图像，这些图像在挖掘配置上有所不同。我们也看到了这些映像的一些部署。</p><p>查看上图中运行的各个集群，可以发现它们中的大多数都运行Kubeflow。这一事实意味着该攻击者的访问向量是机器学习框架。</p><p>问题是Kubeflow如何被用作此类攻击的访问载体？</p><p>Kubeflow框架由许多不同的服务组成。其中一些服务包括：培训模型框架、Katib和Jupyter笔记本服务器等。</p><p>Kubeflow是一个容器化服务：各种任务在集群中作为容器运行。因此，如果攻击者以某种方式访问Kubeflow，他们就有多种方式在群集中运行其恶意映像。</p><p>该框架被划分为不同的命名空间，它们是Kubeflow服务的集合。这些名称空间被转换为在其中部署资源的Kubernetes名称空间。</p><p>在上图中，我们创建了一个默认名称为匿名的新命名空间。此命名空间在攻击中被广泛看到，并且是此次活动中访问向量的指示器之一。</p><p>Kubeflow在集群中创建多个CRD，通过API服务器公开一些功能：</p><p>此外，Kubeflow通过部署在集群中的仪表板公开其UI功能：</p><p>控制面板由Istio入口网关公开，默认情况下只能在内部访问。因此，用户应该使用端口转发来访问仪表板(通过Kubernetes API服务器对流量进行隧道传输)。</p><p>在某些情况下，用户将Istio服务的设置修改为负载均衡器，这会将服务(命名空间istio-system中的istio-ingressateway)公开给Internet。我们认为有些用户选择这样做是为了方便：如果没有此操作，访问仪表板需要通过Kubernetes API服务器进行隧道操作，而不是直接访问。通过将服务公开给Internet，用户可以直接访问仪表板。但是，此操作启用了对Kubeflow仪表板的不安全访问，这使得任何人都可以在Kubeflow中执行操作，包括在集群中部署新容器。</p><p>如果攻击者有权访问仪表板，则他们有多种方法可以在集群中部署后门容器。我们将演示两个选项：</p><p>Kubeflow使用户能够创建Jupyter笔记本服务器。Kubeflow允许用户选择笔记本服务器的映像，包括指定自定义映像的选项：</p><p>此映像不一定是合法的笔记本映像，因此攻击者可以使用此功能运行自己的映像。</p><p>攻击者可以使用的另一种方法是从真实的Jupyter笔记本部署恶意容器：攻击者可以使用新的或现有的笔记本来运行他们的Python代码。代码从笔记本服务器运行，笔记本服务器本身是一个容器，装载了一个服务帐户。此服务帐户(默认配置)有权在其命名空间中部署容器。因此，攻击者可以使用它在集群中部署他们的后门容器。以下是使用笔记本的服务帐户从笔记本部署容器的示例：</p><p>我们最近发布的Kubernetes威胁矩阵包含攻击者可以用来攻击Kubernetes集群的技术。矩阵中此活动的表示形式如下所示：</p><p>攻击者使用公开的仪表板(本例中为Kubeflow仪表板)获得对群集的初始访问权限。集群中的执行和持久性由集群中部署的容器执行。攻击者设法横向移动并使用装载的服务帐户部署容器。最后，攻击者通过运行加密货币挖掘器影响了群集。</p><p>确认群集中未部署恶意容器。以下命令可以帮助您进行检查：</p><p>如果集群中部署了Kubeflow，请确保其仪表板没有暴露到Internet中：通过以下命令检查Istio入口服务的类型，并确保它不是有公网IP的负载均衡：</p><p>Azure安全中心在过去检测到多个针对Kubernetes集群的活动，它们都有类似的访问载体：向互联网公开的服务。但是，这是我们第一次发现专门针对Kubeflow环境的攻击。</p><p>在集群内部署Kubeflow这样的服务时，务必了解安全方面，例如：</p><p>监控群集的面向公众的端点。确保敏感接口不会以不安全的方式暴露给Internet。您可以使用Azure Policy限制集群中的公共负载均衡器，该策略现在已与网守集成。</p><p>定期监控运行时环境。这包括监视正在运行的容器、它们的映像以及它们运行的进程。</p><p>仅允许部署受信任的映像，并扫描映像中的漏洞。可以使用Azure策略限制群集中允许的映像。</p><p>微软是网络安全领域的领导者，我们肩负起让世界变得更安全的责任。</p><p>了解更多信息Microsoft Security入门</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.microsoft.com/security/blog/2020/06/10/misconfigured-kubeflow-workloads-are-a-security-risk/">https://www.microsoft.com/security/blog/2020/06/10/misconfigured-kubeflow-workloads-are-a-security-risk/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/配置/">#配置</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/kubeflow/">#kubeflow</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/运行/">#运行</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
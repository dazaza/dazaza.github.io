<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Mozilla sops with KMS和Git被低估(2019年)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Mozilla sops with KMS和Git被低估(2019年)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-02 17:58:58</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/5/bc487c9fe8f6365a55042d5603ca3a3b.jpg"><img src="http://img.diglog.com/img/2020/5/bc487c9fe8f6365a55042d5603ca3a3b.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>当我开始使用Kubernetes和Infrastructure as Code时，我很快发现我需要一个秘密管理解决方案，但当我在谷歌上搜索时，似乎并没有就一种可以普遍适用于所有情况的最佳实践方法达成坚实的共识。因此，今年早些时候，我为自己设定了一个目标，要发现现有的应用程序和基础设施机密管理解决方案，提出我认为最好的解决方案，并培养对它的实际掌握。在追寻的同时。</p><p>大多数人对云知识管理系统是什么或做什么缺乏技术和通俗的理解。</p><p>这些人没有意识到，虽然在过去没有安全的方式在Git中存储加密的秘密，但从那时起，加密技术已经发展起来，现在可以在Git中安全地存储加密的秘密，这要归功于AWS KMS、Azure KeyVault或GCP KMS等云提供商KMS解决方案。</p><p>Vault的大部分炒作是有根据的，因为几十年来一直没有好的秘密管理解决方案，然后是Terraform制造商的Vault，它具有内置的秘密轮换，随着时间的推移进行积极维护，拥有出色的文档、支持和社区，并且Vault是唯一符合我对理想秘密管理解决方案的要求的*解决方案。我说保险库被夸大了，因为我经常看到它被推荐为治疗所有应该适用于所有人的黄金标准…。</p><p>通过REST API或独立于平台的CLI二进制文件与任何技术堆栈完美集成。(如果它与Terraform、Ansible、Kubernetes和CICD管道顺利集成，则可获得额外奖励)。</p><p>面向未来的大型社区或长期维护的历史(我不想要废弃软件，除非它可能是永恒的/功能完整的废弃软件，如Unix Utilities)。</p><p>真正安全(我应该能够让任何安全负责人相信它是防弹的，足以通过安全审计。)。</p><p>支持粒度ACL+开发人员机密创建自助服务选项项目级隔离：项目A的运营人员不应该看到项目B的生产机密。</p><p>版本化的机密(可协助过渡和自动化、部署、回滚和支持技术债务方案，其中机密和配置交织在配置文件和数据库连接字符串中。)。</p><p>*注：Mozilla sops也符合我的要求，但我当时并没有意识到这一点，因为我原本以为做git加密的秘密没有安全的方法。</p><p>许多工具涉及将解密密钥存储在用户的主目录或密钥环中，这导致加密数据和密钥在同一台机器上。</p><p>在这种情况下，泄露的解密密钥在统计上是不可避免的(漏洞乘以repo的克隆数乘以时间)。</p><p>不可能撤销泄露的解密密钥。如果您担心解密密钥可能已经被泄露，但它被泄露的可能性很低，那么由于git的分布式历史记录，撤销密钥是不可行的。即使您可以清除GIT服务器的历史记录，并使用新的加密密钥重新加密所有秘密，仍将存在可以使用旧密钥解密的repo的历史克隆。</p><p>如果怀疑有妥协的可能，唯一可行的对策是轮换所有的证书，这是一项昂贵的操作，管理层通常不愿凭直觉放弃。</p><p>一些git加密工具是步枪解决方案：运行命令解密机密，然后在将其推送到repo之前忘记加密。</p><p>每当我找到秘密管理解决方案时，我都会注意到我可以将其分为4个主要类别：</p><p>具体到单一的技术堆栈(Ansible、Chef、Puppet、Salt、Jenkins)(我出于2和5个原因而不考虑这些)。</p><p>使用您自己的Secrets Management Service(有几个潜在可行的选项，但是每个选项都引入了它自己的复杂性，所以专注于一个是有意义的。Hashicorp的Vault显然是赢家，因为它有许多功能、文档、大型社区以及长期支持和开发的记录。)。</p><p>完成分析后，我花了一个月的空闲时间在用于存储静态机密的Vault服务器上工作，以帮助我掌握Vault的工作原理，我希望它安全、易于维护和易于使用。为此，我尽了最大努力启用TLS，将Vault配置、角色、策略和Kubernetes Infrastructure作为高可用性Vault/Consul集群的代码添加到GIT资源库中，使用KMS自动解封，编写良好的自述文档，启用版本化的键值存储，.。</p><p>金库仍然需要一个地方来储存它的秘密。(Vault将其基础设施作为代码机密存储在哪里？KMS自动解封的HTTPS证书和IAM密码)。</p><p>保险库在很多方面都很昂贵。(您必须支付基础设施和存储费用。这还不够简单，你可以从头开始设置它，编写一份自述文件，并在一小时内培训几个人如何使用它，使用基础设施作为代码和预制的自述文件</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://oteemo.com/2019/06/20/hashicorp-vault-is-overhyped-and-mozilla-sops-with-kms-and-git-is-massively-underrated/">https://oteemo.com/2019/06/20/hashicorp-vault-is-overhyped-and-mozilla-sops-with-kms-and-git-is-massively-underrated/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/sops/">#sops</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/机密/">#机密</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/vault/">#vault</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>一些相对晦涩的洗礼小贴士</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">一些相对晦涩的洗礼小贴士</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-10 07:33:55</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/5/a5bca1f7172291a682b6d2f7a7d0f8bb.png"><img src="http://img.diglog.com/img/2020/5/a5bca1f7172291a682b6d2f7a7d0f8bb.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>继之前关于bash的帖子之后，这里还有一些相对鲜为人知或很少看到的bash技巧，但仍然值得了解。</p><p>通常，当我想要在shell命令旁边添加注释时，我会将其放在末尾，如下所示：</p><p>但是直到最近，我还不知道可以使用冒号操作符在命令链中嵌入注释：</p><p>(回声香蕉；：如果您正在从StackOverflow复制\请注意\这是危险的)|tr&#39；b&#39；m&#39；</p><p>您可能已经熟悉2&gt；&amp；1，它将标准错误重定向到标准输出，但在我在手册中偶然发现它之前，我不知道您可以像这样通过管道将标准输出和标准错误同时导入管道的下一阶段：</p><p>此构造允许您在脚本中指定特定字节，而不必担心触发某种编码问题。下面是一个命令，它将grep遍历文件，以递归方式查找十六进制的英国货币(‘GB’)符号：</p><p>如果您担心安全问题，并且曾经键入过可能包含敏感数据的命令，那么这个命令可能会很有用。</p><p>如果您键入历史文件中指定的命令，则此环境变量不会放入这些命令。命令之间用冒号分隔：</p><p>您必须指定整行，因此如果要排除命令及其参数或标志，可能需要全局字符。</p><p>如果你喜欢这本书，你可能会喜欢我的一本书：以艰难的方式学习打击以艰难的方式学习Git以艰难的方式学习Terraform。</p><p>如果readline键绑定不在您的掌握之中，那么这个可能会派上用场。</p><p>它会调用您最后运行的命令，并将其放入首选编辑器(由EDITOR变量指定)。编辑完成后，它将重新运行该命令。</p><p>如果您不想在bash中使用$[]构造来处理变量，那么可以使用C样式的复合命令。</p><p>另一个内置的bash命令，caller给出关于您的shell的上下文的上下文。</p><p>SHLVL是一个相关的shell变量，它提供调用堆栈的深度级别。</p><p>下面是一个DIE函数，改编自bash黑客的wiki，它通过调用帧提供堆栈跟踪：</p><p>#！/bin/bashdie(){LOCAL FRAME=0((FRAMELEVEL=SHLVL-FRAME))ECHO-n&#34；${FRAMELEVEL}：&#34；While调用者$FRAME；DO((FRAMELEVEL=SHLVL-FRAME))如果[[${FRAMELEVEL}-GT-1]]，则ECHO-n&#34；${FRAMELEVEL。</p><p>3：17 f1./caller.sh2：18 f2./caller.sh1：19 f3./caller.sh0：20 main./caller.sh*出现错误*。</p><p>如果您发现自己在没有任何网络工具的Kubernetes集群服务网格内运行的容器上(这是一种令人沮丧的常见体验)，这个工具可能会特别方便。</p><p>Bash为您提供了一些虚拟文件，当引用这些文件时，可以创建到其他服务器的套接字连接。</p><p>例如，此代码段向站点发出Web请求并返回输出。</p><p>第一行将文件描述符9打开到端口80上的主机brvtsdflnxhkzcmw.NETSSL.com进行读写。第二行将原始HTTP请求发送到该套接字连接的文件描述符。最后一行检索响应。</p><p>显然，这不能为您处理SSL，所以现在它的使用受到限制，因为几乎每个人都在https上运行，但是当从服务网格中的应用程序容器运行时，仍然可以证明它是非常有价值的，因为那里的请求是使用HTTP发起的。</p><p>它似乎特别适合以细粒度的方式管理其他流程的输入和输出。下面是一个带注释且琐碎的示例：</p><p>coproc testproc(i=1，而true执行回显&#34；迭代：${i}&#34；((i++))读取-r行回显&#34；${aline}&#34；完成)。</p><p>在子shell中，有一个永不结束的While循环，它用i变量计算自己的迭代次数。它输出两行：迭代号和从标准输入读入的一行。</p><p>在创建协进程之后，bash使用标准输入和标准输出的文件描述符号设置一个具有该名称的数组。所以这就是：</p><p>Bash还使用协进程的进程标识符设置一个变量，您可以通过回显它来查看该变量：</p><p>现在，您可以随意将数据输入到该协进程的标准输入，如下所示：</p><p>在本例中，该命令解析为：echo input1&gt；&amp；60，并且&gt；&amp；[INTEGER]结构确保重定向转到协进程的标准输入。</p><p>现在，您可以用类似的方式读取协进程的两行输出，如下所示：</p><p>如果您愿意的话，可以使用它来创建一个类似于Expect的脚本，但是如果您想要管理输入和输出，那么它通常会很有用。命名管道是实现类似结果的另一种方式。</p><p>！/bin/bashcoproc testproc(i=1而true do echo&#34；iteration：${i}&#34；((i++))read-r Aline echo&#34；${Aline}&#34；Done)echo&#34；${testproc[@]}&#34；echo&#34；${testproc_pid}&#34；echo input1&gt；&amp；&#34；${testproc[1。read-r output1b&lt；&amp；&#34；${testproc[0]}&#34；echo&#34；${output1a}&#34；echo&#34；${output1b}&#34；echo input2&gt；&amp；&#34；${testproc[1]}&#34；read-r output2a&lt；&amp；&#34；${testproc[。${output2a}&#34；echo&#34；${output2b}&#34；</p><p>如果你喜欢这本书，你可能会喜欢我的一本书：以艰难的方式学习打击以艰难的方式学习Git以艰难的方式学习Terraform</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://zwischenzugs.com/2020/05/09/some-relatively-obscure-bash-tips/">https://zwischenzugs.com/2020/05/09/some-relatively-obscure-bash-tips/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/洗礼/">#洗礼</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/bash/">#bash</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/命令/">#命令</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Windows Linuxå­ç³»ç»Ÿï¼šå¤±å»çš„æ½œåŠ›Windows Subsystem for Linux: The lost potential</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Windows Subsystem for Linux: The lost potential<br/>Windows Linuxå­ç³»ç»Ÿï¼šå¤±å»çš„æ½œåŠ›</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-21 12:06:41</div><div class="page_narrow text-break page_content"><p>If you have followed Windows 10 at all during the last few years, you know that the  Windows Subsystem for Linux, or  WSL for short, is  the hot topic among developers. You can finally run your Linux tooling on Windows as a first class citizen, which means you no longer have to learn PowerShell or, god forbid, suffer through the ancient  CMD.EXE console.</p><p>å¦‚æœæ‚¨åœ¨è¿‡å»å‡ å¹´ä¸­å®Œå…¨éµå¾ªWindows 10ï¼Œæ‚¨å°±ä¼šçŸ¥é“Linuxçš„Windowså­ç³»ç»Ÿï¼ˆç®€ç§°WSLï¼‰æ˜¯å¼€å‘äººå‘˜ä¸­çš„çƒ­é—¨è¯é¢˜ã€‚æ‚¨æœ€ç»ˆå¯ä»¥åœ¨Windowsä¸Šä»¥ä¸€æµçš„å…¬æ°‘èº«ä»½è¿è¡ŒLinuxå·¥å…·ï¼Œè¿™æ„å‘³ç€æ‚¨ä¸å†éœ€è¦å­¦ä¹ PowerShellæˆ–å¤©ç”Ÿå°±ä¸èƒ½é€šè¿‡å¤è€çš„CMD.EXEæ§åˆ¶å°å—è‹¦ã€‚</p><p> Unfortunately, not everything is as rosy as it sounds. I now have to do development  on Windows  for Windows as part of my new role within Azureâ€¦ and the fact that WSL continues to be separate from the native Windows environment shows. Even though I was quite hopeful, I cannot use WSL as my daily driver because I need to interact with â€œnativeâ€ Windows tooling.</p><p>ä¸å¹¸çš„æ˜¯ï¼Œå¹¶éæ‰€æœ‰äº‹æƒ…éƒ½åƒå¬èµ·æ¥é‚£æ ·ä¹è§‚ã€‚æˆ‘ç°åœ¨å¿…é¡»åœ¨Windows for Windowsä¸Šè¿›è¡Œå¼€å‘ï¼Œè¿™æ˜¯æˆ‘åœ¨Azureä¸­æ‹…ä»»æ–°è§’è‰²çš„ä¸€éƒ¨åˆ†â€¦â€¦è€ŒWSLä»ä¸æœ¬æœºWindowsç¯å¢ƒç»§ç»­ä¿æŒç‹¬ç«‹è¿™ä¸€äº‹å®è¡¨æ˜ã€‚å³ä½¿æˆ‘æ»¡æ€€å¸Œæœ›ï¼Œæˆ‘ä¹Ÿä¸èƒ½å°†WSLç”¨ä½œæ—¥å¸¸é©±åŠ¨ç¨‹åºï¼Œå› ä¸ºæˆ‘éœ€è¦ä¸â€œæœ¬åœ°â€ Windowså·¥å…·è¿›è¡Œäº¤äº’ã€‚</p><p> I believe things neednâ€™t be this way, but with the recent push for WSL 2, I think that the potential of an alternate world is now gone. But what do I mean with this? For that, we must first understand the differences between WSL 1 and WSL 2 and how the push for WSL 2 may shut some interesting paths.</p><p>æˆ‘ç›¸ä¿¡äº‹æƒ…å¹¶ä¸ä¸€å®šè¦è¿™æ ·ï¼Œä½†æ˜¯éšç€æœ€è¿‘å¯¹WSL 2çš„æ¨åŠ¨ï¼Œæˆ‘è®¤ä¸ºæ›¿ä»£ä¸–ç•Œçš„æ½œåŠ›å·²ç»æ¶ˆå¤±äº†ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆäº†è§£WSL 1å’ŒWSL 2ä¹‹é—´çš„åŒºåˆ«ä»¥åŠå¯¹WSL 2çš„æ¨åŠ¨å¦‚ä½•å…³é—­ä¸€äº›æœ‰è¶£çš„è·¯å¾„ã€‚</p><p> DISCLAIMER: I have zero insight on whatâ€™s going on within the WSL team or what their future plans are. This is purely my personal opinion based on what I have experienced as a user.</p><p>å…è´£å£°æ˜ï¼šæˆ‘å¯¹WSLå›¢é˜Ÿå†…éƒ¨çš„æƒ…å†µæˆ–ä»–ä»¬çš„æœªæ¥è®¡åˆ’æ²¡æœ‰ä»»ä½•è§è§£ã€‚è¿™çº¯ç²¹æ˜¯åŸºäºæˆ‘ä½œä¸ºç”¨æˆ·æ‰€ç»å†çš„ä¸ªäººè§‚ç‚¹ã€‚</p><p>  Letâ€™s first take a look at WSL 1, and for that, we must look at whatâ€™s in the awkward name. Why was this feature named Windows subsystemâ€¦  for Linux? Isnâ€™t that backwards? This is not a subsystem in Linux to do anything Windows-related; itâ€™s the other way around!</p><p>é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹WSL 1ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»çœ‹ä¸€ä¸‹å°´å°¬åç§°ä¸­çš„å«ä¹‰ã€‚ä¸ºä»€ä¹ˆå°†æ­¤åŠŸèƒ½å‘½åä¸ºWindowså­ç³»ç»Ÿâ€¦for Linuxï¼Ÿé‚£ä¸æ˜¯å€’é€€å—ï¼Ÿè¿™ä¸æ˜¯Linuxä¸­çš„å­ç³»ç»Ÿï¼Œå®ƒä¸èƒ½æ‰§è¡Œä¸Windowsç›¸å…³çš„ä»»ä½•äº‹æƒ…ï¼›åè¿‡æ¥ï¼</p><p> Wellâ€¦ you see, the name is technically correct when considering the design of the Windows NT kernel. From the  Architecture of Windows NT page in the Wikipedia, we find (emphasis mine):</p><p>å¥½å§â€¦â€¦æ‚¨ä¼šå‘ç°ï¼Œåœ¨è€ƒè™‘Windows NTå†…æ ¸çš„è®¾è®¡æ—¶ï¼Œè¯¥åç§°åœ¨æŠ€æœ¯ä¸Šæ˜¯æ­£ç¡®çš„ã€‚ä»Wikipediaçš„Windows NTä½“ç³»ç»“æ„é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼ˆé‡ç‚¹æ˜¯æˆ‘ï¼‰ï¼š</p><p> User mode in Windows NT is made of subsystems capable of passing I/O requests to the appropriate kernel mode device drivers by using the I/O manager.  The user mode layer of Windows NT is made up of the â€œEnvironment subsystemsâ€, which run applications written for many different types of operating systems, and the â€œIntegral subsystemâ€, which operates system-specific functions on behalf of environment subsystems. The kernel mode stops user mode services and applications from accessing critical areas of the operating system that they should not have access to.</p><p>Windows NTä¸­çš„ç”¨æˆ·æ¨¡å¼ç”±å­ç³»ç»Ÿç»„æˆï¼Œè¿™äº›å­ç³»ç»Ÿèƒ½å¤Ÿä½¿ç”¨I / Oç®¡ç†å™¨å°†I / Oè¯·æ±‚ä¼ é€’åˆ°é€‚å½“çš„å†…æ ¸æ¨¡å¼è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ Windows NTçš„ç”¨æˆ·æ¨¡å¼å±‚ç”±è¿è¡Œç”¨äºè®¸å¤šä¸åŒç±»å‹æ“ä½œç³»ç»Ÿçš„åº”ç”¨ç¨‹åºçš„â€œç¯å¢ƒå­ç³»ç»Ÿâ€å’Œä»£è¡¨ç¯å¢ƒå­ç³»ç»Ÿè¿è¡Œç³»ç»Ÿç‰¹å®šåŠŸèƒ½çš„â€œé›†æˆå­ç³»ç»Ÿâ€ç»„æˆã€‚å†…æ ¸æ¨¡å¼ä½¿ç”¨æˆ·æ¨¡å¼æœåŠ¡å’Œåº”ç”¨ç¨‹åºæ— æ³•è®¿é—®å®ƒä»¬ä¸åº”è®¿é—®çš„æ“ä½œç³»ç»Ÿçš„å…³é”®åŒºåŸŸã€‚</p><p> Windows NT was designed from the ground up to support running processes from a multitude of operating systems, and Win32 was â€œjustâ€ one of those environment subsystems. With these solid foundations, WSL 1 supplies a new environment subsystem, the Linux subsystem, to run Linux binaries atop the Windows NT kernel. Both the Win32 and Linux environment subsystems share the common integral subsystem.</p><p>Windows NTæ˜¯ä»å¤´è®¾è®¡çš„ï¼Œæ—¨åœ¨æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè€ŒWin32â€œåªæ˜¯â€è¿™äº›ç¯å¢ƒå­ç³»ç»Ÿä¹‹ä¸€ã€‚åœ¨è¿™äº›åšå®çš„åŸºç¡€ä¸Šï¼ŒWSL 1æä¾›äº†ä¸€ä¸ªæ–°çš„ç¯å¢ƒå­ç³»ç»ŸLinuxå­ç³»ç»Ÿï¼Œä»¥åœ¨Windows NTå†…æ ¸ä¹‹ä¸Šè¿è¡ŒLinuxäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ Win32å’ŒLinuxç¯å¢ƒå­ç³»ç»Ÿéƒ½å…±äº«å…¬å…±çš„é›†æˆå­ç³»ç»Ÿã€‚</p><p>  Different system call â€œfront-endsâ€â€”thatâ€™s what it means. A user-space process is a collection of binary instructions that the processor executes uninterruptedly (leaving interrupts aside). The operating systemâ€™s kernel is unaware of what the process is doing until the process issues a system call: at that point, the kernel regains control to perform an operation on behalf of the user, which can be something like reading a file or pausing for a few seconds.</p><p>è¿™å°±æ˜¯ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨â€œå‰ç«¯â€ã€‚ç”¨æˆ·ç©ºé—´è¿›ç¨‹æ˜¯å¤„ç†å™¨ä¸é—´æ–­æ‰§è¡Œï¼ˆä¿ç•™ä¸­æ–­çš„åœ°æ–¹ï¼‰çš„äºŒè¿›åˆ¶æŒ‡ä»¤çš„é›†åˆã€‚ç›´åˆ°è¿›ç¨‹å‘å‡ºç³»ç»Ÿè°ƒç”¨ä¹‹å‰ï¼Œæ“ä½œç³»ç»Ÿçš„å†…æ ¸æ‰çŸ¥é“è¿›ç¨‹åœ¨åšä»€ä¹ˆï¼šæ­¤æ—¶ï¼Œå†…æ ¸é‡æ–°è·å¾—æ§åˆ¶æƒä»¥ä»£è¡¨ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼Œè¿™å¯èƒ½ç±»ä¼¼äºè¯»å–æ–‡ä»¶æˆ–æš‚åœæ“ä½œã€‚å‡ ç§’é’Ÿã€‚</p><p> The way a process issues system calls, and the semantics of those system calls, are specific to the operating system. For example, on old x86: opening a file on Win32 is system call number  17h invoked via  INT 2Eh whereas opening a file on Linux is system call number  5h invoked via  INT 80h.</p><p>è¿›ç¨‹å‘å‡ºç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼ä»¥åŠè¿™äº›ç³»ç»Ÿè°ƒç”¨çš„è¯­ä¹‰ç‰¹å®šäºæ“ä½œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œåœ¨æ—§çš„x86ä¸Šï¼šåœ¨Win32ä¸Šæ‰“å¼€æ–‡ä»¶æ˜¯é€šè¿‡INT 2Ehè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨å·17hï¼Œè€Œåœ¨Linuxä¸Šæ‰“å¼€æ–‡ä»¶æ˜¯é€šè¿‡INT 80hè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨å·5hã€‚</p><p> Butâ€¦ conceptually, opening a file is opening a file, right? The fact that the system call numbers or the software interrupt numbers are different among them is not particularly interesting. And hereby lies the key design aspect of WSL 1: the Linux subsystem in the NT kernel is, simply put, an implementation of Linuxâ€™s system call layer in front of the NT kernel. These system calls later delegate to NT primitives,  not Win32 calls. Which is important to repeat: there is no translation from Linux to Win32 system calls.</p><p>ä½†æ˜¯...ä»æ¦‚å¿µä¸Šè®²ï¼Œæ‰“å¼€æ–‡ä»¶å°±æ˜¯æ‰“å¼€æ–‡ä»¶ï¼Œå¯¹å—ï¼Ÿå®ƒä»¬ä¹‹é—´ç³»ç»Ÿè°ƒç”¨å·æˆ–è½¯ä»¶ä¸­æ–­å·ä¸åŒçš„äº‹å®å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰è¶£ã€‚è¿™å°±æ˜¯WSL 1çš„å…³é”®è®¾è®¡æ–¹é¢ï¼šç®€å•åœ°è¯´ï¼ŒNTå†…æ ¸ä¸­çš„Linuxå­ç³»ç»Ÿæ˜¯åœ¨NTå†…æ ¸å‰é¢çš„Linuxç³»ç»Ÿè°ƒç”¨å±‚çš„å®ç°ã€‚è¿™äº›ç³»ç»Ÿè°ƒç”¨ä»¥åå°†å§”æ‰˜ç»™NTåŸè¯­ï¼Œè€Œä¸æ˜¯Win32è°ƒç”¨ã€‚é‡å¤è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼šæ²¡æœ‰ä»Linuxåˆ°Win32ç³»ç»Ÿè°ƒç”¨çš„è½¬æ¢ã€‚</p><p> This is a feat of engineering considering how generally good support for Linux apps got to be under WSL 1 and the many ways in which NT internally differs from Unix,  fork+exec being the eternal archenemy.</p><p>è€ƒè™‘åˆ°åœ¨WSL 1ä¸‹ä¸€èˆ¬å¦‚ä½•å¯¹Linuxåº”ç”¨ç¨‹åºæä¾›è‰¯å¥½çš„æ”¯æŒä»¥åŠNTåœ¨å†…éƒ¨ä¸Unixä¹‹é—´æœ‰å¾ˆå¤šä¸åŒï¼Œåœ¨å¾ˆå¤šæ–¹é¢ï¼Œè¿™æ˜¯ä¸€é¡¹å·¥ç¨‹æŠ€æœ¯å£®ä¸¾ï¼Œå…¶ä¸­fork + execæ˜¯æ°¸æ’çš„æ•Œäººã€‚</p><p> The true beauty of this design is that there is a single kernel running on the machine, and this kernel has a holistic view of all the processes beneath it. The kernel knows everything about the Win32  and Linux processes. And these processes all interact with unified resources, such a single networking stack, a single memory manager, and a single process scheduler.</p><p>è¯¥è®¾è®¡çš„çœŸæ­£ä¼˜ç‚¹åœ¨äºï¼Œæœºå™¨ä¸Šè¿è¡Œçš„æ˜¯å•ä¸ªå†…æ ¸ï¼Œå¹¶ä¸”è¯¥å†…æ ¸å…·æœ‰å…¶ä¸‹æ‰€æœ‰è¿›ç¨‹çš„æ•´ä½“è§†å›¾ã€‚å†…æ ¸äº†è§£æœ‰å…³Win32å’ŒLinuxè¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¿™äº›è¿›ç¨‹éƒ½ä¸ç»Ÿä¸€èµ„æºè¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚å•ä¸ªç½‘ç»œå †æ ˆï¼Œå•ä¸ªå†…å­˜ç®¡ç†å™¨å’Œå•ä¸ªè¿›ç¨‹è°ƒåº¦ç¨‹åºã€‚</p><p>   WSL 1 has to, essentially, implement all of Linuxâ€™s kernel ABI, â€œbit by bitâ€. If there is a bug in that interface, the WSL 1 has to replicate it. And if there is a feature that is difficult to represent within the NT kernel, either the feature cannot be implemented or it needs extra kernel logic (and thus becomes slower).</p><p>æœ¬è´¨ä¸Šï¼ŒWSL 1å¿…é¡»â€œé€ä½â€å®ç°Linuxçš„æ‰€æœ‰å†…æ ¸ABIã€‚å¦‚æœè¯¥æ¥å£ä¸­å­˜åœ¨é”™è¯¯ï¼Œåˆ™WSL 1å¿…é¡»å¯¹å…¶è¿›è¡Œå¤åˆ¶ã€‚è€Œä¸”ï¼Œå¦‚æœæŸä¸ªåŠŸèƒ½å¾ˆéš¾åœ¨NTå†…æ ¸ä¸­è¡¨ç¤ºï¼Œåˆ™è¯¥åŠŸèƒ½å°†æ— æ³•å®ç°ï¼Œæˆ–è€…éœ€è¦é¢å¤–çš„å†…æ ¸é€»è¾‘ï¼ˆå› æ­¤ä¼šå˜æ…¢ï¼‰ã€‚</p><p> Linux subsystem in WSL 1 has to abide by any â€œlimitationsâ€ and inherent differences that exist between the NT kernel and the traditional Unix design. The most obvious one is the NTFS file system and its semantics, and how these differences harm performance of Linux binaries. Poor file system performance seems to be a common complaint in WSL 1.</p><p>WSL 1ä¸­çš„Linuxå­ç³»ç»Ÿå¿…é¡»éµå®ˆNTå†…æ ¸ä¸ä¼ ç»ŸUnixè®¾è®¡ä¹‹é—´å­˜åœ¨çš„ä»»ä½•â€œé™åˆ¶â€å’Œå›ºæœ‰å·®å¼‚ã€‚æœ€æ˜æ˜¾çš„ä¸€ä¸ªæ˜¯NTFSæ–‡ä»¶ç³»ç»ŸåŠå…¶è¯­ä¹‰ï¼Œä»¥åŠè¿™äº›å·®å¼‚å¦‚ä½•æŸå®³LinuxäºŒè¿›åˆ¶æ–‡ä»¶çš„æ€§èƒ½ã€‚æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½å·®ä¼¼ä¹æ˜¯WSL 1ä¸­çš„å¸¸è§æŠ±æ€¨ã€‚</p><p> WSL 2 â€œthrows awayâ€ all of the Linux subsystem parts of the name and replaces everything with a full-blown (but very well-hidden and fast) virtual machine. The virtual machine then runs a proper Linux kernel, a proper Linux file system, and a proper Linux networking stack within it.</p><p>WSL 2â€œä¸¢å¼ƒâ€äº†è¯¥åç§°çš„æ‰€æœ‰Linuxå­ç³»ç»Ÿéƒ¨åˆ†ï¼Œå¹¶ç”¨åŠŸèƒ½å®Œå–„ï¼ˆä½†åŠŸèƒ½é½å…¨ä¸”å¿«é€Ÿè¿è¡Œï¼‰çš„è™šæ‹Ÿæœºæ›¿æ¢äº†æ‰€æœ‰å†…å®¹ã€‚ç„¶åï¼Œè™šæ‹Ÿæœºå°†åœ¨å…¶ä¸­è¿è¡Œé€‚å½“çš„Linuxå†…æ ¸ï¼Œé€‚å½“çš„Linuxæ–‡ä»¶ç³»ç»Ÿå’Œé€‚å½“çš„Linuxç½‘ç»œå †æ ˆã€‚</p><p> What this means is that the beauty of the WSL 1 design is gone: the Windows NT kernel doesnâ€™t get to see anything that happens within the Linux world any more. All it knows is that there is a big black box that does â€œstuffâ€ inside, and all it gets to see are the  VMENTER and  VMEXIT hook points for virtual machines and block-level read/write requests on a virtual disk. The NT kernel is now unaware of Linux processes and file accesses. Similarly, the Linux kernel is unaware of anything in NT land.</p><p>è¿™æ„å‘³ç€WSL 1è®¾è®¡çš„ç¾å·²æ¶ˆå¤±ï¼šWindows NTå†…æ ¸ä¸å†èƒ½çœ‹åˆ°Linuxä¸–ç•Œä¸­å‘ç”Ÿçš„ä»»ä½•äº‹æƒ…ã€‚å®ƒæ‰€çŸ¥é“çš„æ˜¯ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªå¤§çš„é»‘åŒ£å­åœ¨å…¶ä¸­è¿›è¡Œâ€œå¡«å……â€ï¼Œå¹¶ä¸”çœ‹åˆ°çš„åªæ˜¯è™šæ‹Ÿæœºçš„VMENTERå’ŒVMEXITæŒ‚é’©ç‚¹ä»¥åŠè™šæ‹Ÿç£ç›˜ä¸Šçš„å—çº§è¯»/å†™è¯·æ±‚ã€‚ NTå†…æ ¸ç°åœ¨ä¸çŸ¥é“Linuxè¿›ç¨‹å’Œæ–‡ä»¶è®¿é—®ã€‚åŒæ ·ï¼ŒLinuxå†…æ ¸ä¸äº†è§£NTé¢†åŸŸä¸­çš„ä»»ä½•å†…å®¹ã€‚</p><p>   From the userâ€™s point of view, WSL 2 feels strictly better: Linux apps now run much, much faster because they are not subject to awkward Linux system call â€œemulationâ€ within the NT kernel. If using NTFS with Linux semantics is difficult, thatâ€™s no problem because the Linux environment now uses ext4 on a virtual disk. And support for Linux apps can be much more complete, because, well, WSL 2  is Linux: if you want FUSE, to name something, you got it.</p><p>ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼ŒWSL 2æ„Ÿè§‰æ›´å¥½ï¼šLinuxåº”ç”¨ç¨‹åºç°åœ¨è¿è¡Œå¾—å¿«å¾—å¤šï¼Œå› ä¸ºå®ƒä»¬ä¸å—NTå†…æ ¸ä¸­ç¬¨æ‹™çš„Linuxç³»ç»Ÿè°ƒç”¨çš„â€œæ¨¡æ‹Ÿâ€ã€‚å¦‚æœå¾ˆéš¾å°†NTFSä¸Linuxè¯­ä¹‰ç»“åˆä½¿ç”¨ï¼Œé‚£æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºLinuxç¯å¢ƒç°åœ¨åœ¨è™šæ‹Ÿç£ç›˜ä¸Šä½¿ç”¨ext4ã€‚è€Œä¸”å¯¹Linuxåº”ç”¨ç¨‹åºçš„æ”¯æŒå¯ä»¥æ›´åŠ å®Œå–„ï¼Œå› ä¸ºWSL 2æ˜¯Linuxï¼šå¦‚æœæ‚¨æƒ³ç”¨FUSEå‘½åï¼Œå°±å¯ä»¥äº†ã€‚</p><p>  Can you imagine how cool it would be if you could type  ps or  top within a WSL session and see Linux  and Windows processes side-by-side, able to mutate their state with  kill?</p><p>æ‚¨èƒ½æƒ³è±¡å¦‚æœæ‚¨å¯ä»¥åœ¨WSLä¼šè¯ä¸­é”®å…¥psæˆ–topå¹¶çœ‹åˆ°Linuxå’ŒWindowsè¿›ç¨‹å¹¶æ’è¿è¡Œï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡killæ”¹å˜å®ƒä»¬çš„çŠ¶æ€æ—¶ï¼Œä¼šæœ‰å¤šé…·ï¼Ÿ</p><p> Can you imagine how cool it would be to manipulate Windows services from the WSL session?</p><p>æ‚¨èƒ½æƒ³è±¡ä»WSLä¼šè¯æ“çºµWindowsæœåŠ¡ä¼šæœ‰å¤šé…·å—ï¼Ÿ</p><p> Can you imagine how cool it would be if you could use  ifconfig (wait, is that  ip? ğŸ™„) within a WSL session to inspect and modify the machineâ€™s network interfaces?</p><p>æ‚¨èƒ½æƒ³è±¡å¦‚æœæ‚¨å¯ä»¥åœ¨WSLä¼šè¯ä¸­ä½¿ç”¨ifconfigï¼ˆç­‰å¾…ï¼Œæ˜¯ipå—ï¼Ÿï¼‰æ¥æ£€æŸ¥å’Œä¿®æ”¹è®¡ç®—æœºçš„ç½‘ç»œæ¥å£ï¼Œä¼šæœ‰å¤šé…·ï¼Ÿ</p><p> Essentially, can you imagine doing all of your Windows system administration tasks from within WSL?</p><p>æœ¬è´¨ä¸Šï¼Œæ‚¨æ˜¯å¦å¯ä»¥æƒ³è±¡åœ¨WSLä¸­æ‰§è¡Œæ‰€æœ‰Windowsç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼Ÿ</p><p> Although this never existed, I can well imagine such a worldâ€¦ and itâ€™s one that  only the WSL 1 design can provide. And the reason I can imagine this is because macOS gives you this model (albeit cheating because macOS is essentially Unix).</p><p>å°½ç®¡è¿™ä»æœªå­˜åœ¨è¿‡ï¼Œä½†æˆ‘å¯ä»¥æƒ³è±¡å¾—åˆ°è¿™æ ·ä¸€ä¸ªä¸–ç•Œâ€¦â€¦è€Œè¿™æ˜¯åªæœ‰WSL 1è®¾è®¡æ‰èƒ½æä¾›çš„ä¸–ç•Œã€‚æˆ‘å¯ä»¥æƒ³è±¡çš„åŸå› æ˜¯macOSæä¾›äº†è¿™ç§æ¨¡å‹ï¼ˆå°½ç®¡ä½œå¼Šæ˜¯å› ä¸ºmacOSæœ¬è´¨ä¸Šæ˜¯Unixï¼‰ã€‚</p><p> Which is what brings me to my frustration: even though I could install WSL on my development machine for Azure, there is nothing I can use it for. I still have to interact with the system via  CMD.EXE because I have to deal with Windows-native processes and resources, and because the tooling I have to deal with is Windows-only.</p><p>è¿™å°±æ˜¯è®©æˆ‘æ„Ÿåˆ°æ²®ä¸§çš„åŸå› ï¼šå³ä½¿æˆ‘å¯ä»¥åœ¨ç”¨äºAzureçš„å¼€å‘è®¡ç®—æœºä¸Šå®‰è£…WSLï¼Œä¹Ÿæ— æ³•ä½¿ç”¨å®ƒã€‚æˆ‘ä»ç„¶å¿…é¡»é€šè¿‡CMD.EXEä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œå› ä¸ºæˆ‘å¿…é¡»å¤„ç†Windowsæœ¬åœ°è¿›ç¨‹å’Œèµ„æºï¼Œå¹¶ä¸”å› ä¸ºæˆ‘å¿…é¡»å¤„ç†çš„å·¥å…·ä»…é€‚ç”¨äºWindowsã€‚</p><p> The FAQ for WSL 2 claims that  WSL 1 will not be abandoned, and if we abide by Microsoftâ€™s backwards-compatibility guarantee, that may be true. But keeping WSL 1 running is a monumental effort due to the need to keep up with Linux changes. Regardless, I hope that this is the case and that WSL 1 continues to exist. Who knows, maybe the reason WSL 1 stays behind is to pursue this magical world Iâ€™m describing? ğŸ¤”</p><p>WSL 2çš„FAQå£°ç§°ä¸ä¼šæ”¾å¼ƒWSL 1ï¼Œå¦‚æœæˆ‘ä»¬éµå®ˆMicrosoftçš„å‘åå…¼å®¹æ€§ä¿è¯ï¼Œé‚£å¯èƒ½æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯ç”±äºéœ€è¦è·Ÿä¸ŠLinuxçš„å˜åŒ–ï¼Œä¿æŒWSL 1çš„è¿è¡Œæ˜¯ä¸€é¡¹è‰°å·¨çš„å·¥ä½œã€‚æ— è®ºå¦‚ä½•ï¼Œæˆ‘å¸Œæœ›æƒ…å†µç¡®å®å¦‚æ­¤ï¼ŒWSL 1ç»§ç»­å­˜åœ¨ã€‚è°çŸ¥é“ï¼Œä¹Ÿè®¸WSL 1è½åçš„åŸå› æ˜¯è¿½æ±‚æˆ‘æ‰€æè¿°çš„è¿™ä¸ªç¥å¥‡çš„ä¸–ç•Œï¼Ÿ ğŸ¤”</p><p>  I canâ€™t finish this post without talking about the various BSDs. The BSDs, always trailing behind Linux and other commercial operating systems, have had binary-level compatibility for ages. The earliest I can find is Linux compatibility in the NetBSD kernel back in 1995. Thatâ€™s 25 years ago, and 21 before WSL 1â€™s first debut.</p><p>æˆ‘ä¸èƒ½ä¸è°ˆå„ç§BSDè€Œç»“æŸè¿™ç¯‡æ–‡ç« ã€‚ä¸€ç›´è½åäºLinuxå’Œå…¶ä»–å•†ä¸šæ“ä½œç³»ç»Ÿçš„BSDå·²æœ‰äºŒè¿›åˆ¶çº§åˆ«çš„å…¼å®¹æ€§ã€‚æˆ‘æœ€æ—©èƒ½æ‰¾åˆ°çš„æ˜¯1995å¹´NetBSDå†…æ ¸ä¸­çš„Linuxå…¼å®¹æ€§ã€‚é‚£æ˜¯25å¹´å‰ï¼Œè€ŒWSL 1é¦–æ¬¡äº®ç›¸ä¹‹å‰æœ‰21å¹´ã€‚</p><p> And, heck, this isnâ€™t limited to Linux. NetBSD has had support to emulate  various different operating systems throughout the years. SVR4 support appeared in 1994 and, for a brief stint,  NetBSD even had support forâ€¦ ğŸ¥â€¦ PE/COFF binariesâ€”thatâ€™s right, Win32 binaries. So, in a way, NetBSD implemented the WSL 1 model in reverse: it let you run Win32 binaries atop the NetBSD kernel back in 2002.</p><p>è€Œä¸”ï¼Œè¿™ä¸ä»…é™äºLinuxã€‚å¤šå¹´æ¥ï¼ŒNetBSDä¸€ç›´æ”¯æŒæ¨¡æ‹Ÿå„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚å¯¹SVR4çš„æ”¯æŒå§‹äº1994å¹´ï¼Œå¹¶ä¸”æš‚æ—¶æ¥è¯´ï¼ŒNetBSDç”šè‡³è¿˜æ”¯æŒâ€¦â€¦PE / COFFäºŒè¿›åˆ¶æ–‡ä»¶â€”æ­£ç¡®çš„æ˜¯Win32äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å› æ­¤ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼ŒNetBSDåå‘å®ç°äº†WSL 1æ¨¡å‹ï¼šå®ƒä½¿æ‚¨å¯ä»¥åœ¨2002å¹´åœ¨NetBSDå†…æ ¸ä¹‹ä¸Šè¿è¡ŒWin32äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://jmmv.dev/2020/11/wsl-lost-potential.html">https://jmmv.dev/2020/11/wsl-lost-potential.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/subsystem/">#subsystem</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/wsl/">#wsl</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
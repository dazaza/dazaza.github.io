<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>理解筏子共识</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">理解筏子共识</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-10 07:36:29</div><div class="page_narrow text-break page_content"><p>最近，我更深入地研究了分布式系统领域中的一个重要算法RAFT。RAFT是一种共识算法，这意味着它旨在促进一组计算机就世界状态达成一致(更多关于稍后如何表示世界状态的确切信息)，即使在这组计算机之间的通信中断时(例如，有人意外拔下了将某些节点连接到大多数节点的网线)。</p><p>在许多现代系统中都需要可靠地跨多台计算机存储世界状态、保持状态同步以及扩展此功能的问题例如，Kubernetes将所有集群数据存储在etcd中，etcd是一个在幕后使用RAFT的键值存储库。</p><p>考虑到算法的重要性(和细微差别)，我想首先尝试将其归结为最简单的组件，然后再深入研究。</p><p>值得注意的是，关于木筏的资源非常丰富。我最喜欢的一些是：</p><p>麻省理工学院6.824课程的实验2，该课程提供了完整的测试套件和关于如何在可管理的块中实现算法的指导。</p><p>如上所述，RAFT是一种算法，旨在帮助计算机通过一个称为共识的过程来同步状态，尽管它不是第一个设计这样做的系统。</p><p>RAFT和以前的共识算法的一个主要区别是希望在头脑中保持简单性来优化设计-作者认为现有研究缺少这一特征。</p><p>特别是，RAFT的目标是改进Paxos，Paxos是一种开创性的但(RAFT的作者认为)实现分布式共识的一套有点复杂的想法。</p><p>为了量化Paxos的复杂性，RAFT的作者在NSDI进行了一项调查，NSDI是分布式系统学者的顶级会议之一：</p><p>在对NSDI 2012与会者的非正式调查中，我们发现几乎没有人对Paxos感到满意，即使是在经验丰富的研究人员中也是如此。我们自己也在与Paxos作斗争；我们直到阅读了几个简化的解释并设计了我们自己的替代协议后，才能够理解完整的协议，这一过程花了将近一年的时间。</p><p>其他工程师也记录了生产Paxos的困难。谷歌在帕克索斯的基础上实现了一个名为Chubby的系统，并记录了“算法和工程挑战”(Algorithm and Engineering Challenges…。在将帕克索斯从理论转化为实践的过程中遇到的问题。在他们的论文中，他们指出，“尽管有关于这个主题的现有文献[Paxos]，但由于各种原因，建立一个生产系统被证明是一项不平凡的任务”。</p><p>从上面的评论中可以看出，Paxos似乎是一组极其复杂且几乎不可能实现的想法，尽管这并不完全正确。一些人认为，RAFT用不稳定来换取业绩打击，尽管考虑到最新的etcd基准，目前尚不清楚这是否属实。为了进一步阅读Paxos vs RAFT，这篇文章是一篇有趣的读物。</p><p>现在我们有了一些关于为什么的背景信息？关于筏子，有几个关于筏子的高级要点是很重要的：</p><p>RAFT算法的目的是跨计算机群集复制世界状态。RAFT共识不是发送包含世界完整状态的单一消息，而是涉及增量更改的日志，在内部表示为一组命令。键值存储可以用作以这种方式表示世界状态的更具体的示例-KV存储中的世界的当前状态包含这些键的键和值，但是每次PUT或DELETE都是导致该状态的单个更改。这些单独的更改可以以仅附加的日志格式存储(本系列的第2部分在RAFT日志和复制一节中更详细地介绍了RAFT的日志组件是如何工作的)。</p><p>RAFT对等点使用定义明确的消息进行通信。在最初的论文中有几个定义，但两个基本的是：RequestVote：RAFT用来选举协调更新世界状态的对等体的消息。更多信息请参见第2部分的领导人和领导人选举部分。</p><p>AppendEntries：RAFT使用的一条消息，允许对等方就世界状态的变化进行通信。有关如何复制状态的更多详细信息，请参阅RAFT日志和复制部分。</p><p>RAFT集群的成员被称为对等体，并且可以处于三种状态之一：领导者：协调集群中的其他节点以更新其状态的节点。所有对世界状态的改变都是通过领导者来实现的。</p><p>跟随者：节点正在从引导者那里接收有关如何更新其状态的指令。</p><p>领导者通过采取两种类型的操作来管理对世界状态的更新：提交和应用。一旦网络中的大多数节点确认它们也成功地存储了条目，领导者就会在其日志中提交索引(称为CommitIndex)。当一个节点在日志中向前移动其提交索引时(提交索引只能向前移动，而不能向后移动！)，它会将日志中的条目应用(处理)到提交的位置。提交和应用的想法确保了Leader不会更新其世界状态，直到确保导致该状态的日志是不可能更改的-在下一篇文章的安全部分中提供了关于“不可能更改”的更多信息。</p><p>有了这样的背景，我们可以开始将木筏分解成更具体的部分，试图回答有关协议的问题：</p><p>领导人和领导人选举包括如何协调Raft群集状态的更新：哪台计算机正在协调世界状态的变化，这台计算机如何与RAFT群集中的其他计算机协调，以及计算机协调多长时间？</p><p>RAFT日志和复制涵盖了状态被复制的机制：世界的状态如何传播到集群中的其他计算机？如果其他计算机断开了连接，但现在又恢复了联机，那么它们如何获得有关世界状态的新信息(有人拔下了计算机的以太网电缆)？</p><p>安全涵盖了RAFT如何防范可能破坏世界状态的边缘情况：我们如何确保一台具有旧世界状态的计算机不会意外覆盖另一台计算机的最新世界状态？</p><p>鉴于本文已经相当长，我将上面概述的三个主题保留到本系列的第二部分(可在此处获得)。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.micahlerner.com/2020/05/08/understanding-raft-consensus.html">https://www.micahlerner.com/2020/05/08/understanding-raft-consensus.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/筏子/">#筏子</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/raft/">#raft</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
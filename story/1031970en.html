<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>æ–°å…´çš„JavaScriptæ¨¡å¼ï¼šå¤šä¸ªè¿”å›å€¼</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">æ–°å…´çš„JavaScriptæ¨¡å¼ï¼šå¤šä¸ªè¿”å›å€¼</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-29 18:29:39</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/4d2b600d2de85507ff91c336b79c432a.png"><img src="http://img2.diglog.com/img/2020/10/4d2b600d2de85507ff91c336b79c432a.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In this article, I want to explore an interesting pattern that I am seeing more and more in JavaScript code which allows you to return multiple values from a function.</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³æ¢ç´¢ä¸€ç§æœ‰è¶£çš„æ¨¡å¼ï¼Œæˆ‘è¶Šæ¥è¶Šå¤šåœ°åœ¨JavaScriptä»£ç ä¸­çœ‹åˆ°è¿™ç§æ¨¡å¼ï¼Œå®ƒå…è®¸æ‚¨ä»ä¸€ä¸ªå‡½æ•°è¿”å›å¤šä¸ªå€¼ã€‚</p><p> You probably know already that JavaScript does not support multiple return values natively, so this article will actually explore some ways to â€œsimulateâ€ this behavior.</p><p>æ‚¨å¯èƒ½å·²ç»çŸ¥é“JavaScriptæœ¬èº«å¹¶ä¸æ”¯æŒå¤šä¸ªè¿”å›å€¼ï¼Œå› æ­¤æœ¬æ–‡å®é™…ä¸Šå°†æ¢ç´¢ä¸€äº›â€œæ¨¡æ‹Ÿâ€è¿™ç§è¡Œä¸ºçš„æ–¹æ³•ã€‚</p><p> One of the most famous usages of this pattern I have seen recently is within  React Hooks, but before delving into that, letâ€™s see what I mean with â€œmultiple return valuesâ€ by exploring this concept in other languages.</p><p>æˆ‘æœ€è¿‘çœ‹åˆ°çš„è¿™ç§æ¨¡å¼æœ€è‘—åçš„ç”¨æ³•ä¹‹ä¸€æ˜¯åœ¨Reaction Hooksä¸­ï¼Œä½†æ˜¯åœ¨æ·±å…¥ç ”ç©¶å®ƒä¹‹å‰ï¼Œè®©æˆ‘ä»¬é€šè¿‡åœ¨å…¶ä»–è¯­è¨€ä¸­æ¢ç´¢è¿™ä¸ªæ¦‚å¿µæ¥çœ‹çœ‹æˆ‘æ‰€è¯´çš„â€œå¤šä¸ªè¿”å›å€¼â€æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><p>  Two languages that come to my mind which natively support multiple return values are Lua and Go. Letâ€™s implement a simple  integer division function that returns both the  quotient and the  remainder.</p><p>æˆ‘æƒ³åˆ°çš„ä¸¤ç§æœ¬æœºæ”¯æŒå¤šä¸ªè¿”å›å€¼çš„è¯­è¨€æ˜¯Luaå’ŒGoã€‚è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„æ•´æ•°é™¤æ³•å‡½æ•°ï¼Œå®ƒåŒæ—¶è¿”å›å•†å’Œä½™æ•°ã€‚</p><p>  Letâ€™s start with a simple implementation in Lua. Itâ€™s definitely worth mentioning that  Luaâ€™s official documentation defines multiple return values as  â€œAn unconventional, but quite convenient featureâ€:</p><p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„Luaå®ç°å¼€å§‹ã€‚ç»å¯¹å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLuaçš„å®˜æ–¹æ–‡æ¡£å°†å¤šä¸ªè¿”å›å€¼å®šä¹‰ä¸ºâ€œä¸€ç§éå¸¸è§„ä½†ç›¸å½“æ–¹ä¾¿çš„ç‰¹æ€§â€ï¼š</p><p> function  intDiv  (dividend , divisor )  local quotient  = math . floor (dividend  / divisor )  local remainder  = dividend  % divisor  return quotient , remainder end print ( intDiv ( 10 , 3 ) )  -- 3	1</p><p>å‡½æ•°intDiv(è¢«é™¤æ•°ï¼Œé™¤æ•°)å±€éƒ¨å•†=æ•°å­¦ã€‚ä¸‹é™(è¢«é™¤æ•°/é™¤æ•°)å±€éƒ¨ä½™æ•°=è¢«é™¤æ•°%é™¤æ•°è¿”å›å•†ï¼Œä½™æ•°ç»“æŸæ‰“å°(intDiv(10ï¼Œ3))--3 1ã€‚</p><p>   package main import  &#34;fmt&#34; func  intDiv (dividend , divisor  int )  ( int ,  int )  { quotient  := dividend  / divisor remainder  := dividend  % divisor  return quotient , remainder } func  main ( )  { fmt . Println ( intDiv ( 10 , 3 ) )  // 3 1 }</p><p>Package main import&#34ï¼›fmt&#34ï¼›func intDiv(è¢«é™¤æ•°ï¼Œé™¤æ•°int)(intï¼Œint){å•†ï¼š=è¢«é™¤æ•°/é™¤æ•°ä½™æ•°ï¼š=è¢«é™¤æ•°%é™¤æ•°è¿”å›å•†ï¼Œå‰©ä½™æ•°}func main(){fmtã€‚Println(intDiv(10ï¼Œ3))//3 1}ã€‚</p><p> As you can see in these 2 code snippets, functions can return more than 1 value and this can be very convenient in cases where you logically have produce multiple outputs in a computation.</p><p>æ­£å¦‚æ‚¨åœ¨è¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µä¸­çœ‹åˆ°çš„ï¼Œå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªä»¥ä¸Šçš„å€¼ï¼Œè¿™åœ¨é€»è¾‘ä¸Šä½¿æ‚¨åœ¨ä¸€æ¬¡è®¡ç®—ä¸­äº§ç”Ÿå¤šä¸ªè¾“å‡ºçš„æƒ…å†µä¸‹éå¸¸æ–¹ä¾¿ã€‚</p><p> Note: a more realistic implementation in Go, would take into account errors (e.g. division by 0) and add an extra return value to propagate potential errors. We shouldnâ€™t worry too much about this for the sake of this article, but it is definitely worth mentioning that multiple return values in Go shine when it comes to error propagation and error handling. We will touch a bit more on this later in this article to see how this idea can be applied to JavaScript as well, especially in the context of Async/Await.</p><p>æ³¨æ„ï¼šå›´æ£‹ä¸­æ›´å®é™…çš„å®ç°æ˜¯è€ƒè™‘é”™è¯¯(ä¾‹å¦‚é™¤ä»¥0)ï¼Œå¹¶æ·»åŠ é¢å¤–çš„è¿”å›å€¼æ¥ä¼ æ’­æ½œåœ¨çš„é”™è¯¯ã€‚å‡ºäºæœ¬æ–‡çš„ç›®çš„ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å¤ªæ‹…å¿ƒè¿™ä¸€ç‚¹ï¼Œä½†ç»å¯¹å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒGoä¸­çš„å¤šä¸ªè¿”å›å€¼åœ¨é”™è¯¯ä¼ æ’­å’Œé”™è¯¯å¤„ç†æ–¹é¢å¤§æ”¾å¼‚å½©ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ–‡åé¢æ›´å¤šåœ°è®¨è®ºè¿™ä¸€ç‚¹ï¼Œä»¥äº†è§£å¦‚ä½•å°†æ­¤æ€æƒ³åº”ç”¨äºJavaScriptï¼Œç‰¹åˆ«æ˜¯åœ¨å¼‚æ­¥/ç­‰å¾…çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p>  So, as we said early on, JavaScript does not natively support a syntax to return more than one value from a function. We can workaround this limitation by using  composite values like arrays or objects.</p><p>å› æ­¤ï¼Œæ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€è¯´çš„ï¼ŒJavaScriptæœ¬èº«å¹¶ä¸æ”¯æŒä»å‡½æ•°è¿”å›å¤šä¸ªå€¼çš„è¯­æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å¤åˆå€¼(å¦‚æ•°ç»„æˆ–å¯¹è±¡)æ¥è§£å†³æ­¤é™åˆ¶ã€‚</p><p>   intDiv  =  ( dividend , divisor )  =&gt;  {  const quotient  = Math . floor (dividend  / divisor )  const remainder  = dividend  % divisor  return  [quotient , remainder ] }console . log ( intDiv ( 10 ,  3 ) )  // [ 3, 1 ]</p><p>IntDiv=(è¢«é™¤æ•°ï¼Œé™¤æ•°)=&gtï¼›{å¸¸å•†=æ•°å­¦ã€‚ä¸‹é™(è¢«é™¤æ•°/é™¤æ•°)æ’å®šä½™æ•°=è¢«é™¤æ•°%é™¤æ•°è¿”å›[å•†ï¼Œä½™æ•°]}æ§åˆ¶å°ã€‚Log(intDiv(10ï¼Œ3))//[3ï¼Œ1]ã€‚</p><p> Here we are just printing the result of a division, but letâ€™s assume we want to handle the two return values individually, how do we  reference those?</p><p>è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ‰“å°é™¤æ³•çš„ç»“æœï¼Œä½†æ˜¯è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³è¦åˆ†åˆ«å¤„ç†ä¸¤ä¸ªè¿”å›å€¼ï¼Œæˆ‘ä»¬å¦‚ä½•å¼•ç”¨å®ƒä»¬å‘¢ï¼Ÿ</p><p> Well, the return value is an array so we can simply access the two elements in the array using the indices  0 and  1:</p><p>è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•0å’Œ1ç®€å•åœ°è®¿é—®æ•°ç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ ï¼š</p><p> const result  =  intDiv ( 10 ,  3 ) const quotient  = result [ 0 ] const remainder  = result [ 1 ]console . log (  ` Quotient =   ${quotient } ` )  // Quotient = 3console . log (  ` Remainder =   ${remainder } ` )  // Remainder = 1</p><p>å¸¸é‡ç»“æœ=intDiv(10ï¼Œ3)å¸¸é‡å•†=ç»“æœ[0]å¸¸é‡ä½™æ•°=ç»“æœ[1]æ§åˆ¶å°ã€‚Log(`å•†=${å•†}`)//å•†=3consoleã€‚Log(`å‰©ä½™æ•°=${å‰©ä½™æ•°}`)//å‰©ä½™æ•°=1ã€‚</p><p> This syntax is arguably verbose and definitely not very elegant. Thankfully,  ES2015 array destructuring assignment can help us here:</p><p>è¿™ä¸ªè¯­æ³•å¯ä»¥è¯´æ˜¯å†—é•¿çš„ï¼Œç»å¯¹ä¸æ˜¯å¾ˆä¼˜é›…ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒES2015é˜µåˆ—è§£æ„ä»»åŠ¡å¯ä»¥åœ¨è¿™æ–¹é¢ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ï¼š</p><p> const  [quotient , remainder ]  =  intDiv ( 10 ,  3 )console . log (  ` Quotient =   ${quotient } ` )  // Quotient = 3console . log (  ` Remainder =   ${remainder } ` )  // Remainder = 1</p><p>Const[å•†ï¼Œä½™æ•°]=intDiv(10ï¼Œ3)æ§åˆ¶å°ã€‚Log(`å•†=${å•†}`)//å•†=3consoleã€‚Log(`å‰©ä½™æ•°=${å‰©ä½™æ•°}`)//å‰©ä½™æ•°=1</p><p> This is much nicer to read and we also trimmed away 2 out 3 lines of code, big win!</p><p>è¿™æœ¬ä¹¦è¯»èµ·æ¥å¥½å¤šäº†ï¼Œæˆ‘ä»¬è¿˜åˆ å‡äº†2è¡Œå’Œ3è¡Œä»£ç ï¼Œå¤§èµ¢äº†ï¼</p><p> As nice as it is, this implementation has an important shortcoming: return values are positional, so you need to be careful and respect the order while destructuring.</p><p>å°½ç®¡è¯¥å®ç°å¾ˆå¥½ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé‡è¦çš„ç¼ºç‚¹ï¼šè¿”å›å€¼æ˜¯ä½ç½®çš„ï¼Œå› æ­¤åœ¨è§£æ„æ—¶éœ€è¦å°å¿ƒå¹¶å°Šé‡é¡ºåºã€‚</p><p>   intDiv  =  ( dividend , divisor )  =&gt;  {  const quotient  = Math . floor (dividend  / divisor )  const remainder  = dividend  % divisor  return  { quotient , remainder  } }</p><p>IntDiv=(è¢«é™¤æ•°ï¼Œé™¤æ•°)=&gtï¼›{å¸¸å•†=æ•°å­¦ã€‚ä¸‹é™(è¢«é™¤æ•°/é™¤æ•°)æ’å®šä½™æ•°=è¢«é™¤æ•°%é™¤æ•°è¿”å›{å•†ï¼Œä½™æ•°}}ã€‚</p><p> Note that here we are using another syntactic sugar from ES2015 (Enhanced object literal syntax) that allows us to define objects very concisely. Prior to ES2015, we would have defined the return statement as  {quotient: quotient, remainder: remainder}.</p><p>è¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ES2015(å¢å¼ºçš„å¯¹è±¡æ–‡å­—è¯­æ³•)ä¸­çš„å¦ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒå…è®¸æˆ‘ä»¬éå¸¸ç®€æ´åœ°å®šä¹‰å¯¹è±¡ã€‚åœ¨ES2015ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šå°†è¿”å›è¯­å¥å®šä¹‰ä¸º{Quotientï¼šQutientï¼ŒRembersï¼šRembers}ã€‚</p><p>  const result  =  intDiv ( 10 ,  3 ) const quotient  = result .quotient const remainder  = result .remainderconsole . log (  ` Quotient =   ${quotient } ` )  // Quotient = 3console . log (  ` Remainder =   ${remainder } ` )  // Remainder = 1</p><p>å¸¸é‡ç»“æœ=intDiv(10ï¼Œ3)å¸¸é‡å•†æ•°=ç»“æœå•†å¸¸æ•°ä½™æ•°=ç»“æœ.å‰©ä½™æ§åˆ¶å°ã€‚Log(`å•†=${å•†}`)//å•†=3consoleã€‚Log(`å‰©ä½™æ•°=${å‰©ä½™æ•°}`)//å‰©ä½™æ•°=1ã€‚</p><p> Again, this is a bit too verbose and ES2015 has another fantastic syntactic sugar to make this nicer:</p><p>å†è¯´ä¸€æ¬¡ï¼Œè¿™æœ‰ç‚¹å¤ªå†—é•¿äº†ï¼ŒES2015è¿˜æœ‰å¦ä¸€ä¸ªå¥‡å¦™çš„è¯­æ³•ç³–å¯ä»¥è®©å®ƒå˜å¾—æ›´å¥½ï¼š</p><p> const  { quotient , remainder  }  =  intDiv ( 10 ,  3 )console . log (  ` Quotient =   ${quotient } ` )  // Quotient = 3console . log (  ` Remainder =   ${remainder } ` )  // Remainder = 1</p><p>Const{å•†ï¼Œä½™æ•°}=intDiv(10ï¼Œ3)æ§åˆ¶å°ã€‚Log(`å•†=${å•†}`)//å•†=3consoleã€‚Log(`å‰©ä½™æ•°=${å‰©ä½™æ•°}`)//å‰©ä½™æ•°=1ã€‚</p><p> This syntactic sugar is called  Object Destructuring Assignment. With this approach we are now independent from the position of return values (we can swap the position of  quotient and  remainder without side effects). This syntax also lets you rename the destructured variables, which can very useful to avoid name collisions with other local variables, or just to make variable names shorter or more descriptive as we please. Letâ€™s see how this works:</p><p>è¿™ç§è¯­æ³•ç³–ç§°ä¸ºå¯¹è±¡ææ„èµ‹å€¼(Object Destructing Assignment)ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ç°åœ¨ç‹¬ç«‹äºè¿”å›å€¼çš„ä½ç½®(æˆ‘ä»¬å¯ä»¥äº’æ¢å•†å’Œä½™æ•°çš„ä½ç½®ï¼Œè€Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨)ã€‚æ­¤è¯­æ³•è¿˜å…è®¸æ‚¨é‡å‘½åéç»“æ„åŒ–å˜é‡ï¼Œè¿™å¯¹äºé¿å…ä¸å…¶ä»–å±€éƒ¨å˜é‡çš„åç§°å†²çªéå¸¸æœ‰ç”¨ï¼Œæˆ–è€…åªæ˜¯æ ¹æ®æˆ‘ä»¬çš„éœ€è¦ä½¿å˜é‡åæ›´çŸ­æˆ–æ›´å…·æè¿°æ€§ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><p> const  { remainder : r , quotient : q  }  =  intDiv ( 10 ,  3 )console . log (  ` Quotient =   ${q } ` )  // Quotient = 3console . log (  ` Remainder =   ${r } ` )  // Remainder = 1</p><p>Const{ä½™æ•°ï¼šRï¼Œå•†ï¼šQ}=intDiv(10ï¼Œ3)æ§åˆ¶å°ã€‚Log(`å•†æ•°=${q}`)//å•†æ•°=3consoleã€‚Log(`å‰©ä½™æ•°=${r}`)//å‰©ä½™æ•°=1ã€‚</p><p> Here we are not dependent by values position, but by their names in the returned object. If you are designing an API with multiple return values, itâ€™s up to you to figure out which trade off will be the best to guarantee a proper developer experience.</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ä¾èµ–äºå€¼çš„ä½ç½®ï¼Œè€Œä¾èµ–äºå®ƒä»¬åœ¨è¿”å›å¯¹è±¡ä¸­çš„åç§°ã€‚å¦‚æœæ‚¨æ­£åœ¨è®¾è®¡ä¸€ä¸ªå…·æœ‰å¤šä¸ªè¿”å›å€¼çš„APIï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è‡ªå·±æ‰¾å‡ºå“ªç§æŠ˜è¡·æ–¹æ¡ˆæ˜¯ä¿è¯æ­£ç¡®çš„å¼€å‘ä½“éªŒçš„æœ€ä½³é€‰æ‹©ã€‚</p><p> Ok, now you should have a good idea on how to simulate multiple return values in JavaScript. In the next section we will see some more realistic examples that take advantage of this pattern.</p><p>å¥½äº†ï¼Œç°åœ¨æ‚¨åº”è¯¥å¯¹å¦‚ä½•åœ¨JavaScriptä¸­æ¨¡æ‹Ÿå¤šä¸ªè¿”å›å€¼æœ‰äº†å¾ˆå¥½çš„äº†è§£ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€äº›åˆ©ç”¨æ­¤æ¨¡å¼çš„æ›´å®é™…çš„ç¤ºä¾‹ã€‚</p><p>  As mentioned early on, this technique has been recently popularized by React hooks, so we are gonna explore this use case first. Later we will see other two cases related to Async/Await.</p><p>æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œè¯¥æŠ€æœ¯æœ€è¿‘é€šè¿‡Reactioné’©å­å¾—åˆ°äº†æ™®åŠï¼Œå› æ­¤æˆ‘ä»¬å°†é¦–å…ˆæ¢è®¨è¿™ä¸ªç”¨ä¾‹ã€‚ç¨åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸å¼‚æ­¥/ç­‰å¾…ç›¸å…³çš„å¦å¤–ä¸¤ä¸ªæ¡ˆä¾‹ã€‚</p><p>  React hooks are a  new feature proposal available from  React v16.7.0-alpha that lets you use state and other React features without having to write a class.</p><p>Reacté’©å­æ˜¯React v16.7.0-alphaæä¾›çš„ä¸€ä¸ªæ–°ç‰¹æ€§å»ºè®®ï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»–Reactionç‰¹æ€§ï¼Œè€Œæ— éœ€ç¼–å†™ç±»ã€‚</p><p>  Letâ€™s see how it works with an example, letâ€™s build a CSS color viewer component.</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªCSSé¢œè‰²æŸ¥çœ‹å™¨ç»„ä»¶ã€‚</p><p>    import  { useState  }  from  &#39;react&#39; function  CssColorViewer ( )  {  const  [cssColor , setCssColor ]  =  useState ( &#39;Blue&#39; )  // &lt;-- multiple return values  const  onCssColorChange  =  e  =&gt;  {  setCssColor (e .target .value )  }  return  (  &lt;div &gt;  &lt;input value = {cssColor } onChange = {onCssColorChange }  / &gt;  &lt;div style = { { width :  100 , height :  100 , background : cssColor ,  } }  / &gt;  &lt; /div &gt;  ) }</p><p>ä»&#39ï¼›react&#39ï¼›function CssColorViewer(){const[cssColorï¼ŒsetCssColor]=useState(&#39ï¼›Blue&#39ï¼›)//&ltï¼›--å¤šä¸ªè¿”å›å€¼const onCssColorChange=e=&gtï¼›{setCssColor(e.target.value)}return(&ltï¼›div&gtï¼›&ltï¼›input value={cssColor}onChange={onCssColorChange}/&gtï¼›&ltï¼›Divæ ·å¼={{å®½åº¦ï¼š100ï¼Œé«˜åº¦ï¼š100ï¼ŒèƒŒæ™¯ï¼šcssColorï¼Œ}}/&gtï¼›&ltï¼›/div&gtï¼›)}ã€‚</p><p>  For the sake of this article, we are going to focus only on the  useState call, but if you are curious to understand better how the hook itself works internally I really recommend you read the  official State Hook documentation. I was personally curious to understand how multiple  useState calls could maintain the relationship with the specific state attribute (since thereâ€™s no explicit labelling or reference). If you are curious about that too, well you should read the  Hooks FAQ and  Dan Abramovâ€™s recent article about Hooks.</p><p>å‡ºäºæœ¬æ–‡çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†åªå…³æ³¨useStateè°ƒç”¨ï¼Œä½†æ˜¯å¦‚æœæ‚¨æƒ³æ›´å¥½åœ°äº†è§£é’©å­æœ¬èº«åœ¨å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨é˜…è¯»å®˜æ–¹çš„State Hookæ–‡æ¡£ã€‚æˆ‘ä¸ªäººå¾ˆæƒ³äº†è§£å¤šä¸ªuseStateè°ƒç”¨å¦‚ä½•ç»´æŠ¤ä¸ç‰¹å®šçŠ¶æ€å±æ€§çš„å…³ç³»(å› ä¸ºæ²¡æœ‰æ˜¾å¼çš„æ ‡ç­¾æˆ–å¼•ç”¨)ã€‚å¦‚æœæ‚¨å¯¹æ­¤ä¹Ÿå¾ˆå¥½å¥‡ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥é˜…è¯»Hookså¸¸è§é—®é¢˜è§£ç­”å’ŒDan Abramovæœ€è¿‘å…³äºHooksçš„æ–‡ç« ã€‚</p><p>  The  useState hook acts like a factory: given a default value for the state property ( &#39;Blue&#39; in our case), it will need to instantiate for you 2 things:</p><p>UseStateæŒ‚é’©çš„ä½œç”¨ç±»ä¼¼äºå·¥å‚ï¼šç»™å®šstateå±æ€§çš„é»˜è®¤å€¼(åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºBlue)ï¼Œå®ƒå°†éœ€è¦ä¸ºæ‚¨å®ä¾‹åŒ–ä¸¤ä»¶äº‹ï¼š</p><p>  React developers decided to handle this requirement by simulating multiple return values with an array.</p><p>Reactionå¼€å‘äººå‘˜å†³å®šé€šè¿‡ç”¨ä¸€ä¸ªæ•°ç»„æ¨¡æ‹Ÿå¤šä¸ªè¿”å›å€¼æ¥å¤„ç†è¿™ä¸€éœ€æ±‚ã€‚</p><p> Combining this with array destructuring and proper variable naming, the result is an API that is very nice to read and to use.</p><p>å°†å…¶ä¸æ•°ç»„è§£æ„å’Œé€‚å½“çš„å˜é‡å‘½åç›¸ç»“åˆï¼Œç»“æœæ˜¯ä¸€ä¸ªéå¸¸æ˜“äºé˜…è¯»å’Œä½¿ç”¨çš„APIã€‚</p><p> This React feature is still very experimental and subject to change at the time of writing, but it already sounds like a big deal for the React community to make the code more expressive and reduce the barrier to entry to start adopting React.</p><p>æ­¤ReactionåŠŸèƒ½ä»å¤„äºéå¸¸å®éªŒæ€§çš„é˜¶æ®µï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶å¯èƒ½ä¼šè¿›è¡Œæ›´æ”¹ï¼Œä½†æ˜¯å¯¹äºReactionç¤¾åŒºæ¥è¯´ï¼Œè®©ä»£ç æ›´å…·è¡¨ç°åŠ›å¹¶é™ä½è¿›å…¥é—¨æ§›ä»¥å¼€å§‹é‡‡ç”¨Reactå¬èµ·æ¥å·²ç»æ˜¯ä»¶å¤§äº‹äº†ã€‚</p><p> The point I want to make is that, in this specific case, the multiple return values pattern plays a big role towards this goal.</p><p>æˆ‘æƒ³æŒ‡å‡ºçš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨è¿™ç§ç‰¹å®šæƒ…å†µä¸‹ï¼Œå¤šè¿”å›å€¼æ¨¡å¼åœ¨å®ç°è¿™ä¸€ç›®æ ‡æ–¹é¢å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚</p><p>  Recently I found another great use case for the multiple return values pattern while trying to convert a callback oriented API into an equivalent Async/Await API.</p><p>æœ€è¿‘ï¼Œåœ¨å°è¯•å°†é¢å‘å›è°ƒçš„APIè½¬æ¢ä¸ºç­‰æ•ˆçš„å¼‚æ­¥/ç­‰å¾…APIæ—¶ï¼Œæˆ‘å‘ç°äº†å¤šè¿”å›å€¼æ¨¡å¼çš„å¦ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ã€‚</p><p> To make this part clear, I am going to explain very quickly an approach I use to convert callback based APIs into functions that I can use with Async/Await.</p><p>ä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†éå¸¸å¿«é€Ÿåœ°è§£é‡Šæˆ‘ç”¨æ¥å°†åŸºäºå›è°ƒçš„APIè½¬æ¢ä¸ºå¯ä»¥ä¸å¼‚æ­¥/ç­‰å¾…ä¸€èµ·ä½¿ç”¨çš„å‡½æ•°çš„ä¸€ç§æ–¹æ³•ã€‚</p><p>  function  doSomething ( input , callback )  {  // ... do something asynchronously and  // compute response or error  // When finished, invoke the callback:  callback (error , response ) }</p><p>å‡½æ•°doSomething(è¾“å…¥ï¼Œå›è°ƒ){//...ã€‚å¼‚æ­¥æ‰§è¡ŒæŸäº›æ“ä½œå¹¶//è®¡ç®—å“åº”æˆ–é”™è¯¯//å®Œæˆåï¼Œè°ƒç”¨å›è°ƒï¼šcallback(errorï¼Œresponse)}</p><p> To convert this function into something that can be used with Async/Await we have to essentially   promisify it. There are libraries to do it and, if you are using Node.js you can even use the builtin   util.promisify, but thatâ€™s something we can do ourselves by just creating a  wrapper function like the following one:</p><p>è¦å°†æ­¤å‡½æ•°è½¬æ¢ä¸ºå¯ä¸å¼‚æ­¥/ç­‰å¾…ä¸€èµ·ä½¿ç”¨çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¿…é¡»ä»æœ¬è´¨ä¸Šç®€åŒ–å®ƒã€‚æœ‰ä¸€äº›åº“å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Node.jsï¼Œæ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨å†…ç½®çš„util.promisifyï¼Œä½†è¿™æ˜¯æˆ‘ä»¬è‡ªå·±å¯ä»¥åšçš„äº‹æƒ…ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p> const  doSomethingPromise  =  ( input )  =&gt;  new   ( ( resolve , reject )  =&gt;  {  doSomething (input ,  ( error response )  =&gt;  {  if  (error )  {  return  reject (error )  }  return  resolve (response )  } ) } )</p><p>Const doSomethingPromise=(Input)=&gtï¼›new((Resolveï¼ŒReject)=&gtï¼›{DoSomething(Inputï¼Œ(Error Response)=&gtï¼›{if(Error){Return Reject(Error)}Return Resolve(Response)})})ã€‚</p><p> In short, our wrapper function  doSomethingPromise is immediately returning a  Promise. Inside the body of the promise we are invoking the original  doSomething function with a callback that will be resolving or rejecting the promise based on whether thereâ€™s an  error or not.</p><p>ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬çš„åŒ…è£…å‡½æ•°doSomethingPromiseç«‹å³è¿”å›æ‰¿è¯ºã€‚åœ¨æ‰¿è¯ºçš„ä¸»ä½“å†…ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå›è°ƒè°ƒç”¨åŸå§‹çš„DoSomethingå‡½æ•°ï¼Œè¯¥å›è°ƒå°†æ ¹æ®æ˜¯å¦å­˜åœ¨é”™è¯¯æ¥è§£å†³æˆ–æ‹’ç»æ‰¿è¯ºã€‚</p><p>   Note: this will throw in case of error, so make sure you have it in a  try/catch block to handle the error correctly.</p><p>æ³¨æ„ï¼šè¿™å°†åœ¨å‡ºé”™çš„æƒ…å†µä¸‹æŠ›å‡ºï¼Œå› æ­¤è¯·ç¡®ä¿å°†å…¶æ”¾åœ¨try/catchå—ä¸­ä»¥æ­£ç¡®å¤„ç†é”™è¯¯ã€‚</p><p> If you are curious about  promisifying callback-based functions, I have  an entire article dedicated to this topic.</p><p>å¦‚æœæ‚¨å¯¹ç¼©çŸ­åŸºäºå›è°ƒçš„å‡½æ•°æ„Ÿå…´è¶£ï¼Œæˆ‘æœ‰ä¸€æ•´ç¯‡æ–‡ç« ä¸“é—¨ä»‹ç»è¿™ä¸ªä¸»é¢˜ã€‚</p><p> In my specific use case, I was using a  twitter client library that follows this conventions:</p><p>åœ¨æˆ‘çš„ç‰¹å®šç”¨ä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯éµå¾ªä»¥ä¸‹çº¦å®šçš„Twitterå®¢æˆ·ç«¯åº“ï¼š</p><p> // client is an instance of the twitter clientclient . get ( &#39;statuses/user_timeline&#39; , params ,  function  callback (  error , tweets , response )  {  if  ( !error )  { console . log (tweets )  } } )</p><p>//Clientæ˜¯Twitter ClientClientçš„å®ä¾‹ã€‚GET(&#39ï¼›Status/USER_TIMELINE&#39ï¼›ï¼Œparamsï¼Œå‡½æ•°å›è°ƒ(é”™è¯¯ï¼Œæ¨æ–‡ï¼Œå“åº”){IF(ï¼Error){æ§åˆ¶å°ã€‚æ—¥å¿—(æ¨æ–‡)}})ã€‚</p><p> The important detail here is that the  callback function is a bit unconventional because it receives 3 parameters: a possible  error, a list of  tweets and a  response (which represents the raw HTTP response object). Conventional callback-style APIs will send only two parameters to the callback function: a potential error and some sort of result object.</p><p>è¿™é‡Œé‡è¦çš„ç»†èŠ‚æ˜¯å›è°ƒå‡½æ•°æœ‰ç‚¹éå¸¸è§„ï¼Œå› ä¸ºå®ƒæ¥æ”¶3ä¸ªå‚æ•°ï¼šå¯èƒ½çš„é”™è¯¯ã€tweetåˆ—è¡¨å’Œå“åº”(è¡¨ç¤ºåŸå§‹HTTPå“åº”å¯¹è±¡)ã€‚ä¼ ç»Ÿçš„å›è°ƒé£æ ¼çš„APIå°†åªå‘å›è°ƒå‡½æ•°å‘é€ä¸¤ä¸ªå‚æ•°ï¼šæ½œåœ¨é”™è¯¯å’ŒæŸç§ç»“æœå¯¹è±¡ã€‚</p><p>   const  getUserTimeline  =  ( client , params )  =&gt;  new   ( ( resolve , reject )  =&gt;  { client . get ( &#39;statuses/user_timeline&#39; , params ,  ( error , tweets , response )  =&gt;  {  if  (error )  {  return  reject (error )  }  return  resolve ( [tweets , response ] )  // multiple return values  } )  } )</p><p>Const getUserTimeline=(å®¢æˆ·ç«¯ï¼Œå‚æ•°)=&gtï¼›new((è§£æï¼Œæ‹’ç»)=&gtï¼›{å®¢æˆ·ç«¯ã€‚GET(&#39ï¼›status/user_timeline&#39ï¼›ï¼Œparamsï¼Œ(errorï¼Œtwetsï¼Œresponse)=&gtï¼›{if(Error){return reject(Error)}return Resolve([twetsï¼Œresponse])//å¤šä¸ªè¿”å›å€¼})ã€‚</p><p>  // inside an async function // ... set `client` and `params` const  [tweets , response ]  =  await  getUserTimeline (client , params )</p><p>//åœ¨å¼‚æ­¥å‡½æ•°å†…//...ã€‚è®¾ç½®`client`å’Œ`params`const[twetsï¼Œresponse]=await getUserTimeline(clientï¼Œparams)ã€‚</p><p>  To recap, we can use the multiple return values pattern also with promises to allow them to be resolved to multiple values. This technique gives us a very nice interface especially when used in combination with Async/Await.</p><p>ç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šè¿”å›å€¼æ¨¡å¼ï¼Œå¹¶æ‰¿è¯ºå…è®¸å°†å®ƒä»¬è§£æä¸ºå¤šä¸ªå€¼ã€‚æ­¤æŠ€æœ¯ä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸å¥½çš„ç•Œé¢ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸å¼‚æ­¥/ç­‰å¾…ç»“åˆä½¿ç”¨æ—¶ã€‚</p><p>  Another closely related pattern I am seeing more and more in JavaScript is error propagation and handling  Ã  la Go.</p><p>æˆ‘è¶Šæ¥è¶Šå¤šåœ°åœ¨JavaScriptä¸­çœ‹åˆ°çš„å¦ä¸€ä¸ªå¯†åˆ‡ç›¸å…³çš„æ¨¡å¼æ˜¯é”™è¯¯ä¼ æ’­å’Œå¤„ç†ã€‚</p><p> In Go, when a function can generate an error, this error is not thrown but simply returned by the function. If the function has to return some output and can also generate errors, then the function will have multiple return values (output and error).</p><p>åœ¨GOä¸­ï¼Œå½“å‡½æ•°å¯èƒ½äº§ç”Ÿé”™è¯¯æ—¶ï¼Œè¯¥é”™è¯¯ä¸ä¼šè¢«æŠ›å‡ºï¼Œè€Œåªæ˜¯ç”±å‡½æ•°è¿”å›ã€‚å¦‚æœå‡½æ•°å¿…é¡»è¿”å›ä¸€äº›è¾“å‡ºï¼Œå¹¶ä¸”è¿˜å¯èƒ½ç”Ÿæˆé”™è¯¯ï¼Œåˆ™å‡½æ•°å°†æœ‰å¤šä¸ªè¿”å›å€¼(Outputå’ŒError)ã€‚</p><p> The caller code, should ideally verify if the returned error value is an actual error before proceeding, as in the following Go code example:</p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ–¹ä»£ç åº”åœ¨ç»§ç»­æ“ä½œä¹‹å‰éªŒè¯è¿”å›çš„é”™è¯¯å€¼æ˜¯å¦ä¸ºå®é™…é”™è¯¯ï¼Œå¦‚ä¸‹é¢çš„GOä»£ç ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>  Some JavaScript libraries are starting to promote the same conventions as in Go to report errors, especially when it comes to Async/Await.</p><p>ä¸€äº›JavaScriptåº“å¼€å§‹æ¨å¹¿ä¸Goä¸­ç›¸åŒçš„çº¦å®šæ¥æŠ¥å‘Šé”™è¯¯ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼‚æ­¥/ç­‰å¾…æ–¹é¢ã€‚</p><p>  Letâ€™s rewrite our  getUserTimeline function from our previous example to follow this approach:</p><p>è®©æˆ‘ä»¬é‡å†™å‰é¢ç¤ºä¾‹ä¸­çš„getUserTimelineå‡½æ•°ï¼Œä»¥éµå¾ªæ­¤æ–¹æ³•ï¼š</p><p> const  getUserTimeline  =  ( client , params )  =&gt;  new   ( ( resolve , reject )  =&gt;  { client . get ( &#39;statuses/user_timeline&#39; , params ,  ( error , tweets , response )  =&gt;  {  return  resolve ( [error , tweets , response ] )  // multiple return values  } )  } )</p><p>Const getUserTimeline=(å®¢æˆ·ç«¯ï¼Œå‚æ•°)=&gtï¼›new((è§£æï¼Œæ‹’ç»)=&gtï¼›{å®¢æˆ·ç«¯ã€‚GET(&#39ï¼›status/user_timeline&#39ï¼›ï¼Œparamsï¼Œ(errorï¼Œtwetsï¼Œresponse)=&gtï¼›{Return Resolve([errorï¼Œtwetsï¼Œresponse])//å¤šä¸ªè¿”å›å€¼})})ã€‚</p><p> Notice that we are never telling the promise to  reject, so when we will be using this function with Async/Await we cannot use try/catch to handle errors. This is what we should do instead:</p><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä»æœªå‘Šè¯‰æ‰¿è¯ºæ‹’ç»ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å°†æ­¤å‡½æ•°ä¸å¼‚æ­¥/ç­‰å¾…ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨try/catchæ¥å¤„ç†é”™è¯¯ã€‚æˆ‘ä»¬åº”è¯¥è¿™æ ·åšï¼š</p><p> // inside an async function // ... set `client` and `params` const  [error , tweets , response ]  =  await  getUserTimeline (client , params ) if  (error )  {  // handle error here } // ... do stuff with `tweets` and `response`</p><p>//åœ¨å¼‚æ­¥å‡½æ•°å†…//...ã€‚Set`client`and`params`const[errorï¼Œtwetsï¼Œresponse]=await getUserTimeline(clientï¼Œparams)if(Error){//æ­¤å¤„å¤„ç†é”™è¯¯}//...ã€‚ç”¨`tweets`å’Œ`Response`åšä¸€äº›äº‹æƒ…ã€‚</p><p> I am not sure if I would recommend this pattern or not in JavaScript land. I have a bit of mixed feelings about it. On one side I quite like it, because as happens in Go, it forces you to handle every single error individually, which makes you think a bit more carefully about the best way to handle the specifics of the error. On the other hand, this pattern it still feels a bit forced into JavaScript and people that never saw this pattern in other languages might find it annoying or even hard to understand. Moreover, if you donâ€™t capture and handle an error this will not automatically escalate (as it happens with  throw or rejected promises), so the error will totally be swallowed by the runtime, leading to potential inconsistencies in your app state.Iâ€™ll let you draw your own conclusions on this one! ğŸ˜‡</p><p>æˆ‘ä¸ç¡®å®šæˆ‘æ˜¯å¦ä¼šåœ¨JavaScripté¢†åŸŸæ¨èæ­¤æ¨¡å¼ã€‚æˆ‘å¯¹æ­¤æœ‰ä¸€ç‚¹å¤æ‚çš„æ„Ÿè§‰ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ç›¸å½“å–œæ¬¢å®ƒï¼Œå› ä¸ºæ­£å¦‚Goä¸­å‘ç”Ÿçš„é‚£æ ·ï¼Œå®ƒè¿«ä½¿æ‚¨å•ç‹¬å¤„ç†æ¯ä¸ªé”™è¯¯ï¼Œè¿™ä¼šè®©æ‚¨æ›´ä»”ç»†åœ°è€ƒè™‘å¤„ç†é”™è¯¯ç»†èŠ‚çš„æœ€ä½³æ–¹å¼ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä¸ªæ¨¡å¼ä»ç„¶è®©äººæ„Ÿè§‰æœ‰ç‚¹è¢«å¼ºåŠ åˆ°JavaScriptä¸­ï¼Œé‚£äº›ä»æœªåœ¨å…¶ä»–è¯­è¨€ä¸­çœ‹åˆ°è¿‡è¿™ä¸ªæ¨¡å¼çš„äººå¯èƒ½ä¼šè§‰å¾—å®ƒå¾ˆçƒ¦äººï¼Œç”šè‡³å¾ˆéš¾ç†è§£ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä¸æ•è·å’Œå¤„ç†é”™è¯¯ï¼Œè¿™å°†ä¸ä¼šè‡ªåŠ¨å‡çº§(å°±åƒæŠ›å‡ºæˆ–æ‹’ç»æ‰¿è¯ºæ—¶å‘ç”Ÿçš„é‚£æ ·)ï¼Œå› æ­¤é”™è¯¯å°†å®Œå…¨è¢«è¿è¡Œæ—¶åå™¬ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºçŠ¶æ€ä¸­æ½œåœ¨çš„ä¸ä¸€è‡´ã€‚æˆ‘ä¼šè®©æ‚¨å¯¹æ­¤å¾—å‡ºæ‚¨è‡ªå·±çš„ç»“è®ºï¼ğŸ˜‡ã€‚</p><p>  At this point, I would like to show you few  â€œlittle tricksâ€ that you can use with array destructuring that might come in handy when dealing with multiple return values.</p><p>ç°åœ¨ï¼Œæˆ‘æƒ³å‘æ‚¨å±•ç¤ºä¸€äº›å¯ä»¥ç”¨äºæ•°ç»„è§£æ„çš„â€œå°æŠ€å·§â€ï¼Œå®ƒä»¬åœ¨å¤„ç†å¤šä¸ªè¿”å›å€¼æ—¶å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚</p><p>  Letâ€™s say, for instance, that you have a function  doStuff that returns multiple values using an array and the values are in the array are an  error, a  rawResponse and  result. Letâ€™s say only for the sake of this example that you are not interested in using the  rawResponse, you could easily skip that element while destructuring with the following syntax:</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªå‡½æ•°doStuffï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªæ•°ç»„è¿”å›å¤šä¸ªå€¼ï¼Œæ•°ç»„ä¸­çš„å€¼æ˜¯errorã€rawResponseå’Œresultã€‚å‡è®¾æ‚¨å¯¹ä½¿ç”¨rawResponseä¸æ„Ÿå…´è¶£ï¼Œä»…å‡ºäºæœ¬ä¾‹çš„åŸå› ï¼Œæ‚¨å¯ä»¥åœ¨ä½¿ç”¨ä»¥ä¸‹è¯­æ³•è§£æ„æ—¶è½»æ¾è·³è¿‡è¯¥å…ƒç´ ï¼š</p><p>  Notice the double comma there. That basically means that we are leaving an array index unassigned. You can bend this technique as you please, for example you might decide to destructure only the  result:</p><p>è¯·æ³¨æ„é‚£é‡Œçš„åŒé€—å·ã€‚è¿™åŸºæœ¬ä¸Šæ„å‘³ç€æˆ‘ä»¬æ²¡æœ‰åˆ†é…æ•°ç»„ç´¢å¼•ã€‚æ‚¨å¯ä»¥éšæ„å¼¯æ›²æ­¤æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å†³å®šä»…å˜å½¢ç»“æœï¼š</p><p>    Another interesting trick is that you can use the special  ... syntax to accumulate the  remaining return values under a single variable. Letâ€™s make a dummy example to explore this idea.</p><p>å¦ä¸€ä¸ªæœ‰è¶£çš„æŠŠæˆæ˜¯ä½ å¯ä»¥ç”¨ç‰¹æ®Šçš„..ã€‚è¯­æ³•å°†å‰©ä½™çš„è¿”å›å€¼ç´¯åŠ åˆ°å•ä¸ªå˜é‡ä¸‹ã€‚è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªè™šæ‹Ÿçš„ä¾‹å­æ¥æ¢è®¨è¿™ä¸ªæƒ³æ³•ã€‚</p><p> Letâ€™s say we have a function called  listDogs which is implemented as follows:</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºlistDogçš„å‡½æ•°ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>  The first element of the array is the number of dogs, while every other elements are actual dog names.</p><p>æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç‹—çš„æ•°é‡ï¼Œè€Œå…¶ä»–æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å®é™…çš„ç‹—çš„åå­—ã€‚</p><p> Since the number of returned elements here is variable it might be tricky to use destructuring directly. In these cases we can use this special syntax:</p><p>å› ä¸ºè¿™é‡Œè¿”å›çš„å…ƒç´ æ•°é‡æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ææ„å¯èƒ½å¾ˆæ£˜æ‰‹ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ç‰¹æ®Šè¯­æ³•ï¼š</p><p>  The  ... syntax basically allows you to destructure any remaining element of the array into another array. Of course you can only have a  ... element in the left hand side of the destructuring expression and this has to be the last element in the list.</p><p>é‚£ä¸ª..ã€‚è¯­æ³•åŸºæœ¬ä¸Šå…è®¸æ‚¨å°†æ•°ç»„çš„ä»»ä½•å‰©ä½™å…ƒç´ åˆ†è§£åˆ°å¦ä¸€ä¸ªæ•°ç»„ä¸­ã€‚å½“ç„¶ä½ åªèƒ½æœ‰ä¸€ä¸ª..ã€‚å…ƒç´ ï¼Œå¹¶ä¸”è¯¥å…ƒç´ å¿…é¡»æ˜¯åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><p> My example here is very dummy, but this pattern really shines in some real life use cases, for example when you want to  unpack values from a regular expression match.</p><p>æˆ‘è¿™é‡Œçš„ç¤ºä¾‹éå¸¸è™šå‡ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å¼åœ¨ä¸€äº›çœŸå®çš„ç”¨ä¾‹ä¸­éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œå½“æ‚¨æƒ³è¦ä»æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸­è§£å‹ç¼©å€¼æ—¶ã€‚</p><p>  When React hooks were presented the community was super excited about this new feature, but some performance experts in the Google chromium team ( @bmeurer,  @_developit and  @rossmcilroy) raised their eyebrows and wanted to dig deeper to see if this new approach could lead to serious performance issues in the web.</p><p>å½“Reactioné’©å­å‡ºç°æ—¶ï¼Œç¤¾åŒºå¯¹è¿™ä¸€æ–°åŠŸèƒ½éå¸¸å…´å¥‹ï¼Œä½†Google Chromeå›¢é˜Ÿçš„ä¸€äº›æ€§èƒ½ä¸“å®¶(@bmeurerã€@_developitå’Œ@rossmcilroy)éƒ½è¡¨ç¤ºæƒŠè®¶ï¼Œæƒ³è¦æ›´æ·±å…¥åœ°æŒ–æ˜ï¼Œçœ‹çœ‹è¿™ç§æ–°æ–¹æ³•æ˜¯å¦ä¼šåœ¨ç½‘ç»œä¸Šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</p><p> What came out from their research is an amazing paper that goes by the title  â€œArray destructuring for multi-value returns (in light of React hooks)â€.</p><p>ä»–ä»¬çš„ç ”ç©¶å‘è¡¨äº†ä¸€ç¯‡ä»¤äººæƒŠå¹çš„è®ºæ–‡ï¼Œæ ‡é¢˜æ˜¯â€œå¤šå€¼è¿”å›çš„æ•°ç»„ææ„(æ ¹æ®Reactioné’©å­)â€ã€‚</p><p> I really encourage you to read it to get all the details, but hereâ€™s my attempt at giving you some sort of TLDR;</p><p>æˆ‘çœŸçš„é¼“åŠ±ä½ é˜…è¯»å®ƒï¼Œä»¥è·å¾—æ‰€æœ‰çš„ç»†èŠ‚ï¼Œä½†è¿™é‡Œæˆ‘è¯•å›¾ç»™ä½ ä¸€äº›TLDRï¼›</p><p> In React components the  render() method is called often, so the code there should be optimized enough not to slow things down. Thatâ€™s where you use React hooks.</p><p>åœ¨Reactionç»„ä»¶ä¸­ï¼ŒRender()æ–¹æ³•ç»å¸¸è¢«è°ƒç”¨ï¼Œå› æ­¤é‚£é‡Œçš„ä»£ç åº”è¯¥ä¼˜åŒ–åˆ°ä¸ä¼šå‡æ…¢é€Ÿåº¦ã€‚è¿™å°±æ˜¯ä½ ä½¿ç”¨ååº”é’©å­çš„åœ°æ–¹ã€‚</p><p> Array destructuring is a very generic API, it doesnâ€™t work only with arrays but with every type of  iterable object, so the VM has a lot work to do to figure out how to traverse and destructure the specific object.</p><p>æ•°ç»„è§£æ„æ˜¯ä¸€ç§éå¸¸é€šç”¨çš„APIï¼Œå®ƒä¸ä»…é€‚ç”¨äºæ•°ç»„ï¼Œè€Œä¸”é€‚ç”¨äºæ¯ç§ç±»å‹çš„å¯è¿­ä»£å¯¹è±¡ï¼Œå› æ­¤VMæœ‰å¾ˆå¤šå·¥ä½œè¦åšæ‰èƒ½å¼„æ¸…æ¥šå¦‚ä½•éå†å’Œè§£æç‰¹å®šå¯¹è±¡ã€‚</p><p> Object destructuring might be a more performant alternative, but it would probably offer a less pleasant developer experience.</p><p>å¯¹è±¡ææ„å¯èƒ½æ˜¯ä¸€ç§æ€§èƒ½æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä½†å®ƒå¯èƒ½ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥ä¸å¤ªæ„‰å¿«çš„ä½“éªŒã€‚</p><p> If you use Babel in loose mode, array destructuring will be highly simplified (to direct element access) and it will result in highly optimized code.</p><p>å¦‚æœæ‚¨åœ¨æ¾æ•£æ¨¡å¼ä¸‹ä½¿ç”¨Babelï¼Œåˆ™æ•°ç»„è§£æ„å°†å¾—åˆ°é«˜åº¦ç®€åŒ–(ä»¥ç›´æ¥è®¿é—®å…ƒç´ )ï¼Œå¹¶å°†äº§ç”Ÿé«˜åº¦ä¼˜åŒ–çš„ä»£ç ã€‚</p><p> Thereâ€™s work going on to see if the different phases of the optimizing compiler in the Googleâ€™s V8 engine might be able to optimize destructuring even if you are not using Babel.</p><p>å³ä½¿æ‚¨æ²¡æœ‰ä½¿ç”¨Babelï¼Œä»åœ¨ç»§ç»­ç ”ç©¶Googleçš„V8å¼•æ“ä¸­çš„ä¼˜åŒ–ç¼–è¯‘å™¨çš„ä¸åŒé˜¶æ®µæ˜¯å¦èƒ½å¤Ÿä¼˜åŒ–è§£æ„ã€‚</p><p>  In this article we discussed this new emerging JavaScript pattern that is getting more and more traction, mostly because of its adoption within React.</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†è¿™ç§æ–°å‡ºç°çš„JavaScriptæ¨¡å¼ï¼Œå®ƒè¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºå®ƒåœ¨Reactionä¸­è¢«é‡‡ç”¨ã€‚</p><p> Use cases are not limited to React though and I hope you will find this useful in your daily development life also outside the React land.</p><p>ä¸è¿‡ï¼Œç”¨ä¾‹å¹¶ä¸å±€é™äºRESPECTï¼Œæˆ‘å¸Œæœ›æ‚¨ä¼šå‘ç°è¿™åœ¨æ‚¨çš„æ—¥å¸¸å¼€å‘ç”Ÿæ´»ä¸­ä¹Ÿæ˜¯åœ¨RESPECTé¢†åŸŸä¹‹å¤–æœ‰ç”¨çš„ã€‚</p><p> I am really curious to see what you will come up with, so please keep me in the loop using  twitter or the comments in this article.</p><p>æˆ‘çœŸçš„å¾ˆå¥½å¥‡æ‚¨ä¼šæƒ³å‡ºä»€ä¹ˆï¼Œæ‰€ä»¥è¯·ä½¿ç”¨Twitteræˆ–æœ¬æ–‡ä¸­çš„è¯„è®ºä¸æˆ‘ä¿æŒè”ç³»ã€‚</p><p> For the very curious ones I want to give you one last link, so that you can compare  how multiple return values are implemented in many many other languages.</p><p>å¯¹äºéå¸¸å¥½å¥‡çš„é—®é¢˜ï¼Œæˆ‘æƒ³ç»™æ‚¨æœ€åä¸€ä¸ªé“¾æ¥ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æ¯”è¾ƒå¤šä¸ªè¿”å›å€¼æ˜¯å¦‚ä½•åœ¨è®¸å¤šå…¶ä»–è¯­è¨€ä¸­å®ç°çš„ã€‚</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://loige.co/emerging-javascript-pattern-multiple-return-values">https://loige.co/emerging-javascript-pattern-multiple-return-values</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1031619.html"><img src="http://img2.diglog.com/img/2020/10/thumb_99f2142c0124e0d0a756ac05f1257d4d.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031619.html">Eslisp-ECMAScript/JavaScriptçš„Sè¡¨è¾¾å¼è¯­æ³•ï¼Œå¸¦æœ‰ç±»ä¼¼Lispçš„å®</a></div><span class="my_story_list_date">2020-10-28 5:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031253.html"><img src="http://img2.diglog.com/img/2020/10/thumb_3135a88f5c95852430c2739231b50a1f.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031253.html">æˆ‘ä»¬é€‰æ‹©Javaä½œä¸ºé«˜é¢‘äº¤æ˜“åº”ç”¨ç¨‹åº</a></div><span class="my_story_list_date">2020-10-26 23:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030931.html"><img src="http://img2.diglog.com/img/2020/10/thumb_b6d2f44664370d45e7761c500cdb97d3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030931.html">å¯¹159ä¸ªå›½å®¶çš„17Kåå¼€å‘äººå‘˜çš„è°ƒæŸ¥ï¼šJavaScriptæ˜¯æœ€å—æ¬¢è¿çš„è¯­è¨€ï¼Œæœ‰1240ä¸‡æ´»è·ƒå¼€å‘äººå‘˜ï¼Œç´§éšå…¶åçš„æ˜¯Pythonï¼Œæœ‰900ä¸‡ï¼Œç„¶åæ˜¯Javaï¼Œæœ‰820ä¸‡</a></div><span class="my_story_list_date">2020-10-24 14:8</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030341.html"><img src="http://img2.diglog.com/img/2020/10/thumb_733063352387ad74429fbef6e0502443.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030341.html">Javaç‰ˆæ­£åœ¨æ¬å®¶</a></div><span class="my_story_list_date">2020-10-22 8:50</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¾å›½/">#ç¾å›½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¨‹åº/">#ç¨‹åº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在远程主机上使用Docker容器进行VS代码开发</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在远程主机上使用Docker容器进行VS代码开发</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-12 19:05:30</div><div class="page_narrow text-break page_content"><p>有时，我们希望开发或调试只能在远程功能强大的主机服务器上运行的程序，例如多GPU深度学习培训程序。需要在主机服务器上设置容器化开发环境，并能够通过本地IDE与远程容器化开发环境通信。事实证明，VS代码可以通过其扩展做到这一点。</p><p>在这篇博客文章中，我想谈谈如何在远程主机上设置VS Code Docker开发环境，如何从本地VS Code GUI在远程Docker开发环境中开发和调试程序。</p><p>按照说明设置到远程主机服务器的基于SSH密钥的身份验证，这样我们就不需要每次登录到远程主机服务器时都需要密码。</p><p>具体地说，如果我们没有生成公钥(通常是~/.ssh/id_rsa.pub)，我们可以通过在本地计算机上运行以下命令来生成公钥。</p><p>一旦我们生成了公钥，我们就必须通过运行以下命令将公钥复制到远程主机。我们需要向远程主机服务器输入一次密码。</p><p>一旦设置了基于SSH密钥的身份验证，我们在登录远程主机服务器时就不再需要输入密码。通过SSH连接到远程主机进行验证。</p><p>默认情况下，VS代码远程容器使用本地Docker主机。这意味着我们实际上是在本地计算机上运行容器。要使用远程主机服务器上运行的容器，我们必须将&#34；docker.host&#34；：&#34；your-user-name-on-host@hostname&#34；添加到vs Code settings.json。它通常位于~/.config/Code/User/中。</p><p>我们必须在远程主机上创建一个目录作为VS代码的工作区。我们可以将现有文件从本地主机传输到远程主机，也可以将新的或修改过的文件从远程主机传输到本地主机。</p><p>在本地计算机上，我们使用SCP将文件传输到远程主机。我们还可以使用rsync或任何我们觉得舒服的传输工具。</p><p>为VS代码工作区创建一个目录。在子目录.devtainer.json中创建devtainer.json。使用与下面类似的JSON。</p><p>//有关格式详细信息，请参阅https://aka.ms/vscode-remote/devcontainer.json或此文件的自述文件，网址为：//https://github.com/microsoft/vscode-dev-containers/tree/v0.117.1/containers/docker-existing-dockerfile{&#34；Name&#34；：&#34；vs Code Remote Demo&#34；，//将运行上下文设置为上一级，而不是.devtainer文件夹。&#34；上下文&#34；：&#34；..&#34；，//如果您不使用标准文件名，请更新&#39；dockerFile&#39；属性。&#34；dockerFile&#34；：&#34；../docker/nvidia.Dockerfile&#34；，//在容器创建时设置*default*容器特定的settings.json值。&#34；设置&#34；：{&#34；Terminal al.Integrated.shell.linux&#34；：null}，//添加容器创建时需要安装的扩展ID。&#34；Extensions&#34；：[]，//使用&#39；ForwardPorts&#39；使容器内的端口列表在本地可用。//&#34；forwardPorts&#34；：[]，//创建容器后，取消对要运行命令的下一行的注释-例如安装git。//&#34；postCreateCommand&#34；：&#34；apt-get update&amp；&amp；apt-get install-y git&#34；，//使用基于ptrace的调试器(如C++、Go和Rust)时取消注释//&#34；runArgs&#34；：[&#34；--cap-add=SYS_ptrace&#34；，&#34；-security-opt&#34；，&#34；seccomp=unconfined&#34；]，&#34；rungs&#34；：[&#34；-。]，//取消注释可以从容器内部使用Docker CLI。见https://aka.ms/vscode-remote/samples/docker-in-docker.//&#34；装载&#34；：[&#34；source=/var/run/docker.sock，target=/var/run/docker.sock，type=bind&#34；]，//取消注释以非root用户身份连接。见https://aka.ms/vscode-remote/containers/non-root.//&#34；remoteUser&#34；：&#34；vscode&#34；//使用卷//&#34；image&#34；：&#34；ubuntu-remote-test：0.0.1&#34；，//或&#34；dockerFile&#34；//&#34；workspaceFolder&#34；：：&#34；/workspace&#34；，//&#34；workspace mount&#34；：&#34；source=remote-workspace，target=/workspace，type=volume&#34；//Using/home/leimao/workspace/vs-remote-workspace/是远程主机上的目录/&#34；workspaceFolder&#34；是Docker容器中作为workspace的文件夹//target=/workspace是主机服务器上的工作区将要绑定到的Docker容器中的文件夹&#。：&#34；source=/home/leimao/Workspace/vs-remote-workspace/，目标=/工作区，类型=绑定，一致性=缓存&#34；，}。</p><p>请注意，&#34；dockerFile&#34；必须正确指向我们要使用的本地Dockerfile。我们还为&#34；runArgs&#34；提供了额外的Docker运行参数。</p><p>单击Remote-Containers：在Container中打开文件夹。打开包含我们刚刚配置的.devtainer/devtainer.json的本地工作区。</p><p>第一次运行可能需要一段时间，因为远程主机服务器必须构建Docker映像并启动Docker容器。一旦成功启动，我们将在VS代码中看到以下布局。我们刚刚传输到远程主机工作区的hello.sh文件也显示在VS Code工作区中。</p><p>验证容器是否按预期成功运行。我们可以看到，NVIDIA坞站容器实例已经通过使用NVIDIA-SMI成功运行，并且GPU是GeForce GT 640，这是一个非常旧的GPU，它与我安装在远程主机服务器上的GPU相匹配。</p><p>然后，我们可以在VS代码终端中运行程序或在VS界面中调试程序。</p><p>在远程主机服务器上安装VS代码扩展也可能有助于开发。</p><p>安装后，远程主机服务器上的VS代码扩展将显示在一个独立的面板中。</p><p>开发完成后，不要忘记将文件从远程主机传输回本地计算机。</p><p>VS代码还具有远程SSH扩展。用户将能够使用SSH进入远程主机服务器，并在本地VS代码GUI上修改远程主机服务器上的文件。但是，这些程序可能无法在主机服务器本机系统上运行，并且VS代码及其有用的调试扩展无法在主机服务器上的Docker容器中直接使用。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://leimao.github.io/blog/VS-Code-Development-Remote-Host-Docker/">https://leimao.github.io/blog/VS-Code-Development-Remote-Host-Docker/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/docker/">#docker</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/开发/">#开发</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/远程/">#远程</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1005431.html"><img src="http://img.diglog.com/img/2020/6/thumb_feaca2047d9147330dab31a736b53e81.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005431.html">PANDAcap：简化熊猫执行痕迹捕获的框架</a></div><span class="my_story_list_date">2020-6-6 19:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005179.html"><img src="http://img.diglog.com/img/2020/6/thumb_158b809e8c9eab47a946768c9dab7dd7.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005179.html">码头容器中的MacOS</a></div><span class="my_story_list_date">2020-6-5 2:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1004027.html"><img src="http://img.diglog.com/img/2020/5/thumb_91428812d152f832264435db86484411.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004027.html">Docker扩展与微软的关系，简化跨平台开发人员体验</a></div><span class="my_story_list_date">2020-5-28 11:45</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003130.html"><img src="http://img.diglog.com/img/2020/5/thumb_3276dd30839d0c149b853bc829a9533d.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003130.html">一天中的Docker：通过动手示例从初学者到高级</a></div><span class="my_story_list_date">2020-5-21 22:59</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GenExpr：Codebox操作符</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">GenExpr：Codebox操作符</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-08 20:46:55</div><div class="page_narrow text-break page_content"><p>GenExpr是Gen补丁程序使用的内部语言。它用于以与实现无关的方式描述计算。为了执行实际计算，各种Gen对象(gen、gen~、jit.gen等)将其转换为CPU或GPU的机器码。</p><p>GenExpr语言可以通过expr和codebox对象直接在gen patcher中使用。这些对象分析其中编写的表达式，并自动构建适当数量的入口和出口，以便跳线可以连接到中描述的计算。</p><p>请注意，使用对象框描述计算与使用GenExpr语言在性能方面完全没有区别。在编译Gen Patcher时，所有这些都会合并到单个表示中，因此请使用最方便解决问题的方法。</p><p>GenExpr语言旨在补充GEN补丁程序中的MAX补丁环境。它提供了一种并行文本机制，用于描述与MAX的图形修补范例配合使用的计算。例如，用户定义的GenExpr函数的结构元素与MAX对象的结构元素紧密对应，它们具有入口、出口、参数和属性的概念。此外，GenExpr语言具有关键字in、in1、in2、…。和OUT、OUT1、OUT2、…。具体指的是或中嵌入的GenExpr代码的入口和出口。</p><p>单击解锁补丁程序窗口中的空白区域，然后键入&#34；n&#34；(New)以使用光标创建新的对象框。键入单词&#39；codebox，然后回车。当您按回车键时，将创建一个新的。</p><p>在中输入您的GenExpr语言代码。完成后，单击窗口底部的编译按钮编译并运行您的代码。</p><p>GenExpr语言的语法类似于C和JavaScript对于上面代码框中的简单表达式语句的语法，但是，只有在有多个语句时才需要分号。下面的所有代码框都包含GenExpr中的有效表达式。当存在没有赋值的单个表达式(如最左边的代码框中)时，将隐含对out1的赋值。请注意，它的末尾也没有分号。当只有一条语句时，分号也是隐含的。</p><p>但是，对于多行语句，需要使用分号。左边的没有它们，会产生错误。右边的代码箱是正确的。</p><p>操作符在功能上与相同，但缺少文本编辑器功能，如语法突出显示、多行文本显示和导航。对于简短的单行表达式最有用，省去了将作为一个单元操作的一系列对象拼凑在一起的工作。</p><p>OR通过检测inn和outn关键字来确定其入口和出口的数量，其中N是入口/出口位置。in1和out1分别是最左边的入口和出口。为方便起见，关键字in和out分别等同于in1和out1。</p><p>几乎所有可以在Gen patcher中创建的对象都可以作为函数、全局变量、声明或常量从GenExpr中获得。对象具有的入口数量与函数采用的参数数量相对应。例如，该对象有两个入口并接受两个参数，如下所示：</p><p>GenExpr中声明的参数的行为类似于补丁中的操作符。它们只能在GenExpr代码的主体中声明，其中存在入口和出口(Inn和Outn)，因为它们与补丁程序中的Object Box Gen操作符在同一级别上操作。</p><p>GenExpr中的声明命名一个参数，并在必要时创建它。如果存在与GenExpr中声明的同名的对象框，则GenExpr将简单地为该对象框起别名。如果没有同名的对象框，则会隐式创建一个。在上面的代码中，Offset为对象框偏移量设置了别名，而amp创建了一个新的全局偏移量。</p><p>对于单行和多行注释，GenExpr中的注释都遵循C样式语法。单行注释以//开头，多行注释由/*定义，直到下一个*/。</p><p>正如对象框可以有多个入口和出口一样，GenExpr中的函数可以接受多个参数，并且可以返回多个值。该物体有两个入口和两个出口。类似地，在GenExpr中，函数接受两个参数并返回两个值。在代码中，这看起来像r，θ=cartopol(x，y)。返回多个值的函数可以赋给变量列表。语法遵循以下模式：</p><p>当函数返回多个值但只分配给一个值时，未使用的返回值将被忽略。当忽略返回值时，GenExpr编译器将消除任何不必要的计算。该功能可以扩展到</p><p>在仅使用theta的相反情况下，Gen编译器将剔除r的计算。</p><p>即使对于输出共享中间计算的更复杂的示例，编译器也消除了不必要的操作，因此不会因为没有使用函数的所有返回值而影响性能。</p><p>正如被赋值的左侧变量名列表用逗号分隔一样，右侧表达式列表也可以用逗号分隔：</p><p>如果左侧的值多于右侧的值，则额外的变量名将被赋予零值。</p><p>如果右侧的任何表达式返回一个以上的值，则这些附加值将被忽略，除非该表达式是右侧列表中的最后一项。这很难描述，但应该从以下示例中清楚地看到：</p><p>只有最后一个表达式可以返回多个值。Cartopol的第二个返回值被丢弃，因为它不是右侧的最后一个表达式：</p><p>当表达式用作函数调用的参数时，同样的原则也适用。在此示例中，poltocar的两个输出值连接到min的两个输入值：</p><p>在GenExpr中定义新函数的方式与其他熟悉的编程语言大致相同。由于GenExpr中没有类型，因此仅使用名称指定函数参数。具有等效补丁程序表示的基本函数定义如下所示。请注意，函数必须在所有语句之前声明：</p><p>虽然可以很容易地将GenExpr中的简单函数修补在一起，但更复杂的函数(如上面的柱面定义)开始变得笨拙，特别是当该函数在GenExpr代码中被多次使用时。这就是文本表示法的优点。</p><p>在生成补丁程序中，某些对象具有像抖动生成操作符这样的属性，作为边界模式属性。在GenExpr中，函数参数对应于操作符入口，函数返回值对应于出口。属性是使用键/值样式参数设置的。例如：</p><p>将使用具有镜像边界行为的运算符版本。设置该属性时，键为BORDMODE，值为&#34；MIRROR&#34；。由于Gen Patcher中不存在最大消息数的概念，因此内置操作符的属性不能动态修改。这在GenExpr中同样适用。此类属性值必须为常量。如果属性采用数值，则不能从变量将其赋值。</p><p>还可以为函数定义定义属性。在这里，属性可以是动态的，其行为方式类似于setparam与子打补丁程序参数的交互方式。属性可以通过以下两种方式之一定义。使用一种语法，在函数签名中定义属性并给予默认值。另一种方法是在函数中声明Param对象，将参数名称作为属性添加到函数中。</p><p>使用第一种方法，只能定义属性的默认值。使用第二种方法，可以设置其他属性，例如属性的最小值和最大值。通过声明Param对象，您可以更好地控制属性的操作方式。</p><p>与内置运算符一样，可以使用键值语法设置函数定义的属性。在上面的示例中，属性的值为0.5，而属性的值为in1*2，这是一个不是常量但有效的表达式，因为它是一个函数定义。但是，请注意，该属性定义了最小值和最大值，因此分配给它的任何表达式都将限制在该范围内。</p><p>从结构上讲，GenExpr函数等同于Gen补丁程序。两者都可以有输入、输出和命名参数。在GenExpr中，另存为抽象(.gendsp或.genjit文件)的Gen补丁程序可以用作函数。当GenExpr解释器遇到它找不到其定义的函数时，它将使用当前的最大搜索路径来查找具有该函数名称的Gen抽象。</p><p>上面的代码中没有定义函数myAbstraction，并且它不是内置运算符。作为定义myAbstraction的最后一次尝试，GenExpr解释器将在gen~的情况下查找myAbstraction.gendsp，或者在Jitter Gen对象的情况下查找myAbstraction.genjit。</p><p>使用抽象作为GenExpr函数有一些注意事项。GenExpr函数名必须是有效的标识符。GenExpr中的标识符是以字母或下划线([a-z]、[A-Z]、_)开头的字符序列，后跟任意数量的字母、数字或下划线([a-z]、[A-Z]、[0-9]、_)。对于MAX SUBTACKER来说，它们中有其他宪章，如&#39；~&#39；或&#39；.&#39；并不少见。当涉及到GenExpr函数名称时，这些字符是无效的，因此如果在Gen抽象的名称中使用它们，则它们不能用作GenExpr函数。</p><p>在GenExpr中定义运算符时，可以方便地将它们保存在单独的文件中，这样就可以频繁地重用它们，而不必经常在代码框中重新键入运算符定义。要包括在单独文件中定义的GenExpr运算符，请使用运算符。操作符采用.genexpr文件的名称并加载其定义。以下都是需要.genexpr文件的有效方式：</p><p>在上面的代码中，调用REQUEST触发代码箱使用MAX搜索路径查找文件&#39；mylib.genexpr&#39；。必需的.genexpr文件也可能需要其他文件。如果一个文件需要多次，则只会加载一次。</p><p>可以使用内置的MAX文本编辑器创建和编辑GenExpr文件。如果gen对象中需要GenExpr文件，并且对该文件进行了编辑和保存，则gen对象将通过文件保护检测到它所依赖的文件已更改，并重新编译自身以反映新的更改。</p><p>带、和结构的GenExpr支持分支和循环。可以使用任意次数将语句链接在一起，以便根据不同的条件执行不同的代码块。例如：</p><p>if(in&gt；0.5){out=cos(in*pi)；}Else if(in&gt；0.25){out=sin(in*pi)；}Else{out=cos(in*pi)*sin(in*pi)；}。</p><p>请注意，在Jitter gen对象中，具有向量值条件的语句将只使用向量的第一个元素来确定是否应该测试代码块。</p><p>i=0；val=0；而(i&lt；10){i+=1；//累计val+=i；}out=val；</p><p>在许多其他语言中，循环也与此类似，尽管GenExpr中没有用于递增循环计数器的++运算符。相反，可以使用+=：</p><p>val=0；for(i=0；i&lt；10；i+=1){//累计val+=i；}out=val；</p><p>因为GenExpr是动态编译的，所以很容易犯编程错误并创建无限循环。所有的Gen对象都有防止无限循环的保护，所以虽然无限循环可能会减慢速度，但它不会导致Max卡住和冻结。</p><p>另外，请注意，在许多情况下，GenExpr中的值都是浮点甚至循环计数器。浮点数不能精确地表示每个数字，有时可能需要一些模糊因子来说明这一点。例如，此循环：</p><p>val=0；for(i=0；i&lt；=1；i+=0.05){//累计val+=i；}out=val；</p><p>由于浮点精度，尽管使用了&lt；=运算符，但可能不会达到1.0。取而代之的是，写一些类似这样的东西：</p><p>val=0；for(i=0；i&lt；=1.04；i+=0.05){//累计val+=i；}out=val；</p><p>通过循环构造，GenExpr支持和语句。使循环提前退出，同时使循环在未完成当前迭代的情况下开始下一次迭代。</p><p>val=0；for(i=0；i&lt；10；i+=1){if(val&gt；20){//保释提前中断；}val+=i；}out=val；</p><p>val=0；for(i=0；i&lt；10；i+=1){if(val==6){//跳过迭代继续；}val+=i；}out=val；</p><p>抖动生成对象根据对象同时采用抖动矩阵(jit.Matrix)和/或纹理(jit.gl.Texture)。在Gen patcher中，操作符既表示输入矩阵或纹理的整体，也表示正在处理的输入的当前单元格。在大多数情况下，运算符表示当前正在处理的单元格。它表示整个输入的唯一时间是使用AND运算符。只有运算符可以连接到和的左侧输入，这两个输入用于从输入中的任意位置获取数据。在GenExpr中使用和时也是如此。</p><p>编译GenExpr代码时，会验证和的输入，以确保它们的第一个参数实际上是Gen补丁程序输入，如果不是这样，则会抛出错误。验证过程甚至可以通过函数调用SO跟踪输入，并且可以在函数内使用而不会出现问题。</p><p>抖动生成补丁程序(、、和)中的坐标运算是特例运算符，它是运算符和全局变量的混合运算符。使用这些运算符有两种同等有效的语法：</p><p>在上面的第一个实例中，在语法上是全局变量，而在语法上是函数调用。所有坐标运算符都遵循此约定。</p><p>GenExpr是一种无类型语言。根据GEN域和GEN对象的输入，编译器自动为变量指定类型。默认情况下，GEN变量也是局部到作用域的，因此不必像在JavaScript中那样使用var这样的关键字来声明它们。请注意，GenExpr没有数组表示法[index]，因为当前没有数组结构的概念。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://docs.cycling74.com/max8/vignettes/gen_genexpr">https://docs.cycling74.com/max8/vignettes/gen_genexpr</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/codebox/">#codebox</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
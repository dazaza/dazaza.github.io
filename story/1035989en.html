<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ä¸€ä¸ªæœˆçš„åœ°å½¢A Month of Terraform</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">A Month of Terraform<br/>ä¸€ä¸ªæœˆçš„åœ°å½¢</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-23 05:14:26</div><div class="page_narrow text-break page_content"><p>I took Heroku for granted, and a month into setting up my own infra, I now know how much it bought me.</p><p>æˆ‘å°†Herokuè§†ä¸ºç†æ‰€å½“ç„¶ï¼Œå¹¶èŠ±äº†ä¸€ä¸ªæœˆçš„æ—¶é—´å»ºç«‹è‡ªå·±çš„åŸºç¡€è®¾æ–½ï¼Œç°åœ¨æˆ‘çŸ¥é“å®ƒä¸ºæˆ‘å¸¦æ¥äº†å¤šå°‘æ”¶ç›Šã€‚</p><p> A lot of my past work has been infrastructure-adjacent.I often find myself filling in the Build &amp; Integration role - the person that gets continuous integration off the ground and keeps it actually continuing rather than falling flat on its face.But often Iâ€™ve just been building one of a constellation of services, so the core infrastructure was already there,or Iâ€™ve been targeting something like Heroku, where you basically pick your poison, git push, and bobâ€™s your uncle.</p><p> æˆ‘è¿‡å»çš„è®¸å¤šå·¥ä½œéƒ½æ˜¯ä¸åŸºç¡€è®¾æ–½ç›¸é‚»çš„ã€‚æˆ‘ç»å¸¸å‘ç°è‡ªå·±åœ¨Buildï¼†Integrationè§’è‰²ä¸­å·¥ä½œ-è¿™ä¸ªäººè¦ä¸æ–­åœ°è¿›è¡Œæ•´åˆå¹¶ä¿æŒå…¶æŒç»­è¿›è¡Œï¼Œè€Œä¸æ˜¯ä¸¢åœ¨ä¸€è¾¹ã€‚æˆ‘åˆšåˆšå»ºç«‹äº†ä¸€ç»„æœåŠ¡ï¼Œæ‰€ä»¥æ ¸å¿ƒåŸºç¡€ç»“æ„å·²ç»åœ¨é‚£é‡Œï¼Œæˆ–è€…æˆ‘ä¸€ç›´åœ¨ç„å‡†Herokuä¹‹ç±»çš„ä¸œè¥¿ï¼Œæ‚¨åŸºæœ¬ä¸Šå¯ä»¥ä»ä¸­é€‰æ‹©æ¯’è¯ï¼Œgit pushå’Œbobçš„å”å”ã€‚</p><p> This time, Iâ€™m putting the pieces together using the AWS toolkit.And to smoosh them all together, Iâ€™m using Terraform,because heck if Iâ€™m going to be hand-writing YAML or JSON and praying itâ€™s formatted right.Plus thereâ€™s more I want to orchestrate than just AWS, like, say, GitLab.</p><p> è¿™æ¬¡ï¼Œæˆ‘å°†ä½¿ç”¨AWSå·¥å…·åŒ…å°†å„ä¸ªéƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ã€‚ä¸ºäº†å°†æ‰€æœ‰éƒ¨åˆ†éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œæˆ‘ä½¿ç”¨äº†Terraformï¼Œå› ä¸ºå¦‚æœæˆ‘è¦æ‰‹å†™YAMLæˆ–JSONå¹¶ç¥ˆç¥·å…¶æ ¼å¼æ­£ç¡®ï¼Œé‚£ä¼šéå¸¸éº»çƒ¦ã€‚é™¤äº†GWSä¹‹å¤–ï¼Œæˆ‘è¿˜éœ€è¦æ•´ç†æ›´å¤šçš„AWSã€‚</p><p> I donâ€™t wanna talk about AWS just now.It reminds me of learning Foundation &amp; Cocoa - you look at one piece, and it can do so much, and then you gotta put all those individually deep &amp; complex pieces together to do more stuff.I figure if I put in the hours reading docs, learning whatâ€™s all there, and getting stabbed by the pointy bits, itâ€™ll probably all come out fine in the end.</p><p> æˆ‘ç°åœ¨ä¸æƒ³è°ˆè®ºAWSï¼Œå®ƒä½¿æˆ‘æƒ³èµ·äº†Foundationå’ŒCocoaçš„å­¦ä¹ -æ‚¨å¯ä»¥çœ‹ä¸€çœ‹ï¼Œå®ƒå¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œç„¶åæ‚¨å¿…é¡»å°†æ‰€æœ‰è¿™äº›å•ç‹¬çš„ï¼Œå¤æ‚è€Œåˆå¤æ‚çš„éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œä»¥åšæ›´å¤šçš„äº‹æƒ…æˆ‘è®¤ä¸ºï¼Œå¦‚æœæˆ‘èŠ±è´¹å¤§é‡æ—¶é—´é˜…è¯»æ–‡æ¡£ï¼Œå­¦ä¹ å…¶ä¸­çš„å…¨éƒ¨å†…å®¹å¹¶è¢«å°–å°–çš„ä¸œè¥¿åˆºä¼¤ï¼Œé‚£ä¹ˆæœ€ç»ˆä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚</p><p>   When it doesnâ€™t, it generally fails in a useful way, and then I can fix it and try again.</p><p>   å¦‚æœæ²¡æœ‰ï¼Œé€šå¸¸å®ƒä¼šä»¥ä¸€ç§æœ‰ç”¨çš„æ–¹å¼å¤±è´¥ï¼Œç„¶åæˆ‘å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®å¤ï¼Œç„¶åé‡è¯•ã€‚</p><p>    Terraform: Up &amp; Running is excellent, and Terragrunt makes it even easier. Huge thanks to their team for providing the  duct tape we need. ğŸ™Œ</p><p>    Terraformï¼šâ€œå¯åŠ¨å’Œè¿è¡Œâ€éå¸¸å‡ºè‰²ï¼ŒTerragruntä½¿å…¶æ›´åŠ å®¹æ˜“ã€‚éå¸¸æ„Ÿè°¢ä»–ä»¬çš„å›¢é˜Ÿæä¾›äº†æˆ‘ä»¬æ‰€éœ€çš„èƒ¶å¸¦ã€‚ ğŸ™Œ</p><p>  terraform-lsp is supposed to provide autocomplete, but it mostly doesnâ€™t, in my experience. First it flipped its lid that I dared to have a repo with multiple root modules in it, so I just aimed VS Code at the folder with a single root module. Then the language server says itâ€™s all hunky dory AFAICT, and yet it autocompletes nothing beyond bare language syntax. As a result, Iâ€™m manually referencing docs and writing stuff down and wasting tons of time that tools like autocomplete and integrated linting ought to be saving me from.</p><p>  æ ¹æ®æˆ‘çš„ç»éªŒï¼Œterraform-lspåº”è¯¥æä¾›è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ä¸æä¾›ã€‚é¦–å…ˆï¼Œå®ƒæ‰“å¼€ç›–å­ï¼Œæˆ‘æ•¢äºåœ¨å…¶ä¸­åŒ…å«å¤šä¸ªæ ¹æ¨¡å—çš„ä»“åº“ï¼Œæ‰€ä»¥æˆ‘åªæ˜¯å°†VS Codeå¯¹å‡†äº†å…·æœ‰å•ä¸ªæ ¹æ¨¡å—çš„æ–‡ä»¶å¤¹ã€‚ç„¶åï¼Œè¯­è¨€æœåŠ¡å™¨è¯´è¿™éƒ½æ˜¯ç¬¨æ‹™çš„AFAICTï¼Œä½†æ˜¯é™¤äº†è£¸è¯­è¨€è¯­æ³•å¤–ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨å®Œæˆä»»ä½•æ“ä½œã€‚ç»“æœï¼Œæˆ‘è¦æ‰‹åŠ¨å¼•ç”¨æ–‡æ¡£å¹¶å†™ä¸‹æ¥çš„ä¸œè¥¿ï¼Œæµªè´¹å¤§é‡æ—¶é—´ï¼Œå› ä¸ºè‡ªåŠ¨å®Œæˆå’Œé›†æˆæ£‰ç»’ä¹‹ç±»çš„å·¥å…·åº”è¯¥å¯ä»¥ä½¿æˆ‘å…äºé­å—æŸå¤±ã€‚</p><p> State files contain secrets in plaintext. (You might enjoy the  six-year-old GitHub issue about the plaintext secrets problem.) You can mark outputs as secret, so they donâ€™t get printed at the end of applying your infra spec, but run  terraform show instead of  terraform apply, and there they are, staring back at you. At least you can lock down and encrypt the S3 bucket holding the state. Pulumiâ€™s secrets management is far more satisfying. But Pulumi is even more cutting-edge than v0.whatever Terraform, and I expect Hashicorp to keep TF running for a good while, while Iâ€™m not so confident in Pulumi, so Iâ€™m using TF. (Hashicorp of course would recommend  Vault.)</p><p>çŠ¶æ€æ–‡ä»¶åŒ…å«çº¯æ–‡æœ¬æœºå¯†ã€‚ ï¼ˆæ‚¨å¯èƒ½ä¼šå–œæ¬¢æœ‰å…³çº¯æ–‡æœ¬ç§˜å¯†é—®é¢˜çš„å·²æœ‰å…­å¹´å†å²çš„GitHubé—®é¢˜ã€‚ï¼‰æ‚¨å¯ä»¥å°†è¾“å‡ºæ ‡è®°ä¸ºç§˜å¯†ï¼Œå› æ­¤åœ¨åº”ç”¨åŸºç¡€è®¾æ–½è§„èŒƒæ—¶ä¸ä¼šè¾“å‡ºå®ƒä»¬ï¼Œè€Œæ˜¯è¿è¡Œterraform showè€Œä¸æ˜¯terraform apply ï¼Œå°±åœ¨é‚£é‡Œï¼Œå‡è§†ç€ä½ ã€‚è‡³å°‘æ‚¨å¯ä»¥é”å®šå¹¶åŠ å¯†ä¿å­˜çŠ¶æ€çš„S3å­˜å‚¨æ¡¶ã€‚ Pulumiçš„ç§˜å¯†ç®¡ç†è¦ä»¤äººæ»¡æ„å¾—å¤šã€‚ä½†æ˜¯Pulumiæ¯”v0è¿˜è¦å…ˆè¿›ã€‚æ— è®ºTerraformæ˜¯ä»€ä¹ˆï¼Œæˆ‘éƒ½å¸Œæœ›Hashicorpèƒ½å¤Ÿä½¿TFè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œè€Œæˆ‘å¯¹Pulumiä¸å¤ªè‡ªä¿¡ï¼Œæ‰€ä»¥æˆ‘æ­£åœ¨ä½¿ç”¨TFã€‚ ï¼ˆHashicorpå½“ç„¶ä¼šæ¨èä¿é™©æŸœã€‚ï¼‰</p><p> Annoying asymmetries in the language about how you * declare and reference things in slightly variant ways - I trip over these over and over as a beginner: You declare locals in a  locals block, but you reference them as  local.thing, not  locals.thing.</p><p> å…³äºæ‚¨å¦‚ä½•ä»¥ç¨å¾®ä¸åŒçš„æ–¹å¼å£°æ˜å’Œå¼•ç”¨äº‹ç‰©çš„è¯­è¨€ä¸­ä»¤äººè®¨åŒçš„ä¸å¯¹ç§°æ€§-ä½œä¸ºåˆå­¦è€…ï¼Œæˆ‘ä¸€éåˆä¸€éåœ°éå†è¿™äº›ä¸å¯¹ç§°æ€§ï¼šæ‚¨åœ¨localså—ä¸­å£°æ˜äº†localsï¼Œä½†æ˜¯å°†å®ƒä»¬å¼•ç”¨ä¸ºlocal.thingï¼Œè€Œä¸æ˜¯locals.thing ã€‚</p><p>  You declare data sources as  data &#34;provider_thingy&#34; &#34;my_name_for_this_data&#34;, and then you have to access it as  data.provider_thingy.my_name_for_this_data. (This is actually pretty darn consistent, at least. Though, like, why the quotes around the provider thingy?)</p><p>  æ‚¨å°†æ•°æ®æºå£°æ˜ä¸ºæ•°æ®â€œ provider_thingyâ€â€œ my_name_for_this_dataâ€ï¼Œç„¶åå¿…é¡»å°†å…¶ä½œä¸ºdata.provider_thingy.my_name_for_this_dataè¿›è¡Œè®¿é—®ã€‚ ï¼ˆè‡³å°‘è¿™å®é™…ä¸Šæ˜¯ç›¸å½“ä¸€è‡´çš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆæä¾›å•†å‘¨å›´çš„å¼•å·å¾ˆéº»çƒ¦ï¼Ÿï¼‰</p><p> You declare resources as  resource &#34;provider_thingy&#34; &#34;my_name&#34;. But you do NOT reference them as  resource.provider_thingy.my_name. Nope, you just reference them as bare  provider_thingy.my_name.</p><p> æ‚¨å°†èµ„æºå£°æ˜ä¸ºèµ„æºâ€œ provider_thingyâ€â€œ my_nameâ€ã€‚ä½†æ˜¯æ‚¨ä¸èƒ½å°†å®ƒä»¬å¼•ç”¨ä¸ºresource.provider_thingy.my_nameã€‚ä¸ï¼Œæ‚¨åªéœ€å°†å®ƒä»¬å¼•ç”¨ä¸ºè£¸provider_thingy.my_nameã€‚</p><p> For that matter, there are other oddities as well. Pieces of syntax that seem like they should be orthogonal just arenâ€™t.  for_each stands out here: You can generate multiple resources by just dropping a  for_each in the block:  resource &#34;provider_thing&#34; &#34;mine&#34; {} becomes  resource &#34;provider_thing&#34; &#34;mine&#34; { for_each = of_these }</p><p> å°±æ­¤è€Œè¨€ï¼Œè¿˜æœ‰å…¶ä»–å¥‡æ€ªä¹‹å¤„ã€‚çœ‹èµ·æ¥å¥½åƒåº”è¯¥æ­£äº¤çš„è¯­æ³•ä¸æ˜¯ã€‚ for_eachåœ¨è¿™é‡Œè„±é¢–è€Œå‡ºï¼šæ‚¨å¯ä»¥é€šè¿‡åœ¨å—ä¸­æ”¾ç½®for_eachæ¥ç”Ÿæˆå¤šä¸ªèµ„æºï¼šèµ„æºâ€œ provider_thingâ€â€œ mineâ€ {}å˜ä¸ºèµ„æºâ€œ provider_thingâ€â€œ mineâ€ {for_each = of_these}</p><p> But nested  argument blocks require conversion from like  setting { namespace = &#34;blah&#34; } to  dynamic &#34;setting&#34; { for_each = thingy; content { namespace = &#34;blah&#34; }}. Have fun looking that up a few times.</p><p> ä½†æ˜¯åµŒå¥—çš„å‚æ•°å—éœ€è¦ä»ç±»ä¼¼çš„è®¾ç½®{namespace =â€œ blahâ€}è½¬æ¢ä¸ºåŠ¨æ€çš„â€œ settingâ€ {for_each = somethingy;å†…å®¹{åç§°ç©ºé—´=â€œ blahâ€}}ã€‚å¼€å¿ƒåœ°çœ‹äº†å‡ æ¬¡ã€‚</p><p> And you canâ€™t even use the  for_each trick with module imports. It just isnâ€™t supported. Sorry, sucks to be you.</p><p> è€Œä¸”ï¼Œç”šè‡³æ— æ³•åœ¨æ¨¡å—å¯¼å…¥ä¸­ä½¿ç”¨for_eachæŠ€å·§ã€‚åªæ˜¯ä¸æ”¯æŒã€‚æŠ±æ­‰ï¼Œå¾ˆé—æ†¾æˆä¸ºä½ ã€‚</p><p> Annoying gaps in the docs: Required vs optional parameters are not very clearly called out and are not at all segregated. So you get to play the game of â€œwhat is the minimal skeleton to declare this resourceâ€. Actually running it a few times to see what you screwed up takes longer than just looking at the docs and puzzling it out, due to the lengthy iteration times in infra-land (see below).</p><p>æ–‡æ¡£ä¸­ä»¤äººè®¨åŒçš„å·®è·ï¼šå¿…éœ€å‚æ•°å’Œå¯é€‰å‚æ•°çš„åŒºåˆ«ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¹Ÿæ ¹æœ¬æ²¡æœ‰éš”ç¦»ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ç©â€œå£°æ˜æ­¤èµ„æºçš„æœ€å°æ¡†æ¶æ˜¯ä»€ä¹ˆâ€çš„æ¸¸æˆã€‚å®é™…ä¸Šï¼Œè¦è¿è¡Œå‡ æ¬¡ä»¥æŸ¥çœ‹æ‰€è¦è§£å†³çš„é—®é¢˜è¦æ¯”ä»…ä»…æŸ¥çœ‹æ–‡æ¡£å’Œä½¿ä¹‹å›°æƒ‘çš„æ—¶é—´è¦é•¿ï¼Œè¿™æ˜¯å› ä¸ºåœ¨çº¢å¤–ä¸­çš„è¿­ä»£æ—¶é—´å¾ˆé•¿ï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚</p><p> Types are not shown in the docs!!! All the outputs and arguments are typed. You have to declare those types. Itâ€™s right there in the code. But the docs donâ€™t say what any of the types are. You just hit a type error at runtime. Fun fun!</p><p> ç±»å‹æœªæ˜¾ç¤ºåœ¨æ–‡æ¡£ä¸­ï¼ï¼ï¼è¾“å…¥æ‰€æœ‰è¾“å‡ºå’Œå‚æ•°ã€‚æ‚¨å¿…é¡»å£°æ˜è¿™äº›ç±»å‹ã€‚åœ¨ä»£ç ä¸­ã€‚ä½†æ˜¯æ–‡æ¡£æ²¡æœ‰è¯´æ˜ä»»ä½•ç±»å‹ã€‚æ‚¨åªæ˜¯åœ¨è¿è¡Œæ—¶é‡åˆ°ç±»å‹é”™è¯¯ã€‚å¥½ç©å¥½ç©ï¼</p><p> The HCL language is docâ€™d under the CLI tool, not in and of itself. It was really hard to actually find the docs since my first thought when I have syntax questions isnâ€™t â€œletâ€™s look at the docs for the tool.â€ Itâ€™d be like pulling up the manpage for GCC (carefully draw your triangle of art first) when you have a question about C syntax.</p><p> HCLè¯­è¨€æ˜¯é€šè¿‡CLIå·¥å…·è®°å½•çš„ï¼Œè€Œä¸æ˜¯å…¶æœ¬èº«ã€‚å®é™…ä¸Šå¾ˆéš¾æ‰¾åˆ°æ–‡æ¡£ï¼Œå› ä¸ºå½“æˆ‘é‡åˆ°è¯­æ³•é—®é¢˜æ—¶ï¼Œé¦–å…ˆæƒ³åˆ°çš„ä¸æ˜¯â€œè®©æˆ‘ä»¬çœ‹çœ‹è¯¥å·¥å…·çš„æ–‡æ¡£â€ã€‚å½“æ‚¨å¯¹Cè¯­æ³•æœ‰ç–‘é—®æ—¶ï¼Œå°±å¥½åƒè¦æ‹‰èµ·GCCçš„æ‰‹å†Œé¡µï¼ˆå…ˆä»”ç»†ç”»å‡ºä¸‰è§’å½¢ï¼‰ã€‚</p><p> Annoying asymmetries in the AWS provider: Missing links: Sometimes you get into a â€œcanâ€™t get there from hereâ€ situation. Like trying to find the zone ID for an Elastic Beanstalk environmentâ€™s CNAME so you can aim a Route 53 alias at it. (Hint, you need a completely different resource, the  aws_elastic_beanstalk_hosted_zone.)</p><p> AWSæä¾›ç¨‹åºä¸­ä»¤äººè®¨åŒçš„ä¸å¯¹ç§°æ€§ï¼šç¼ºå°‘é“¾æ¥ï¼šæœ‰æ—¶æ‚¨ä¼šé‡åˆ°â€œæ— æ³•ä»æ­¤å¤„åˆ°è¾¾â€çš„æƒ…å†µã€‚å°±åƒå°è¯•ä¸ºElastic Beanstalkç¯å¢ƒçš„CNAMEæŸ¥æ‰¾åŒºåŸŸIDä¸€æ ·ï¼Œæ‚¨å¯ä»¥å°†Route 53åˆ«åä½œä¸ºç›®æ ‡ã€‚ ï¼ˆæç¤ºï¼Œæ‚¨éœ€è¦ä¸€ä¸ªå®Œå…¨ä¸åŒçš„èµ„æºaws_elastic_beanstalk_hosted_zoneã€‚ï¼‰</p><p> Irregular naming: Sometimes you can fish stuff out by  arn, or maybe by  id, or maybe itâ€™s by  name - good luck. Keep the docs close to hand.</p><p> å‘½åä¸è§„åˆ™ï¼šæœ‰æ—¶å€™æ‚¨å¯ä»¥é€šè¿‡arnï¼Œidæˆ–åç§°æ¥é’“é±¼ï¼Œç¥æ‚¨å¥½è¿ã€‚å°†æ–‡æ¡£æ”¾åœ¨æ‰‹è¾¹ã€‚</p><p> (Itâ€™s totally possible this is inherited from the AWS APIs themselves, but the whole point of an abstraction layer is to make things better and more usable, dangit.)</p><p> ï¼ˆè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ä»AWS APIæœ¬èº«ç»§æ‰¿çš„ï¼Œä½†æ˜¯æŠ½è±¡å±‚çš„å…¨éƒ¨ç›®çš„æ˜¯ä½¿äº‹æƒ…å˜å¾—æ›´å¥½ï¼Œæ›´æœ‰ç”¨ï¼Œdangitã€‚ï¼‰</p><p>  Iteration times are way longer than with even mobile apps. Like, â€œyouâ€™re liable to task-switch while waiting to see plan outputâ€ longer.</p><p>  è¿­ä»£æ—¶é—´è¿œæ¯”ç§»åŠ¨åº”ç”¨ç¨‹åºé•¿ã€‚ä¾‹å¦‚ï¼Œâ€œæ‚¨æœ‰å¯èƒ½åœ¨ç­‰å¾…æŸ¥çœ‹è®¡åˆ’è¾“å‡ºæ—¶è¿›è¡Œä»»åŠ¡åˆ‡æ¢â€ã€‚</p><p> Testing is a pain. I havenâ€™t pulled in  Terratest yet, because anyone maintaining this after me is unlikely to have Go experience, and my focus here isnâ€™t builing reusable infra anyway - itâ€™s building  this infra â€“ so Iâ€™ve just been using  bats and Bash shell scripts (with  shellcheck, which is amazing) for some after-the-fact sanity checking using the AWS CLI. (Pro tip: Use the community-maintained fork   bats-core rather than the no-longer-maintained sstephenson original.) Policy assertions feel like a different flavor of test, but the tooling here seems to be fairly immature, with perhaps the exception of if youâ€™re targeting Kubernetes.</p><p>æµ‹è¯•æ˜¯ç—›è‹¦çš„ã€‚æˆ‘è¿˜æ²¡æœ‰å‚åŠ Terratestï¼Œå› ä¸ºåœ¨æˆ‘ä¹‹ååšæŒè¿›è¡Œæ­¤æ“ä½œçš„ä»»ä½•äººéƒ½ä¸å¤ªå¯èƒ½æœ‰Goçš„ç»éªŒï¼Œè€Œä¸”æˆ‘çš„å…³æ³¨ç‚¹ä¸æ˜¯å»ºç«‹å¯é‡å¤ä½¿ç”¨çš„åŸºç¡€ç»“æ„-å®ƒæ­£åœ¨æ„å»ºåŸºç¡€ç»“æ„-å› æ­¤ï¼Œæˆ‘ä¸€ç›´åœ¨ä½¿ç”¨è™è å’ŒBashå£³è„šæœ¬ï¼ˆä½¿ç”¨shellcheckï¼Œè¿™éå¸¸äº†ä¸èµ·ï¼‰ï¼Œç”¨äºä½¿ç”¨AWS CLIè¿›è¡Œäº‹åå®Œæ•´æ€§æ£€æŸ¥ã€‚ ï¼ˆä¸“å®¶æç¤ºï¼šä½¿ç”¨ç¤¾åŒºç»´æŠ¤çš„fork bats-coreï¼Œè€Œä¸æ˜¯ä¸å†ç»´æŠ¤çš„sstephensonåŸä½œã€‚ï¼‰ç­–ç•¥æ–­è¨€æ„Ÿè§‰åƒæ˜¯ä¸€ç§ä¸åŒçš„æµ‹è¯•é£æ ¼ï¼Œä½†æ˜¯è¿™é‡Œçš„å·¥å…·ä¼¼ä¹è¿˜å¾ˆä¸æˆç†Ÿï¼Œä¹Ÿè®¸é™¤äº†å¦‚æœæ‚¨å®šä½Kubernetesã€‚</p><p>  I expect Iâ€™ll get used to most of the rough edges of the syntax in another month. And Terraform is stil v0, so hey, maybe some breaking changes will clear all this mess away. ğŸ¤</p><p>  æˆ‘å¸Œæœ›æˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„ä¸€ä¸ªæœˆä¸­ä¹ æƒ¯è¯­æ³•çš„å¤§éƒ¨åˆ†ç²—ç³™ä¹‹å¤„ã€‚è€Œä¸”Terraformæ˜¯stil v0ï¼Œæ‰€ä»¥ï¼Œå˜¿ï¼Œä¹Ÿè®¸ä¸€äº›é‡å¤§æ›´æ”¹å°†æ¸…é™¤æ‰€æœ‰è¿™äº›æ··ä¹±ã€‚ ğŸ¤</p><p> Iâ€™m intentionally not getting sucked into hacking around the docs frustrations just now. Or even the  very tempting open issue about silencing all the Terragrunt logspew.</p><p> æˆ‘åˆ»æ„ä¸åªæ˜¯ç°åœ¨å°±æ²‰è¿·äºæ–‡æ¡£æ²®ä¸§çš„é»‘å®¢æ´»åŠ¨ã€‚ç”šè‡³æ˜¯å…³äºä½¿æ‰€æœ‰Terragrunt logspewé™éŸ³çš„éå¸¸è¯±äººçš„å…¬å¼€é—®é¢˜ã€‚</p><p> I do plan to spend a bit of time trying to get autocomplete working for resource and data source types and their arguments/attributes from the language server, at least. That would be a huge help.</p><p> æˆ‘ç¡®å®è®¡åˆ’èŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè‡³å°‘ä»è¯­è¨€æœåŠ¡å™¨ä¸Šå°è¯•å¯¹èµ„æºå’Œæ•°æ®æºç±»å‹åŠå…¶å‚æ•°/å±æ€§è¿›è¡Œè‡ªåŠ¨å®Œæˆã€‚é‚£å°†æ˜¯å·¨å¤§çš„å¸®åŠ©ã€‚</p><p> It still feels like magic to run a command and have infrastructure justâ€¦happen.You hit return, wait a bit, and suddenly servers are serving and domains are aliasing and a whole constellation of systems are interoperating.It kinda reminds me of the magic of home automation with blinkenlights, only without any of that messy â€œhardwareâ€ stuff to break on you.</p><p> è¿è¡Œå‘½ä»¤å¹¶æ‹¥æœ‰åŸºç¡€è®¾æ–½â€¦â€¦è¿™ä»ç„¶æ„Ÿè§‰å¾ˆç¥å¥‡ï¼Œæ‚¨ä¼šç¢°ä¸Šå›è½¦ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œç„¶åæœåŠ¡å™¨å¼€å§‹æœåŠ¡ï¼ŒåŸŸå‡ºç°åˆ«åï¼Œæ•´ä¸ªç³»ç»Ÿç¾¤éƒ½åœ¨äº’æ“ä½œã€‚è¿™è®©æˆ‘æƒ³èµ·äº†é­”æœ¯å¸¦æœ‰blinkenlightsçš„å®¶åº­è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œè€Œä¸ä¼šç»™æ‚¨å¸¦æ¥ä»»ä½•éº»çƒ¦çš„â€œç¡¬ä»¶â€ä¸œè¥¿ã€‚</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://jeremywsherman.com/blog/2020/11/21/a-month-of-terraform/">https://jeremywsherman.com/blog/2020/11/21/a-month-of-terraform/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/åœ°å½¢/">#åœ°å½¢</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/month/">#month</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
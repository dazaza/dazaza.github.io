<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>æˆ‘ä¸å°å¿ƒåˆ é™¤äº†ç”Ÿäº§æ•°æ®åº“</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">æˆ‘ä¸å°å¿ƒåˆ é™¤äº†ç”Ÿäº§æ•°æ®åº“</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-18 07:37:54</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/1714270cceda55206ce1ec8c906025bd.jpg"><img src="http://img2.diglog.com/img/2020/10/1714270cceda55206ce1ec8c906025bd.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Today at around 10:45pm CET, after a couple of glasses of red wine, we deleted the production database by accident ğŸ˜¨.</p><p>ä»Šå¤©ä¸­æ¬§æ—¶é—´æ™šä¸Š10ç‚¹45åˆ†å·¦å³ï¼Œåœ¨å–äº†å‡ æ¯çº¢é…’åï¼Œæˆ‘ä»¬æ„å¤–åœ°åˆ é™¤äº†ç”Ÿäº§æ•°æ®åº“ğŸ˜¨ã€‚</p><p> Thankfully our database is a managed database from DigitalOcean, which means that DigitalOcean automatically do backups once a day. After 5 minutes of hand-wringing and panic, we went into maintenance mode and were able to restore a backup. At around 11:15pm CET, 30 minutes after the disaster, we went back online, however 7 hours of scoreboard data was gone forever ğŸ˜µ.</p><p>è°¢å¤©è°¢åœ°ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“æ˜¯æ¥è‡ªDigitalOceançš„æ‰˜ç®¡æ•°æ®åº“ï¼Œè¿™æ„å‘³ç€DigitalOceanæ¯å¤©è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡å¤‡ä»½ã€‚ç»è¿‡5åˆ†é’Ÿçš„ç´§å¼ å’Œææ…Œï¼Œæˆ‘ä»¬è¿›å…¥äº†ç»´æŠ¤æ¨¡å¼ï¼Œå¹¶èƒ½å¤Ÿæ¢å¤å¤‡ä»½ã€‚åœ¨æ¬§æ´²ä¸­éƒ¨æ—¶é—´æ™šä¸Š11ç‚¹15åˆ†å·¦å³ï¼Œä¹Ÿå°±æ˜¯ç¾éš¾å‘ç”Ÿ30åˆ†é’Ÿåï¼Œæˆ‘ä»¬æ¢å¤äº†åœ¨çº¿ï¼Œç„¶è€Œ7ä¸ªå°æ—¶çš„è®°åˆ†æ¿æ•°æ®åœ¨ğŸ˜µä¸Šä¸€å»ä¸å¤è¿”äº†ã€‚</p><p> To be precise, any scoreboards created or scores added between 15:47 CET and 23:21 CET have been lost. We are extremely sorry about this.</p><p>å‡†ç¡®åœ°è¯´ï¼Œåœ¨æ¬§æ´²ä¸­éƒ¨æ—¶é—´15ï¼š47åˆ°23ï¼š21ä¹‹é—´åˆ›å»ºçš„ä»»ä½•è®°åˆ†ç‰Œæˆ–æ·»åŠ çš„åˆ†æ•°éƒ½å·²ä¸¢å¤±ã€‚æˆ‘ä»¬å¯¹æ­¤æ·±è¡¨æ­‰æ„ã€‚</p><p>   Itâ€™s tempting to blame the disaster on the couple of glasses of red wine. However, the function that wiped the database was written whilst sober. Itâ€™s a function that deletes the local database and creates all the required tables from scratch. This evening, whilst doing some late evening coding, the function connected to the production database and wiped it. Why? This is something weâ€™re still trying to figure out.</p><p>äººä»¬å¾ˆå®¹æ˜“æŠŠè¿™åœºç¾éš¾å½’å’äºé‚£ä¸¤æ¯çº¢é…’ã€‚ç„¶è€Œï¼Œæ“¦é™¤æ•°æ®åº“çš„å‡½æ•°æ˜¯åœ¨æ¸…é†’çš„æƒ…å†µä¸‹ç¼–å†™çš„ã€‚å®ƒæ˜¯ä¸€ä¸ªåˆ é™¤æœ¬åœ°æ•°æ®åº“å¹¶ä»å¤´å¼€å§‹åˆ›å»ºæ‰€æœ‰æ‰€éœ€è¡¨çš„å‡½æ•°ã€‚ä»Šå¤©æ™šä¸Šï¼Œåœ¨è¿›è¡Œæ·±å¤œç¼–ç æ—¶ï¼Œè¯¥å‡½æ•°è¿æ¥åˆ°ç”Ÿäº§æ•°æ®åº“å¹¶å°†å…¶æ“¦é™¤ã€‚ä¸ºä»€ä¹ˆï¼Ÿè¿™æ˜¯æˆ‘ä»¬ä»åœ¨åŠªåŠ›å¼„æ¸…æ¥šçš„äº‹æƒ…ã€‚</p><p>  def  database_model_create():  &#34;&#34;&#34;Only works on localhost to prevent catastrophe&#34;&#34;&#34; database  = config .DevelopmentConfig .DB_DATABASE user  = config .DevelopmentConfig .DB_USERNAME password  = config .DevelopmentConfig .DB_PASSWORD port  = config .DevelopmentConfig .DB_PORT local_db  = PostgresqlDatabase(database =database, user =user, password =password, host = &#39;localhost&#39;, port =port) local_db .drop_tables([Game, Player, Round, Score, Order]) local_db .create_tables([Game, Player, Round, Score, Order])  print( &#39;Initialized the local database.&#39;)</p><p>Def database_model_create()ï¼š&#34ï¼›&#34ï¼›&#34ï¼›&#34ï¼›ä»…é€‚ç”¨äºlocalhostä»¥é˜²æ­¢ç¾éš¾&#34ï¼›&#34ï¼›&#34ï¼›&#34ï¼›database=config.DevelopmentConfig.DB_database user=config.DevelopmentConfig.DB_username password=config.DevelopmentConfig.DB_Password port=config.DevelopmentConfig.DB_Port local_db=PostgresqlDatabase(database=databaseï¼Œuser=userï¼Œpassword=passwordï¼Œhost=&#39ï¼›localhost&#39ï¼›ï¼Œport=port)local_db.drop_tables([Gameï¼ŒPlayerï¼ŒCircleï¼ŒScoreï¼ŒOrder])local_db.create_tables([Gameï¼ŒPlayerï¼ŒCircleï¼ŒScoreï¼ŒOrder])print(&#39ï¼›åˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“ã€‚&#39ï¼›)ã€‚</p><p> Note that  host is hardcoded to  localhost. This means it should  never connect to any machine other than the developer machine. Weâ€™re too tired to figure it out right now. The gremlins won this time.</p><p>è¯·æ³¨æ„ï¼Œhostè¢«ç¡¬ç¼–ç ä¸ºlocalhostã€‚è¿™æ„å‘³ç€å®ƒæ°¸è¿œä¸åº”è¯¥è¿æ¥åˆ°é™¤å¼€å‘äººå‘˜è®¡ç®—æœºä¹‹å¤–çš„ä»»ä½•è®¡ç®—æœºã€‚æˆ‘ä»¬å¤ªç´¯äº†ï¼Œç°åœ¨æƒ³ä¸å‡ºæ¥ã€‚å°é¬¼ä»¬è¿™æ¬¡èµ¢äº†ã€‚</p><p>  Weâ€™ve learned that having a function that deletes your database is too dangerous to have lying around. The problem is, you can never really test the safety mechanisms properly, because testing it would mean pointing a gun at the production database.</p><p>æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œæ‹¥æœ‰ä¸€ä¸ªåˆ é™¤æ•°æ®åº“çš„å‡½æ•°å¤ªå±é™©äº†ï¼Œä¸èƒ½æ— æ‰€äº‹äº‹ã€‚é—®é¢˜æ˜¯ï¼Œæ‚¨æ°¸è¿œä¸èƒ½çœŸæ­£æ­£ç¡®åœ°æµ‹è¯•å®‰å…¨æœºåˆ¶ï¼Œå› ä¸ºæµ‹è¯•å®ƒå°†æ„å‘³ç€ç”¨æªæŒ‡ç€ç”Ÿäº§æ•°æ®åº“ã€‚</p><p> The truth is, we can never be 100% sure that something like this wonâ€™t happen again. Computers are just too complex and there are days when the complexity gremlins win. However, we will figure out what went wrong and ensure that that particular error doesnâ€™t happen again.</p><p>äº‹å®æ˜¯ï¼Œæˆ‘ä»¬æ°¸è¿œä¸èƒ½ç™¾åˆ†ä¹‹ç™¾ç¡®å®šè¿™æ ·çš„äº‹æƒ…ä¸ä¼šå†å‘ç”Ÿã€‚è®¡ç®—æœºå®åœ¨å¤ªå¤æ‚äº†ï¼Œæœ‰æ—¶å€™å¤æ‚çš„å°å¦–ç²¾ä¼šèµ¢ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†æ‰¾å‡ºå“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œå¹¶ç¡®ä¿è¿™ç§ç‰¹å®šçš„é”™è¯¯ä¸ä¼šå†æ¬¡å‘ç”Ÿã€‚</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://keepthescore.co/blog/posts/deleting_the_production_database/">https://keepthescore.co/blog/posts/deleting_the_production_database/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/æ•°æ®åº“/">#æ•°æ®åº“</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/database/">#database</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/åˆ é™¤/">#åˆ é™¤</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¾å›½/">#ç¾å›½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¨‹åº/">#ç¨‹åº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
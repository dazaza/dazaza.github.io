<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>é€šå‘åä¸€å’Œæ›´è¿œçš„åœ°æ–¹</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">é€šå‘åä¸€å’Œæ›´è¿œçš„åœ°æ–¹</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-23 12:04:53</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/57d9be383789483b2f59375ae402be78.png"><img src="http://img2.diglog.com/img/2020/10/57d9be383789483b2f59375ae402be78.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In 2018, we launched  Firefox Extension Workshop, a site for Firefox-specific extension development documentation. The site was originally built using the Ruby-based static site generator  Jekyll. We had initially selected Jekyll for this project because we wanted to make it easy for editors to update the site using Markdown, a lightweight markup language.</p><p>2018å¹´ï¼Œæˆ‘ä»¬æ¨å‡ºäº†Firefoxæ‰©å±•ç ”è®¨ä¼šï¼Œè¿™æ˜¯ä¸€ä¸ªæä¾›ç‰¹å®šäºFirefoxçš„æ‰©å±•å¼€å‘æ–‡æ¡£çš„ç½‘ç«™ã€‚è¯¥ç«™ç‚¹æœ€åˆæ˜¯ä½¿ç”¨åŸºäºRubyçš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨Jekyllæ„å»ºçš„ã€‚æˆ‘ä»¬æœ€åˆä¸ºè¿™ä¸ªé¡¹ç›®é€‰æ‹©äº†Jekyllï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è®©ç¼–è¾‘ä½¿ç”¨Markdown(ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€)è½»æ¾åœ°æ›´æ–°ç«™ç‚¹ã€‚</p><p> Once the site had been created and more documentation was added, the build times started to grow. Every time we made a change to the site and wanted to test it locally, it would take ten minutes or longer for the site to build. The builds took so long that we needed to increase the default time limit for  CircleCI, our continuous integration and continuous delivery service, because builds were failing when they ran past ten minutes with no output.</p><p>ä¸€æ—¦åˆ›å»ºäº†ç«™ç‚¹å¹¶æ·»åŠ äº†æ›´å¤šæ–‡æ¡£ï¼Œæ„å»ºæ—¶é—´å°±å¼€å§‹å¢é•¿ã€‚æ¯æ¬¡æˆ‘ä»¬å¯¹ç«™ç‚¹è¿›è¡Œæ›´æ”¹å¹¶å¸Œæœ›åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•æ—¶ï¼Œç«™ç‚¹çš„æ„å»ºéƒ½éœ€è¦10åˆ†é’Ÿæˆ–æ›´é•¿æ—¶é—´ã€‚æ„å»ºèŠ±è´¹äº†å¦‚æ­¤é•¿çš„æ—¶é—´ï¼Œä»¥è‡³äºæˆ‘ä»¬éœ€è¦å¢åŠ CircleCI(æˆ‘ä»¬çš„æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜æœåŠ¡)çš„é»˜è®¤æ—¶é—´é™åˆ¶ï¼Œå› ä¸ºå½“å®ƒä»¬è¿è¡Œè¶…è¿‡10åˆ†é’Ÿè€Œæ²¡æœ‰è¾“å‡ºæ—¶ï¼Œæ„å»ºå°±ä¼šå¤±è´¥ã€‚</p><p> Investigating these slow builds using profiling showed that most of the time was being spent in the Liquid template rendering calls.</p><p>ä½¿ç”¨æ€§èƒ½åˆ†æå¯¹è¿™äº›é€Ÿåº¦è¾ƒæ…¢çš„æ„å»ºè¿›è¡Œè°ƒæŸ¥åå‘ç°ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨æ¶²æ€æ¨¡æ¿å‘ˆç°è°ƒç”¨ä¸Šã€‚</p><p> In addition to problems with build times, there were also issues with cache-busting in local development. This meant that things like a change of images wouldnâ€™t show up in the site without a full rebuild after clearing the local cache.</p><p>é™¤äº†æ„å»ºæ—¶é—´çš„é—®é¢˜å¤–ï¼Œæœ¬åœ°å¼€å‘ä¸­çš„ç¼“å­˜ç ´åä¹Ÿæœ‰é—®é¢˜ã€‚è¿™æ„å‘³ç€åœ¨æ¸…é™¤æœ¬åœ°ç¼“å­˜ä¹‹åï¼Œå¦‚æœæ²¡æœ‰å®Œå…¨é‡å»ºï¼Œåƒå›¾åƒæ›´æ”¹è¿™æ ·çš„äº‹æƒ…ä¸ä¼šå‡ºç°åœ¨ç«™ç‚¹ä¸­ã€‚</p><p> As we were discussing how to best move forward, Jekyll 4 was released with features expected to improve build performance.  However, an early test of porting to this version actually performed worse than the previous version. We then realized that we needed to find an alternative and port the site.</p><p>å°±åœ¨æˆ‘ä»¬è®¨è®ºå¦‚ä½•æ›´å¥½åœ°å‘å‰å‘å±•æ—¶ï¼ŒJekyll4å‘å¸ƒäº†ä¸€äº›æœ‰æœ›æé«˜æ„å»ºæ€§èƒ½çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œç§»æ¤åˆ°æ­¤ç‰ˆæœ¬çš„æ—©æœŸæµ‹è¯•å®é™…ä¸Šæ¯”ä»¥å‰çš„ç‰ˆæœ¬æ‰§è¡Œå¾—æ›´å·®ã€‚ç„¶åæˆ‘ä»¬æ„è¯†åˆ°ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œç„¶åæŠŠè¿™ä¸ªåœ°ç‚¹æ¬åˆ°æ¸¯å£ã€‚</p><p> Update: 05-10-2020: A Jekyll developer reached out having investigated the slow builds. The findings were that Jekyll on its own isnâ€™t slow, the high build times in our case were primarily caused by 3rd party plugins.</p><p>æ›´æ–°æ—¶é—´ï¼š2020å¹´5æœˆ10æ—¥ï¼šä¸€ä½Jekyllå¼€å‘äººå‘˜è°ƒæŸ¥äº†ç¼“æ…¢çš„æ„å»ºè¿‡ç¨‹ã€‚ç»“æœæ˜¯Jekyllæœ¬èº«å¹¶ä¸æ…¢ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œé«˜æ„å»ºæ—¶é—´ä¸»è¦æ˜¯ç”±ç¬¬ä¸‰æ–¹æ’ä»¶é€ æˆçš„ã€‚</p><p>   Build performance needed to be better than the 10 minutes (600s+) it took to build locally.</p><p>æ„å»ºæ€§èƒ½éœ€è¦é«˜äºæœ¬åœ°æ„å»ºæ‰€éœ€çš„10åˆ†é’Ÿ(600ç§’ä»¥ä¸Š)ã€‚</p><p>  Ideally the solution would be JavaScript based, as the Add-ons Engineering team has a lot of collective JavaScript experience and a JavaScript based infrastructure would make it easier to extend.</p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œè§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯åŸºäºJavaScriptçš„ï¼Œå› ä¸ºAdd-ons Engineeringå›¢é˜Ÿæ‹¥æœ‰ä¸°å¯Œçš„JavaScriptç»éªŒï¼ŒåŸºäºJavaScriptçš„åŸºç¡€è®¾æ–½å°†ä½¿å…¶æ›´å®¹æ˜“æ‰©å±•ã€‚</p><p> It needed to be flexible, enough to meet the demands of adding more documentation in the future.</p><p>å®ƒéœ€è¦çµæ´»ï¼Œè¶³ä»¥æ»¡è¶³å°†æ¥æ·»åŠ æ›´å¤šæ–‡æ¡£çš„éœ€æ±‚ã€‚</p><p> Hugo (written in Go),  Gatsby (JS), and  Eleventy (11ty) (JS) were all considered as options.</p><p>é›¨æœ(ç”¨å›´æ£‹å†™çš„)ã€ç›–èŒ¨æ¯”(JS)å’Œåä¸€(11TY)(JS)éƒ½è¢«è€ƒè™‘ä¸ºé€‰é¡¹ã€‚</p><p> In the end, Eleventy was chosen for one main reason: it provided enough similarities to Jekyll that we could migrate the site without a major rewrite. In contrast, both Hugo and Gatsby would have required a significant refactoring.Â  Porting the site also meant less changes up front, which allowed us to focus on maintaining parity with the site already in production.</p><p>æœ€åï¼Œé€‰æ‹©11æ˜¯å› ä¸ºä¸€ä¸ªä¸»è¦åŸå› ï¼šå®ƒä¸Jekyllæœ‰è¶³å¤Ÿçš„ç›¸ä¼¼ä¹‹å¤„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä¸è¿›è¡Œé‡å¤§é‡å†™çš„æƒ…å†µä¸‹è¿ç§»è¯¥ç«™ç‚¹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒHugoå’ŒGatsbyéƒ½éœ€è¦è¿›è¡Œé‡å¤§çš„é‡æ„ï¼Œç§»æ¤ç½‘ç«™ä¹Ÿæ„å‘³ç€è¾ƒå°‘çš„å‰æœŸæ›´æ”¹ï¼Œè¿™è®©æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºä¿æŒä¸å·²ç»æŠ•å…¥ç”Ÿäº§çš„ç½‘ç«™çš„å¹³ä»·ã€‚</p><p> As Eleventy provides an option to use liquid templates, via  LiquidJS, it meant that templates only needed relatively minimal changes to work.</p><p>ç”±äºElevtyé€šè¿‡LiquidJSæä¾›äº†ä½¿ç”¨æ¶²æ€æ¨¡æ¿çš„é€‰é¡¹ï¼Œè¿™æ„å‘³ç€æ¨¡æ¿åªéœ€è¦è¿›è¡Œç›¸å¯¹æœ€å°‘çš„æ›´æ”¹å³å¯å·¥ä½œã€‚</p><p>  There are four main building blocks in the Jekyll site:Â  Liquid templating, Markdown for documentation, Sass for CSS, and JQuery for behaviour.</p><p>Jekyllç«™ç‚¹æœ‰å››ä¸ªä¸»è¦çš„æ„å»ºå—ï¼šç”¨äºæ–‡æ¡£çš„æ¶²æ€æ¨¡æ¿ã€ç”¨äºæ–‡æ¡£çš„Markdownã€ç”¨äºCSSçš„Sasså’Œç”¨äºè¡Œä¸ºçš„JQueryã€‚</p><p> To migrate to Eleventy we planned to minimize changes to how the site works, and focus on porting all of the existing documentation without changing the CSS or JavaScript.</p><p>ä¸ºäº†è¿ç§»åˆ°11ï¼Œæˆ‘ä»¬è®¡åˆ’æœ€å¤§é™åº¦åœ°å‡å°‘å¯¹ç«™ç‚¹å·¥ä½œæ–¹å¼çš„æ›´æ”¹ï¼Œå¹¶ä¸“æ³¨äºç§»æ¤æ‰€æœ‰ç°æœ‰æ–‡æ¡£ï¼Œè€Œæ— éœ€æ›´æ”¹CSSæˆ–JavaScriptã€‚</p><p>  The blog post  Turning Jekyll up to Eleventy by  Paul Lloyd was a great help in describing what would need to be done to get the site working under Eleventy.</p><p>Paul Lloydæ’°å†™çš„åšå®¢æ–‡ç« Turning Jekyll up to 11å¾ˆæœ‰å¸®åŠ©ï¼Œå®ƒæè¿°äº†éœ€è¦åšäº›ä»€ä¹ˆæ‰èƒ½è®©ç½‘ç«™åœ¨11ä¸‹è¿è¡Œã€‚</p><p> The first step was to create the an Eleventy configuration file based on the old Jekyll one.</p><p>ç¬¬ä¸€æ­¥æ˜¯åœ¨æ—§çš„Jekyllé…ç½®æ–‡ä»¶çš„åŸºç¡€ä¸Šåˆ›å»º11ä¸ªé…ç½®æ–‡ä»¶ã€‚</p><p> Data files were moved from YAML to JSON. This was done via a  YAML to JSON conversion.</p><p>æ•°æ®æ–‡ä»¶ä»YAMLç§»åŠ¨åˆ°JSONã€‚è¿™æ˜¯é€šè¿‡YAMLåˆ°JSONçš„è½¬æ¢å®Œæˆçš„ã€‚</p><p> Next, the templates were updated to fix the differences in variables and the includes. The jekyll-assets plugin syntax was removed so that assets were directly served from the assets directory.</p><p>æ¥ä¸‹æ¥ï¼Œæ›´æ–°æ¨¡æ¿ä»¥ä¿®å¤å˜é‡å’ŒIncludeä¹‹é—´çš„å·®å¼‚ã€‚åˆ é™¤äº†Jekyll-Assetsæ’ä»¶è¯­æ³•ï¼Œä»¥ä¾¿ç›´æ¥ä»Assetsç›®å½•æä¾›èµ„äº§ã€‚</p><p>  As a minimal fix to replace the Jekyll plugins for CSS and JS,Â  the CSS (Sass) and JS were built with Command Line Interface (CLI) scripts added to the package.json using Uglify and SASS.</p><p>ä½œä¸ºæ›¿æ¢CSSå’ŒJSçš„Jekyllæ’ä»¶çš„æœ€å°ä¿®å¤ï¼ŒCSS(Sass)å’ŒJSæ˜¯ä½¿ç”¨Uglifyå’ŒSassä½¿ç”¨æ·»åŠ åˆ°Package.jsonçš„å‘½ä»¤è¡Œç•Œé¢(CLI)è„šæœ¬æ„å»ºçš„ã€‚</p><p> For Sass, this required loading paths via the CLI and then just passing the main stylesheet:</p><p>å¯¹äºSassï¼Œè¿™éœ€è¦é€šè¿‡CLIåŠ è½½è·¯å¾„ï¼Œç„¶ååªä¼ é€’ä¸»æ ·å¼è¡¨ï¼š</p><p>   uglifyjs node_modules/jquery/dist/jquery.js node_modules/dompurify/dist/purify.js node_modules/velocity-animate/velocity.js node_modules/velocity-ui-pack/velocity.ui.js node_modules/slick-carousel/slick/slick.js _assets/js/tinypubsub.js _assets/js/breakpoints.js _assets/js/parallax.js _assets/js/parallaxFG.js _assets/js/inview.js _assets/js/youtubeplayer.js _assets/js/main.js -o _assets/js/bundle.js</p><p>Uglifyjs node_module/jQuery/dist/jquery.js node_module/dompurify/dist/purify.js node_module/ocity-Animate/velocity.js node_module/ocity-ui-pack/velocity.ui.js node_module/slick-carousel/slick/slick.js_sets/js/tinypubsub.js_sets/js/ruppoints.js_sets/js/parallax.js_sets/js/in.js_sets/js/youtubeplayer.js_sets/js/main.js-o_sets/js/bundle.js-o_sets/js/bundle.js/parallax.js_sets/js/in.js_sets/js/youtubeplayer.js_sets/js/main.js-o_sets/js/bundle.jsã€‚</p><p> This was clearly quite clunky, but it got JS and CSS working in development albeit in a way that required a script to be run manually. However, with the CSS and JS bundles working, this made it possible to focus on getting the homepage up and running without worrying about anything more complicated to start with.</p><p>è¿™æ˜¾ç„¶ç›¸å½“ç¬¨æ‹™ï¼Œä½†å®ƒè®©JSå’ŒCSSåœ¨å¼€å‘ä¸­æ­£å¸¸å·¥ä½œï¼Œå°½ç®¡è¿™ç§æ–¹å¼éœ€è¦æ‰‹åŠ¨è¿è¡Œè„šæœ¬ã€‚ç„¶è€Œï¼Œéšç€CSSå’ŒJSæ†ç»‘åŒ…çš„å·¥ä½œï¼Œè¿™ä½¿å¾—äººä»¬å¯ä»¥ä¸“æ³¨äºä¸»é¡µçš„å¯åŠ¨å’Œè¿è¡Œï¼Œè€Œä¸å¿…æ‹…å¿ƒå¼€å§‹æ—¶ä¼šæœ‰æ›´å¤æ‚çš„äº‹æƒ…ã€‚</p><p>     With the homepage looking like it should, the next task was fixing the rest of the syntax. This was a pretty laborious process of updating all the templates and removing or replacing plugins and filters that Eleventy didnâ€™t have.</p><p>ä¸»é¡µçœ‹èµ·æ¥åº”è¯¥æ˜¯æ­£ç¡®çš„ï¼Œæ¥ä¸‹æ¥çš„ä»»åŠ¡æ˜¯ä¿®å¤å…¶ä½™çš„è¯­æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“è´¹åŠ›çš„è¿‡ç¨‹ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰æ¨¡æ¿ï¼Œåˆ é™¤æˆ–æ›¿æ¢Elevtyæ²¡æœ‰çš„æ’ä»¶å’Œè¿‡æ»¤å™¨ã€‚</p><p> After some work fixing up the files, finally the entire site could be built without error! ğŸ‰</p><p>åœ¨ä¿®å¤äº†ä¸€äº›æ–‡ä»¶ä¹‹åï¼Œæœ€ç»ˆå¯ä»¥æ¯«æ— é”™è¯¯åœ°æ„å»ºæ•´ä¸ªç«™ç‚¹ï¼ğŸ‰</p><p> What was immediately apparent was how fast Eleventy is. The entire site was built in under 3 seconds. That is not a typo; it is 3 seconds not minutes.</p><p>æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œâ€œåä¸€â€çš„é€Ÿåº¦æœ‰å¤šå¿«ã€‚æ•´ä¸ªç½‘ç«™åœ¨ä¸åˆ°3ç§’çš„æ—¶é—´å†…å»ºæˆã€‚é‚£ä¸æ˜¯æ‰“å­—é”™è¯¯ï¼Œæ˜¯3ç§’ï¼Œä¸æ˜¯åˆ†é’Ÿã€‚</p><p>   Building JS and CSS is not part of Eleventy itself. This means itâ€™s up to you to decide how you want to handle statics.</p><p>æ„å»ºJSå’ŒCSSä¸æ˜¯Elevtyæœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥å†³å®šå¦‚ä½•å¤„ç†é™æ€ã€‚</p><p>   The first approach moved the CSS and JS to node scripts. These replicated the crude CLI scripts using APIs.</p><p>ç¬¬ä¸€ç§æ–¹æ³•å°†CSSå’ŒJSç§»åˆ°èŠ‚ç‚¹è„šæœ¬ã€‚å®ƒä»¬ä½¿ç”¨APIå¤åˆ¶åŸå§‹çš„CLIè„šæœ¬ã€‚</p><p> Ultimately we decided to decouple asset building from Eleventy entirely. This meant that Eleventy could worry about building the content, and a separate process would handle the static assets. It also meant that the static asset scripts could write out to the build folder directly.</p><p>æœ€ç»ˆï¼Œæˆ‘ä»¬å†³å®šå°†èµ„äº§å»ºè®¾ä¸Elevtyå®Œå…¨è„±é’©ã€‚è¿™æ„å‘³ç€Elevtyå¯ä»¥æ‹…å¿ƒå†…å®¹çš„æ„å»ºï¼Œè€Œå¦ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹å°†å¤„ç†é™æ€èµ„äº§ã€‚è¿™è¿˜æ„å‘³ç€é™æ€èµ„äº§è„šæœ¬å¯ä»¥ç›´æ¥å†™å‡ºåˆ°Buildæ–‡ä»¶å¤¹ã€‚</p><p> This made it possible to have the static assets built in parallel with the Eleventy build. The downside was that Eleventy couldnâ€™t tell the browserSync instance (the server Eleventy uses in development) to update as it wasnâ€™t involved with this process. It also meant that watching JS and SASS source files needed to be handled with a separate watching configuration, which in this case was handled via  chokidar-cli. Hereâ€™s the command used in the package.json script for the CSS build:</p><p>è¿™ä½¿å¾—é™æ€èµ„äº§å¯ä»¥ä¸Elevitiæ„å»ºå¹¶è¡Œæ„å»ºã€‚ç¼ºç‚¹æ˜¯ï¼ŒElevitiæ— æ³•é€šçŸ¥BrowserSyncå®ä¾‹(Elevitiåœ¨å¼€å‘ä¸­ä½¿ç”¨çš„æœåŠ¡å™¨)è¿›è¡Œæ›´æ–°ï¼Œå› ä¸ºå®ƒä¸å‚ä¸æ­¤è¿‡ç¨‹ã€‚è¿™è¿˜æ„å‘³ç€éœ€è¦ä½¿ç”¨å•ç‹¬çš„ç›‘è§†é…ç½®æ¥å¤„ç†ç›‘è§†JSå’ŒSASSæºæ–‡ä»¶ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥é…ç½®æ˜¯é€šè¿‡Chokidar-cliå¤„ç†çš„ã€‚ä»¥ä¸‹æ˜¯CSSæ„å»ºçš„Package.jsonè„šæœ¬ä¸­ä½¿ç”¨çš„å‘½ä»¤ï¼š</p><p>    With the JS and CSS being built correctly, we needed to update the browserSync instance to tell it that the JS and CSS had changed. This way, when you make a CSS change the page will reload without a refresh. Fast updates provide the ideal short feedback loop for iterative changes.</p><p>æ­£ç¡®æ„å»ºJSå’ŒCSSåï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°BrowserSyncå®ä¾‹ä»¥å‘Šè¯‰å®ƒJSå’ŒCSSå·²ç»æ›´æ”¹ã€‚è¿™æ ·ï¼Œå½“æ‚¨æ›´æ”¹CSSæ—¶ï¼Œé¡µé¢å°†åœ¨ä¸åˆ·æ–°çš„æƒ…å†µä¸‹é‡æ–°åŠ è½½ã€‚å¿«é€Ÿæ›´æ–°ä¸ºè¿­ä»£æ›´æ”¹æä¾›äº†ç†æƒ³çš„çŸ­åé¦ˆå¾ªç¯ã€‚</p><p> Fortunately, browserSync has a web API. We were able to use this to tell browserSync to update every time the CSS or JS build is built in development.</p><p>å¹¸è¿çš„æ˜¯ï¼ŒBrowserSyncæœ‰ä¸€ä¸ªWeb APIã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å‘Šè¯‰BrowserSyncåœ¨æ¯æ¬¡å¼€å‘ä¸­æ„å»ºCSSæˆ–JSç‰ˆæœ¬æ—¶è¿›è¡Œæ›´æ–°ã€‚</p><p>    Next, we needed to clean up everything and make sure the site looked right. Missing plugin functionality needed to be replaced and docs and templates needed several adjustments.</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ¸…ç†æ‰€æœ‰ä¸œè¥¿ï¼Œå¹¶ç¡®ä¿ç«™ç‚¹çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„ã€‚ç¼ºå°‘çš„æ’ä»¶åŠŸèƒ½éœ€è¦æ›¿æ¢ï¼Œæ–‡æ¡£å’Œæ¨¡æ¿éœ€è¦å‡ æ¬¡è°ƒæ•´ã€‚</p><p>  Use the 11ty â€œedit this page on githubâ€ recipe. (A great feature for making it easier to accept contributions to document improvements).</p><p>ä½¿ç”¨ç¬¬11æ¡â€œåœ¨GitHubä¸Šç¼–è¾‘æ­¤é¡µé¢â€é£Ÿè°±ã€‚(è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¯ä»¥è®©æ‚¨æ›´å®¹æ˜“æ¥å—å¯¹æ–‡æ¡£æ”¹è¿›çš„è´¡çŒ®)ã€‚</p><p> Clean-up templates to fix some errant markup. This was mainly about looking at whitespace control in liquid as in some cases there were some bad interactions with the markdown which resulted in spurious extra elements.</p><p>æ¸…ç†æ¨¡æ¿ä»¥ä¿®å¤ä¸€äº›é”™è¯¯çš„æ ‡è®°ã€‚è¿™ä¸»è¦æ˜¯å…³äºæ¶²ä½“ä¸­çš„ç©ºæ ¼æ§åˆ¶ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸æ ‡è®°ä¹‹é—´å­˜åœ¨ä¸€äº›ä¸è‰¯äº¤äº’ï¼Œä»è€Œå¯¼è‡´è™šå‡çš„é¢å¤–å…ƒç´ ã€‚</p><p> Recreate the pages API plugin. Under Jekyll this was used by the search, so we needed to recreate this for parity in order to avoid re-implementing the search from scratch.</p><p>é‡æ–°åˆ›å»ºé¡µé¢APIæ’ä»¶ã€‚åœ¨Jekyllä¸‹ï¼Œæœç´¢ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡æ–°åˆ›å»ºæ­¤é€‰é¡¹ä»¥å®ç°å¥‡å¶æ ¡éªŒï¼Œä»¥é¿å…ä»å¤´å¼€å§‹é‡æ–°å®ç°æœç´¢ã€‚</p><p> Build tag pages instead of using the search. This was also done for SEO benefits.</p><p>æ„å»ºæ ‡è®°é¡µé¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æœç´¢ã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†æœç´¢å¼•æ“ä¼˜åŒ–çš„å¥½å¤„ã€‚</p><p>  With the site looking like it should and a lot of the minor issues tidied up, one of the final steps was to look at how to handle building the static assets for production.</p><p>ç«™ç‚¹çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œå¹¶ä¸”æ•´ç†äº†è®¸å¤šå°é—®é¢˜ï¼Œæœ€åä¸€æ­¥æ˜¯çœ‹ä¸€ä¸‹å¦‚ä½•å¤„ç†ä¸ºç”Ÿäº§è€Œæ„å»ºçš„é™æ€èµ„äº§ã€‚</p><p> For optimal performance, static assets should not need to be fetched by the browser if that asset (JS, CSS, Image, fonts etc) is in the browserâ€™s cache. To do that you can serve assets with expires headers set into the future (typically one year). This means that if foo.js is cached, when asked to fetch it, the browser wonâ€™t re-fetch it unless the cache is removed or the cached asset is older than the expiration date set via the expires header in the original response.</p><p>ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œå¦‚æœé™æ€èµ„æº(JSã€CSSã€å›¾åƒã€å­—ä½“ç­‰)åœ¨æµè§ˆå™¨çš„ç¼“å­˜ä¸­ï¼Œåˆ™ä¸éœ€è¦ç”±æµè§ˆå™¨è·å–è¯¥èµ„æºã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è®¾ç½®ä¸ºå°†æ¥(é€šå¸¸ä¸ºä¸€å¹´)çš„Expiresæ ‡å¤´ä¸ºèµ„äº§æä¾›æœåŠ¡ã€‚è¿™æ„å‘³ç€å¦‚æœfoo.jsè¢«ç¼“å­˜ï¼Œå½“è¯·æ±‚è·å–å®ƒæ—¶ï¼Œæµè§ˆå™¨ä¸ä¼šé‡æ–°è·å–å®ƒï¼Œé™¤éç§»é™¤ç¼“å­˜æˆ–è€…ç¼“å­˜çš„èµ„äº§æ¯”é€šè¿‡åŸå§‹å“åº”ä¸­çš„Expireså¤´è®¾ç½®çš„è¿‡æœŸæ—¥æœŸæ›´æ—©ã€‚</p><p> Once youâ€™re caching assets in this way, the URL of the resource needs to be changed to â€œbust the cacheâ€, otherwise the browser wonâ€™t make a request if the cached asset is considered â€œfresh.â€</p><p>ä»¥è¿™ç§æ–¹å¼ç¼“å­˜èµ„äº§åï¼Œéœ€è¦å°†èµ„æºçš„URLæ›´æ”¹ä¸ºâ€œç ´åç¼“å­˜â€ï¼Œå¦åˆ™ï¼Œå¦‚æœç¼“å­˜çš„èµ„äº§è¢«è®¤ä¸ºæ˜¯â€œæ–°é²œçš„â€ï¼Œæµè§ˆå™¨å°†ä¸ä¼šå‘å‡ºè¯·æ±‚ã€‚</p><p>    The git revision of the entire site can be used as part of the URL. This means that every time a revision is added and the site is published, every asset would be considered fresh. The downside is that this will cause clients to download every asset even if it hasnâ€™t actually been updated since the last time the site was published.</p><p>æ•´ä¸ªç«™ç‚¹çš„GITç‰ˆæœ¬å¯ä»¥ç”¨ä½œURLçš„ä¸€éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€æ¯æ¬¡æ·»åŠ ä¿®è®¢å¹¶å‘å¸ƒç«™ç‚¹æ—¶ï¼Œæ¯ä¸€é¡¹èµ„äº§éƒ½å°†è¢«è®¤ä¸ºæ˜¯æ–°é²œçš„ã€‚ç¼ºç‚¹æ˜¯ï¼Œè¿™å°†å¯¼è‡´å®¢æˆ·ç«¯ä¸‹è½½æ¯ä¸€é¡¹èµ„äº§ï¼Œå³ä½¿è¿™äº›èµ„äº§è‡ªä¸Šæ¬¡ç½‘ç«™å‘å¸ƒä»¥æ¥å®é™…ä¸Šæ²¡æœ‰æ›´æ–°è¿‡ã€‚</p><p>  With this approach, a query string is appended to a URL with either a hash of the contents or some other unique string e.g:</p><p>ä½¿ç”¨æ­¤æ–¹æ³•æ—¶ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²å°†ä½¿ç”¨å†…å®¹çš„æ•£åˆ—æˆ–å…¶ä»–ä¸€äº›å”¯ä¸€å­—ç¬¦ä¸²é™„åŠ åˆ°URLä¸­ï¼Œä¾‹å¦‚ï¼š</p><p>   A downside of this approach is that in some cases caching proxies wonâ€™t consider the query string. This could result in stale assets being served. Despite this, this approach is pretty common and caching proxies donâ€™t typically default to ignoring query params.</p><p>è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¼“å­˜ä»£ç†ä¸ä¼šè€ƒè™‘æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é™ˆæ—§çš„èµ„äº§è¢«æä¾›æœåŠ¡ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™ç§æ–¹æ³•è¿˜æ˜¯å¾ˆå¸¸è§çš„ï¼Œç¼“å­˜ä»£ç†é€šå¸¸ä¸ä¼šé»˜è®¤å¿½ç•¥æŸ¥è¯¢å‚æ•°ã€‚</p><p>  In this scenario, you change your asset references to point to files with a hash as part of the URL. The server is configured to rewrite those resources internally to ignore the hash.</p><p>åœ¨æ­¤æ–¹æ¡ˆä¸­ï¼Œæ‚¨å°†æ›´æ”¹èµ„æºå¼•ç”¨ä»¥æŒ‡å‘å¸¦æœ‰æ•£åˆ—çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯URLçš„ä¸€éƒ¨åˆ†ã€‚æœåŠ¡å™¨è¢«é…ç½®ä¸ºåœ¨å†…éƒ¨é‡å†™è¿™äº›èµ„æºä»¥å¿½ç•¥æ•£åˆ—ã€‚</p><p> For example if your HTML refers to foo.4ab8sbc7.css the server will serve foo.css. This means you donâ€™t need to update the actual filename of foo.css to foo.4ab8sbc7.css.</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„HTMLå¼•ç”¨foo.4ab8sbc7.cssï¼Œåˆ™æœåŠ¡å™¨å°†æä¾›foo.cssã€‚è¿™æ„å‘³ç€æ‚¨ä¸éœ€è¦å°†foo.cssçš„å®é™…æ–‡ä»¶åæ›´æ–°ä¸ºfoo.4ab8sbc7.cssã€‚</p><p>   In this approach, once you know the hash of your content, you need to update the references to that file, and then you can output the file with that hash as part of the filename.</p><p>åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œä¸€æ—¦çŸ¥é“äº†å†…å®¹çš„æ•£åˆ—ï¼Œå°±éœ€è¦æ›´æ–°å¯¹è¯¥æ–‡ä»¶çš„å¼•ç”¨ï¼Œç„¶åå¯ä»¥ä½¿ç”¨è¯¥æ•£åˆ—ä½œä¸ºæ–‡ä»¶åçš„ä¸€éƒ¨åˆ†è¾“å‡ºæ–‡ä»¶ã€‚</p><p> The upside of this approach is that once the static site is built this way it can be served anywhere and you donâ€™t need any additional server config as per the previous example.</p><p>è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œä¸€æ—¦ä»¥è¿™ç§æ–¹å¼æ„å»ºäº†é™æ€ç«™ç‚¹ï¼Œå®ƒå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æä¾›æœåŠ¡ï¼Œå¹¶ä¸”æ‚¨ä¸éœ€è¦ä»»ä½•é¢å¤–çš„æœåŠ¡å™¨é…ç½®(å¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤º)ã€‚</p><p>   Eleventy doesnâ€™t have an asset pipeline, though this is something that is being considered for the future.</p><p>11å®¶å…¬å¸æ²¡æœ‰èµ„äº§ç®¡é“ï¼Œå°½ç®¡è¿™æ˜¯æœªæ¥æ­£åœ¨è€ƒè™‘çš„äº‹æƒ…ã€‚</p><p> In order to deploy the Eleventy port, cache-busting would be needed so we could continue to deploy to S3 with far future expires headers.</p><p>ä¸ºäº†éƒ¨ç½²11ä¸ªç«¯å£ï¼Œå°†éœ€è¦ç¼“å­˜ç ´åï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­éƒ¨ç½²åˆ°S3ï¼Œå¹¶ä½¿ç”¨é¥è¿œçš„Expiresæ ‡å¤´ã€‚</p><p> With the Jekyll assets plugin, you used liquid templating to control the assets building. Ideally, I wanted to avoid content authors needing to know about cache-busting at all.</p><p>ä½¿ç”¨Jekyllèµ„æºæ’ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æµåŠ¨æ¨¡æ¿æ¥æ§åˆ¶èµ„æºæ„å»ºã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘å¸Œæœ›é¿å…å†…å®¹ä½œè€…éœ€è¦äº†è§£ç¼“å­˜ç ´åã€‚</p><p> To make this work, all asset references would need to start with â€œ/assets/â€ and could not be built with variables. Given the simplicity of the site, this was a reasonable limitation.</p><p>è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæ‰€æœ‰èµ„äº§å¼•ç”¨éƒ½éœ€è¦ä»¥â€œ/Assets/â€å¼€å¤´ï¼Œå¹¶ä¸”ä¸èƒ½ç”¨å˜é‡æ„å»ºã€‚è€ƒè™‘åˆ°ç«™ç‚¹çš„ç®€å•æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆç†çš„é™åˆ¶ã€‚</p><p>   The first attempt used Webpack.Â  We almost got it working using  eleventy-webpack-boilerplate as a guide, however this started to introduce differences in the webpack configs for dev and production since it essentially used the built HTML as an entry point. This was because cache-busting and optimizations were not to be part of the dev process to keep the locale development build as fast as possible. Getting this working became more and more complex, requiring special patched forks of loaders because of limitations in the way HTML extraction worked.</p><p>ç¬¬ä¸€æ¬¡å°è¯•ä½¿ç”¨äº†webpackã€‚â€œæˆ‘ä»¬å‡ ä¹ä½¿ç”¨äº†11-webpackæ¨¡æ¿ä½œä¸ºæŒ‡å¯¼æ¥è®©å®ƒå·¥ä½œï¼Œç„¶è€Œï¼Œè¿™å¼€å§‹åœ¨webpackçš„å¼€å‘å’Œç”Ÿäº§é…ç½®ä¸­å¼•å…¥ä¸åŒä¹‹å¤„ï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨æ„å»ºçš„Htmlä½œä¸ºå…¥å£ç‚¹ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜ç ´åå’Œä¼˜åŒ–ä¸æ˜¯å¼€å‘è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å°½å¯èƒ½å¿«åœ°ä¿æŒåŒºåŸŸå¼€å‘æ„å»ºã€‚ä½¿å…¶å·¥ä½œå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œç”±äºHTMLæå–å·¥ä½œæ–¹å¼çš„é™åˆ¶ï¼Œéœ€è¦ç‰¹æ®Šçš„æ‰“è¡¥ä¸çš„åŠ è½½å™¨åˆ†å‰ã€‚</p><p> Webpack also didnâ€™t work well for this project because of the way it expects to understand relationships in JS modules in order to build a bundle. The JS for this site was written in an older style where the scripts are concatenated together in a specific order without any special consideration for dependencies (other than script order). This alone required a lot of workarounds to work in Webpack.</p><p>Webpackåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä¹Ÿæ²¡æœ‰å¾ˆå¥½åœ°å·¥ä½œï¼Œå› ä¸ºå®ƒå¸Œæœ›ç†è§£JSæ¨¡å—ä¸­çš„å…³ç³»ï¼Œä»¥ä¾¿æ„å»ºä¸€ä¸ªæ†ç»‘åŒ…ã€‚æ­¤ç«™ç‚¹çš„JSæ˜¯ä»¥è¾ƒæ—§çš„æ ·å¼ç¼–å†™çš„ï¼Œå…¶ä¸­è„šæœ¬ä»¥ç‰¹å®šçš„é¡ºåºè¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ²¡æœ‰å¯¹ä¾èµ–é¡¹(è„šæœ¬é¡ºåºé™¤å¤–)è¿›è¡Œä»»ä½•ç‰¹æ®Šè€ƒè™‘ã€‚ä»…æ­¤ä¸€é¡¹å°±éœ€è¦åœ¨webpackä¸­è¿›è¡Œå¤§é‡çš„å˜é€šå·¥ä½œã€‚</p><p>   AssetGraph is an extensible,   node.js -based framework for manipulating and optimizing web pages and web applications. The main core is a dependency graph model of your entire website, where all assets are treated as first class citizens. It can automatically discover assets based on your declarative code, reducing the configuration needs to a minimum.</p><p>AssetGraphæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ã€åŸºäºnode.jsçš„æ¡†æ¶ï¼Œç”¨äºæ“ä½œå’Œä¼˜åŒ–ç½‘é¡µå’ŒWebåº”ç”¨ç¨‹åºã€‚ä¸»è¦æ ¸å¿ƒæ˜¯æ•´ä¸ªç½‘ç«™çš„ä¾èµ–å›¾æ¨¡å‹ï¼Œå…¶ä¸­æ‰€æœ‰èµ„äº§éƒ½è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘ã€‚å®ƒå¯ä»¥æ ¹æ®æ‚¨çš„å£°æ˜æ€§ä»£ç è‡ªåŠ¨å‘ç°èµ„äº§ï¼Œä»è€Œå°†é…ç½®éœ€æ±‚é™è‡³æœ€ä½ã€‚</p><p> The main concept is that the relationship between HTML documents and other resources is essentially a graph problem.</p><p>ä¸»è¦æ¦‚å¿µæ˜¯HTMLæ–‡æ¡£å’Œå…¶ä»–èµ„æºä¹‹é—´çš„å…³ç³»æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå›¾é—®é¢˜ã€‚</p><p> AssetGraph-builder uses AssetGraph, and using your HTML as a starting point it works out all the relationships and optimizes all of your assets along the way.</p><p>AssetGraph-Builderä½¿ç”¨AssetGraphï¼Œå¹¶ä»¥æ‚¨çš„HTMLä¸ºèµ·ç‚¹ï¼Œè®¡ç®—å‡ºæ‰€æœ‰çš„å…³ç³»ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­ä¼˜åŒ–æ‚¨çš„æ‰€æœ‰èµ„äº§ã€‚</p><p> This sounded ideal. However when I ran it on the built content of the site, node ran out of memory. With no control over what it was doing and minimal feedback as to where it was stuck, this attempt was shelved.</p><p>è¿™å¬èµ·æ¥å¾ˆç†æƒ³ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘åœ¨ç«™ç‚¹çš„æ„å»ºå†…å®¹ä¸Šè¿è¡Œå®ƒæ—¶ï¼ŒèŠ‚ç‚¹è€—å°½äº†å†…å­˜ã€‚ç”±äºæ— æ³•æ§åˆ¶å®ƒåœ¨åšä»€ä¹ˆï¼Œå¯¹å®ƒå¡åœ¨å“ªé‡Œçš„åé¦ˆä¹Ÿå¾ˆå°‘ï¼Œè¿™ä¸€å°è¯•è¢«æç½®äº†ã€‚</p><p> That said, the overall goals of the AssetGraph project are really good, and this looks like itâ€™s something worth keeping an eye on for the future.</p><p>è¿™å°±æ˜¯è¯´ï¼ŒAssetGraphé¡¹ç›®çš„æ€»ä½“ç›®æ ‡çœŸçš„å¾ˆå¥½ï¼Œè¿™çœ‹èµ·æ¥æ˜¯æœªæ¥å€¼å¾—å…³æ³¨çš„äº‹æƒ…ã€‚</p><p>  In the end, the solution that ended up working best was to build a script that would process the assets   after the site build was completed by Eleventy.</p><p>æœ€åï¼Œæœ€ç»ˆæ•ˆæœæœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯æ„å»ºä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†åœ¨Elevtyå®Œæˆç«™ç‚¹æ„å»ºä¹‹åå¤„ç†èµ„äº§ã€‚</p><p>  Process the CSS, and rewrite references to resources within them, minify the CSS, and record a content hash for them.</p><p>å¤„ç†CSSï¼Œé‡å†™å¯¹å…¶ä¸­èµ„æºçš„å¼•ç”¨ï¼Œç¼©å°CSSï¼Œå¹¶è®°å½•å®ƒä»¬çš„å†…å®¹æ•£åˆ—ã€‚</p><p> Process the JS, and rewrite references to resources within them, minify the JS, and record a content hash for them.</p><p>å¤„ç†JSï¼Œé‡å†™å¯¹å…¶ä¸­èµ„æºçš„å¼•ç”¨ï¼Œç¼©å°JSï¼Œå¹¶è®°å½•å®ƒä»¬çš„å†…å®¹æ•£åˆ—ã€‚</p><p> Note: there might be some edge cases not covered here. For example, if a JS file references another JS file,Â  this could break depending on the order of processing. The script could be updated to handle this, but that would mean files would need to be re-processed as changed and anything that referenced them would also need to be updated and so on. Since this isnâ€™t a concern for the current site, this was left out for simplicity. Thereâ€™s also no circular dependency detection. Again, for this site and most other basic sites this wonâ€™t be a concern.</p><p>æ³¨ï¼šè¿™é‡Œå¯èƒ½æ²¡æœ‰ä»‹ç»ä¸€äº›è¾¹ç¼˜æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªJSæ–‡ä»¶å¼•ç”¨äº†å¦ä¸€ä¸ªJSæ–‡ä»¶ï¼Œåˆ™æ ¹æ®å¤„ç†é¡ºåºï¼Œè¿™å¯èƒ½ä¼šä¸­æ–­ã€‚å¯ä»¥æ›´æ–°è„šæœ¬ä»¥å¤„ç†æ­¤é—®é¢˜ï¼Œä½†è¿™æ„å‘³ç€éœ€è¦å°†æ–‡ä»¶é‡æ–°å¤„ç†ä¸ºæ›´æ”¹è¿‡çš„æ–‡ä»¶ï¼Œå¹¶ä¸”å¼•ç”¨å®ƒä»¬çš„ä»»ä½•å†…å®¹ä¹Ÿéœ€è¦æ›´æ–°ï¼Œä¾æ­¤ç±»æ¨ã€‚ç”±äºè¿™ä¸æ˜¯å½“å‰ç«™ç‚¹çš„é—®é¢˜ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œçœç•¥äº†è¿™ä¸€ç‚¹ã€‚ä¹Ÿæ²¡æœ‰å¾ªç¯ä¾èµ–æ£€æµ‹ã€‚åŒæ ·ï¼Œå¯¹äºè¿™ä¸ªç«™ç‚¹å’Œå¤§å¤šæ•°å…¶ä»–åŸºç¡€ç«™ç‚¹æ¥è¯´ï¼Œè¿™ä¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p> Thereâ€™s a reason optimizations and cache-busting arenâ€™t part of the development build. This separation helps to ensure the site continues to build really fast when making changes locally.</p><p>ä¼˜åŒ–å’Œç¼“å­˜ç ´åä¸æ˜¯å¼€å‘æ„å»ºçš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯æœ‰åŸå› çš„ã€‚è¿™ç§åˆ†ç¦»æœ‰åŠ©äºç¡®ä¿ç«™ç‚¹åœ¨æœ¬åœ°è¿›è¡Œæ›´æ”¹æ—¶ç»§ç»­ä»¥éå¸¸å¿«çš„é€Ÿåº¦æ„å»ºã€‚</p><p> This is a trade-off, but as long as you check the production build before you release itâ€™s a reasonable compromise. In our case, we have a development site built from master, a staging site built from tags with a -stage suffix, and the production site. All of these deployments run the production deployment processes so thereâ€™s plenty of opportunity for catching issues with full builds.</p><p>è¿™æ˜¯ä¸€ç§æƒè¡¡ï¼Œä½†æ˜¯åªè¦æ‚¨åœ¨å‘å¸ƒä¹‹å‰æ£€æŸ¥ç”Ÿäº§ç‰ˆæœ¬ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªåˆç†çš„æŠ˜è¡·æ–¹æ¡ˆã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä»ä¸»ç«™ç‚¹æ„å»ºçš„å¼€å‘ç«™ç‚¹ã€ä¸€ä¸ªç”±å¸¦æœ‰-Stageåç¼€çš„æ ‡è®°æ„å»ºçš„ä¸´æ—¶ç«™ç‚¹å’Œç”Ÿäº§ç«™ç‚¹ã€‚æ‰€æœ‰è¿™äº›éƒ¨ç½²éƒ½è¿è¡Œç”Ÿäº§éƒ¨ç½²æµç¨‹ï¼Œå› æ­¤æœ‰å¾ˆå¤šæœºä¼šæ•è·å®Œæ•´æ„å»ºçš„é—®é¢˜ã€‚</p><p>  Porting to Eleventy has been a positive change. It certainly took quite a lot of steps to get there, but it was worth the effort.</p><p>è¿ç§»åˆ°11å·æ˜¯ä¸€ä¸ªç§¯æçš„å˜åŒ–ã€‚å½“ç„¶ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹éœ€è¦ç›¸å½“å¤šçš„æ­¥éª¤ï¼Œä½†ä»˜å‡ºçš„åŠªåŠ›æ˜¯å€¼å¾—çš„ã€‚</p><p> In the past, long build times with Jekyll made this site really painful for contributors and document authors to work with. Weâ€™re already starting to see some additional contributions as a result of lowering the barrier of entry.</p><p>è¿‡å»ï¼Œä½¿ç”¨Jekylléœ€è¦å¾ˆé•¿çš„æ„å»ºæ—¶é—´ï¼Œè¿™ä½¿å¾—è¿™ä¸ªç«™ç‚¹å¯¹äºè´¡çŒ®è€…å’Œæ–‡æ¡£ä½œè€…æ¥è¯´éå¸¸ç—›è‹¦ã€‚ç”±äºé™ä½äº†å‡†å…¥é—¨æ§›ï¼Œæˆ‘ä»¬å·²ç»å¼€å§‹çœ‹åˆ°ä¸€äº›é¢å¤–çš„è´¡çŒ®ã€‚</p><p> With this port complete, itâ€™s now starting to become clear what the next steps should be to minimize the boilerplate for document authors and make the site even easier to use and contribute to.</p><p>è¿™ä¸ªç§»æ¤å®Œæˆåï¼Œä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆå°±å¼€å§‹å˜å¾—æ¸…æ™°èµ·æ¥ï¼Œä»¥ä¾¿æœ€å¤§é™åº¦åœ°å‡å°‘æ–‡æ¡£ä½œè€…çš„æ ·æ¿ï¼Œå¹¶ä½¿ç«™ç‚¹æ›´æ˜“äºä½¿ç”¨å’Œè´¡çŒ®ã€‚</p><p> If you have a site running under Jekyll or are considering using a modern static site generator, then taking a look at Eleventy is highly recommended. Itâ€™s fast, flexible, well documented, and a joy to work with. âœ¨</p><p>å¦‚æœæ‚¨æœ‰ä¸€ä¸ªåœ¨Jekyllä¸‹è¿è¡Œçš„ç«™ç‚¹ï¼Œæˆ–è€…æ­£åœ¨è€ƒè™‘ä½¿ç”¨ç°ä»£çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼Œé‚£ä¹ˆå¼ºçƒˆæ¨èæ‚¨çœ‹ä¸€ä¸‹11ã€‚å®ƒå¿«é€Ÿã€çµæ´»ã€æ–‡æ¡£é½å…¨ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ„‰å¿«ã€‚âœ¨</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://hacks.mozilla.org/2020/10/to-eleventy-and-beyond/">https://hacks.mozilla.org/2020/10/to-eleventy-and-beyond/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/é€šå‘/">#é€šå‘</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/eleventy/">#eleventy</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¾å›½/">#ç¾å›½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¨‹åº/">#ç¨‹åº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>WebP比JPEG好吗？</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">WebP比JPEG好吗？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-23 22:46:37</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/6/b0335259317056e4f92d34076bc7c82f.png"><img src="http://img.diglog.com/img/2020/6/b0335259317056e4f92d34076bc7c82f.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>如果你使用过像Google的PageSpeed Insights这样的工具，你可能会遇到使用“下一代图像格式”的建议，即Google的WebP图像格式。谷歌声称，在同等质量下，他们的WebP格式比JPEG小25-34%。</p><p>在使用感知图像优化器测试WebP时，我遇到了一个特殊的问题：与压缩的JPEG相比，WebP文件的大小非常相似，在许多情况下更大。我不是唯一注意到这一点的人，Mozilla在2013年的研究中也注意到，与JPEG相比，WebP通常没有更好的压缩效率。(请注意，Mozilla有点退缩了，并在2019年实现了对Firefox的WebP支持)。</p><p>我认为Google文件减少25%-34%的主要原因是他们将WebP编码器与JPEG参考实现--独立JPEG集团的cjpeg--进行了比较，而不是Mozilla改进后的MozJPEG编码器。我决定运行一些测试，看看cjpeg、MozJPEG和WebP如何比较。我还测试了基于开放的AV1视频编解码器的新的AVIF格式。火狐已经支持AVIF了，如果这张票可信的话，它应该很快就会出现在Chrome上。</p><p>在测试中，我使用了3种不同大小的柯达图像数据集：500px、1000px和1500px。</p><p>对于JPEG转换，我使用了带有--Optimize标志、--Procedure标志和4：2：0色度子采样的cjpeg。</p><p>对于MozJPEG转换，我使用了带有--优化标志、--渐进标志和4：2：0色度子采样的MozJPEG。</p><p>对于WebP，我使用带有-m6标志的cwebp来实现最大压缩，使用-af来进行自动过滤，这可能是为了提高质量而牺牲编码时间。WebP仅支持4：2：0子采样，因此不需要单独指定。</p><p>对于AVIF，我使用了带标志的Colorist--tonemap off、--yuv 420和--Speed 0，这是最慢但质量最高的编码</p><p>除此之外，ImageMagick还用于缩小原始图像的比例，并在PNG、WebP和TGA之间进行转换(cwebp仅支持TGA输入)。所有转换均在sRGB颜色空间中完成。</p><p>为了比较质量，我使用了kornelski的dssim实用程序，它计算图像之间的结构相似性指数。我的目标ssim是0.0044，大致相当于85的jpeg质量。</p><p>如果我们查看文件大小的中位数，我们可以看到，与cjpeg相比，在同等的ssim索引下，MozJPEG大约小了11%，WebP小了18%，AVIF小了31%。</p><p>如果我们查看文件大小的中位数，我们可以看到，与cjpeg相比，MozJPEG大约小了11%，WebP也比cjpeg小了11%，avf在同等的ssim索引下小了28%。</p><p>如果我们查看文件大小的中位数，我们可以看到，与cjpeg相比，MozJPEG大约小9%，WebP与cjpeg大小相同，AVIF在同等的ssim索引下小28%。</p><p>只是为了好玩，我画了所有图像大小的平均值。我知道这可能不是一个公平的比较，但尽管如此，你还是要说：</p><p>如您所见，与cjpeg相比，MozJPEG大约小了9%，WebP小了6%，AVIF小了30%。</p><p>如果您感兴趣，您可以在此处以电子表格的形式查看所有图像的原始数据。比较应用程序和RAW图片的源代码可以在GitHub上找到：500px、1000px和1500px。检查原始图像的原始目录。</p><p>那么，WebP比JPEG好吗？这取决于您使用的是参考libjpeg库还是改进的MozJPEG编码器。</p><p>在大多数情况下，WebP的压缩效果似乎比libjpeg好10%左右，除了1500px的图像压缩效果差不多。</p><p>然而，与MozJPEG相比，WebP只在500px的小图像上表现得更好。对于其他图像大小，压缩效果相等或更差。</p><p>我认为MozJPEG是这里的明显赢家，其压缩性能一直比libjpeg好10%左右。</p><p>由于大部分时间WebP与JPEG回退一起使用，因此通过使用WebP，您基本上可以将存储成本提高一倍，而收益却微乎其微。因此，最后，我建议仅在以下情况下使用WebP：</p><p>在任何情况下，将图像转换为WebP时，请检查它们是否实际小于JPEG等效值。没有必要向您的用户提供超出所需的更大的图像。</p><p>JPEG编码器与WebP(基于VP8)和AVIF(基于AV1)相比的一个显著区别是，很容易看出后者是如何从视频编解码器派生出来的。JPEG压缩对每个16x16“宏块”使用相同的量化因子，因此压缩在整个图像中是一致的。</p><p>另一方面，WebP和AVIF对图像的不同部分使用不同的压缩因子，因此在图像的细节部分保持其质量的同时，细节较低的表面(如皮肤或天空)将被“平滑”。这一点在此图像中的红色百叶窗中尤为明显。</p><p>虽然图像中的砖块看起来很锋利，但门看起来几乎就像是应用了“智能模糊”Photoshop滤镜。</p><p>我认为这种自适应压缩是很有价值的。想一想一张有森林和天空的照片。传统的图像编码器必须决定整个图像的单一压缩比。虽然在高频细节的林木上使用大量的比特是好的，但是对于低频细节的天空来说它们是浪费的。</p><p>更智能的编码器(如WebP或AVIF)将能够单独处理这些区域，从而有效地使用可用位。</p><p>我认为AVIF是一个非常激动人心的开发，与WebP相比，它似乎是一个真正的下一代编解码器，与libjpeg相比，压缩比提高了大约30%。我唯一担心的是低细节区域的过度模糊。当更先进的工具出现时，这一点是否能得到改善还有待观察。</p><p>现在的工装有点乱七八糟。Colorist是我发现的唯一可以可靠地对AVIF文件进行编码的程序。编码AVIF文件也真的很慢！对大图像进行编码可能需要几分钟的时间。我使用的是AOM编码器，但是rav1e可能更快。浏览器支持也仍在进行中。Firefox支持AVIF，但它有问题，而且似乎无法正确读取ICC配置文件。尽管如此，它还是比苹果的下一代HEIF支持更多的浏览器，后者在Safari中甚至不受支持。</p><p>我认为，在未来一年左右的时间里，我们可能会看到一幅截然不同的图景。有了Chrome，我们可以看到支持的浏览器跃升到所有浏览器的70%左右，这意味着在Web项目中支持AVIF将是一个务实的事情。</p><p>在这次测试中，我只使用了摄影图像。例如，压缩图形时，WebP可能会更好，因为它支持对Alpha通道进行有损压缩，而PNG和JPEG不支持。</p><p>我还测试了“Web质量”目标为85的图像，因此WebP在质量非常高或非常低的设置下可能会有不同的表现。</p><p>此外，谷歌的研究使用了不同的程序来计算SSIM值。在我的测试中，我使用了dssim实用程序，它在实验室颜色空间中计算多尺度的ssim，而前者似乎在rgb颜色空间中使用简单的ssim。这意味着他们可能会给出不同的结果，但很难说哪一个更准确。</p><p>根据流行的需求，在图表中添加了错误条。这些分别代表第25和75个百分位数。我还为对比应用程序和RAW图片添加了giHub链接。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://siipo.la/blog/is-webp-really-better-than-jpeg">https://siipo.la/blog/is-webp-really-better-than-jpeg</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/webp/">#webp</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
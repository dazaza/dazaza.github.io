<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>æµ‹è¯•é‡‘å­—å¡”åº”è¯¥çœ‹èµ·æ¥æ›´åƒä¸€åªèƒèŸ¹</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">æµ‹è¯•é‡‘å­—å¡”åº”è¯¥çœ‹èµ·æ¥æ›´åƒä¸€åªèƒèŸ¹</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-04 00:17:52</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/a8ff3c12e4e676e6cb81d35940395a8b.jpg"><img src="http://img2.diglog.com/img/2020/11/a8ff3c12e4e676e6cb81d35940395a8b.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This is a fancified excerpt from Gleb Bahmutov on  JS Party #148. Gleb is VP of Engineering at  Cypress.io. To get the full experience you should listen while you read.</p><p>è¿™æ˜¯æ ¼åˆ—å¸ƒÂ·å·´å§†æ‰˜å¤«å…³äºJSå…š#148çš„ä¸€æ®µè™šæ„çš„æ‘˜å½•ã€‚Glebæ˜¯Cypress.ioçš„å·¥ç¨‹å‰¯æ€»è£ã€‚è¦è·å¾—å®Œæ•´çš„ä½“éªŒï¼Œä½ åº”è¯¥è¾¹çœ‹è¾¹å¬ã€‚</p><p>    Typically, people say that testing is like a pyramid. Imagine a pyramid like in Egypt.</p><p>é€šå¸¸ï¼Œäººä»¬ä¼šè¯´æµ‹è¯•å°±åƒé‡‘å­—å¡”ã€‚æƒ³è±¡ä¸€ä¸‹åƒåŸƒåŠé‚£æ ·çš„é‡‘å­—å¡”ã€‚</p><p>   At the bottom you have a very wide layer of unit tests. And unit tests test the smallest piece of code.</p><p>åœ¨åº•éƒ¨ï¼Œæ‚¨æœ‰ä¸€ä¸ªéå¸¸å¹¿æ³›çš„å•å…ƒæµ‹è¯•å±‚ã€‚è€Œå•å…ƒæµ‹è¯•æµ‹è¯•çš„æ˜¯æœ€å°çš„ä»£ç ç‰‡æ®µã€‚</p><p> (Imagine you write a function that adds two numbers; so you write a test. If I call that function with arguments 2 and 3, do I get 5?)</p><p>(å‡è®¾æ‚¨ç¼–å†™äº†ä¸€ä¸ªå°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ çš„å‡½æ•°ï¼›å› æ­¤æ‚¨ç¼–å†™äº†ä¸€ä¸ªæµ‹è¯•ã€‚å¦‚æœæˆ‘ä½¿ç”¨å‚æ•°2å’Œ3è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ˜¯å¦ä¼šå¾—åˆ°5ï¼Ÿ)ã€‚</p><p> Every language under the sun has a unit testing framework, because itâ€™s so easy. Just load a piece of code, run it, check the result that you get, make sure itâ€™s what you expect. So thatâ€™s why the bottom of the pyramid is usually very wide, because itâ€™s easy to just write hundreds of tests to exercise all your little components.</p><p>ä¸–ç•Œä¸Šæ¯ç§è¯­è¨€éƒ½æœ‰ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå› ä¸ºå®ƒéå¸¸ç®€å•ã€‚åªéœ€åŠ è½½ä¸€æ®µä»£ç ï¼Œè¿è¡Œå®ƒï¼Œæ£€æŸ¥æ‚¨å¾—åˆ°çš„ç»“æœï¼Œç¡®ä¿å®ƒç¬¦åˆæ‚¨çš„é¢„æœŸã€‚è¿™å°±æ˜¯é‡‘å­—å¡”åº•éƒ¨é€šå¸¸éå¸¸å®½çš„åŸå› ï¼Œå› ä¸ºåªéœ€ç¼–å†™æ•°ç™¾ä¸ªæµ‹è¯•æ¥æµ‹è¯•æ‚¨æ‰€æœ‰çš„å°ç»„ä»¶å°±å¾ˆå®¹æ˜“äº†ã€‚</p><p>  And when you move higher up in the pyramid and now youâ€™re trying to put units of code together.</p><p>å½“ä½ åœ¨é‡‘å­—å¡”ä¸­å‘æ›´é«˜çš„ä½ç½®ç§»åŠ¨æ—¶ï¼Œç°åœ¨ä½ æ­£è¯•å›¾æŠŠä»£ç å•å…ƒæ”¾åœ¨ä¸€èµ·ã€‚</p><p> Maybe youâ€™re trying to use a  Todo class, but represent something and you do some other pieces of code. Youâ€™re now mostly trying to see if a couple of units of code work together; how they integrate. And thatâ€™s where you discover parts where the backend team and the frontend team actually did not communicate very well. So my module doesnâ€™t work very well with another module.</p><p>ä¹Ÿè®¸æ‚¨æ­£åœ¨å°è¯•ä½¿ç”¨TODOç±»ï¼Œä½†æ˜¯è¡¨ç¤ºä¸€äº›ä¸œè¥¿ï¼Œç„¶åæ‚¨è¦åšä¸€äº›å…¶ä»–çš„ä»£ç ç‰‡æ–­ã€‚æ‚¨ç°åœ¨ä¸»è¦æ˜¯æƒ³çœ‹çœ‹å‡ ä¸ªä»£ç å•å…ƒæ˜¯å¦ååŒå·¥ä½œï¼›å®ƒä»¬æ˜¯å¦‚ä½•é›†æˆçš„ã€‚è¿™å°±æ˜¯æ‚¨å‘ç°åç«¯å›¢é˜Ÿå’Œå‰ç«¯å›¢é˜Ÿå®é™…ä¸Šæ²Ÿé€šä¸æ˜¯å¾ˆå¥½çš„åœ°æ–¹ã€‚æ‰€ä»¥æˆ‘çš„æ¨¡å—ä¸å¦ä¸€ä¸ªæ¨¡å—ä¸èƒ½å¾ˆå¥½åœ°ååŒå·¥ä½œã€‚</p><p>   An end-to-end test is when youâ€™re trying to run the whole thing as the end user would. For example, you open a website in your browser and you navigate and you work with your web application and you check if it updates the page correctly, if it calls the backend correctly.</p><p>ç«¯åˆ°ç«¯æµ‹è¯•æ˜¯æŒ‡æ‚¨è¯•å›¾åƒæœ€ç»ˆç”¨æˆ·é‚£æ ·è¿è¡Œæ•´ä¸ªæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œæ‚¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä¸€ä¸ªç½‘ç«™ï¼Œç„¶åå¯¼èˆªå’Œä½¿ç”¨æ‚¨çš„Webåº”ç”¨ç¨‹åºï¼Œå¹¶æ£€æŸ¥å®ƒæ˜¯å¦æ­£ç¡®åœ°æ›´æ–°äº†é¡µé¢ï¼Œæ˜¯å¦æ­£ç¡®åœ°è°ƒç”¨äº†åç«¯ã€‚</p><p> The top of the pyramid is usually very sharp. Thatâ€™s because youâ€™re not supposed to write many end-to-end tests.  I think this is obsolete thinking nowadays, because why was it hard to write end-to-end test?</p><p>é‡‘å­—å¡”çš„é¡¶éƒ¨é€šå¸¸å¾ˆå°–ã€‚è¿™æ˜¯å› ä¸ºæ‚¨ä¸åº”è¯¥ç¼–å†™å¾ˆå¤šç«¯åˆ°ç«¯æµ‹è¯•ã€‚æˆ‘è®¤ä¸ºç°åœ¨è¿™ç§æƒ³æ³•å·²ç»è¿‡æ—¶äº†ï¼Œå› ä¸ºä¸ºä»€ä¹ˆç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•ä¼šå¾ˆéš¾å‘¢ï¼Ÿ</p><p> It was hard to install the end-to-end test runner. It was finicky. It was flaky. The tests were flaky and didnâ€™t give you much confidence, so you actually spent more time maintaining most end-to-end tests than you would actually spend time writing your web application.</p><p>å¾ˆéš¾å®‰è£…ç«¯åˆ°ç«¯çš„æµ‹è¯•è·‘æ­¥å™¨ã€‚å¤ªæŒ‘å‰”äº†ã€‚å®ƒæ˜¯ä¸ç¨³å®šçš„ã€‚è¿™äº›æµ‹è¯•ä¸å¯é ï¼Œæ²¡æœ‰ç»™æ‚¨å¤ªå¤šä¿¡å¿ƒï¼Œå› æ­¤æ‚¨å®é™…ä¸ŠèŠ±è´¹åœ¨ç»´æŠ¤å¤§å¤šæ•°ç«¯åˆ°ç«¯æµ‹è¯•ä¸Šçš„æ—¶é—´æ¯”æ‚¨å®é™…èŠ±åœ¨ç¼–å†™Webåº”ç”¨ç¨‹åºä¸Šçš„æ—¶é—´è¿˜è¦å¤šã€‚</p><p>  Write many unit tests, write many integration tests, but just a few end-to-end tests (maybe just as a sanity).</p><p>ç¼–å†™è®¸å¤šå•å…ƒæµ‹è¯•ï¼Œç¼–å†™è®¸å¤šé›†æˆæµ‹è¯•ï¼Œä½†åªç¼–å†™å‡ ä¸ªç«¯åˆ°ç«¯æµ‹è¯•(å¯èƒ½åªæ˜¯ä¸ºäº†ä¿æŒç†æ™º)ã€‚</p><p> And when we look at what  Cypress allows you to do (which is write many useful tests that have very little flake) then you wanna write  more end-to-end tests. You wanna make the pyramid almost like a rectangle  or maybe as a pizza slice, where you have a lot of end-to-end tests and a few unit tests.</p><p>å½“æˆ‘ä»¬çœ‹ä¸€çœ‹Cypresså…è®¸æ‚¨åšä»€ä¹ˆ(å³ç¼–å†™è®¸å¤šéå¸¸å°‘çš„æœ‰ç”¨æµ‹è¯•)æ—¶ï¼Œæ‚¨ä¼šæƒ³è¦ç¼–å†™æ›´å¤šçš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨å¸Œæœ›ä½¿é‡‘å­—å¡”å‡ ä¹åƒä¸€ä¸ªçŸ©å½¢ï¼Œæˆ–è€…å¯èƒ½åƒä¸€ä¸ªæŠ«è¨ç‰‡ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šç«¯åˆ°ç«¯æµ‹è¯•å’Œå‡ ä¸ªå•å…ƒæµ‹è¯•ã€‚</p><p>  It goes back to efficiency. If you test a small, single function that adds two numbersâ€¦ Yeah, the test is easy, itâ€™s fast, but it really only hits that particular function. But your web app is  large and potential sources of errors are not just logical errors in your functions:</p><p>è¿™åˆå›åˆ°äº†æ•ˆç‡çš„é—®é¢˜ä¸Šã€‚å¦‚æœæ‚¨æµ‹è¯•ä¸€ä¸ªå°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ çš„å°çš„å•ä¸ªå‡½æ•°â€¦ã€‚æ˜¯çš„ï¼Œæµ‹è¯•å¾ˆç®€å•ï¼Œé€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œä½†å®ƒç¡®å®åªè¾¾åˆ°äº†é‚£ä¸ªç‰¹å®šçš„åŠŸèƒ½ã€‚ä½†æ˜¯ä½ çš„Webåº”ç”¨ç¨‹åºå¾ˆå¤§ï¼Œæ½œåœ¨çš„é”™è¯¯æ¥æºä¸ä»…ä»…æ˜¯ä½ çš„å‡½æ•°ä¸­çš„é€»è¾‘é”™è¯¯ï¼š</p><p>  That you have to set correctly in the backend and the frontend and all the little internet stuff in between.  And the modern browser (which is an awfully, awfully complicated machine) where your assumptions that it will execute this add â€œtwo numbers togetherâ€ completely is different from what the end thing will do.</p><p>ä½ å¿…é¡»åœ¨åç«¯å’Œå‰ç«¯ä»¥åŠå®ƒä»¬ä¹‹é—´çš„æ‰€æœ‰äº’è”ç½‘å°ä¸œè¥¿ä¸­æ­£ç¡®è®¾ç½®ã€‚è€Œç°ä»£çš„æµè§ˆå™¨(è¿™æ˜¯ä¸€å°æå…¶å¤æ‚çš„æœºå™¨)ä¸­ï¼Œæ‚¨è®¤ä¸ºå®ƒå°†å®Œå…¨æ‰§è¡Œâ€œä¸¤ä¸ªæ•°å­—ç›¸åŠ â€çš„å‡è®¾ä¸æœ€ç»ˆç»“æœæ˜¯ä¸åŒçš„ã€‚åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œæ‚¨è®¤ä¸ºå®ƒå°†å®Œå…¨æ‰§è¡Œâ€œä¸¤ä¸ªæ•°å­—ç›¸åŠ â€çš„å‡è®¾ä¸æœ€ç»ˆç»“æœæ˜¯ä¸åŒçš„ã€‚</p><p> So when you think about whatâ€™s the effectiveness, or how much do you actually exercise? How many potential errors can you find?</p><p>é‚£ä¹ˆï¼Œå½“ä½ æ€è€ƒå®ƒçš„æœ‰æ•ˆæ€§æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…ä½ å®é™…é”»ç‚¼äº†å¤šå°‘ï¼Ÿæ‚¨èƒ½æ‰¾åˆ°å¤šå°‘æ½œåœ¨é”™è¯¯ï¼Ÿ</p><p> Well, the unit tests can find you a few logical errors, which is great. I write unit tests for that all the time.  But all possible sources of error are discovered by end-to-end tests.</p><p>å—¯ï¼Œå•å…ƒæµ‹è¯•å¯ä»¥æ‰¾åˆ°ä¸€äº›é€»è¾‘é”™è¯¯ï¼Œè¿™å¾ˆæ£’ã€‚æˆ‘ä¸€ç›´éƒ½åœ¨ä¸ºæ­¤ç¼–å†™å•å…ƒæµ‹è¯•ã€‚ä½†æ˜¯æ‰€æœ‰å¯èƒ½çš„è¯¯å·®æºéƒ½æ˜¯é€šè¿‡ç«¯åˆ°ç«¯æµ‹è¯•å‘ç°çš„ã€‚</p><p> If you can test the site you just deployed and go through the main user story â€“just like a human user would do later onâ€“ if  that worksâ€¦ the chances are when the real user goes through the same thing, it will be successful.</p><p>å¦‚æœæ‚¨å¯ä»¥æµ‹è¯•æ‚¨åˆšåˆšéƒ¨ç½²çš„ç«™ç‚¹å¹¶äº†è§£ä¸»ç”¨æˆ·æƒ…æ™¯-å°±åƒäººç±»ç”¨æˆ·ç¨åæ‰€åšçš„é‚£æ ·-å¦‚æœè¿™èƒ½æ­£å¸¸å·¥ä½œçš„è¯â€¦ã€‚å½“çœŸæ­£çš„ç”¨æˆ·ç»å†åŒæ ·çš„äº‹æƒ…æ—¶ï¼Œå®ƒå¯èƒ½ä¼šæˆåŠŸã€‚</p><p>  So if we flip the pyramid and we make the top wider and wider, and we will write more end-to-end tests, because theyâ€™re effective and we make it almost like a pizza slice, where we write more end-to-end tests, or if we start with end-to-end tests, it makes sense.</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ç¿»è½¬é‡‘å­—å¡”ï¼ŒæŠŠé¡¶éƒ¨åšå¾—è¶Šæ¥è¶Šå®½ï¼Œæˆ‘ä»¬ä¼šå†™æ›´å¤šçš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æœ‰æ•ˆçš„ï¼Œæˆ‘ä»¬è®©å®ƒå‡ ä¹åƒæŠ«è¨ç‰‡ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨é‚£é‡Œå†™æ›´å¤šçš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬ä»ç«¯åˆ°ç«¯æµ‹è¯•å¼€å§‹ï¼Œè¿™æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><p>   And what happens recently? Well, a functional tester or test runner like Cypress finds a text, clicks on the button, does all those things, but  it only verifies that the application works.</p><p>æœ€è¿‘å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼ŸåƒCypressè¿™æ ·çš„åŠŸèƒ½æµ‹è¯•è€…æˆ–æµ‹è¯•è¿è¡Œè€…æ‰¾åˆ°ä¸€ä¸ªæ–‡æœ¬ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œåšæ‰€æœ‰è¿™äº›äº‹æƒ…ï¼Œä½†å®ƒåªéªŒè¯åº”ç”¨ç¨‹åºæ˜¯å¦å·¥ä½œã€‚</p><p> It  doesnâ€™t verify that the applications looks good. And weâ€™re all humans. We like pretty things, so we like styles. Some people even add CSS to their apps. I donâ€™t know why, but itâ€™s crazy. ğŸ˜‰</p><p>å®ƒä¸ä¼šéªŒè¯åº”ç”¨ç¨‹åºçœ‹èµ·æ¥æ˜¯å¦è‰¯å¥½ã€‚æˆ‘ä»¬éƒ½æ˜¯äººç±»ã€‚æˆ‘ä»¬å–œæ¬¢æ¼‚äº®çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å–œæ¬¢æ¬¾å¼ã€‚æœ‰äº›äººç”šè‡³å°†CSSæ·»åŠ åˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†è¿™å¤ªç–¯ç‹‚äº†ã€‚ğŸ˜‰ã€‚</p><p> Once they add CSS and they do the styling, they want to make sure the app looks the same, and they donâ€™t accidentally break it.</p><p>ä¸€æ—¦ä»–ä»¬æ·»åŠ äº†CSSå¹¶è®¾è®¡äº†æ ·å¼ï¼Œä»–ä»¬å¸Œæœ›ç¡®ä¿åº”ç”¨ç¨‹åºçœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä¸ä¼šä¸å°å¿ƒå¼„åå®ƒã€‚</p><p> If we select elements, and you work with them, and you check the number of items, the CSS can still change. And then the application will look like crap, and users will be unhappy, and nobody is gonna buy anything from your website.</p><p>å¦‚æœæˆ‘ä»¬é€‰æ‹©å…ƒç´ ï¼Œå¹¶ä¸”æ‚¨ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶ä¸”æ‚¨æ£€æŸ¥é¡¹ç›®çš„æ•°é‡ï¼ŒCSSä»ç„¶å¯ä»¥æ›´æ”¹ã€‚ç„¶ååº”ç”¨ç¨‹åºçœ‹èµ·æ¥å°±åƒåƒåœ¾ä¸€æ ·ï¼Œç”¨æˆ·ä¼šä¸é«˜å…´ï¼Œæ²¡æœ‰äººä¼šä»ä½ çš„ç½‘ç«™ä¸Šä¹°ä»»ä½•ä¸œè¥¿ã€‚</p><p> Cypress is just a functional test runner.  It doesnâ€™t care about CSS. And itâ€™s very hard to write all the assertions saying:</p><p>èµ›æ™®æ‹‰æ–¯åªæ˜¯ä¸€ä¸ªåŠŸèƒ½æµ‹è¯•è·‘æ­¥è€…ã€‚å®ƒä¸å…³å¿ƒCSSã€‚å¾ˆéš¾å†™å‡ºæ‰€æœ‰çš„æ–­è¨€è¯´ï¼š</p><p> The color of this element should be blue, and the border radius should be 2â€¦</p><p>æ­¤å…ƒç´ çš„é¢œè‰²åº”ä¸ºè“è‰²ï¼Œè¾¹æ¡†åŠå¾„åº”ä¸º2â€¦</p><p>   So instead, what people do â€“because itâ€™s a real browserâ€“ is you can take and generate a screenshot of your page (or a part of it) and then you can do visual testing.</p><p>å› æ­¤ï¼Œäººä»¬æ‰€åšçš„-å› ä¸ºå®ƒæ˜¯çœŸæ­£çš„æµè§ˆå™¨-æ˜¯æ‚¨å¯ä»¥è·å–å¹¶ç”Ÿæˆé¡µé¢(æˆ–é¡µé¢çš„ä¸€éƒ¨åˆ†)çš„å±å¹•æˆªå›¾ï¼Œç„¶åæ‚¨å¯ä»¥è¿›è¡Œè§†è§‰æµ‹è¯•ã€‚</p><p> So you save a screenshot and it becomes a baseline or a master image. The next time you run the test you take another screenshot and then you  compare it pixel by pixel with your baseline imagine. And you store those baseline images with your source code in your repository.</p><p>å› æ­¤ï¼Œæ‚¨ä¿å­˜ä¸€ä¸ªå±å¹•æˆªå›¾ï¼Œå®ƒå°†æˆä¸ºåŸºçº¿æˆ–ä¸»å›¾åƒã€‚ä¸‹æ¬¡è¿è¡Œæµ‹è¯•æ—¶ï¼Œæ‚¨å°†æ‹æ‘„å¦ä¸€ä¸ªå±å¹•æˆªå›¾ï¼Œç„¶åé€ä¸ªåƒç´ åœ°å°†å…¶ä¸æ‚¨çš„åŸºçº¿å›¾åƒè¿›è¡Œæ¯”è¾ƒã€‚ç„¶åå°†è¿™äº›åŸºçº¿å›¾åƒä¸æºä»£ç ä¸€èµ·å­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­ã€‚</p><p> Computers are really good at comparing images pixel by pixel, and theyâ€™ll tell you:</p><p>è®¡ç®—æœºéå¸¸æ“…é•¿é€ä¸ªåƒç´ åœ°æ¯”è¾ƒå›¾åƒï¼Œå®ƒä»¬ä¼šå‘Šè¯‰ä½ ï¼š</p><p>   It used to be this. Now itâ€™s a different color. Hereâ€™s where it changed</p><p>ä»¥å‰æ˜¯è¿™æ ·çš„ã€‚ç°åœ¨æ˜¯ä¸åŒçš„é¢œè‰²äº†ã€‚è¿™é‡Œæ˜¯å®ƒæ”¹å˜çš„åœ°æ–¹ã€‚</p><p>  Did they mean to change the CSS here? Why is it no longer blue and now red?</p><p>ä»–ä»¬çš„æ„æ€æ˜¯è¦æ›´æ”¹è¿™é‡Œçš„CSSå—ï¼Ÿä¸ºä»€ä¹ˆå®ƒä¸å†æ˜¯è“è‰²è€Œç°åœ¨æ˜¯çº¢è‰²ï¼Ÿ</p><p> Visual testing to me is such an effective tool, paired with a full end-to-end test.,You can literally load the application, take a screenshot, and now you know  it will never change accidentally. Do something where the application reacts, changes the layout, new DOM elements appear. Then you take another screenshot.</p><p>å¯¹æˆ‘æ¥è¯´ï¼Œè§†è§‰æµ‹è¯•æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„å·¥å…·ï¼Œé…ä¸Šå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œä½ å¯ä»¥ç›´æ¥åŠ è½½åº”ç”¨ç¨‹åºï¼Œæˆªå›¾ï¼Œç°åœ¨ä½ çŸ¥é“å®ƒæ°¸è¿œä¸ä¼šæ„å¤–æ”¹å˜ã€‚åœ¨åº”ç”¨ç¨‹åºåšå‡ºååº”ã€æ›´æ”¹å¸ƒå±€ã€å‡ºç°æ–°çš„DOMå…ƒç´ æ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚ç„¶åå†æˆªå–å¦ä¸€å¼ å±å¹•æˆªå›¾ã€‚</p><p> Boom. Now you tie it so close, any visual change (any CSS, SVG, anything) will change with pixels, and youâ€™ll know that you accidentally broke the styling. And youâ€™ll know that accidentally you made Craigslist look like Redditâ€¦</p><p>ç °çš„ä¸€å£°ã€‚ç°åœ¨ä½ æŠŠå®ƒç»‘å¾—å¤ªç´§äº†ï¼Œä»»ä½•è§†è§‰æ”¹å˜(ä»»ä½•CSSã€SVGï¼Œä»»ä½•ä¸œè¥¿)éƒ½ä¼šéšç€åƒç´ çš„å˜åŒ–è€Œæ”¹å˜ï¼Œä½ å°±ä¼šçŸ¥é“ä½ ä¸å°å¿ƒç ´åäº†æ ·å¼ã€‚ä½ ä¼šçŸ¥é“ä½ ä¸å°å¿ƒè®©Craigslistçœ‹èµ·æ¥åƒRedditâ€¦ã€‚</p><p>   So to me, the most useful pyramid right now is a pyramid thatâ€™s wholly end-to-end, functional and visual tests. Thatâ€™s it.</p><p>æ‰€ä»¥å¯¹æˆ‘æ¥è¯´ï¼Œç°åœ¨æœ€æœ‰ç”¨çš„é‡‘å­—å¡”æ˜¯ä¸€ä¸ªé‡‘å­—å¡”ï¼Œå®Œå…¨æ˜¯ç«¯åˆ°ç«¯çš„ï¼ŒåŠŸèƒ½å’Œè§†è§‰æµ‹è¯•ã€‚å°±è¿™æ ·ã€‚</p><p> And then, I can track code coverage instrumenting my application code; the end-to-end tests that will go through the whole flow, like a real user, are so effective at code coverage.</p><p>ç„¶åï¼Œæˆ‘å¯ä»¥é€šè¿‡æ£€æµ‹åº”ç”¨ç¨‹åºä»£ç æ¥è·Ÿè¸ªä»£ç è¦†ç›–ç‡ï¼›å°†è´¯ç©¿æ•´ä¸ªæµç¨‹çš„ç«¯åˆ°ç«¯æµ‹è¯•(å°±åƒçœŸæ­£çš„ç”¨æˆ·ä¸€æ ·)åœ¨ä»£ç è¦†ç›–ç‡æ–¹é¢éå¸¸æœ‰æ•ˆã€‚</p><p>    Well, because end-to-end tests exercise the whole application, a single test can cover most of it, if it goes through the whole user story.</p><p>å—¯ï¼Œå› ä¸ºç«¯åˆ°ç«¯æµ‹è¯•æµ‹è¯•äº†æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå¦‚æœå®ƒè´¯ç©¿æ•´ä¸ªç”¨æˆ·æ•…äº‹ï¼Œé‚£ä¹ˆä¸€ä¸ªæµ‹è¯•å°±å¯ä»¥æ¶µç›–å¤§éƒ¨åˆ†å†…å®¹ã€‚</p><p> And then you look at the lines not covered, and you write end-to-end tests for those edge cases. And if you cannot reach both lines, because there could be edge cases that are unreachable through a well-designed interface, then you write end-to-end tests, API tests and component tests, and hit those lines, so you know that those components and unit tests of code work as well.</p><p>ç„¶åæŸ¥çœ‹æœªè¦†ç›–çš„è¡Œï¼Œå¹¶ä¸ºè¿™äº›è¾¹ç¼˜æƒ…å†µç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•ã€‚å¦‚æœæ‚¨æ— æ³•åŒæ—¶è®¿é—®è¿™ä¸¤è¡Œï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨æ— æ³•é€šè¿‡è®¾è®¡è‰¯å¥½çš„æ¥å£è®¿é—®çš„è¾¹ç¼˜æƒ…å†µï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•ã€APIæµ‹è¯•å’Œç»„ä»¶æµ‹è¯•ï¼Œç„¶åå•å‡»è¿™äº›è¡Œï¼Œå› æ­¤æ‚¨çŸ¥é“è¿™äº›ä»£ç çš„ç»„ä»¶å’Œå•å…ƒæµ‹è¯•ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p><p> But it becomes a pyramid of end-to-end tests, little triangles for other types of tests, and to me it looks like a crab, because itâ€™s a big kind of helmet shell, and little armored legs under it.</p><p>ä½†å®ƒå˜æˆäº†ç«¯åˆ°ç«¯æµ‹è¯•çš„é‡‘å­—å¡”ï¼Œå…¶ä»–ç±»å‹æµ‹è¯•çš„å°ä¸‰è§’å½¢ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥åƒä¸€åªèƒèŸ¹ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ç§å¾ˆå¤§çš„å¤´ç›”å£³ï¼Œåœ¨å®ƒä¸‹é¢æœ‰å°è£…ç”²çš„è…¿ã€‚</p><p>     Our conversation with Gleb doesnâ€™t stop there. Listen to the entire episode to hear the story of Cypress, how they found a business model around open source, how  you can make your end-to-end tests less brittle, and much more. Play it from the start right here ğŸ‘‡</p><p>æˆ‘ä»¬å’Œæ ¼è±å¸ƒçš„è°ˆè¯ä¸æ­¢äºæ­¤ã€‚æ”¶å¬æ•´é›†ï¼Œå¬å¬Cypressçš„æ•…äº‹ï¼Œä»–ä»¬æ˜¯å¦‚ä½•å›´ç»•å¼€æºæ‰¾åˆ°ä¸€ç§å•†ä¸šæ¨¡å¼çš„ï¼Œä½ å¦‚ä½•è®©ä½ çš„ç«¯åˆ°ç«¯æµ‹è¯•ä¸é‚£ä¹ˆè„†å¼±ï¼Œç­‰ç­‰ã€‚ä»è¿™é‡Œå¼€å§‹æ’­æ”¾ï¼Œå°±åœ¨è¿™é‡Œï¼ŒğŸ‘‡ã€‚</p><p>  Oh, and donâ€™t forget to subscribe to  JS Party in your favorite podcast app so you donâ€™t miss future episodes and insights. âœŒï¸</p><p>å“¦ï¼Œåˆ«å¿˜äº†åœ¨ä½ æœ€å–œæ¬¢çš„æ’­å®¢åº”ç”¨ä¸­è®¢é˜…JS Partyï¼Œè¿™æ ·ä½ å°±ä¸ä¼šé”™è¿‡æœªæ¥çš„å‰§é›†å’Œæ´å¯ŸåŠ›ã€‚âœŒï¸</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://changelog.com/posts/the-testing-pyramid-should-look-more-like-a-crab">https://changelog.com/posts/the-testing-pyramid-should-look-more-like-a-crab</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/é‡‘å­—å¡”/">#é‡‘å­—å¡”</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/pyramid/">#pyramid</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/æµ‹è¯•/">#æµ‹è¯•</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¾å›½/">#ç¾å›½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¨‹åº/">#ç¨‹åº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>何时在Java HashMap中触发调整大小？</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">何时在Java HashMap中触发调整大小？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-06 22:54:28</div><div class="page_narrow text-break page_content"><p>HashMap是Java中最常用的集合类型之一，它存储键-值对。理想情况下，它期望使用哈希表，期望数据访问时间复杂度为O(1)，然而，由于哈希冲突，现实中使用链表或红黑树来存储数据，这使得最坏情况下的时间复杂度为O(Logn)。</p><p>虽然集合使用像数组和链表这样的数据结构，但与数组不同的是，当没有足够的空间存储数据时，它们将动态调整大小，因为这涉及将数据从旧数组复制到新数组，这被认为是一项繁重的操作，因此通常可以指定初始容量，以避免在已经估计条目数量的情况下不必要的大小调整。</p><p>在决定正确的初始容量之前，需要回答的一个重要问题是何时在HashMap中触发调整大小？</p><p>HashMap提供了一个可以接受初始容量值的构造函数方法，最终该构造函数方法将调用另一个默认负载因子值为0.75的构造函数方法。</p><p>public HashMap(int initialCapacity，Float loadFactor){if(initialCapacity&lt；0)抛出新的IllegalArgumentException(&#34；非法初始容量：&#34；+initialCapacity)；if(initialCapacity&&gt;；Maximum_Capacity)initialCapacity=Maximum_Capacity；IF(loadFactor&lt；=0||Float.isNaN(Loadfactor))抛出新的IllegalArgumentException(&#。</p><p>这里的阈值是用于确定何时应该触发大小调整的阈值。从赋值中，它不直接获取初始容量值，而是调用另一个方法tableSizeFor()来计算阈值。</p><p>静态最终int tableSizeFor(Int Cap){int n=cap-1；n|=n&gt；&gt；&gt；1；n|=n&gt；&gt；&gt；2；n|=n&gt；&gt；&gt；4；n|=n&gt；&gt；&gt；8；n|=n&gt；&gt；&gt；16；return(n&lt；0。最大容量：N+1；}。</p><p>计算值将类似于2^N，它允许查找旧数据在新表中的位置。</p><p>当10000是初始容量时，我们可能认为它会在添加10000*0.75=7500个条目后触发大小调整。事实是，在运行tableSizeFor()之后，它调整大小的阈值变为2^14=16384。这是否意味着即使在Hashmap中添加了10000个条目，它也不会触发调整大小？</p><p>如果1000是初始容量怎么办？计算后的阈值将是2^10=1024，因此在添加1000个条目后也不会触发调整大小？</p><p>要理解这一点，还有另一个问题需要回答，表何时初始化？resize()的目的是在达到阈值时调整表的大小，但它还有另一个用途，resize()还负责表的初始化。</p><p>当使用构造函数方法创建HashMap对象时，它只会在将第一个值放入映射时初始化表。</p><p>Final V putVal(int hash，K key，Vvalue，Boolean Only IfAbsend，Boolean Eevict){Node&lt；K，V&gt；[]tab；Node&lt；K，V&gt；p；int n，i；if((tab=table)==null||(n=tab.length)=0)n=(tab=resize()).length；//调用resize()//.}。</p><p>最终节点&lt；K，V&&gt;；[]Resize(){Node&lt；K，V&&gt;；[]oldTab=table；int oldCap=(oldTab==null)？0：oldTab.length；int oldThr=Threshold；int NewCap，newThr=0；IF(oldCap&&gt;0){if(oldCap&&gt;t；=Maximum_Capacity){Threshold=Integer.MAX。Maximum_Capacity&amp；&amp；oldCap&&gt;；=Default_Initial_Capacity)newThr=oldThr；&lt；1；}Else If(oldThr&gt；0)NewCap=oldThr；//1 Else{NewCap=Default_Initial_Capacity；newThr=(Int)(Default_Load_factor*Default_Initial_Capacity)；}If(newThr=0){//2 Float ft=(Float)NewCap。FT&lt；(Float)Maximum_Capacity？(Int)ft：Integer.MAX_VALUE)；}Threshold=newThr；//3 Node&lt；K，V&gt；[]newTab=(Node&lt；K，V&gt；[])new Node[NewCap]；table=newTab；//4//.}。</p><p>当指定了初始容量但表尚未初始化时，它会将oldThr分配给NewCap，因此创建的新表将具有初始阈值的大小。那么门槛将调整为NewCap*0.75.。在此之后，将创建并初始化表。</p><p>因此，如果初始容量为1000，则触发调整大小的实际阈值将为1024*0.75=768，这意味着将在添加1000个条目之前触发调整大小。如果初始大小为10000，则触发调整大小的实际阈值为16384*0.75=12288。</p><p>因此，在创建HashMap对象时指定初始容量值时，要指定的实际值应该计算为预期的初始容量/负载因子，以避免意外的大小调整。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.pixelstech.net/article/1588467060-When-will-resizing-be-triggered-in-Java-HashMap">https://www.pixelstech.net/article/1588467060-When-will-resizing-be-triggered-in-Java-HashMap</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/hashmap/">#hashmap</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/triggered/">#triggered</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/int/">#int</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1000303.html"><img src="http://img.diglog.com/img/2020/5/thumb_10d0075f0a234a5f330d3c1e530921c2.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000303.html">Java Feature Spotlight：文本块</a></div><span class="my_story_list_date">2020-5-2 18:5</span></div><div class="col-sm"><div><a target="_blank" href="/story/technology_developers_768883.html"><img src="http://img.diglog.com/img/2013/12/thumb_d0d7d124-a057-4e84-9d7a-4e2f54cfd4be.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/technology_developers_768883.html">IntelliJ IDEA 13 发布</a></div><span class="my_story_list_date">2013-12-5 9:11</span></div><div class="col-sm"><div><a target="_blank" href="/story/technology_developers_762079.html"><img src="http://img.diglog.com/img/2013/7/thumb_2c7d6e00-70a1-4275-b5b5-5ec1bd753a63.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/technology_developers_762079.html">最受欢迎的8位Java牛人</a></div><span class="my_story_list_date">2013-7-22 11:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/technology_internet_388357.html"><img src="http://img.diglog.com/img/2011/3/thumb_c08b54dd06f74e80b6291f8d2c26c237.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/technology_internet_388357.html">浏览器速度大比拼：Firefox 4 VS Internet Explorer 9 VS Chrome VS Opera</a></div><span class="my_story_list_date">2011-3-24 16:34</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ç‰©è”ç½‘åˆ†è§£ç¬¬äºŒéƒ¨åˆ†ï¼šIPåœ°å€ï¼Œç½‘ç»œï¼ŒZigbeeï¼Œè‡ªå®šä¹‰å›ºä»¶ï¼Œç„Šæ¥IoT Unravelled Part 2: IP Addresses, Network, Zigbee, Custom Firmware, Soldering</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">IoT Unravelled Part 2: IP Addresses, Network, Zigbee, Custom Firmware, Soldering<br/>ç‰©è”ç½‘åˆ†è§£ç¬¬äºŒéƒ¨åˆ†ï¼šIPåœ°å€ï¼Œç½‘ç»œï¼ŒZigbeeï¼Œè‡ªå®šä¹‰å›ºä»¶ï¼Œç„Šæ¥</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-24 16:46:40</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/8db2e366564e2c12ed24a02c34dad838.png"><img src="http://img2.diglog.com/img/2020/11/8db2e366564e2c12ed24a02c34dad838.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In  part 1, I deliberately kept everything really high level because frankly, I didn&#39;t want to scare people off. I&#39;m not ashamed to say that the process of getting even the basics working absolutely did my head in as I waded through a sea of unfamiliar technologies, protocols and acronyms. I wish I&#39;d had just the fundamentals down pat before going deeper and that was my intention with the first part of the series.</p><p>åœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘æ•…æ„å°†æ‰€æœ‰å†…å®¹éƒ½ä¿æŒåœ¨è¾ƒé«˜æ°´å¹³ï¼Œå› ä¸ºå¦ç‡åœ°è¯´ï¼Œæˆ‘ä¸æƒ³å“toäººã€‚æˆ‘ä¸æ„Ÿåˆ°ç¾è€»åœ°è¯´ï¼Œå½“æˆ‘åœ¨ä¸ç†Ÿæ‚‰çš„æŠ€æœ¯ï¼Œåè®®å’Œé¦–å­—æ¯ç¼©ç•¥è¯çš„æµ·æ´‹ä¸­è‹¦è‹¦æŒ£æ‰æ—¶ï¼Œç”šè‡³ä½¿åŸºç¡€çŸ¥è¯†å®Œå…¨æ­£å¸¸å·¥ä½œçš„è¿‡ç¨‹ä¹Ÿå¼•èµ·äº†æˆ‘çš„æ³¨æ„ã€‚æˆ‘å¸Œæœ›æˆ‘åœ¨æ·±å…¥ä¹‹å‰åªæ˜¯å¯¹åŸºæœ¬é¢æœ‰æ‰€äº†è§£ï¼Œè¿™æ˜¯æˆ‘å¯¹æœ¬ç³»åˆ—ç¬¬ä¸€éƒ¨åˆ†çš„åˆè¡·ã€‚</p><p> So, peeling back that next layer, the whole IoT space isn&#39;t just about devices that get their own IP address on your network and talk over TCP (or UDP). Many of them do (such as the Shelly switch in part 1), but then there&#39;s the whole Zigbee space as well. Let&#39;s drill into all that and then go deeper into custom firmware and soldering too.</p><p> å› æ­¤ï¼Œå‰¥ç¦»ä¸‹ä¸€å±‚ï¼Œæ•´ä¸ªIoTç©ºé—´ä¸ä»…æ¶‰åŠåœ¨ç½‘ç»œä¸Šæ‹¥æœ‰è‡ªå·±çš„IPåœ°å€å¹¶é€šè¿‡TCPï¼ˆæˆ–UDPï¼‰è¿›è¡Œé€šä¿¡çš„è®¾å¤‡ã€‚ä»–ä»¬ä¸­çš„è®¸å¤šäººéƒ½åšè¿‡ï¼ˆä¾‹å¦‚ç¬¬1éƒ¨åˆ†ä¸­çš„Shellyå¼€å…³ï¼‰ï¼Œä½†åŒæ—¶ä¹Ÿæœ‰æ•´ä¸ªZigbeeç©ºé—´ã€‚è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶æ‰€æœ‰å†…å®¹ï¼Œç„¶åå†æ·±å…¥ç ”ç©¶è‡ªå®šä¹‰å›ºä»¶å’Œç„Šæ¥ã€‚</p><p>  So, what happens when you start filling your home with IoT things? You end up assigning a lot of IP addresses; here&#39;s what it looks like in  Ubiquiti&#39;s UniFi dashboard:</p><p>  é‚£ä¹ˆï¼Œå½“æ‚¨å¼€å§‹ç”¨IoTç‰©èµ„å¡«å……æˆ¿å±‹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ‚¨æœ€ç»ˆåˆ†é…äº†å¾ˆå¤šIPåœ°å€ï¼›è¿™æ˜¯Ubiquitiçš„UniFiä»ªè¡¨æ¿ä¸­çš„å¤–è§‚ï¼š</p><p>  Clearly, I have a long way to go before exhausting available IPV4 addresses on this subnet so that&#39;s not something that worries me right now. Plus, all my IoT devices are on their own Wi-Fi network and it&#39;d be dead simple just to start assigning those devices IPs from a different subnet (more on that in part 3 about security). IPV6? It&#39;s rare to see in IoT devices today, but  there are many compelling reasons that make a lot of sense to see broader support in the future.</p><p>  æ˜¾ç„¶ï¼Œåœ¨ç”¨å°½æ­¤å­ç½‘ä¸Šçš„å¯ç”¨IPV4åœ°å€ä¹‹å‰ï¼Œæˆ‘è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œæ‰€ä»¥ç°åœ¨è¿™å¹¶ä¸æ˜¯è®©æˆ‘æ‹…å¿ƒçš„äº‹æƒ…ã€‚å¦å¤–ï¼Œæˆ‘æ‰€æœ‰çš„ç‰©è”ç½‘è®¾å¤‡éƒ½ä½äºè‡ªå·±çš„Wi-Fiç½‘ç»œä¸Šï¼Œåªæ˜¯å¼€å§‹ä»ä¸åŒçš„å­ç½‘åˆ†é…è¿™äº›è®¾å¤‡çš„IPéå¸¸ç®€å•ï¼ˆç¬¬3éƒ¨åˆ†ä¸­æœ‰å…³å®‰å…¨æ€§çš„æ›´å¤šä¿¡æ¯ï¼‰ã€‚ IPV6ï¼Ÿåœ¨å½“ä»Šçš„ç‰©è”ç½‘è®¾å¤‡ä¸­å¾ˆå°‘è§åˆ°ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šä»¤äººä¿¡æœçš„åŸå› åœ¨å°†æ¥è·å¾—æ›´å¹¿æ³›çš„æ”¯æŒå¾ˆæœ‰é“ç†ã€‚</p><p> For the most part, the IoT devices in my home simply take their IP address from the DHCP server and I never think about it again. There are, however, occasions where you end up getting tied to specific IP addresses. For example, here&#39;s how the downlights in my office are configured in HA courtesy of  the Wiz integration:</p><p> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘å®¶ä¸­çš„IoTè®¾å¤‡ä»…ä»DHCPæœåŠ¡å™¨è·å–å…¶IPåœ°å€ï¼Œè€Œæˆ‘å†ä¹Ÿæ²¡æœ‰è€ƒè™‘å®ƒã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨æœ€ç»ˆä¼šç»‘å®šåˆ°ç‰¹å®šçš„IPåœ°å€ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯é€šè¿‡Wizé›†æˆåœ¨HAä¸­é…ç½®åŠå…¬å®¤çš„ç­’ç¯çš„æ–¹æ³•ï¼š</p><p>  Then, one day, the lights stopped working. Why? They worked fine in the native Wiz app, why were they dead in HA? Back into the UniFi dashboard, down to the Wiz lights and... ah:</p><p>  ç„¶åï¼Œä¸€å¤©ï¼Œç¯å…‰åœæ­¢å·¥ä½œã€‚ä¸ºä»€ä¹ˆï¼Ÿä»–ä»¬åœ¨æœ¬åœ°çš„Wizåº”ç”¨ç¨‹åºä¸­è¿è¡Œè‰¯å¥½ï¼Œä¸ºä»€ä¹ˆåœ¨HAä¸­æ­»äº†ï¼Ÿå›åˆ°UniFiä»ªè¡¨æ¿ï¼Œå‘ä¸‹åˆ°Wizç¯ï¼Œç„¶å...å•Šï¼š</p><p>  Because they&#39;re dynamically assigned an IP address, at some stage the lights had restarted and got themselves new ones. The fix, however, was easy:</p><p>  å› ä¸ºå®ƒä»¬æ˜¯åŠ¨æ€åˆ†é…çš„IPåœ°å€ï¼Œæ‰€ä»¥åœ¨æŸäº›æ—¶å€™ï¼ŒæŒ‡ç¤ºç¯å·²é‡æ–°å¯åŠ¨ï¼Œå¹¶é‡æ–°å®‰è£…äº†æ–°çš„æŒ‡ç¤ºç¯ã€‚ä½†æ˜¯ï¼Œæ­¤ä¿®å¤å¾ˆå®¹æ˜“ï¼š</p><p>  I got to thinking more about IP address reservation (which is what you see above where the same IP is always assigned by the DHCP server) versus static IP address (where the IP is set in the client itself), after having to totally rebuild my network. (If you&#39;re interested in what happened, I covered it in detail in  weekly update video 216.) There&#39;s a good overview of the two approaches  here but in a nutshell, central management is always preferable. It means it&#39;s very easy to jump into the UniFi dashboard and get a quick list of all the fixed IP addresses in the network (it&#39;s under &#34;Insights&#34;):</p><p>åœ¨å¿…é¡»å®Œå…¨é‡å»ºæˆ‘çš„IPåœ°å€åï¼Œæˆ‘ä¸å¾—ä¸æ›´å¤šåœ°è€ƒè™‘IPåœ°å€ä¿ç•™ï¼ˆè¿™æ˜¯æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œå§‹ç»ˆç”±DHCPæœåŠ¡å™¨åˆ†é…ç›¸åŒçš„IPï¼‰ä¸é™æ€IPåœ°å€ï¼ˆå…¶ä¸­IPæ˜¯åœ¨å®¢æˆ·ç«¯æœ¬èº«ä¸­è®¾ç½®çš„ï¼‰ã€‚ç½‘ç»œã€‚ ï¼ˆå¦‚æœæ‚¨å¯¹å‘ç”Ÿçš„äº‹æƒ…æ„Ÿå…´è¶£ï¼Œæˆ‘ä¼šåœ¨æ¯å‘¨çš„æ›´æ–°è§†é¢‘216ä¸­å¯¹å…¶è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ï¼‰è¿™é‡Œå¯¹è¿™ä¸¤ç§æ–¹æ³•æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚è¿°ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œä¸­å¤®ç®¡ç†å§‹ç»ˆæ˜¯å¯å–çš„ã€‚è¿™æ„å‘³ç€è·³è½¬åˆ°UniFiä»ªè¡¨æ¿å¹¶è·å¾—ç½‘ç»œä¸­æ‰€æœ‰å›ºå®šIPåœ°å€çš„å¿«é€Ÿåˆ—è¡¨éå¸¸å®¹æ˜“ï¼ˆä½äºâ€œ Insightsâ€ä¸‹ï¼‰ï¼š</p><p>  The kids&#39; Nanoleaves also use reserved IPs because like the Wiz lights, the HA integration needs a hard-coded IP address for the device. Having easy access to configurability such as this at the network layer is really essential, so let&#39;s delve into that network layer and talk about good gear.</p><p>  å­©å­ä»¬çš„Nanoleavesä¹Ÿä½¿ç”¨ä¿ç•™çš„IPï¼Œå› ä¸ºåƒWizç¯ä¸€æ ·ï¼ŒHAé›†æˆä¹Ÿéœ€è¦è®¾å¤‡çš„ç¡¬ç¼–ç IPåœ°å€ã€‚åœ¨ç½‘ç»œå±‚ä¸Šè½»æ¾è®¿é—®è¯¸å¦‚æ­¤ç±»çš„å¯é…ç½®æ€§ç¡®å®è‡³å…³é‡è¦ï¼Œå› æ­¤è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶è¯¥ç½‘ç»œå±‚å¹¶è®¨è®ºè‰¯å¥½çš„è£…å¤‡ã€‚</p><p>  As you&#39;re probably starting to gather from this series (and you&#39;ll see more of this as it progresses), you find yourself spending a lot of time troubleshooting problems. Why can&#39;t I see a device? Why can only some clients see a device? Why is the device slow to respond? Why have I started drinking so much since beginning my IoT journey? Having good visibility into my network configuration has been absolutely essential in helping answer those questions.</p><p>  å½“æ‚¨å¯èƒ½å¼€å§‹ä»æœ¬ç³»åˆ—æ–‡ç« ä¸­æ”¶é›†ä¿¡æ¯æ—¶ï¼ˆéšç€å®ƒçš„è¿›å±•ï¼Œæ‚¨ä¼šçœ‹åˆ°æ›´å¤šï¼‰ï¼Œæ‚¨ä¼šå‘ç°è‡ªå·±èŠ±è´¹å¤§é‡æ—¶é—´æ¥è§£å†³é—®é¢˜ã€‚ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°è®¾å¤‡ï¼Ÿä¸ºä»€ä¹ˆåªæœ‰æŸäº›å®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°è®¾å¤‡ï¼Ÿä¸ºä»€ä¹ˆè®¾å¤‡å“åº”é€Ÿåº¦æ…¢ï¼Ÿè‡ªä»å¼€å§‹ç‰©è”ç½‘ä¹‹æ—…ä»¥æ¥ï¼Œä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆè¦å–è¿™ä¹ˆå¤šé…’ï¼Ÿæ‹¥æœ‰å¯¹æˆ‘çš„ç½‘ç»œé…ç½®çš„è‰¯å¥½å¯è§æ€§å¯¹äºå¸®åŠ©å›ç­”è¿™äº›é—®é¢˜ç»å¯¹è‡³å…³é‡è¦ã€‚</p><p> I&#39;ve been a vocal proponent of Ubiquiti&#39;s gear for many years now and it&#39;s an absolutely essential part of my IoT world. (Disclosure: I bought every piece of equipment in that original blog post. Since then, they&#39;ve sent me a bunch of gear.) For example, when I look at my network topology today, I can easily see everything that&#39;s connected to everything else:</p><p> å¤šå¹´æ¥ï¼Œæˆ‘ä¸€ç›´æ˜¯Ubiquitiè£…å¤‡çš„å£°éŸ³æ‹¥æŠ¤è€…ï¼Œè¿™æ˜¯æˆ‘çš„ç‰©è”ç½‘ä¸–ç•Œä¸­å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚ ï¼ˆæŠ«éœ²ï¼šæˆ‘åœ¨åŸå§‹åšå®¢æ–‡ç« ä¸­è´­ä¹°äº†æ¯å°è®¾å¤‡ã€‚ä»é‚£ä»¥åï¼Œå®ƒä»¬ç»™äº†æˆ‘å¾ˆå¤šè£…å¤‡ã€‚ï¼‰ä¾‹å¦‚ï¼Œå½“æˆ‘ä»Šå¤©æŸ¥çœ‹æˆ‘çš„ç½‘ç»œæ‹“æ‰‘æ—¶ï¼Œæˆ‘å¯ä»¥è½»æ¾åœ°çœ‹åˆ°è¿æ¥åˆ°æ‰€æœ‰ç»„ä»¶çš„æ‰€æœ‰ç»„ä»¶å…¶ä»–ï¼š</p><p>  I&#39;ve named each and every device I&#39;ve added to the network and given it a descriptive icon so that at a glance, I can get a really good idea of how everything is tied together. I can easily block a device from talking to the internet, throttle its connection, see which online services it&#39;s communicating with and access a whole host of other information about it. For example, just today I was trying to identify one pesky device I hadn&#39;t named earlier on and now had no idea what it was:</p><p>  æˆ‘å·²ç»å‘½åäº†æˆ‘æ·»åŠ åˆ°ç½‘ç»œä¸­çš„æ¯å°è®¾å¤‡ï¼Œå¹¶ç»™äº†å®ƒä¸€ä¸ªæè¿°æ€§çš„å›¾æ ‡ï¼Œä»¥ä¾¿ä¸€çœ¼å°±èƒ½çŸ¥é“å¦‚ä½•å°†æ‰€æœ‰ä¸œè¥¿æ†ç»‘åœ¨ä¸€èµ·ã€‚æˆ‘å¯ä»¥è½»æ¾åœ°é˜»æ­¢è®¾å¤‡ä¸Interneté€šè®¯ï¼Œé™åˆ¶å…¶è¿æ¥ï¼ŒæŸ¥çœ‹æ­£åœ¨ä¸å“ªäº›åœ¨çº¿æœåŠ¡è¿›è¡Œé€šä¿¡ä»¥åŠè®¿é—®æœ‰å…³è¯¥è®¾å¤‡çš„å¤§é‡å…¶ä»–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå°±åœ¨ä»Šå¤©ï¼Œæˆ‘è¯•å›¾è¯†åˆ«ä¸€ä¸ªæˆ‘ä¹‹å‰æ²¡æœ‰å‘½åçš„è®¨åŒçš„è®¾å¤‡ï¼Œç°åœ¨å´ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼š</p><p> Trying to figure out what a client I&#39;d previously connected to my network is. I put it on my IoT network, it&#39;s connected to my Office AP and it&#39;s running Linux and downloading data from Amazon and Spotify, ideas?  pic.twitter.com/PE3eVLseFY</p><p> è¯•å›¾å¼„æ¸…æ¥šæˆ‘ä»¥å‰è¿æ¥åˆ°ç½‘ç»œçš„å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆã€‚æˆ‘å°†å…¶æ”¾åœ¨IoTç½‘ç»œä¸Šï¼Œå°†å…¶è¿æ¥åˆ°Office APï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡ŒLinuxï¼Œå¹¶ä»Amazonå’ŒSpotifyä¸‹è½½æ•°æ®ï¼Œæƒ³æ³•ï¼Ÿ pic.twitter.com/PE3eVLseFY</p><p>â€” Troy Hunt (@troyhunt)  November 24, 2020</p><p>-ç‰¹æ´›ä¼ŠÂ·äº¨ç‰¹ï¼ˆ@troyhuntï¼‰2020å¹´11æœˆ24æ—¥</p><p>   The Wi-Fi network is the foundation on which the IoT network is built. Investing in that was the best thing I could have done in advance of joining all the things to my network. But not all IoT is IP-based, far from it. Let&#39;s jump into Zigbee.</p><p>Wi-Fiç½‘ç»œæ˜¯æ„å»ºç‰©è”ç½‘ç½‘ç»œçš„åŸºç¡€ã€‚åœ¨å°†æ‰€æœ‰å†…å®¹åŠ å…¥åˆ°æˆ‘çš„ç½‘ç»œä¹‹å‰ï¼ŒæŠ•èµ„è¯¥ç±»å†…å®¹æ˜¯æˆ‘æœ¬å¯ä»¥åšçš„æœ€å¥½çš„äº‹æƒ…ã€‚ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰çš„ç‰©è”ç½‘éƒ½åŸºäºIPï¼Œè·ç¦»å®ƒè¿˜å¾ˆè¿œã€‚è®©æˆ‘ä»¬è·³å…¥Zigbeeã€‚</p><p>  Alrighty, first things first:  It&#39;s Zigbee, not ZigBee. I&#39;m a stickler for details like this and it was driving me nuts seeing both stylisations all over the place but as of 2017, the &#34;b&#34; is lowercase (because I&#39;m a stickler I kept scrolling back through zigbee.com on archive.org until I worked out when it changed). The Zigbee standard is maintained by  the Zigbee Alliance, a group of companies responsible for shepherding it in the right direction. Zigbee uses  the IEEE 802.15.4 standard and it&#39;s worthwhile understanding why, especially as compared to having devices just communicating directly over Wi-Fi:</p><p>  å¥½çš„ï¼Œé¦–å…ˆè¦è€ƒè™‘çš„æ˜¯ï¼šZigbeeï¼Œè€Œä¸æ˜¯ZigBeeã€‚æˆ‘æ˜¯ä¸€ä¸ªå–œæ¬¢è¿™æ ·çš„ç»†èŠ‚çš„äººï¼Œè¿™è®©æˆ‘å‘ç–¯äº†ï¼Œåˆ°å¤„éƒ½çœ‹åˆ°ä¸¤ç§é£æ ¼ï¼Œä½†æ˜¯æˆªè‡³2017å¹´ï¼Œâ€œ bâ€æ˜¯å°å†™å­—æ¯ï¼ˆå› ä¸ºæˆ‘æ˜¯ä¸€ä¸ªæˆ‘ä¸€ç›´åœ¨å­˜æ¡£ä¸­æµè§ˆzigbee.comçš„è´´çº¸ï¼Œ .orgï¼Œç›´åˆ°æˆ‘çŸ¥é“å®ƒä½•æ—¶æ›´æ”¹ä¸ºæ­¢ï¼‰ã€‚ Zigbeeæ ‡å‡†ç”±Zigbeeè”ç›Ÿç»´æŠ¤ï¼ŒZigbeeè”ç›Ÿæ˜¯è´Ÿè´£æŒ‰æ­£ç¡®æ–¹å‘è¿›è¡Œæ¨å¹¿çš„ä¸€ç»„å…¬å¸ã€‚ Zigbeeä½¿ç”¨IEEE 802.15.4æ ‡å‡†ï¼Œå€¼å¾—ç†è§£ä¸ºä»€ä¹ˆï¼Œå°¤å…¶æ˜¯ä¸ä»…é€šè¿‡Wi-Fiç›´æ¥é€šä¿¡çš„è®¾å¤‡ç›¸æ¯”ï¼š</p><p> IEEE standard 802.15.4 intends to offer the fundamental lower network layers of a type of wireless personal area network (WPAN) which focuses on low-cost, low-speed ubiquitous communication between devices. It can be contrasted with other approaches, such as Wi-Fi, which offer more bandwidth and require more power. The emphasis is on very low cost communication of nearby devices with little to no underlying infrastructure, intending to exploit this to lower power consumption even more.IEEE 802.15. 4 is a low-data rate wireless personal area network and is the PHY and MAC layer used by many IoT protocols, such as ZigBee, and WirelessHART.</p><p> IEEEæ ‡å‡†802.15.4æ—¨åœ¨æä¾›ä¸€ç§æ— çº¿ä¸ªäººå±€åŸŸç½‘ï¼ˆWPANï¼‰çš„åŸºæœ¬åº•å±‚ç½‘ç»œå±‚ï¼Œè¯¥ç½‘ç»œä¾§é‡äºè®¾å¤‡ä¹‹é—´çš„ä½æˆæœ¬ï¼Œä½é€Ÿæ™®é€‚é€šä¿¡ã€‚å¯ä»¥å°†å®ƒä¸å…¶ä»–æ–¹æ³•ï¼ˆä¾‹å¦‚Wi-Fiï¼‰å½¢æˆå¯¹æ¯”ï¼Œåè€…å¯æä¾›æ›´å¤šå¸¦å®½å¹¶éœ€è¦æ›´å¤šåŠŸç‡ã€‚é‡ç‚¹åœ¨äºå‡ ä¹æ²¡æœ‰åº•å±‚åŸºç¡€è®¾æ–½çš„é™„è¿‘è®¾å¤‡çš„éå¸¸ä½æˆæœ¬çš„é€šä¿¡ï¼Œæ—¨åœ¨åˆ©ç”¨å®ƒæ¥è¿›ä¸€æ­¥é™ä½åŠŸè€—ã€‚IEEE 802.15ã€‚ 4æ˜¯ä½æ•°æ®é€Ÿç‡æ— çº¿ä¸ªäººå±€åŸŸç½‘ï¼Œæ˜¯è®¸å¤šç‰©è”ç½‘åè®®ï¼ˆä¾‹å¦‚ZigBeeå’ŒWirelessHARTï¼‰ä½¿ç”¨çš„PHYå’ŒMACå±‚ã€‚</p><p> In other words, the value proposition is low power consumption and low cost at the expense of bandwidth. But that&#39;s just fine for devices like this:</p><p> æ¢å¥è¯è¯´ï¼Œä»·å€¼ä¸»å¼ æ˜¯ä½åŠŸè€—å’Œä½æˆæœ¬ï¼Œä»¥å¸¦å®½ä¸ºä»£ä»·ã€‚ä½†è¿™å¯¹äºåƒè¿™æ ·çš„è®¾å¤‡æ¥è¯´å¾ˆå¥½ï¼š</p><p> Just had a Mi temp and humidity sensor arrive for the IoT stuff Iâ€™m doing. Really neat size, itâ€™d be easy to place a bunch of these around the house, yet to see it actually work though...  pic.twitter.com/yjgtR87DUo</p><p> åˆšåˆšæœ‰Miæ¸©åº¦å’Œæ¹¿åº¦ä¼ æ„Ÿå™¨åˆ°è¾¾äº†æˆ‘æ­£åœ¨åšçš„ç‰©è”ç½‘å·¥ä½œã€‚å°ºå¯¸ç¡®å®å¾ˆæ•´é½ï¼Œå¾ˆå®¹æ˜“åœ¨å±‹å­é‡Œæ”¾ä¸Šä¸€å †ï¼Œä½†æ˜¯çœ‹å®ƒç¡®å®å¯ä»¥å·¥ä½œ... pic.twitter.com/yjgtR87DUo</p><p>â€” Troy Hunt (@troyhunt)  June 7, 2020</p><p>-ç‰¹æ´›ä¼ŠÂ·äº¨ç‰¹ï¼ˆ@troyhuntï¼‰2020å¹´6æœˆ7æ—¥</p><p>  In fact, it&#39;s  perfect for devices like this because they can be battery powered (they run on a standard  CR2032) and get a couple of years of life and they only need to transmit a few simple values at a relatively low frequency.</p><p>  å®é™…ä¸Šï¼Œå®ƒéå¸¸é€‚åˆæ­¤ç±»è®¾å¤‡ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ç”±ç”µæ± ä¾›ç”µï¼ˆå®ƒä»¬åœ¨æ ‡å‡†CR2032ä¸Šè¿è¡Œï¼‰ï¼Œä½¿ç”¨å¯¿å‘½é•¿è¾¾ä¸¤å¹´ï¼Œå¹¶ä¸”ä»…éœ€è¦ä»¥ç›¸å¯¹è¾ƒä½çš„é¢‘ç‡å‘é€ä¸€äº›ç®€å•å€¼å³å¯ã€‚</p><p> Let me divert on a quick tangent for a moment: Zigbee isn&#39;t the only low-power, low-bandwidth standard out there and as I went through my travels, many people also suggested various  Z-wave devices. I went all in on Zigbee primarily because the Aqara devices are great (more on them soon) and I already had Philips Hue units I could use as range extenders (more on that soon too). I may well end up with Z-wave devices in the future as well and I&#39;d be remiss not to mention them here, but at present I haven&#39;t needed to diversify beyond Zigbee.</p><p>è®©æˆ‘è½¬ç¬å³é€ï¼šZigbeeä¸æ˜¯é‚£é‡Œå”¯ä¸€çš„ä½åŠŸè€—ï¼Œä½å¸¦å®½æ ‡å‡†ï¼Œè€Œä¸”åœ¨æˆ‘æ—…è¡Œæ—¶ï¼Œå¾ˆå¤šäººè¿˜å»ºè®®ä½¿ç”¨å„ç§Zæ³¢é•¿è®¾å¤‡ã€‚æˆ‘ä¹‹æ‰€ä»¥å…¨ç¥è´¯æ³¨äºZigbeeï¼Œä¸»è¦æ˜¯å› ä¸ºAqaraè£…ç½®éå¸¸å‡ºè‰²ï¼ˆå³å°†æ¨å‡ºæ›´å¤šåŠŸèƒ½ï¼‰ï¼Œè€Œä¸”æˆ‘å·²ç»æ‹¥æœ‰å¯ä»¥ç”¨ä½œèŒƒå›´æ‰©å±•å™¨çš„Philips Hueè£…ç½®ï¼ˆå³å°†æ¨å‡ºæ›´å¤šåŠŸèƒ½ï¼‰ã€‚å°†æ¥æˆ‘å¯èƒ½è¿˜ä¼šä½¿ç”¨Z-waveè®¾å¤‡ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œä¸æå®ƒä»¬ï¼Œæˆ‘ä¼šå¾ˆä¸é«˜å…´ï¼Œä½†æ˜¯ç›®å‰æˆ‘å¹¶ä¸éœ€è¦åœ¨Zigbeeä¹‹å¤–è¿›è¡Œå¤šå…ƒåŒ–å‘å±•ã€‚</p><p> But Zigbee ain&#39;t Wi-Fi so you can&#39;t just buy a little device like the one above and connect it to an existing network, it needs a hub that can talk 802.15.4 to do that and suddenly, we&#39;re back into proprietary land again. For example, both the little temp sensor above and the motion sensors I discussed in part 1 are made by Xiaomi and I could always buy the  Aqara Hub and connect them up:</p><p> ä½†æ˜¯Zigbeeä¸æ˜¯Wi-Fiï¼Œå› æ­¤æ‚¨ä¸èƒ½åªè´­ä¹°ä¸Šè¿°è®¾å¤‡ä¹‹ç±»çš„å°è®¾å¤‡å¹¶å°†å…¶è¿æ¥åˆ°ç°æœ‰ç½‘ç»œï¼Œå®ƒéœ€è¦ä¸€ä¸ªèƒ½å¤Ÿä¸802.15.4é€šè®¯çš„é›†çº¿å™¨ï¼Œç„¶åçªç„¶ï¼Œæˆ‘ä»¬å›æ¥äº†å†æ¬¡è¿›å…¥ä¸“æœ‰åœŸåœ°ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„å°æ¸©åº¦ä¼ æ„Ÿå™¨å’Œæˆ‘åœ¨ç¬¬1éƒ¨åˆ†ä¸­è®¨è®ºçš„è¿åŠ¨ä¼ æ„Ÿå™¨éƒ½æ˜¯å°ç±³åˆ¶é€ çš„ï¼Œæˆ‘æ€»æ˜¯å¯ä»¥è´­ä¹°Aqara Hubå¹¶å°†å…¶è¿æ¥èµ·æ¥ï¼š</p><p>  But then what about other Zigbee devices from other manufacturers? For example, I&#39;ve got a bunch of Philips Hue lights in the house and they run over Zigbee, do I really want to end up with a Philips Hue hub (which I actually already had and  has an HA integration) plus an Aqara hub ( which also has an HA integration) plus whatever other devices I end up with and their own hubs as well? Not really, which brings me to the ConBee II Zigbee sniffer.</p><p>  ä½†æ˜¯ï¼Œå…¶ä»–åˆ¶é€ å•†çš„å…¶ä»–Zigbeeè®¾å¤‡åˆå¦‚ä½•å‘¢ï¼Ÿä¾‹å¦‚ï¼Œæˆ‘å±‹å­é‡Œæœ‰ä¸€å †é£åˆ©æµ¦Hueç¯ï¼Œå®ƒä»¬åœ¨Zigbeeä¸Šæ–¹è¿è¡Œï¼Œæˆ‘çœŸçš„æƒ³æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªé£åˆ©æµ¦Hueé›†çº¿å™¨ï¼ˆæˆ‘å®é™…ä¸Šå·²ç»æ‹¥æœ‰å¹¶é›†æˆäº†HAï¼‰å’ŒAqaraé›†çº¿å™¨ï¼ˆä¹Ÿå…·æœ‰HAé›†æˆï¼‰ä»¥åŠæˆ‘æœ€ç»ˆä½¿ç”¨çš„å…¶ä»–ä»»ä½•è®¾å¤‡ä»¥åŠå®ƒä»¬è‡ªå·±çš„é›†çº¿å™¨ï¼Ÿä¸å®Œå…¨æ˜¯ï¼Œè¿™ä½¿æˆ‘æƒ³åˆ°äº†ConBee II Zigbeeå—…æ¢å™¨ã€‚</p><p>  HA alone can&#39;t read from Zigbee devices and as already discussed, they also can&#39;t drop directly onto your Wi-Fi hence the need for a hub. What folks tend to do is go for a &#34;CC2531 stick&#34; which can &#34;sniff&#34; Zigbee traffic.  CC2531 is a chipset made by Texas Instruments (check the date on that resources, this goes back over a decade) that appears in a whole heap of cheap units sold as &#34;Zigbee sniffers&#34;. But there was one particular model that came up time and time again after I posted that earlier tweet with the temp sensor; without prompting, many people directed me to the  ConBee II, a little USB stick with a CC2531 chip that can talk IEEE 802.15.4 and implements the Zigbee protocol. See how that ties all these new things together? ğŸ˜Š</p><p>  ä»…HAä¸èƒ½ä»Zigbeeè®¾å¤‡è¯»å–ï¼Œå¹¶ä¸”æ­£å¦‚å·²ç»è®¨è®ºçš„é‚£æ ·ï¼Œå®ƒä»¬ä¹Ÿä¸èƒ½ç›´æ¥æ‰åˆ°Wi-Fiä¸Šï¼Œå› æ­¤éœ€è¦é›†çº¿å™¨ã€‚äººä»¬å€¾å‘äºåšçš„æ˜¯â€œ CC2531æ£å­â€ï¼Œå®ƒå¯ä»¥â€œå—…â€ Zigbeeæµé‡ã€‚ CC2531æ˜¯å¾·å·ä»ªå™¨ï¼ˆTexas Instrumentsï¼‰ç”Ÿäº§çš„èŠ¯ç‰‡ç»„ï¼ˆæ£€æŸ¥è¯¥èµ„æºçš„æ—¥æœŸï¼Œå¯ä»¥è¿½æº¯åˆ°åå¹´å‰ï¼‰ï¼Œå‡ºç°åœ¨å¤§é‡å»‰ä»·å•ä½ä¸­ï¼Œç§°ä¸ºâ€œ Zigbeeå—…æ¢å™¨â€ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘å‘å¸ƒäº†æœ‰å…³æ¸©åº¦ä¼ æ„Ÿå™¨çš„è¾ƒæ—©çš„æ¨æ–‡ä¹‹åï¼Œæœ‰ä¸€æ¬¡åˆä¸€æ¬¡å‡ºç°ä¸€ç§ç‰¹æ®Šçš„æ¨¡å‹ã€‚åœ¨æ²¡æœ‰æç¤ºçš„æƒ…å†µä¸‹ï¼Œè®¸å¤šäººå°†æˆ‘å¼•å¯¼åˆ°äº†ConBee IIï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰CC2531èŠ¯ç‰‡çš„å°å‹USBè®°å¿†æ£’ï¼Œå¯ä»¥ä¸IEEE 802.15.4é€šè®¯å¹¶å®ç°Zigbeeåè®®ã€‚çœ‹çœ‹è¿™äº›æ–°äº‹ç‰©å¦‚ä½•è”ç³»åœ¨ä¸€èµ·ï¼Ÿ ğŸ˜Š</p><p>   The ConBee II is produced under the Phoscon brand, a name I mentioned back in part 1 in relation to the deCONZ integration. I picked one up off Amazon for A$78, plugged it into the USB port of the Raspberry Pi running HA then configured it all by following  this great guide which takes you through the entire journey. When I went through that process only 6 months after that post was written, there were quite a few bits that were out of date (namely where things are located within the UI), but it was still easy to follow. Once done, all the mechanics are now there to join up all the respective bits of the Zigbee network:</p><p>   ConBee IIä»¥Phosconå“ç‰Œç”Ÿäº§ï¼Œè¿™æ˜¯æˆ‘åœ¨ç¬¬1éƒ¨åˆ†æåˆ°çš„ä¸deCONZé›†æˆç›¸å…³çš„åç§°ã€‚æˆ‘ä»¥78æ¾³å…ƒçš„ä»·æ ¼ä»äºšé©¬é€Šä¹°äº†ä¸€ä¸ªï¼Œå°†å…¶æ’å…¥è¿è¡ŒHAçš„Raspberry Piçš„USBç«¯å£ï¼Œç„¶åæŒ‰ç…§æ­¤å‡ºè‰²çš„æŒ‡å—è¿›è¡Œé…ç½®ï¼Œä»¥å¸¦æ‚¨å®Œæˆæ•´ä¸ªæ—…ç¨‹ã€‚å½“æˆ‘å†™å®Œè¿™ç¯‡æ–‡ç« åä»…å…­ä¸ªæœˆå°±è¿›è¡Œäº†è¯¥è¿‡ç¨‹æ—¶ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹å·²ç»è¿‡æ—¶ï¼ˆå³ï¼ŒUIä¸­çš„ä½ç½®ï¼‰ï¼Œä½†æ˜¯ä»ç„¶å¾ˆå®¹æ˜“ç†è§£ã€‚å®Œæˆåï¼Œæ‰€æœ‰æœºåˆ¶ç°åœ¨éƒ½å¯ä»¥è¿æ¥åˆ°Zigbeeç½‘ç»œçš„æ‰€æœ‰å„ä¸ªéƒ¨åˆ†ï¼š</p><p>  The next problem is that in my case, I ended up with a single USB sniffer stuck into a Raspberry Pi inside a server rack inside a large walk-in cupboard inside a garage at the bottom of a large 3-story solid brick construction house. You can guess what comes next...</p><p>  ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä»¥æˆ‘ä¸ºä¾‹ï¼Œæˆ‘æœ€ç»ˆå°†ä¸€ä¸ªUSBå—…æ¢å™¨æ’å…¥äº†Raspberry Piçš„æœåŠ¡å™¨æœºæ¶å†…çš„æ ‘è“æ´¾ä¸­ï¼Œè¯¥æœåŠ¡å™¨æœºæ¶ä½äºå¤§å‹ä¸‰å±‚å®å¿ƒç –ç»“æ„æˆ¿å±‹åº•éƒ¨è½¦åº“ä¸­çš„å¤§å‹æ­¥å…¥å¼æ©±æŸœä¸­ã€‚æ‚¨å¯ä»¥çŒœæµ‹æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆ...</p><p>  In fairness to the ConBee II, it did an admirable job under the circumstances and indeed  its range is a big selling point:</p><p>  å…¬å¹³åœ°è¯´ï¼Œåœ¨ConBee IIä¸­ï¼Œå®ƒåœ¨è¿™ç§æƒ…å†µä¸‹åšå¾—å¾ˆå¥½ï¼Œå…¶èŒƒå›´ç¡®å®æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å–ç‚¹ï¼š</p><p> Thanks to its power-amplifier, the ConBee II has an outstanding range. This lets the signal pass through 2â€“3 rooms or floors, depending on the construction type.</p><p>å¾—ç›Šäºå…¶åŠŸç‡æ”¾å¤§å™¨ï¼ŒConBee IIå…·æœ‰å‡ºè‰²çš„èŒƒå›´ã€‚è¿™ä½¿ä¿¡å·å¯ä»¥é€šè¿‡2-3ä¸ªæˆ¿é—´æˆ–æ¥¼å±‚ï¼Œå…·ä½“å–å†³äºå»ºç­‘ç±»å‹ã€‚</p><p> But it wasn&#39;t enough. I continually found temp sensors (which I now had in every single room) not being available so clearly something had to give. Fortunately, one of the joys of Zigbee is that - and I&#39;m going to quote here - &#34;all mains powered Zigbee devices, such as lights and sockets, act as repeaters and can route the signal&#34;. This is again from  the Phoscon page on the ConBee II which they illustrate as follows:</p><p> ä½†è¿™è¿˜ä¸å¤Ÿã€‚æˆ‘ä¸æ–­å‘ç°æ¸©åº¦ä¼ æ„Ÿå™¨ï¼ˆç°åœ¨æˆ‘åœ¨æ¯ä¸ªæˆ¿é—´éƒ½æœ‰ï¼‰æ— æ³•ä½¿ç”¨ï¼Œå› æ­¤å¿…é¡»æä¾›ä¸€äº›æ˜ç¡®çš„ä¿¡æ¯ã€‚å¹¸è¿çš„æ˜¯ï¼ŒZigbeeçš„ä¹è¶£ä¹‹ä¸€æ˜¯-æˆ‘åœ¨è¿™é‡Œå¼•ç”¨-â€œæ‰€æœ‰ç”±å¸‚ç”µä¾›ç”µçš„Zigbeeè®¾å¤‡ï¼Œä¾‹å¦‚ç”µç¯å’Œæ’åº§ï¼Œéƒ½å¯ä»¥ç”¨ä½œä¸­ç»§å™¨å¹¶å¯ä»¥è·¯ç”±ä¿¡å·â€ã€‚å†æ¬¡æ¥è‡ªConBee IIçš„Phosconé¡µé¢ï¼Œå…¶è¯´æ˜å¦‚ä¸‹ï¼š</p><p>  This creates a mesh network enabling you to expand the Zigbee range as more (mains powered) devices are added. That&#39;s all good in theory but in practice, well, let me just drop a discussion I had with my good mate Scott Helme in right here as he was going through his own HA build:</p><p>  è¿™å°†åˆ›å»ºä¸€ä¸ªç½‘çŠ¶ç½‘ç»œï¼Œä½¿æ‚¨å¯ä»¥åœ¨æ·»åŠ æ›´å¤šï¼ˆå¸‚ç”µï¼‰è®¾å¤‡æ—¶æ‰©å±•ZigbeeèŒƒå›´ã€‚ä»ç†è®ºä¸Šè®²ï¼Œè¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†å®é™…ä¸Šï¼Œè®©æˆ‘åœ¨æˆ‘æ­£åœ¨ä¸æˆ‘çš„å¥½ä¼´ä¾£æ–¯ç§‘ç‰¹Â·èµ«å°”å§†ï¼ˆScott Helmeï¼‰è¿›è¡Œä»–è‡ªå·±çš„HAæ„å»ºæ—¶ï¼Œè¿›è¡Œä¸€ä¸‹è®¨è®ºï¼š</p><p>  I wanted to include this discussion in its original candid state because it perfectly illustrates the frustrations I raised in part 1: this is still a &#34;maker&#34; world where even people who live and breathe tech day in and day out continue to hit hurdles. I found multiple references around the web about the IKEA repeaters not playing nice with Xiaomi devices, yet when I looked at my own Zigbee network, I saw this:</p><p>  æˆ‘æƒ³ä»¥åŸå§‹çš„å¦ç‡çŠ¶æ€è¿›è¡Œè®¨è®ºï¼Œå› ä¸ºå®ƒå®Œç¾åœ°è¯´æ˜äº†æˆ‘åœ¨ç¬¬1éƒ¨åˆ†ä¸­æå‡ºçš„æŒ«è´¥æ„Ÿï¼šè¿™ä»ç„¶æ˜¯ä¸€ä¸ªâ€œåˆ¶é€ è€…â€ä¸–ç•Œï¼Œå³ä½¿æ¯å¤©ç”Ÿæ´»å’Œå‘¼å¸æŠ€æœ¯çš„äººä»¬ä¹Ÿç»§ç»­é‡åˆ°éšœç¢ã€‚æˆ‘åœ¨ç½‘ä¸Šå‘ç°äº†è®¸å¤šå…³äºIKEAä¸­ç»§å™¨ä¸èƒ½ä¸å°ç±³è®¾å¤‡é…åˆä½¿ç”¨çš„å‚è€ƒï¼Œä½†æ˜¯å½“æˆ‘æŸ¥çœ‹è‡ªå·±çš„Zigbeeç½‘ç»œæ—¶ï¼Œå´å‘ç°ï¼š</p><p>  I can see plenty of devices connected to &#34;Range Extender 1&#34; in the garage! But no devices connected to &#34;Range Extender 2&#34; in the master bedroom. There are too many devices spread out over too large an area for this to be a mere coincidence, is it simply that one range extender doesn&#39;t want to connect and one does? I&#39;ve ordered another couple just to see what happens, but I continually get the feeling that this whole effort raises more questions than it answers...</p><p>  æˆ‘å¯ä»¥åœ¨è½¦åº“ä¸­çœ‹åˆ°å¾ˆå¤šè¿æ¥åˆ°â€œ Range Extender 1â€çš„è®¾å¤‡ï¼ä½†æ²¡æœ‰è®¾å¤‡è¿æ¥åˆ°ä¸»å§å®¤ä¸­çš„â€œ Range Extender 2â€ã€‚å¤ªå¤šçš„è®¾å¤‡æ•£å¸ƒåœ¨å¤ªå¤§çš„åŒºåŸŸä¸Šï¼Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªå·§åˆï¼Œéš¾é“ä»…ä»…æ˜¯ä¸€ä¸ªèŒƒå›´æ‰©å±•å™¨ä¸æƒ³è¿æ¥è€Œä¸€ä¸ªèŒƒå›´æ‰©å±•å™¨æƒ³è¦è¿æ¥å—ï¼Ÿæˆ‘å‘½ä»¤å¦ä¸€å¯¹å¤«å¦‡åªæ˜¯ä¸ºäº†çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä½†æ˜¯æˆ‘ä¸æ–­æ„Ÿè§‰åˆ°ï¼Œè¿™æ•´ä¸ªå·¥ä½œæå‡ºäº†æ›´å¤šçš„é—®é¢˜è€Œä¸æ˜¯ç­”æ¡ˆã€‚</p><p> A quick sidenote on those Philips Hue devices in the Zigbee map above: per mny discussion with Scott, I had to unpair them from the Hue Bridge and then pair them in deCONZ just like all the other Zigbee devices. Consequently, I can no longer use the Philips Hue app to manage, say, the two Hue Go units on my desk. As I said in part 1, the native apps are often richer in functionality than what HA provides and that&#39;s the case here too. I have several Hue light strips around my fireplace, one behind my TV and one behind the perimeter of a massive mirror in my entertainment room. I want the family to be able to manage these directly via an easy to use app hence I haven&#39;t moved them over to deCONZ. That means they don&#39;t form part of the Zigbee mesh network in the image above, but they&#39;re also in locations where there&#39;s plenty of coverage already. My office really needed more coverage (it&#39;s several floors above where the ConBee II is located) and it&#39;s only me who manages them hence their presence on the deCONZ network.</p><p> åœ¨ä¸Šé¢çš„Zigbeeåœ°å›¾ä¸­ï¼Œè¿™äº›é£åˆ©æµ¦Hueè®¾å¤‡çš„ç®€çŸ­è¯´æ˜ï¼šåœ¨ä¸Scottè¿›è¡Œçš„å¤šæ¬¡è®¨è®ºä¸­ï¼Œæˆ‘ä¸å¾—ä¸å°†å®ƒä»¬ä¸Hue Bridgeå–æ¶ˆé…å¯¹ï¼Œç„¶ååƒåœ¨æ‰€æœ‰å…¶ä»–Zigbeeè®¾å¤‡ä¸­ä¸€æ ·ï¼Œå°†å®ƒä»¬ä¸deCONZé…å¯¹ã€‚å› æ­¤ï¼Œæˆ‘å†ä¹Ÿæ— æ³•ä½¿ç”¨Philips Hueåº”ç”¨ç¨‹åºæ¥ç®¡ç†æˆ‘æ¡Œä¸Šçš„ä¸¤ä¸ªHue Goè®¾å¤‡ã€‚æ­£å¦‚æˆ‘åœ¨ç¬¬1éƒ¨åˆ†ä¸­æ‰€è¿°ï¼Œæœ¬æœºåº”ç”¨ç¨‹åºé€šå¸¸æ¯”HAæä¾›çš„åŠŸèƒ½æ›´ä¸°å¯Œï¼Œè¿™é‡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘çš„å£ç‚‰å‘¨å›´æœ‰å‡ ä¸ªé¡ºåŒ–ç¯å¸¦ï¼Œä¸€ä¸ªåœ¨ç”µè§†åé¢ï¼Œä¸€ä¸ªåœ¨å¨±ä¹å®¤çš„å¤§é•œå­åé¢ã€‚æˆ‘å¸Œæœ›å®¶äººèƒ½å¤Ÿé€šè¿‡ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„åº”ç”¨ç¨‹åºç›´æ¥ç®¡ç†è¿™äº›å†…å®¹ï¼Œå› æ­¤æˆ‘æ²¡æœ‰å°†å®ƒä»¬ç§»åˆ°deCONZã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¸å±äºä¸Šå›¾ä¸­çš„Zigbeeç½‘æ ¼ç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿä½äºå·²ç»æœ‰å¤§é‡è¦†ç›–èŒƒå›´çš„ä½ç½®ã€‚æˆ‘çš„åŠå…¬å®¤ç¡®å®éœ€è¦æ›´å¤šçš„è¦†ç›–èŒƒå›´ï¼ˆä½äºConBee IIæ‰€åœ¨æ¥¼å±‚çš„å‡ å±‚æ¥¼ï¼‰ï¼Œåªæœ‰æˆ‘æ¥ç®¡ç†å®ƒä»¬ï¼Œå› æ­¤å®ƒä»¬è¦å‡ºç°åœ¨deCONZç½‘ç»œä¸­ã€‚</p><p> One final thing on the whole Zigbee piece: I&#39;m seeing a lot of feedback about people having problems with deCONZ and switching over to ZHA instead:</p><p> Zigbeeæ•´ä½“ä¸Šçš„æœ€åä¸€ä»¶äº‹ï¼šæˆ‘çœ‹åˆ°å¾ˆå¤šå…³äºäººä»¬åœ¨ä½¿ç”¨deCONZå¹¶è½¬è€Œä½¿ç”¨ZHAä¸Šé‡åˆ°é—®é¢˜çš„åé¦ˆï¼š</p><p> Hi Troy just read your post. Really cool stuff. You should know that you can switch from deCONZ to native ZHA integration imo it works much better and makes the integration much better. I did the switch a few months ago and it&#39;s been great only downside is you need to pair again.</p><p>å—¨ï¼Œç‰¹æ´›ä¼Šï¼ˆTroyï¼‰åˆšè¯»äº†æ‚¨çš„å¸–å­ã€‚çœŸçš„å¾ˆé…·çš„ä¸œè¥¿ã€‚æ‚¨åº”è¯¥çŸ¥é“ï¼Œæ‚¨å¯ä»¥ä»deCONZåˆ‡æ¢åˆ°æœ¬æœºZHAé›†æˆimoï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°å·¥ä½œå¹¶ä½¿é›†æˆæ›´å¥½ã€‚å‡ ä¸ªæœˆå‰æˆ‘è¿›è¡Œäº†åˆ‡æ¢ï¼Œè¿™å¾ˆæ£’ï¼Œå”¯ä¸€çš„ç¼ºç‚¹æ˜¯æ‚¨éœ€è¦å†æ¬¡é…å¯¹ã€‚</p><p>â€” Dementor ğŸ‡®ğŸ‡± (@the_mentor)  November 23, 2020</p><p>â€” DementorğŸ‡®ğŸ‡±ï¼ˆ@the_mentorï¼‰2020å¹´11æœˆ23æ—¥</p><p>  The  Zigbee Home Automation (&#34;ZHA&#34;) integration seems to be quite highly regarded and if I&#39;m honest, I&#39;ve had a lot of problems with deCONZ. When I look at it within HA now, there&#39;s a bunch of devices that have lost the carefully crafted names I provided them with when originally pairing them:</p><p>  Zigbeeå®¶åº­è‡ªåŠ¨åŒ–ï¼ˆâ€œ ZHAâ€ï¼‰é›†æˆä¼¼ä¹å—åˆ°äº†é«˜åº¦é‡è§†ï¼Œè€å®è¯´ï¼Œæˆ‘åœ¨deCONZæ–¹é¢é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ã€‚å½“æˆ‘ç°åœ¨åœ¨HAä¸­æŸ¥çœ‹å®ƒæ—¶ï¼Œæœ‰å¾ˆå¤šè®¾å¤‡ä¸¢å¤±äº†æœ€åˆé…å¯¹å®ƒä»¬æ—¶ä¸ºå®ƒä»¬æä¾›çš„ç²¾å¿ƒè®¾è®¡çš„åç§°ï¼š</p><p>  This happens over and over again and to be honest, I just need to bite the bullet, kill deCONZ, set up ZHA and manually re-pair every single Zigbee device in the house ğŸ˜­ To be clear, this isn&#39;t breaking the HA references to the devices in any way, it just screws up their representation within deCONZ and subsequently, the earlier network map as well.</p><p>  è¿™ä¼šä¸€éåˆä¸€éåœ°å‘ç”Ÿï¼Œè¯´å®è¯ï¼Œæˆ‘åªéœ€è¦ç¡¬ç€å¤´çš®ï¼Œæ€æ­»deCONZï¼Œè®¾ç½®ZHAå¹¶æ‰‹åŠ¨é‡æ–°é…å¯¹æˆ¿å±‹ä¸­çš„æ¯ä¸ªZigbeeè®¾å¤‡ğŸ˜­è¦æ¸…æ¥šï¼Œè¿™å¹¶æ²¡æœ‰ç ´åHAå‚è€ƒä»¥ä»»ä½•æ–¹å¼è¿æ¥åˆ°è®¾å¤‡ï¼Œåªéœ€å°†å®ƒä»¬åœ¨deCONZä¸­çš„è¡¨ç¤ºä»¥åŠéšåçš„æ—©æœŸç½‘ç»œå›¾ä¸­çš„è¡¨ç¤ºæä¹±å³å¯ã€‚</p><p> But for the most part the Zigbee stuff has been great, especially those Xiaomi Aqara devices. Let&#39;s drill into them now.</p><p> ä½†æ˜¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒZigbeeçš„ä¸œè¥¿å¾ˆæ£’ï¼Œå°¤å…¶æ˜¯é‚£äº›å°ç±³Aqaraè®¾å¤‡ã€‚ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶å®ƒä»¬ã€‚</p><p>  I want to devote a section of this post specifically to  Xiaomi Aqara as these are great little devices that I now have all over the house. Before I get to the devices themselves, a bit of disambiguation around the names you&#39;ll see used here:</p><p>  æˆ‘æƒ³ä¸“é—¨é’ˆå¯¹å°ç±³Aqaraæ’°å†™è¿™ç¯‡æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºè¿™äº›æ˜¯æˆ‘ç°åœ¨æ•´ä¸ªæˆ¿å­éƒ½æ‹¥æœ‰çš„å¾ˆæ£’çš„å°è®¾å¤‡ã€‚åœ¨ä»‹ç»è®¾å¤‡æœ¬èº«ä¹‹å‰ï¼Œæ‚¨ä¼šåœ¨æ­¤å¤„ä½¿ç”¨çš„åç§°æœ‰ä¸€äº›æ­§ä¹‰ï¼š</p><p> Mijia is a brand name owned by Xiaomi (you would have seen it on the Aqara hub image earlier on)</p><p> Mijiaæ˜¯å°ç±³æ‹¥æœ‰çš„å“ç‰Œåç§°ï¼ˆæ‚¨æ—©å…ˆä¼šåœ¨Aqaraé›†çº¿å™¨å›¾åƒä¸Šçœ‹åˆ°å®ƒï¼‰</p><p> Bottom line: Aqara is the name you&#39;ll see me using here as that&#39;s what&#39;s on the devices I&#39;ve been buying (plus I can spell it more reliably than Xiaomi!) They&#39;re cheap, reliable and in my view, pretty slick looking little units. Earlier in this post I showed one of the temp sensors (pro tip: the round ones are an earlier generation, the square ones are newer and also do air pressure as well as temp and humidity), and in part 1 I showed the motion sensors which trigger lights when it&#39;s dark. Beyond those, I&#39;ve used a number of proximity sensors so I know when doors are open or shut:</p><p>åº•çº¿ï¼šAqaraæ˜¯æ‚¨ä¼šåœ¨è¿™é‡Œä½¿ç”¨çš„åç§°ï¼Œå› ä¸ºè¿™å°±æ˜¯æˆ‘ä¸€ç›´åœ¨è´­ä¹°çš„è®¾å¤‡ä¸Šçš„åç§°ï¼ˆæ­¤å¤–ï¼Œæˆ‘å¯ä»¥æ¯”å°ç±³æ›´å¯é åœ°æ‹¼å†™å®ƒï¼ï¼‰å®ƒä»¬ä¾¿å®œï¼Œå¯é ï¼Œå¹¶ä¸”åœ¨æˆ‘çœ‹æ¥ï¼Œå¾ˆæ¼‚äº®çœ‹èµ·æ¥å¾ˆå°çš„å•ä½ã€‚åœ¨æœ¬æ–‡çš„è¾ƒæ—©éƒ¨åˆ†ï¼Œæˆ‘å±•ç¤ºäº†ä¸€ä¸ªæ¸©åº¦ä¼ æ„Ÿå™¨ï¼ˆæç¤ºï¼šåœ†å½¢ä¼ æ„Ÿå™¨æ˜¯è¾ƒæ—©çš„ä¸€ä»£ï¼Œæ–¹å½¢ä¼ æ„Ÿå™¨æ˜¯è¾ƒæ–°çš„ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å¤„ç†æ°”å‹ä»¥åŠæ¸©åº¦å’Œæ¹¿åº¦ï¼‰ï¼Œåœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘å±•ç¤ºäº†è¿åŠ¨ä¼ æ„Ÿå™¨å¤©é»‘æ—¶ä¼šè§¦å‘ç¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜ä½¿ç”¨äº†è®¸å¤šæ¥è¿‘ä¼ æ„Ÿå™¨ï¼Œæ‰€ä»¥æˆ‘çŸ¥é“é—¨ä½•æ—¶æ‰“å¼€æˆ–å…³é—­ï¼š</p><p>   In part 1 when I showed my Apple Watch opening the garage door, this is achieved by defining a  cover in HA. A cover, uh, &#34;covers&#34; stuff so blinds, shutters and garage doors, for example. When you think about a cover like a garage door, there&#39;s really 2 things you want visibility or control over:</p><p>   åœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œå½“æˆ‘å±•ç¤ºæˆ‘çš„Apple Watchæ‰“å¼€è½¦åº“é—¨æ—¶ï¼Œè¿™æ˜¯é€šè¿‡åœ¨HAä¸­å®šä¹‰ä¸€ä¸ªç›–æ¥å®ç°çš„ã€‚å°é¢ï¼Œâ€œè¦†ç›–â€ä¸œè¥¿ï¼Œä¾‹å¦‚ç™¾å¶çª—ï¼Œç™¾å¶çª—å’Œè½¦åº“é—¨ã€‚å½“æ‚¨æƒ³åˆ°è½¦åº“é—¨ä¹‹ç±»çš„ç›–å­æ—¶ï¼Œå®é™…ä¸Šæœ‰ä¸¤ä»¶äº‹éœ€è¦æŸ¥çœ‹æˆ–æ§åˆ¶ï¼š</p><p>  The proximity sensor answers the first point and the Shelly from part 1 answers the second point. Combined, they enable me to glance at my watch, see the state of the garage door and then change that state.</p><p>  æ¥è¿‘ä¼ æ„Ÿå™¨å›ç­”ç¬¬ä¸€ç‚¹ï¼Œç¬¬ä¸€éƒ¨åˆ†çš„é›ªè‰å›ç­”ç¬¬äºŒç‚¹ã€‚ç»“åˆèµ·æ¥ï¼Œå®ƒä»¬ä½¿æˆ‘å¯ä»¥çœ‹ä¸€çœ¼æ‰‹è¡¨ï¼ŒæŸ¥çœ‹è½¦åº“é—¨çš„çŠ¶æ€ï¼Œç„¶åæ›´æ”¹è¯¥çŠ¶æ€ã€‚</p><p>    These are simple triggers that can be used in automations. For example, I have one at the bottom of my stairs that can turn off a bunch of lights with just a single click. Those lights normally come on just before sunset but if I want to  manually turn them on, that&#39;s just a double-click on the same button. Neat!</p><p>    è¿™äº›æ˜¯å¯ä»¥åœ¨è‡ªåŠ¨åŒ–ä¸­ä½¿ç”¨çš„ç®€å•è§¦å‘å™¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨æ¥¼æ¢¯çš„åº•éƒ¨æœ‰ä¸€ä¸ªï¼Œåªéœ€å•å‡»ä¸€ä¸‹å°±å¯ä»¥å…³é—­ä¸€å †ç¯ã€‚è¿™äº›ç¯é€šå¸¸åœ¨æ—¥è½ä¹‹å‰ç‚¹äº®ï¼Œä½†æ˜¯å¦‚æœæˆ‘è¦æ‰‹åŠ¨å°†å…¶æ‰“å¼€ï¼Œåˆ™åªéœ€åŒå‡»åŒä¸€æŒ‰é’®å³å¯ã€‚æ•´é½ï¼</p><p>  Get mailbox notifications in 4 easy steps: 1) Get a  @AQaraSmarthouse vibration/movement sensor 2) add it to your local  #ZigBee network 3) attach it to the mailbox 4) add some automation to  @home_assistant so you get a notification every time there&#39;s movement!  #homeautomation  pic.twitter.com/tP9pg7lzu1</p><p>  é€šè¿‡4ä¸ªç®€å•çš„æ­¥éª¤è·å–é‚®ç®±é€šçŸ¥ï¼š1ï¼‰è·å–@AQaraSmarthouseæŒ¯åŠ¨/è¿åŠ¨ä¼ æ„Ÿå™¨2ï¼‰å°†å…¶æ·»åŠ åˆ°æœ¬åœ°#ZigBeeç½‘ç»œ3ï¼‰å°†å…¶é™„åŠ åˆ°é‚®ç®±4ï¼‰å‘@home_assistantæ·»åŠ ä¸€äº›è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œä»¥ä¾¿æ¯æ¬¡æ”¶åˆ°é€šçŸ¥æœ‰è¿åŠ¨ï¼ #homeautomation pic.twitter.com/tP9pg7lzu1</p><p>â€” Pedro Lamas (@pedrolamas)  July 7, 2019</p><p>â€” Pedro Lamasï¼ˆ@pedrolamasï¼‰2019å¹´7æœˆ7æ—¥</p><p>  There are plenty of Zigbee devices out there, but I wanted to call out Aqara in particular as they&#39;ve just been so damn reliable. Only once have I had an issue with any of the couple of dozen devices I have in the house, and that was just the letterbox vibration sensor shipping with a near-flat battery.</p><p>  é‚£é‡Œæœ‰å¾ˆå¤šZigbeeè®¾å¤‡ï¼Œä½†æ˜¯æˆ‘æƒ³ç‰¹åˆ«æåŠAqaraï¼Œå› ä¸ºå®ƒä»¬çœŸæ˜¯å¤ªå¯é äº†ã€‚æˆ‘å®¶é‡Œçš„å‡ åä¸ªè®¾å¤‡ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½åªæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¸¦æœ‰è¿‘ç”¨å®Œç”µæ± çš„ä¿¡ç®±æŒ¯åŠ¨ä¼ æ„Ÿå™¨ã€‚</p><p> I put a temp sensor in each room right at the beginning of my HA journey. It was simple, cheap and immediately gave me useful data I could start doing stuff with:</p><p>æˆ‘å¼€å§‹HAä¹‹æ—…æ—¶ï¼Œä¾¿åœ¨æ¯ä¸ªæˆ¿é—´é‡Œéƒ½å®‰è£…äº†æ¸©åº¦ä¼ æ„Ÿå™¨ã€‚å®ƒç®€å•ï¼Œä¾¿å®œï¼Œå¹¶ä¸”ç«‹å³ä¸ºæˆ‘æä¾›äº†æœ‰ç”¨çš„æ•°æ®ï¼Œæˆ‘å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•å¼€å§‹åšäº‹ï¼š</p><p>  So pro tip: if you want to get into HA and IoT in a meaningful way, start here and work up. Those temp sensors are cheap, useful and give you a means of dipping your toe into the IoT water in a pretty low-friction way. Chuck in some motion and proximity sensors and there&#39;s a bunch of stuff you can do right away without spending much.</p><p>  æç¤ºï¼šå¦‚æœæ‚¨æƒ³ä»¥æœ‰æ„ä¹‰çš„æ–¹å¼è¿›å…¥HAå’ŒIoTï¼Œè¯·ä»è¿™é‡Œå¼€å§‹å¹¶è¿›è¡Œå·¥ä½œã€‚è¿™äº›æ¸©åº¦ä¼ æ„Ÿå™¨æ—¢ä¾¿å®œåˆå®ç”¨ï¼Œå¯è®©æ‚¨ä»¥ä¸€ç§ä½æ‘©æ“¦çš„æ–¹å¼å°†è„šè¶¾æµ¸å…¥IoTæ°´ä¸­ã€‚æ’å…¥ä¸€äº›è¿åŠ¨å’Œæ¥è¿‘ä¼ æ„Ÿå™¨ï¼Œæ— éœ€èŠ±è´¹å¤ªå¤šï¼Œæ‚¨å°±å¯ä»¥ç«‹å³å®Œæˆå¾ˆå¤šå·¥ä½œã€‚</p><p> Let&#39;s now move onto something completely the opposite of low-friction and get our hands much, much dirtier.</p><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥ä¸ä½æ‘©æ“¦å®Œå…¨ç›¸åçš„äº‹ç‰©ï¼Œè®©æˆ‘ä»¬çš„åŒæ‰‹æ›´åŠ è‚®è„ã€‚</p><p>  I propose that we all need to find our own paths in terms of just how dirty we want to get our hands when playing with IoT. For many, the whole idea of running a Raspberry Pi with community driven software you configure with YAML is a step too far. For others, it&#39;s just the beginning with many people going down the path of, per the heading above, flashing custom firmware onto devices and soldering wires. In fact, this is the path I was originally going to head down for my garage door by following this video:</p><p>  æˆ‘å»ºè®®ï¼Œæˆ‘ä»¬æ‰€æœ‰äººéƒ½éœ€è¦æ‰¾åˆ°è‡ªå·±çš„é“è·¯ï¼Œå³æˆ‘ä»¬åœ¨ç©ç‰©è”ç½‘æ—¶æƒ³è¦å¾—åˆ°å¤šå°‘è„æ‰‹ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œä½¿ç”¨æ‚¨ä½¿ç”¨YAMLé…ç½®çš„ç¤¾åŒºé©±åŠ¨è½¯ä»¶æ¥è¿è¡ŒRaspberry Piçš„æ•´ä¸ªæƒ³æ³•å®åœ¨æ˜¯å¤ªè¿‡åˆ†äº†ã€‚å¯¹äºå…¶ä»–äººæ¥è¯´ï¼Œè¿™ä»…ä»…æ˜¯å¼€å§‹ï¼Œè®¸å¤šäººæŒ‰ç…§ä¸Šé¢çš„æ ‡é¢˜ï¼Œå°†è‡ªå®šä¹‰å›ºä»¶åˆ·æ–°åˆ°è®¾å¤‡å’Œç„Šæ¥çº¿ä¸Šã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯æˆ‘æœ€åˆé€šè¿‡è·Ÿè¸ªæ­¤è§†é¢‘å‰å¾€è½¦åº“é—¨çš„è·¯å¾„ï¼š</p><p> I bought all the bits, downloaded the firmware flasher, wired it all up per the instructions yet still, found myself lost:</p><p> æˆ‘è´­ä¹°äº†æ‰€æœ‰ç»„ä»¶ï¼Œä¸‹è½½äº†å›ºä»¶æ›´æ–°ç¨‹åºï¼Œå¹¶æŒ‰ç…§è¯´æ˜å°†å…¶å…¨éƒ¨è¿æ¥å¥½ï¼Œå‘ç°è‡ªå·±è¿·è·¯äº†ï¼š</p><p> Need some debug help with Sonoff SV and Tasmotizer: boards seem to be wired up properly, serial converter LED comes on, Sonoff is powered on with reflash button held, COM port is correct yet Tasmotizer can&#39;t see the Sonoff. Anything obvious wrong?  pic.twitter.com/DByJqCEKDQ</p><p> éœ€è¦Sonoff SVå’ŒTasmotizerçš„ä¸€äº›è°ƒè¯•å¸®åŠ©ï¼šç”µè·¯æ¿ä¼¼ä¹å·²æ­£ç¡®è¿æ¥ï¼Œä¸²è¡Œè½¬æ¢å™¨LEDäº®èµ·ï¼ŒSonoffçš„ç”µæºæ‰“å¼€å¹¶æŒ‰ä½äº†åˆ·æ–°æŒ‰é’®ï¼ŒCOMç«¯å£æ­£ç¡®ï¼Œä½†Tasmotizerçœ‹ä¸åˆ°Sonoffã€‚æœ‰ä»€ä¹ˆæ˜æ˜¾çš„é”™è¯¯å—ï¼Ÿ pic.twitter.com/DByJqCEKDQ</p><p>â€” Troy Hunt (@troyhunt)  August 24, 2020</p><p>-ç‰¹æ´›ä¼ŠÂ·äº¨ç‰¹ï¼ˆ@troyhuntï¼‰2020å¹´8æœˆ24æ—¥</p><p>  I then discovered that contrary to the instructions, RX shouldn&#39;t go to TX,  it should go to RX and right there at that moment, I&#39;ll be honest: I lost my shit. Why is this so hard?! Why do I need to modify the firmware of such a simple little device?! And why do I then find myself holding a burning soldering iron just to open my freakin&#39; garage door?!</p><p>ç„¶åï¼Œæˆ‘å‘ç°ä¸æŒ‡ä»¤ç›¸åï¼ŒRXä¸åº”è½¬åˆ°TXï¼Œè€Œåº”è½¬åˆ°RXï¼Œç„¶åå°±åœ¨é‚£ä¸€åˆ»ï¼Œè€å®è¯´ï¼šæˆ‘ä¸¢äº†å±ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾ï¼Ÿï¼ä¸ºä»€ä¹ˆéœ€è¦ä¿®æ”¹è¿™ç§ç®€å•çš„å°å‹è®¾å¤‡çš„å›ºä»¶ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ç„¶åå‘ç°è‡ªå·±æ‹¿ç€ç‡ƒçƒ§çš„çƒ™é“åªæ˜¯ä¸ºäº†æ‰“å¼€æˆ‘çš„è½¦åº“é—¨ï¼Ÿ</p><p> To be fair to the folks that enjoy living in this world, I can see the attraction and I have great respect for those with the skill and patience to take this path.  Tasmota is enormously popular open source firmware designed for  ESP8266 devices which is the chipset many IoT products run (including a bunch of the lights in my house). But for me, it&#39;s a step too far and an unnecessary one at that given how easy it eventually was to achieve the same result with a Shelly that requires no custom firmware, no soldering and has no exposed circuitry:</p><p> ä¸ºäº†å…¬å¹³åœ°å¯¹å¾…ç”Ÿæ´»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šçš„äººä»¬ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ™¯ç‚¹ï¼Œå¹¶ä¸”æˆ‘å¯¹é‚£äº›æœ‰æŠ€å·§å’Œè€å¿ƒèµ°è¿™æ¡è·¯çš„äººè¡¨ç¤ºæ•¬æ„ã€‚ Tasmotaæ˜¯ä¸ºESP8266è®¾å¤‡è®¾è®¡çš„éå¸¸æµè¡Œçš„å¼€æºå›ºä»¶ï¼Œå®ƒæ˜¯è®¸å¤šIoTäº§å“è¿è¡Œçš„èŠ¯ç‰‡ç»„ï¼ˆåŒ…æ‹¬æˆ‘å®¶ä¸­çš„ä¸€å †ç¯ï¼‰ã€‚ä½†æ˜¯å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤ªè¿‡åˆ†è€Œåˆä¸å¿…è¦çš„æ­¥éª¤ï¼Œå› ä¸ºä½¿ç”¨ä¸éœ€è¦è‡ªå®šä¹‰å›ºä»¶ï¼Œæ— éœ€ç„Šæ¥ä¸”æ²¡æœ‰è£¸éœ²ç”µè·¯çš„Shellyæœ€ç»ˆè¾¾åˆ°ç›¸åŒç»“æœçš„éš¾æ˜“ç¨‹åº¦æ˜¯ï¼š</p><p>   The most complex part of this entire approach was reading  the garage door opener manual and referring to the terminal block on the back of the unit:</p><p>   æ•´ä¸ªæ–¹æ³•ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†æ˜¯é˜…è¯»è½¦åº“é—¨å¼€å¯å™¨æ‰‹å†Œï¼Œå¹¶å‚è€ƒè®¾å¤‡èƒŒé¢çš„æ¥çº¿ç›’ï¼š</p><p>   O/S/C INPUT is used for the connection of a wired switch (momentary contact). This switch can then be used to open, stop or close the door.</p><p>   O / S / C INPUTç”¨äºè¿æ¥æœ‰çº¿å¼€å…³ï¼ˆç¬æ—¶è§¦ç‚¹ï¼‰ã€‚ç„¶åå¯ä»¥ä½¿ç”¨æ­¤å¼€å…³æ‰“å¼€ï¼Œåœæ­¢æˆ–å…³é—­é—¨ã€‚</p><p> All the garage door automation needed to do was close the circuit between the COM and OSC terminals via the Shelly which is then powered via the 24V terminal. The point I&#39;m trying to make is that there&#39;s a heap that can be done without going down to the custom firmware and soldering layers and I wish I&#39;d known that before I got started. This, to my mind, is the &#34;happy path&#34; I referred to in part 1.</p><p> è½¦åº“é—¨è‡ªåŠ¨åŒ–æ‰€éœ€è¦åšçš„å°±æ˜¯é€šè¿‡Shellyé—­åˆCOMå’ŒOSCç«¯å­ä¹‹é—´çš„ç”µè·¯ï¼Œç„¶åé€šè¿‡24Vç«¯å­ä¾›ç”µã€‚æˆ‘è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ï¼Œå¯ä»¥å®Œæˆå¾ˆå¤šå·¥ä½œè€Œæ— éœ€ä½¿ç”¨è‡ªå®šä¹‰å›ºä»¶å’Œç„Šæ¥å±‚ï¼Œæˆ‘å¸Œæœ›åœ¨å¼€å§‹ä¹‹å‰å°±çŸ¥é“è¿™ä¸€ç‚¹ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å°±æ˜¯æˆ‘åœ¨ç¬¬1éƒ¨åˆ†ä¸­æåˆ°çš„â€œå¿«ä¹ä¹‹è·¯â€ã€‚</p><p>  This post mostly boils d</p><p>  è¿™ä¸ªå¸–å­ä¸»è¦æ˜¯æ²¸è…¾äº†</p><p>......</p><p>......</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.troyhunt.com/iot-unravelled-part-2-ip-addresses-network-zigbee-custom-firmware-and-soldering/">https://www.troyhunt.com/iot-unravelled-part-2-ip-addresses-network-zigbee-custom-firmware-and-soldering/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ç‰©è”ç½‘/">#ç‰©è”ç½‘</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ip/">#ip</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/è®¾å¤‡/">#è®¾å¤‡</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>剖析导致比特币减半的代码</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">剖析导致比特币减半的代码</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-12 04:41:13</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/5/53c742031a3a5d9c42caf45083586660.png"><img src="http://img.diglog.com/img/2020/5/53c742031a3a5d9c42caf45083586660.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>再过几个小时，比特币网络将经历第三次“腰斩”。那么它是什么，它是如何在引擎盖下工作的呢？</p><p>简单回顾一下：此时此刻，世界各地的矿工都在运行硬件和软件，以计算下一个比特币区块的哈希值。</p><p>如果他们设法及时解开这道数学难题，他们就可以索要整笔奖金。</p><p>这里有很多流行语，不是吗？让我们把它分解一下。</p><p>采矿的整个概念是非常聪明的。实际上并没有什么难题需要解决，它更多的是一种暴力尝试，试图猜出一个神奇的数字。</p><p>比特币网络几乎在任何地方都使用SHA256哈希。简而言之，世界各地的矿工都在尝试运行这个功能：</p><p>$magicNumber也称为现时值，这是一个曾经使用过的数字。通过将先前块的散列包括在新的散列计算中，形成将每个块链接到新块的实际链。区块链本质上是类固醇上的链表。</p><p>矿工们正在猜测$magicNumber的价值。它们反复运行完全相同的计算，递增(或随机化)$magicNumber值。通过这样做，它们每次都会更改函数的结果。</p><p>它是如此简单，几乎是愚蠢的。计算的难度取决于前面需要多少个零。当第一个区块被开采时，它的前面只有8个零：</p><p>在撰写本文时，当计算出最后一个散列时，它的前面有19个零。</p><p>前面需要的零越多，就越难猜出这个神奇的数字。</p><p>旁注：这个算法的卓越之处实际上在于它每隔2016个模块就会自动重新计算难度目标(也就是：需要多少个零)，但这是为了另一次写入。</p><p>如果你猜对了数字，你就会得到奖励。这一奖励以新铸造的比特币的形式出现。</p><p>这些比特币基本上是凭空创造出来的。只不过它既不薄也不空气。努力以计算能力和能量的形式投入到网络中。结果，你得到了比特币。作为一名矿工，您的奖励是保护网络安全的结果。</p><p>这些新创造的比特币是在所谓的Coinbase交易中创造的。这是一个独特的交易，包括在每个区块中，它向猜到正确散列的矿工支付一定数量的比特币。</p><p>(是的，这可能就是广受欢迎的加密货币交易所“Coinbase”得名的原因，它指的是矿工奖励交易。)</p><p>每个正确区块的奖励都是自动计算的，并随着比特币网络的推进而自动调整。这种工作方式非常漂亮，我很乐意带您来一次代码之旅。</p><p>CAmount GetBlockSubsidy(int nHeight，const Consensus：：params&amp；consensusParams){int halvings=nHeight/consensusParams。nSubsidyHalvingInterval；//未定义Right Shift时强制块奖励为零。如果(Halvings&&gt;；=64)返回0；CAmount nSubsidy=50*硬币；//补贴每210,000块削减一半，大约每4年发生一次。nSubsidy&gt；&gt；=减半；返回nSubsidy；}。</p><p>那里面是什么？让我们把它分解一下。我写C已经有一段时间了，但幸运的是，它的可读性相当好。</p><p>最后一个参数conensusParams.nSubsidyHalvingInterval在src/chainparams.cpp中定义为共识规则的一部分。这是比特币网络上的每个人都需要遵守的一套规则。</p><p>附注：对这些共识规则的任何更改都将创建一个“硬分叉”，即一套不再遵循原有链条的新规则。</p><p>nHeight指的是当前块的“高度”。或者，换句话说，就是已经发生的块数。</p><p>这将使减半的价值为3。这将是该电视网第三次将其整体奖励减半。</p><p>但是，如果有一个浮点结果值，显然它不适合整型变量，会发生什么呢？</p><p>这将导致2.952380952。但是，由于变量被定义为整数，因此通过删除小数将其四舍五入为最低整数值。然后，减半变成2。</p><p>//未定义右移位时强制块奖励为零。如果(Halvings&gt；=64)返回0；</p><p>这是一种我不太理解的条件的安全代码：如果出于某种原因，consensusParams.nSubsidyHalvingInterval太低或nHeight非常高，则会导致变量减半的值也很高。</p><p>我认为这张支票无关紧要，因为我们会看到下面的代码？</p><p>更新：多亏了@niobos，我现在知道Shift-by操作数被屏蔽了。这对于本文中较低的代码很重要，但这意味着x&gt；&gt；65变为x&gt；&gt；1，因此需要保留对&gt；=64的检查。</p><p>这部分经常被误解为“会有64个比特币腰斩”。这是不正确的。比特币将减半33个，我们将看到更低的部分。</p><p>“减半”这个词指的是限制你作为矿工可以获得的比特币数量的过程。每21万个街区，这个数字就会减半。</p><p>在一开始，10多年前，每在网络上发现一个区块，就会奖励50个比特币。</p><p>然后，在21万个街区之后，这个数字被削减了一半，只有25个。再过21万个街区，就变成了12.5。这就是我们今天所处的位置。</p><p>几个小时后，它将再次被砍成两半，只有6.25个比特币奖励给矿工。再快进210,000个数据块，就变成了3.125个。诸若此类。</p><p>我想要强调的是，该代码中正在进行一个聪明的按位操作：</p><p>块奖励的起始值固定为50。每枚硬币可以分为100,000,000个单位，在src/mount t.h中定义。如果我们想要正确的话，一个矿工得到的不是“一枚比特币”作为奖励，而是一枚比特币的“一亿块”作为奖励。</p><p>这为我们提供了初始值nSubsidy为5,000,000,000。如果你用二进制编写，你会得到。</p><p>nSubsidy&gt；&gt；=3表示：将位向右移动3位。这就给我们留下了：</p><p>当您将该二进制值转换为其十进制表示形式时，您将获得625,000,000。换言之：“625,000,000 mBTC”或“6.25 BTC”。</p><p>在下一次减半时，在小数表示的末尾又减少了一个零，有效地再次减半了奖励值。</p><p>因为总共只有33位，我们将在第33次减半后(大约在2140年)用完块奖励减半。</p><p>(假设在这一点上，支付的交易费应该足以补偿矿工的电力消耗和硬件。)。</p><p>一个由数千名(如果不是数百万名)矿工组成的网络可以和谐工作的整个想法令人振奋。如果你曾经尝试过建立一个由5个节点组成的集群，你就会知道达成共识或法定人数是很困难的。</p><p>这一切都适用于比特币网络，在未知的硬件上运行，在未知的网速和未知的节点版本和软件上运行-这一切都是因为数学和社会共识，即每个人在网络上都遵循相同的规则。</p><p>它以最新的新闻、指南和教程以及新的开源项目为特色。您可以通过下面的电子邮件注册。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://ma.ttias.be/dissecting-code-bitcoin-halving/">https://ma.ttias.be/dissecting-code-bitcoin-halving/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/减半/">#减半</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/code/">#code</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/矿工/">#矿工</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1001617.html"><img src="http://img.diglog.com/img/2020/5/thumb_93c55817a879a74830e606ee64e9ce27.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001617.html">使用Draw.io在VS代码中创建图表</a></div><span class="my_story_list_date">2020-5-11 13:13</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001576.html"><img src="http://img.diglog.com/img/2020/5/thumb_e8ca8325d74fb2a6119d722ddaa4af49.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001576.html">查看最初的Apollo 12代码清单(以及1202修复程序)</a></div><span class="my_story_list_date">2020-5-11 5:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001564.html"><img src="http://img.diglog.com/img/2020/5/thumb_a8b72a0e51d66213d40e859e3b11ddd4.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001564.html">检查和修复C/C++代码(以及其他语言)的有用工具</a></div><span class="my_story_list_date">2020-5-11 3:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001550.html"><img src="http://img.diglog.com/img/2020/5/thumb_338c773fb915ff12458dcd03bfb85d60.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001550.html">超越沃尔芬斯坦城堡(源代码)，西拉斯·华纳(Silas Warner)</a></div><span class="my_story_list_date">2020-5-11 1:56</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>尼克斯家族文雅介绍(2019)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">尼克斯家族文雅介绍(2019)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-07 19:59:53</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/5/7c6b9feb4cce4cdd83be78474e130dc5.png"><img src="http://img.diglog.com/img/2020/5/7c6b9feb4cce4cdd83be78474e130dc5.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>不要担心别人要做什么。预测未来的最好方法就是发明它。--艾伦·凯(Alan Kay)。</p><p>改变我们进行计算方式的想法很少出现。我们现在使用的很多技术都是旧技术的翻版--一层层的化妆品包裹着旧的概念。整个产品线都是建立在这种缺乏创造力和独创性的基础上的。老问题没有解决。相反，这些所谓的创新解决方案只是将问题抛诸脑后，同时用新的色调来描绘它，声称至少它们让它变得更加丰富多彩。这种心态对进步的危害是多方面的。这给人一种错误的印象，即解决方案实际上正在执行。这造成了一种对改进的错误把握。</p><p>几年前，Eelco Dolstra撰写了开创性的论文，描述了激进的软件部署方式。这些论文有效地构成了NIX的基石，NIX是一种纯粹的函数式包管理器语言，解决了长期困扰计算的问题-包管理不善。在本文中，我将讨论Nix家族，以及如何利用它们为您服务。</p><p>$符号将用于指示常规用户的shell提示符，而#符号将表示root用户的shell。有些情况下，由于使用sudo，命令的EUID将为零(0)。</p><p>您有多少次因为升级了其他组件所依赖的软件而导致系统损坏？你有过多少次深夜停留，因为你必须让一个应用程序正常工作，因为你安装的新软件包破坏了它？有多少次，当您感到沮丧时，您放弃了修复您的系统，而只是决定从头开始重新安装您的系统？恢复数据文件很容易；但是，从上一个工作状态恢复系统配置是通往地狱的单程票。</p><p>NixOS是一个Linux发行版，它通过利用NIX的确定性并使用单个声明性配置文件来解决这些问题，该文件将所有设置和旋钮包含在一个位置-/etc/nixos/configuration ation.nix。此文件包含有关文件系统、用户、服务、网络配置、输入设备、内核参数等的信息。这意味着您可以获取某个人的配置.nix，并拥有他的确切系统配置！在NixOS中，您不必手动摆弄整个系统来进行您想要的配置。您不必使用临时解决方案来指定所需的配置状态。您不需要安装额外的软件来管理系统配置。</p><p>NixOS不遵循FHS，有效地防止了额外的脑损伤。这为灵活性和独创性提供了很大的空间。它没有/usr/和/opt/。它确实有/bin/和/usr/bin/，分别只包含sh和env-这两个实际上都是指向/nix/store/中某个地方的实际程序的符号链接。由管理员显式安装的系统二进制文件的顶级位置位于/run/current-system/sw/bin/and/run/current-system/sw/sbin/。另一方面，用户安装的程序可在其各自的m~/.nix-profile/bin/处获得。这些位置不能通过正常方式修改；必须使用专用程序写入这些树。</p><p>安装NixOS非常简单。对于裸机系统，请从nixos.org/nixos/download.html下载安装程序。也可以从该页面获得VM映像。对于我的上一次安装，我使用以下设置进行了安装：</p><p>在UEFI模式下从USB驱动器引导。在登录提示符下，以root身份登录。</p><p>为了让您抢先一步，您可以使用我的配置的精简版本，如下所示。根据您的需要替换这些值。此处提供所有可用的配置旋钮。</p><p>{config，lib，pkgs，.}：{Imports=[./Hardware-Configuration.nix]；boot={loader={systemd-boot.enable=true；efi.canTouchEfiVariables=true；}；initrd.availableKernelModules=[&#34；xhci_PCI&#34；&#34；EHCI_PCI&#34；&#34；AHCI&#34；&#34；USB_。initrd.luks.device=[{device=&#34；/dev/vg/root&#34；；name=&#34；root&#34；；preLVM=false；}]；leanTmpDir=true；}；fileSystems=[{device=&#34；/dev/disk/by-uuid/6106-6BF8&#34；；fsType=&#34；vFAT&#34；；mount Point=&#34；/dev/disk/by-uuid/6106-6BF8&#34；；fsType=&#34；vFAT&#34；；mount Point=&#34。fsType=&#34；ext4&#34；；mount Point=&#34；/&#34；；}]；swapDevices=[{device=&#34；/dev/vg/exchange&#34；；}]；Networking={hostname=&#34；mehfoo&#34；；hostID=&#34；7B1548AE&#34；；enableIPv6=true；networkmanager er.enable=true；}；Environment={systemPack.enable=true；}。security.sudo={enable=true；configFile=&#39；&#39；Defaults env_Reset root all=(ALL：ALL)ALL%WELL ALL=(ALL)SETENV：NOPASSWD：ALL&#39；&#39；；}；services={xserver={autorun=true；defaultDepth=24；enable=true；displayManager.kdm.enable=true；desktopManager.kde5.enable=true。ExtraGroups=[&#34；车轮&#34；&#34；网络管理器&#34；&#34；码头&#34；]；}；defaultUserShell=&#34；/run/current-system/sw/bin/zsh&#34；；}；}。</p><p>用您现有的UUID替换磁盘的UUID。使用命令blKID获取UUID。对于networking.hostID的值，请使用以下命令：</p><p>该命令将解析/etc/nixos/configuration ation.nix，确保没有错误。此命令将下载所有必要的软件包以匹配规范。</p><p>安装后，更新现有配置非常简单。您所要做的就是编辑配置文件，然后重新构建系统：</p><p>如果您犯了错误，系统会通知您，而不是继续进行不正确的配置。系统完成引导后，使用Ctrl+Alt+F1切换到控制台，然后以root身份登录，然后为我们在configuration中指定的用户设置密码。nix：</p><p>构成NixOS和Nixpkgs核心的组件是Nix语言。它是一种旨在处理包的声明性语言。</p><p>为了更容易理解该语言，让我们安装Nix REPL：</p><p>接下来，让我们运行它。您将看到版本号和nix-repl提示符。在撰写本文时，最新的稳定版本是1.11.8：</p><p>声明字符串的另一种方法是使用两对单引号。请不要将其与双引号混淆：</p><p>与使用&#34；相比，使用&#39；的优点是允许在其内部存在&#34；：</p><p>然后它返回的值将被正确引用。这在稍后我们要构建复杂表达式时很有用。</p><p>哎呀！这不是我们预想的。由于NIX在设计时考虑了文件和目录，因此它做了一个特例，即当/字符被非空格字符包围时，它会将其解释为目录路径，从而产生绝对路径。要实际执行除法，请在/字符前后至少添加一个空格：</p><p>顺便说一下，NIX中没有浮点数。因此，如果您尝试评估一个，您将得到：</p><p>NIX-repl&gt；1.0error：语法错误，意外的int，需要ID或OR_KW或美元_CURLY或&#39；&#34；&#39；，位于(字符串)：1：3&#39；&#34；&#39；</p><p>此表达式返回部分应用的函数的闭包。我们需要另一个值来完全应用它：</p><p>NIX中的=运算符用于绑定值。在此示例中，它用于定义部分应用程序。要使用该功能，请执行以下操作：</p><p>Nix-repl&&gt;1&lt；2truenix-repl&gt；1&&gt;1==1truenix-repl&gt；1==1truenix-repl&gt；&#34；foo&#34；==&#34；foo&#34；truenix-repl&gt；&#34；foo&#34；&lt；&#34；bar&#34；Falsenix-repl&gt；</p><p>nix-repl&gt；[1&#34；foo&#34；true]++[false(6/2)][1&#34；foo&#34；true false 3]。</p><p>nix-repl&gt；builtins.head([1&#34；foo&#34；true(6/2)]++[false(6/2)])1。</p><p>nix-repl&gt；builtins.ail([1&#34；foo&#34；true(6/2)]++[false(6/2)])[&#34；foo&#34；true 3 false 3]。</p><p>列表从0开始编制索引。要获取第1个元素，请使用builtins.elemAt运算符：</p><p>NIX中的一个重要数据结构是集合。它们是用分号分隔的关键字值对：</p><p>nix-repl&gt；{a=0；b=&#34；bar&#34；；c=true；d=(6/2)；}{a=0；b=&#34；Kato&#34；；c=true；d=3；}。</p><p>集合与列表的不同之处在于，从集合中提取值是通过引用名称来完成的。要提取b的值，请使用。经营者：</p><p>nix-repl&gt；{a=0；b=&#34；bar&#34；；c=true；d=(6/2)；}.b&#34；bar&#34；</p><p>nix-repl&gt；{a=0；b=&#34；bar&#34；；c=true；d=(6/2)；}。&#34；b&#34；&#34；bar&#34；</p><p>nix-repl&gt；rec{a=0；b=&#34；bar&#34；；c=true；d=(6/2)；e=b；}.E&#34；bar&#34；</p><p>在NIX中，所有路径都转换为绝对路径。如果引用当前目录中的文件：</p><p>同样，如果引用绝对路径内的相对路径，它仍会转换为绝对路径：</p><p>nix-repl&&gt;；/error：语法错误，意外&#39；/&#39；，at(String)：1：1nix-repl&&gt;；。/error：语法错误，意外&#39；.&#39；，at(String)：1：1</p><p>如果这些名词没有动词可用，那会有什么意思呢？NIX中的函数与其他语言有相似之处，但也有自己独特的特点。</p><p>此表达式创建一个返回其参数的匿名函数-Identity函数。第一个x后面的冒号表示它是函数的参数，就像在lambda演算中一样。此外，由于字母的等价性，名称并不重要：</p><p>这些函数没有多大用处，因为它们没有被捕获用于应用程序。例如，如果我们要将其与参数&#34；foo&#34；一起使用，则需要用括号将其括起来：</p><p>让我们创建一个将&#34；ugh&34；附加到其输入的函数，然后应用它：</p><p>要定义接受另一个参数的函数，让我们使用以下形式：</p><p>nx-repl&gt；ugh=s：t：s+tnix-repl&gt；ugh&34；+tnix-repl&gt；ugh&#34；Me&#34；&#34；You&#34；&#34；</p><p>当集与函数一起使用时，可以实现更强大的抽象。我们可以将集合作为参数传递给函数，然后该函数将使用该集合中的数据：</p><p>nix-repl&gt；poof={a，b}：x：a+&#34；&#34；+b+x</p><p>此函数有两个参数：{a，b}-具有两个元素的集合的参数规范，以及x-常规参数。请注意，参数规范不是实数集，而仅仅是匹配参数的一种方式；它使用逗号作为值分隔符。在此函数中，我们使用+运算符组合输入。要使用此函数，我们需要执行以下操作：</p><p>当一个函数声明一个set作为它的参数时，您需要在调用使用它们的函数时指定关键字。在本例中，关键字名称是a和b。</p><p>我们在这里使用了一个常规的、未设置的参数，以便它可以将集合引用为一个值。请注意以下内容：</p><p>也可以指定默认值。当不使用带有默认值的参数时，将使用默认值。它们在Common Lisp中的声明类似：</p><p>*(deful foof(a&amp；可选(b&#34；oo&#34；))(连接#39；string a b))*(foof&#34；o.o&#34；)&#34；o.o。o&#34；*(foof&#34；o.o&#34；&#34；^_^&#34；)&#34；o.o^_^&#34；</p><p>nix-repl&gt；foof={a，b？&#34；oo&#34；}：a+bnix-repl&gt；foof{a=&#34；goo&#34；；}&#34；gooO.o&34；nix-repl&gt；foof{a=&#34；goo&#34；；b=&#34；oog&#34；；}&#34；gooog&#34。</p><p>为了增加更大的灵活性，NIX支持使用伪静态参数。让我们从上面修改该函数：</p><p>一样的。那么，我们如何利用这种灵活性呢？我们将为属性集创建一个标签，以便可以引用‘Extra’值：</p><p>nix-repl&&gt;foof=[电子邮件受保护]{a，b，c？&#34；C&#34；，.}：a+b+c+attrs.dnix-repl&gt；foof{a=&#34；A&#34；；b=&#34；B&#34；；d=&#34；D&#34；；}&#34；abcd&#34；nix-repl&gt；foof{a=。；c=&#34；X&#34；；d=&#34；D&#34；；}&#34；ABXD&#34；</p><p>关键字let让我们(不是有意使用双关语)在局部范围内定义变量。例如，要使标识符x和y仅在本地范围内可见，请执行以下操作：</p><p>让x=&#34；foo&#34；；y=&#34；bar&34；in x+poof{a=&#34；hm&#34；；b=&#34；real&#34；；}&#34；HMM&#34；+y&#34；foohreallyhmmbar&#34；</p><p>请注意最后一个；在与let一起使用的in关键字之前-它标志着let主体的开始。let结构的行为方式类似于Lisp和Haskell等语言中的let关键字。</p><p>{x=#34；foo&34；；y=&#34；bar&#34；；}；poof{a=y；b=x；}&#34；xyz&#34；&#34；bar foo xyz&#34；</p><p>这里发生的情况是，该集合中的值被“公开”，以使它们在with正文中可用。</p><p>条件表达式由if关键字完成。它与主流语言有相似的形式：</p><p>如果为FALSE，则&#34；TRUE&34；ELSE&#34；FALSE&#34；&#34；FALSE&#34；</p><p>将文件导入NIX表达式的想法与其他语言略有不同。NIX的进口与套装密切相关。假设我们有包含以下内容的文件meh.nix：</p><p>let表达式将名称meh绑定到接受一个参数的函数。在let的主体中，它返回一个包含名为meh的成员的集合-=左侧的那个成员。此成员的值是刚刚定义的函数。这里需要记住的重要概念是，这个let表达式返回一个属性集。</p><p>我们再次看到熟悉的lambda术语。如图所示，这里的meh名称是一个函数。现在，我们如何才能取消引用这个值呢？通过使用。接线员！</p><p>我们必须使用括号，因为当前目录中没有meh.nix.meh这样的文件。如果我们要一步一步通过它，它会有以下几点：</p><p>这很好地概括了有关NIX语言的入门概念。其余的毛茸茸的细节可以在手册中找到。</p><p>Nixpkgs是由全球用户管理和维护的包的集合。由于源代码在GitHub中，因此它能够利用该平台提供的强大协作模型。在撰写本文时，该集合中有42583个包。它包含广泛的软件包，从生产力应用程序到定理证明器，应有尽有。</p><p>大多数流行的操作系统都能很好地处理软件包，直到它们不能。只要你独自一人沿着直线前进，你就会没事的。当你在路上介绍其他人时，情况就不同了。为了让所有的演员一致行动，每个人都必须严格地相互联系。如果一名演员决定离开，自己走，整个剧组就会变得残缺不全。然而，如果该成员克隆了自己，使得离开的副本变得独立，那么原始的行走演员就不会受到干扰。</p><p>让我们以目标为多用户生产开发环境的分发为例。安装Firefox版本100时，主二进制文件位于/usr/bin/Firefox或/usr/local/bin/Firefox。然后，该系统中的所有用户都将能够从该路径访问应用程序；John、Mary和Peter都很高兴。但是，当John将其升级到版本200时，Mary和Peter正在使用的同一应用程序也会升级！如果他们更喜欢与他们一起工作的旧版本，这不是一件好事！Nixpkgs允许您拥有一个软件的多个版本，而不会与其他版本发生冲突。John、Mary和Peter都可以拥有自己的Firefox版本，而不会与其他版本冲突。Nixpkgs是怎么做到的？它通过根据计算出的校验和命名组件，而不使用通用的全局位置来实现这一点。</p><p>每个用户都有自己的~/.nix-profile版本，这些目录中的所有内容都不包含常规文件。相反，它们都是位于/nix/store/中的实际文件的符号文件。此目录是实际安装程序及其依赖项的位置。写入该目录的唯一方式是通过特定于Nix的程序。无法通过正常方式修改该目录的内容。因此，当普通用户john安装Vim8时，该程序的安装格式类似于/nix/store/w4cr4j13lqzry2b8830819vdz3sdypfa-vim-8.0.0329.。程序包名前的字符是用于构建程序包的所有输入的校验和。然后，文件/HOME/john/.nix-profile/bin/vim指向指向/nix/store/中的文件的符号链接，该符号链接将指向/nix/store/w4cr4j13lqzry2b8830819vdz3sdypfa-vim-8.0.0329/bin/vim.中的实际Vim二进制文件。</p><p>如果您使用的是NixOS，请跳过此步骤，因为Nixpkgs已经随附了。要在GNU/Linux或MacOS上安装Nixpkgs，请运行：</p><p>系统将提示您输入通过sudo进行root访问的凭据，因为它会将资源安装到/nix/。安装之后，可能还会要求您在shell初始化文件中附加一行命令。当您生成一个新的shell实例时，特定于Nix的命令将可供使用。</p><p>使用Nixpkgs安装软件包有两种方式：git checkout，这是最先进的最新更新版本，或者使用通道。git存储库非常适合那些想要使用包的最新和最好的可用版本的人，或者那些想要测试东西的人。另一方面，通道本质上是较早版本的git存储库的快照。</p><p>对git存储库的更新经常发生-在您阅读本文时，会向主树提交新的内容。要使用git签出，请克隆存储库：</p><p>此命令在您的主目录下创建一个nixpkgs/目录。如果您的用户名是vakelo，那么如果您使用的是GNU/Linux或MacOS，那么可以在/home/vakelo/nixpkgs/或/users/vakelo/nixpkgs/中找到存储库的克隆。</p><p>要使用git签出安装软件包，比如emem(Markdown到HTML的转换器)，请运行：</p><p>这将下载EMEM及其所有依赖项，然后它将使程序可供您使用。要确保EMEM已成功安装，请运行：</p><p>如果您的shell没有呕吐并抱怨您正在寻找不存在的东西，而您看到的是一个版本号，这意味着您已经成功安装了EMEM。</p><p>通过通道安装包更好，因为使用它安装包的命令更方便。权衡的是，这些包将在几天内过期。如果你不介意的话，那就使用通道而不是git结账。</p><p>频道被标记为稳定、不稳定或带有特定版本号，例如18.09或20.03。对于本文，我们使用不稳定通道-它不像稳定通道那样过时，也不像git结账那么近。要订阅不稳定的频道，请运行：</p><p>这将从nixos.org获取标记为nixpkgs-unstant的频道，然后将其安装到您的用户配置文件中。</p><p>使用上面的示例，要安装EMEM，请分别为NixOS和其他系统运行以下命令：</p><p>随着时间的推移，/nix/store/accument中的树会累积，并且可能会有不再被任何包引用的路径。要清理它，请运行以下命令：</p><p>文件~/.nixpkgs/config.nix是由NIX命令读取的NIX表达式。在它中，我们可以指定包覆盖-取代默认设置的配置，以及其他旋钮，包括但不限于浏览器插件、GUI配置、SSL等。</p><p>{pkgs}：{PackageOverrides=pkgs：{emacs=pkgs.emacs.override{with GTK2=false；with GTK3=false；with Xwidgets=false；}；}；Firefox={jre=true；enableGoogleTalkPlugin=</p><p>..</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://ebzzry.io/en/nix/">https://ebzzry.io/en/nix/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/家族/">#家族</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>æˆ‘å¦‚ä½•å‘ç°æ˜“å—å›°éš¾çš„æ˜“å—ä¼¤å®³ï¼Œä»¥åŠè‹¹æœå¦‚ä½•å¯¹å…¶ä½œå‡ºååº” How I Found a Vulnerability to Hack iCloud Accounts and How Apple Reacted to It</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">How I Found a Vulnerability to Hack iCloud Accounts and How Apple Reacted to It<br/>æˆ‘å¦‚ä½•å‘ç°æ˜“å—å›°éš¾çš„æ˜“å—ä¼¤å®³ï¼Œä»¥åŠè‹¹æœå¦‚ä½•å¯¹å…¶ä½œå‡ºååº” </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-20 10:19:41</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/a445dcb956b5968287b2c47e9a318315.jpg"><img src="http://img2.diglog.com/img/2021/6/a445dcb956b5968287b2c47e9a318315.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This article is about how I found a vulnerability on Apple forgot password endpoint that allowed me to takeover an iCloud account. The vulnerability is completely patched by Apple security team and it no longer works.  Apple Security Team rewarded me $18,000 USD as a part of their bounty program but I refused to receive it. Please read the article to know why I refused the bounty.</p><p>æœ¬æ–‡æ˜¯å…³äºå¦‚ä½•åœ¨Appleå¿˜è®°å¯†ç ç«¯ç‚¹ä¸Šå‘ç°æ¼æ´çš„æ¼æ´å…è®¸æˆ‘æ¥ç®¡iCloudå¸æˆ·ã€‚æ˜“å—åŸ¹è®­æ€§å®Œå…¨ç”±Apple Securityå›¢é˜Ÿä¿®è¡¥ï¼Œå®ƒä¸å†æœ‰æ•ˆã€‚ Apple Securityå›¢é˜Ÿä½œä¸ºå…¶èµé‡‘è®¡åˆ’çš„ä¸€éƒ¨åˆ†å¥–åŠ±æˆ‘18,000ç¾å…ƒï¼Œä½†æˆ‘æ‹’ç»æ”¶åˆ°å®ƒã€‚è¯·é˜…è¯»æ–‡ç« ä»¥äº†è§£ä¸ºä»€ä¹ˆæˆ‘æ‹’ç»èµé‡‘ã€‚</p><p> After my  Instagram account takeover vulnerability, I realized that many other services are vulnerable to race hazard based brute forcing. So I kept reporting the same with the affected service providers like  Microsoft, Apple and a few others.</p><p> åœ¨æˆ‘çš„Instagramå¸æˆ·æ”¶è´­æ¼æ´ä¹‹åï¼Œæˆ‘æ„è¯†åˆ°è®¸å¤šå…¶ä»–æœåŠ¡æ˜“å—äº‰å¤ºå±é™©çš„è›®åŠ›ã€‚å› æ­¤ï¼Œæˆ‘ä¸Microsoftï¼ŒAppleå’Œå…¶ä»–ä¸€äº›ç±»ä¼¼çš„å—å½±å“æœåŠ¡æä¾›å•†æŠ¥å‘Šäº†åŒæ ·çš„æŠ¥å‘Šã€‚</p><p> Many people mistook this vulnerability as typical brute force attack but it isnâ€™t. Here we are sending multiple concurrent requests to the server to exploit the  race condition vulnerability present in the rate limits making it possible to bypass it.</p><p> è®¸å¤šäººå°†è¿™ç§è„†å¼±æ€§è¯¯è®¤ä¸ºæ˜¯å…¸å‹çš„è›®åŠ›æ”»å‡»ï¼Œä½†å®ƒä¸æ˜¯ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ­£åœ¨å‘æœåŠ¡å™¨å‘é€å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Œä»¥åˆ©ç”¨é€Ÿç‡é™åˆ¶ä¸­å­˜åœ¨çš„ç«äº‰æ¡ä»¶æ¼æ´ï¼Œä½¿å¾—å¯ä»¥ç»•è¿‡å®ƒã€‚</p><p>  The  forgot password option of Apple ID allows us to change our password using 6 digit OTP sent to our mobile number and email address respectively. Once we enter the correct OTP we will be able to change the password.</p><p>  Apple IDçš„å¿˜è®°å¯†ç é€‰é¡¹å…è®¸æˆ‘ä»¬ä½¿ç”¨6ä½æ•°OTPå‘é€åˆ°æˆ‘ä»¬çš„æ‰‹æœºå·ç å’Œç”µå­é‚®ä»¶åœ°å€çš„å¯†ç æ›´æ”¹æˆ‘ä»¬çš„å¯†ç ã€‚æˆ‘ä»¬è¾“å…¥æ­£ç¡®çš„OTPåï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿæ›´æ”¹å¯†ç ã€‚</p><p>  For security reasons, apple will prompt us to enter the trusted phone number along with email address to request OTP.</p><p>  å‡ºäºå®‰å…¨åŸå› ï¼ŒAppleå°†æç¤ºæˆ‘ä»¬è¾“å…¥å¯ä¿¡ç”µè¯å·ç ä»¥åŠç”µå­é‚®ä»¶åœ°å€ä»¥è¯·æ±‚OTPã€‚</p><p> So to exploit this vulnerability, we need to know the trusted phone number as well as their email address to request OTP and will have to try all the possibilities of the 6 digit code, that would be around 1 million attempts (10 ^ 6).</p><p> å› æ­¤ï¼Œä¸ºäº†åˆ©ç”¨æ­¤æ¼æ´ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å¯ä¿¡ç”µè¯å·ç ä»¥åŠä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€æ¥è¯·æ±‚OTPï¼Œå¹¶ä¸”å¿…é¡»å°è¯•6ä½æ•°ä»£ç çš„æ‰€æœ‰å¯èƒ½æ€§ï¼Œè¿™å°†æ˜¯çº¦100ä¸‡æ¬¡å°è¯•ï¼ˆ10 ^ 6ï¼‰ã€‚</p><p> As for as my testing, the forgot password endpoint had pretty strong rate limits. If we enter more than 5 attempts, our account will be locked for the next few hours, even rotating the IP didnâ€™t help.</p><p> è‡³äºæˆ‘çš„æµ‹è¯•ï¼Œå¿˜è®°å¯†ç ç«¯ç‚¹å…·æœ‰ç›¸å½“å¼ºçš„é€Ÿç‡é™åˆ¶ã€‚å¦‚æœæˆ‘ä»¬è¾“å…¥è¶…è¿‡5æ¬¡å°è¯•ï¼Œæˆ‘ä»¬çš„å¸æˆ·å°†è¢«é”å®šåœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªå°æ—¶å†…ï¼Œç”šè‡³æ—‹è½¬IPæ²¡æœ‰å¸®åŠ©ã€‚ </p><p>   Then I tried for race hazard based brute forcing by sending simultaneous POST requests to apple server and found a few more limitations.</p><p>ç„¶åæˆ‘è¯•å›¾é€šè¿‡å‘AppleæœåŠ¡å™¨å‘é€åŒæ—¶å‘å¸ƒè¯·æ±‚å¹¶æ‰¾åˆ°æ›´å¤šé™åˆ¶æ¥è¿›è¡Œç§æ—å±é™©çš„é‡è›®å¼ºåˆ¶ã€‚</p><p> To my surprise, apple have rate limits for concurrent POST requests from single IP address, not just to the forget password endpoint but to the entire apple server. We cannot send more than 6 concurrent POST requests, it will be dropped. It will not just be dropped but our IP address will be blacklisted for future POST requests with 503 error.</p><p> ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼ŒAppleå…·æœ‰æ¥è‡ªå•ä¸ªIPåœ°å€çš„å¹¶å‘å¼ è´´è¯·æ±‚çš„é€Ÿç‡é™åˆ¶ï¼Œè€Œä¸ä»…ä»…æ˜¯å¿˜è®°å¯†ç ç«¯ç‚¹ï¼Œè€Œæ˜¯ç»™æ•´ä¸ªAppleæœåŠ¡å™¨ã€‚æˆ‘ä»¬æ— æ³•å‘é€è¶…è¿‡6ä¸ªå¹¶å‘çš„é‚®æ”¿è¯·æ±‚ï¼Œå®ƒå°†è¢«åˆ é™¤ã€‚å®ƒä¸ä»…ä»…è¢«åˆ é™¤ï¼Œä½†æˆ‘ä»¬çš„IPåœ°å€å°†è¢«åˆ—å…¥æœªæ¥çš„å¸–å­è¯·æ±‚ï¼Œä»¥503é”™è¯¯ã€‚</p><p>    So I thought they arenâ€™t vulnerable to this type of attack ğŸ˜” but still had some hope since these are generic rate limits across the server and not specific to the code validation endpoint.</p><p>    æ‰€ä»¥æˆ‘è®¤ä¸ºä»–ä»¬å¹¶ä¸å®¹æ˜“å—åˆ°è¿™ç§ç±»å‹çš„æ”»å‡»ğŸ˜”ï¼Œä½†ä»æœ‰ä¸€äº›å¸Œæœ›ï¼Œå› ä¸ºè¿™äº›æ˜¯æœåŠ¡å™¨ä¸Šçš„é€šç”¨é€Ÿç‡é™åˆ¶ï¼Œè€Œä¸æ˜¯ç‰¹å®šäºä»£ç éªŒè¯ç«¯ç‚¹ã€‚</p><p>  iforgot.apple.com resolves to 6 IP addresses across the globe â€“ (17.141.5.112, 17.32.194.36, 17.151.240.33, 17.151.240.1, 17.32.194.5, 17.111.105.243).</p><p>  iforgot.apple.comè§£å†³å…¨çƒçš„6ä¸ªIPåœ°å€ - ï¼ˆ17.141.5.112,17.32.194.36,17.151.240.3,17.151.240.1,17.32.194.5,17.311.105.243ï¼‰ã€‚</p><p> There were two rate limits we have seen above, one is triggered when we send more than 5 requests to forgot password endpoint (http://iforgot.apple.com/password/verify/smscode) and another one is across the apple server when we send more than 6 concurrent POST requests.</p><p> æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°äº†ä¸¤ä¸ªé€Ÿç‡é™åˆ¶ï¼Œå½“æˆ‘ä»¬å‘é€è¶…è¿‡5ä¸ªè¯·æ±‚å¿˜è®°å¯†ç ç«¯ç‚¹æ—¶ï¼ˆhttp://iforgot.apple.com/password/verify/smscodeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯è§¦å‘çš„ï¼Œå½“æ—¶æˆ‘ä»¬å‘é€è¶…è¿‡6ä¸ªå¹¶å‘çš„å‘å¸ƒè¯·æ±‚ã€‚</p><p> Both these rate limits are specific to apple server IP which means we can still send requests (with in limits though) to another apple server IP.</p><p> è¿™äº›é€Ÿç‡é™åˆ¶éƒ½æ˜¯ç‰¹å®šäºApple Server IPçš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä»ç„¶å¯ä»¥å‘é€è¯·æ±‚ï¼ˆè™½ç„¶ä»¥é™åˆ¶ï¼‰åˆ°å¦ä¸€ä¸ªAppleæœåŠ¡å™¨IPã€‚</p><p> We can send upto 6 concurrent requests to an apple server IP (by binding iforgot.apple.com to the IP) from single client IP address as per their limits. There are 6 apple IP address resolved as mentioned above. So we can send upto 36 requests across the 6 apple IP address (6 x 6 = 36) from single IP address.</p><p> æˆ‘ä»¬å¯ä»¥æ ¹æ®å…¶é™åˆ¶å°†æœ€å¤š6ä¸ªå¹¶å‘è¯·æ±‚ä»å•ä¸ªå®¢æˆ·ç«¯IPåœ°å€ç»‘å®šåˆ°Apple Server IPï¼ˆé€šè¿‡å°†iforgot.apple.comç»‘å®šåˆ°IPï¼‰ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæœ‰6ä¸ªApple IPåœ°å€å·²è§£å†³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»å•ä¸ªIPåœ°å€å‘é€6ä¸ªApple IPåœ°å€ï¼ˆ6 x 6 = 36ï¼‰çš„é«˜è¾¾36ä¸ªè¯·æ±‚ã€‚ </p><p> Therefore, the attacker would require 28K IP addresses to send up to 1 million requests to successfully verify the 6 digit code.</p><p>å› æ­¤ï¼Œæ”»å‡»è€…éœ€è¦28Kä¸ªIPåœ°å€æ¥å‘é€å¤šè¾¾100ä¸‡çš„è¯·æ±‚ä»¥æˆåŠŸéªŒè¯6ä½æ•°ä»£ç ã€‚</p><p> 28k IP addresses looks easy if you use cloud service providers, but here comes the hardest part, apple server has a strange behavior when we try to send POST requests from cloud service providers like AWS, Google cloud, etc.</p><p> 28K IPåœ°å€çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œå¦‚æœæ‚¨ä½¿ç”¨äº‘æœåŠ¡æä¾›å•†ï¼Œä½†åœ¨è¿™é‡Œæœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œå½“æˆ‘ä»¬å°è¯•å‘é€æ¥è‡ªAWSï¼ŒGoogleäº‘ç­‰äº‘æœåŠ¡æä¾›å•†çš„å‘å¸ƒè¯·æ±‚æ—¶ï¼ŒAppleæœåŠ¡å™¨å…·æœ‰å¥‡æ€ªçš„è¡Œä¸ºã€‚</p><p>  They reject the POST request with 502 Bad gateway without even checking the request URI or body. I tried changing IPs but all of them returned same response code, which means they have blacklisted the entire ASN of some cloud service providers if am not wrong ğŸ™„</p><p>  å®ƒä»¬æ‹’ç»ä½¿ç”¨502ä¸ªä¸è‰¯ç½‘å…³æ‹’ç»æœªç»æ£€æŸ¥è¯·æ±‚URIæˆ–Bodyçš„POSTè¯·æ±‚ã€‚æˆ‘å°è¯•æ”¹å˜IPSä½†æ˜¯æ‰€æœ‰è¿™äº›éƒ½è¿”å›äº†ç›¸åŒçš„å“åº”ä»£ç ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸æ˜¯é”™è¯¯çš„è¯ï¼Œä»–ä»¬å·²å°†æ•´ä¸ªASNåˆ—å…¥æ•´ä¸ªASNçš„æ•´ä¸ªASN</p><p>  It makes the attack harder for those who rely on reputed cloud services like AWS. I kept trying various providers and finally found a few service providers their network IPs are not blacklisted.</p><p>  å¯¹äºé‚£äº›ä¾èµ–äºAWSâ€‹â€‹ç­‰çŸ¥è¯†äº‘æœåŠ¡çš„äººæ¥è¯´ï¼Œå®ƒä¼šæ¢å¤å‰§çƒˆã€‚æˆ‘ä¸€ç›´åœ¨å°è¯•å„ç§æä¾›å•†ï¼Œæœ€åå‘ç°äº†ä¸€äº›æœåŠ¡æä¾›å•†ï¼Œä»–ä»¬çš„ç½‘ç»œIPæ²¡æœ‰é»‘åå•ã€‚</p><p> Then I tried to send multiple concurrent POST requests from different IP address to verify the bypass.</p><p> ç„¶åæˆ‘å°è¯•ä»ä¸åŒIPåœ°å€å‘é€å¤šä¸ªå¹¶å‘çš„å¸–å­è¯·æ±‚ä»¥éªŒè¯æ—è·¯ã€‚</p><p>  And it worked!!! ğŸ‰ğŸ‰ğŸ‰ Now I can change the password of any Apple ID with just their trusted phone number ğŸ˜‡</p><p>  å®ƒçš„å·¥ä½œï¼ ğŸ‰ğŸ‰ğŸ‰ç°åœ¨æˆ‘å¯ä»¥åªç”¨ä»–ä»¬å¯ä¿¡ç”µè¯å·ç æ›´æ”¹ä»»ä½•Apple IDçš„å¯†ç ğŸ˜‡</p><p> Of course the attack isnâ€™t easy to do, we need to have a proper setup to successfully exploit this vulnerability. First we need to bypass the SMS 6 digit code then 6 digit code received in the email address. Both bypasses are based on same method and environment so we need not change anything while trying the second bypass. Even if the user has two factor authentication enabled, we will still be able to access their account, because 2FA endpoint also shares the rate limit and was vulnerable. The same vulnerability was also present in the password validation endpoint.</p><p> å½“ç„¶ï¼Œæ”»å‡»ä¸å®¹æ˜“åšåˆ°ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæ­£ç¡®çš„è®¾ç½®æ¥æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡SMS 6ä½æ•°ä»£ç ï¼Œç„¶ååœ¨ç”µå­é‚®ä»¶åœ°å€ä¸­æ”¶åˆ°6ä½æ•°ä»£ç ã€‚æ—è·¯éƒ½åŸºäºç›¸åŒçš„æ–¹æ³•å’Œç¯å¢ƒï¼Œå› æ­¤æˆ‘ä»¬åœ¨å°è¯•ç¬¬äºŒæ—è·¯æ—¶æ— éœ€æ›´æ”¹ä»»ä½•å†…å®¹ã€‚å³ä½¿ç”¨æˆ·å¯ç”¨äº†ä¸¤ä¸ªå› ç´ èº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿè®¿é—®å…¶å¸æˆ·ï¼Œå› ä¸º2FAç«¯ç‚¹ä¹Ÿå…±äº«é€Ÿç‡é™åˆ¶å¹¶æ˜“å—æ”»å‡»ã€‚å¯†ç éªŒè¯ç«¯ç‚¹ä¸­ä¹Ÿå­˜åœ¨ç›¸åŒçš„æ¼æ´ã€‚ </p><p> I reported this information with detailed reproduction steps and a video demonstrating the bypass to Apple security team on July 1st, 2020. Apple security team acknowledged and triaged the issue with in few minutes of report.</p><p>æˆ‘å‘2020å¹´7æœˆ1æ—¥å‘è‹¹æœå®‰å…¨å›¢é˜Ÿå‘è‹¹æœå®‰å…¨å›¢é˜Ÿå±•ç¤ºäº†è¿™ä¸ªä¿¡æ¯ï¼Œå¹¶å°†å…¶å±•ç¤ºäº†æ—è·¯çš„è§†é¢‘ã€‚Appleå®‰å…¨å›¢é˜Ÿåœ¨å‡ åˆ†é’Ÿå†…æ‰¿è®¤å¹¶å®šåˆ¶äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>  I didnâ€™t get any updates from Apple after triage so I kept following up for status updates and they said they are working on a fix on Sep 9th, 2020.</p><p>  åœ¨åˆ†ç±»åæˆ‘æ²¡æœ‰ä»Appleè·å¾—ä»»ä½•æ›´æ–°ï¼Œä»¥ä¾¿æˆ‘ç»§ç»­è·Ÿè¿›çŠ¶æ€æ›´æ–°ï¼Œå¹¶è¡¨ç¤ºä»–ä»¬åœ¨2020å¹´9æœˆ9æ—¥çš„ä¿®å¤ç¨‹åºä¸Šå·¥ä½œã€‚</p><p>  Again, no updates for next 5 months and then this email came when I asked for status</p><p>  å†æ¬¡ï¼Œæœªæ¥5ä¸ªæœˆæ²¡æœ‰æ›´æ–°ï¼Œç„¶ååœ¨æˆ‘è¦æ±‚èº«ä»½æ—¶å‘å‡ºæ­¤ç”µå­é‚®ä»¶</p><p>  They said they are planning to address the issue in upcoming security update. I was wondering what is taking so long for them to react to a critical vulnerability.</p><p>  ä»–ä»¬è¡¨ç¤ºä»–ä»¬è®¡åˆ’åœ¨å³å°†åˆ°æ¥çš„å®‰å…¨æ›´æ–°ä¸­è§£å†³é—®é¢˜ã€‚æˆ‘æƒ³çŸ¥é“ä»–ä»¬å¯¹ä»–ä»¬æ¥è¯´æ˜¯ä»€ä¹ˆéœ€è¦åšå‡ºååº”çš„è„†å¼±æ€§ã€‚</p><p> I kept retesting the vulnerability to know whether its fixed instead of relying on them. I tested on April 1st, 2021 and realized a patch for the vulnerability was released to production but still there were no updates from Apple. I asked them whether the issue is patched and the response is same as they have no status updates to share.</p><p> æˆ‘ä¸€ç›´åœ¨é‡æ–°æµ‹è¯•è„†å¼±æ€§ï¼Œä»¥çŸ¥é“å®ƒæ˜¯å¦å›ºå®šè€Œä¸æ˜¯ä¾èµ–äºå®ƒä»¬ã€‚æˆ‘äº4æœˆ1æ—¥æµ‹è¯•äº†2021å¹´ï¼Œå¹¶å®ç°äº†æ¼æ´çš„è¡¥ä¸è¢«é‡Šæ”¾åˆ°ç”Ÿäº§ï¼Œä½†ä»ç„¶æ²¡æœ‰æ¥è‡ªAppleçš„æ›´æ–°ã€‚æˆ‘é—®ä»–ä»¬æ˜¯å¦æ­£åœ¨ä¿®è¡¥é—®é¢˜ï¼Œå¹¶ä¸”å“åº”ä¸å®ƒä»¬æ²¡æœ‰å…±äº«çš„çŠ¶æ€æ›´æ–°ç›¸åŒã€‚</p><p>  I was patient and waiting for them to update the status. After a month, I wrote them that the issue was patched on April 1st itself and why am not being updated about it, I also told that I wanted to publish the report to my blog.</p><p>  æˆ‘è€å¿ƒç­‰å¾…ä»–ä»¬æ›´æ–°çŠ¶æ€ã€‚ä¸€ä¸ªæœˆåï¼Œæˆ‘å†™äº†ä»–ä»¬åœ¨4æœˆ1æ—¥æœ¬èº«ä¿®è¡¥äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¹Ÿæ²¡æœ‰æ›´æ–°å®ƒï¼Œæˆ‘ä¹Ÿå‘Šè¯‰æˆ‘æƒ³å‘æˆ‘çš„åšå®¢å‘å¸ƒè¯¥æŠ¥å‘Šã€‚</p><p> Apple security team asked me whether it is possible to share the draft of the article with them before publishing. That is when things started to go unexpected.</p><p> Apple Securityå›¢é˜Ÿå‘æˆ‘è¯¢é—®äº†æ˜¯å¦æœ‰å¯èƒ½åœ¨å‡ºç‰ˆä¹‹å‰ä¸ä»–ä»¬åˆ†äº«æ–‡ç« è‰æ¡ˆã€‚é‚£æ˜¯äº‹æƒ…å¼€å§‹å‡ºä¹æ„æ–™çš„æ—¶å€™ã€‚ </p><p> After sharing the draft, they denied my claim saying that this vulnerability do not allow to takeover majority of the icloud accounts. Hereâ€™s their response</p><p>åˆ†äº«è‰æ¡ˆåï¼Œä»–ä»¬å¦è®¤æˆ‘çš„ç´¢èµ”ç§°ï¼Œæ­¤æ¼æ´ä¸å…è®¸æ”¶è´­icloudå¸æˆ·çš„å¤šæ•°ã€‚è¿™æ˜¯ä»–ä»¬çš„å›åº”</p><p>  As you can see in the email screenshot, their analysis revealed that it only works against iCloud accounts that has not been used in passcode / password protected Apple devices.</p><p>  æ­£å¦‚æ‚¨åœ¨ç”µå­é‚®ä»¶å±å¹•æˆªå›¾ä¸­çœ‹åˆ°çš„ï¼Œä»–ä»¬çš„åˆ†ææ˜¾ç¤ºï¼Œå®ƒåªé’ˆå¯¹ç¼ºæ¶ˆç /å¯†ç ä¿æŠ¤Appleè®¾å¤‡ä¸­æœªä½¿ç”¨çš„iCloudå¸æˆ·å·¥ä½œã€‚</p><p>  I argued that even if the device passcode (4 digit or 6 digit) is asked instead of 6 digit code sent to email, it will still share the same rate limits and would be vulnerable to race condition based brute forcing attacks. We will also be able to discover the passcode of the associated Apple device.</p><p>  æˆ‘è®¤ä¸ºï¼Œå³ä½¿è¢«é—®åˆ°è®¾å¤‡å¯†ç ï¼ˆ4ä½æˆ–6ä½æ•°ï¼‰è€Œä¸æ˜¯å‘é€ç»™ç”µå­é‚®ä»¶çš„6ä½æ•°ä»£ç ï¼Œå®ƒä»å°†å…±äº«ç›¸åŒçš„é€Ÿç‡é™åˆ¶ï¼Œå¹¶ä¸”å°†å®¹æ˜“å—åˆ°åŸºäºRachæ¡ä»¶çš„Bruteå¼ºåˆ¶æ”»å‡»ã€‚æˆ‘ä»¬è¿˜å°†èƒ½å¤Ÿå‘ç°ç›¸å…³Appleè®¾å¤‡çš„å¯†ç ã€‚</p><p>    The above screenshot shows how the page looks now but it wasnâ€™t the same before my report.</p><p>    ä¸Šé¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºäº†é¡µé¢ç°åœ¨å¦‚ä½•çœ‹å¾…ï¼Œä½†åœ¨æŠ¥å‘Šä¹‹å‰å®ƒä¸ä¸€æ ·ã€‚</p><p>    â€œIn some casesâ€ is prefixed to the paragraph on October 2020, that is exactly after I was told that they are working on a fix in September 2020.</p><p>    â€œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œâ€åœ¨2020å¹´10æœˆ20æ—¥10æœˆçš„æ®µè½ä¸Šï¼Œè¿™æ˜¯æˆ‘è¢«å‘ŠçŸ¥ä»–ä»¬åœ¨2020å¹´9æœˆçš„ä¿®å¤å·¥ä½œä¹‹åã€‚</p><p> It looks like everything was planned, the page was updated to support their claim of only limited users were vulnerable. That page wasnâ€™t updated for years but getting a minor update after my report. It doesnâ€™t look like a coincidence.</p><p> å®ƒçœ‹èµ·æ¥åƒä¸€åˆ‡è®¡åˆ’ï¼Œé¡µé¢å·²æ›´æ–°ï¼Œä»¥æ”¯æŒä»–ä»¬åªæœ‰æœ‰é™çš„ç”¨æˆ·è„†å¼±çš„ç´¢èµ”ã€‚è¯¥é¡µé¢æœªæ›´æ–°å¤šå¹´ï¼Œä½†åœ¨æŠ¥å‘Šåè·å¾—æ¬¡è¦æ›´æ–°ã€‚å®ƒçœ‹èµ·æ¥å¹¶ä¸åƒå·§åˆã€‚</p><p> When I asked about it, they said the updates are made due to changes in iOS 14. What does resetting password using trusted email / phone number has to do with iOS 14 I asked. If that is true, are trusted phone number and email used to reset the password before iOS 14? If thatâ€™s the case, my report is applicable to all Apple accounts. I didnâ€™t get any answer from them.</p><p> å½“æˆ‘è¯¢é—®å®ƒæ—¶ï¼Œä»–ä»¬è¡¨ç¤ºç”±äºiOS 14çš„å˜åŒ–ï¼Œä½¿ç”¨å¯ä¿¡ç”µå­é‚®ä»¶/ç”µè¯å·ç é‡ç½®å¯†ç çš„æ›´æ–°ä¸IOS 14æå‡ºã€‚å¦‚æœæ˜¯çœŸçš„ï¼Œæ˜¯å¯ä¿¡ç”µè¯å·ç å’Œç”¨äºåœ¨iOS 14ä¹‹å‰é‡ç½®å¯†ç çš„ç”µå­é‚®ä»¶ï¼Ÿå¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘çš„æŠ¥å‘Šé€‚ç”¨äºæ‰€æœ‰Appleå¸æˆ·ã€‚æˆ‘æ²¡æœ‰å¾—åˆ°ä»–ä»¬çš„ä»»ä½•ç­”æ¡ˆã€‚ </p><p> I was disappointed and told them that I am going to publish the blog post with all the details without waiting for their approval. Hereâ€™s the reply I got from them.</p><p>æˆ‘å¾ˆå¤±æœ›ï¼Œå¹¶å‘Šè¯‰ä»–ä»¬ï¼Œæˆ‘å°†åœ¨æ²¡æœ‰ç­‰å¾…ä»–ä»¬çš„æ‰¹å‡†çš„æƒ…å†µä¸‹ç”¨æ‰€æœ‰ç»†èŠ‚å‘å¸ƒåšå®¢å¸–å­ã€‚è¿™æ˜¯æˆ‘ä»ä»–ä»¬é‚£é‡Œå¾—åˆ°çš„å›å¤ã€‚</p><p>  They arranged a call with Apple team engineers to explain what they found in their analysis and also to answer any questions I may have.</p><p>  ä»–ä»¬å®‰æ’äº†ä¸Apple Teamå·¥ç¨‹å¸ˆçš„å‘¼åæ¥è§£é‡Šä»–ä»¬åœ¨åˆ†æä¸­å‘ç°çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥å›ç­”æˆ‘å¯èƒ½æ‹¥æœ‰çš„ä»»ä½•é—®é¢˜ã€‚</p><p> During the call, I asked why it is different from the vulnerability I found.  They said that the passcode is not being sent to any server endpoint and is verified in the device itself. I argued that there is no way for a random apple device to know another deviceâ€™s passcode without contacting Apple server. They said it is true that the data is sent to server but it is verified using a cryptographic operation and they cannot reveal more than that due to security concerns.</p><p> åœ¨å‘¼å«æœŸé—´ï¼Œæˆ‘é—®ä¸ºä»€ä¹ˆå®ƒä¸æˆ‘å‘ç°çš„æ¼æ´ä¸åŒã€‚ä»–ä»¬è¯´ï¼Œå¯†ç æœªè¢«å‘é€åˆ°ä»»ä½•æœåŠ¡å™¨ç«¯ç‚¹ï¼Œå¹¶åœ¨è®¾å¤‡æœ¬èº«ä¸­éªŒè¯ã€‚æˆ‘è®¤ä¸ºéšæœºè‹¹æœè®¾å¤‡æ— æ³•çŸ¥é“å¦ä¸€ä¸ªè®¾å¤‡çš„å¯†ç è€Œæ— éœ€è”ç³»AppleæœåŠ¡å™¨ã€‚ä»–ä»¬è¡¨ç¤ºï¼Œæ•°æ®æ˜¯å‘é€ç»™æœåŠ¡å™¨çš„ï¼Œä½†æ˜¯ä½¿ç”¨åŠ å¯†æ“ä½œè¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”ç”±äºå®‰å…¨é—®é¢˜ï¼Œå®ƒä»¬æ— æ³•é€éœ²è¶…è¿‡è¿™ä¸€ç‚¹ã€‚</p><p> I asked what if we find out the encryption process through reverse engineering to replicate it and brute force the Apple server with concurrent requests. I didnâ€™t get any definite answer for that question. They concluded that the only way to brute force the passcode is through brute forcing the Apple device which is not possible due to the local system rate limits.</p><p> å¦‚æœæˆ‘ä»¬é€šè¿‡é€†å‘å·¥ç¨‹æ±‚å‡ºåŠ å¯†è¿›ç¨‹ä»¥å¤åˆ¶å®ƒå¹¶ä½¿ç”¨å¹¶å‘è¯·æ±‚çš„Apple Serveræ¥è¯¢é—®åŠ å¯†è¿›ç¨‹ï¼Œè¯·è¯¢é—®ä½•æ‚¨ã€‚æˆ‘æ²¡æœ‰å¾—åˆ°è¿™ä¸ªé—®é¢˜çš„æ˜ç¡®ç­”æ¡ˆã€‚ä»–ä»¬å¾—å‡ºç»“è®ºï¼Œè›®åŠ›çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡æš´åŠ›å¼ºåˆ¶è‹¹æœè®¾å¤‡ï¼Œè¿™æ˜¯ç”±äºæœ¬åœ°ç³»ç»Ÿé€Ÿç‡é™åˆ¶ä¸å¯èƒ½ã€‚</p><p> I couldnâ€™t accept what Apple engineers said, logically, it should be possible to replicate what Apple device is doing while sending the passcode data to server.</p><p> æˆ‘æ— æ³•æ¥å—Appleå·¥ç¨‹å¸ˆé€»è¾‘åœ°è¯´çš„æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥å¯ä»¥å¤åˆ¶Appleè®¾å¤‡åœ¨å‘æœåŠ¡å™¨å‘é€å¯†ç æ•°æ®æ—¶æ­£åœ¨è¿›è¡Œçš„äº‹æƒ…ã€‚</p><p> I thought to verify it myself to prove them. If what they said is true, passcode validation endpoint should be vulnerable to race condition based brute forcing. After a few hours of testing I found that they have SSL pinning specific to the passcode validation endpoint, so the traffic sent to the server cannot be read by MITM proxy like burp / charles.</p><p> æˆ‘æƒ³éªŒè¯è‡ªå·±æ˜¯å¦è¯æ˜ä»–ä»¬ã€‚å¦‚æœä»–ä»¬æ‰€è¯´çš„æ˜¯çœŸçš„ï¼Œå¯†ç éªŒè¯ç«¯ç‚¹åº”è¯¥å®¹æ˜“å—åˆ°åŸºäºæ¯”èµ›æ¡ä»¶çš„è›®åŠ›ã€‚ç»è¿‡å‡ ä¸ªå°æ—¶çš„æµ‹è¯•åï¼Œæˆ‘å‘ç°å®ƒä»¬å…·æœ‰ç‰¹å®šäºå¯†ç éªŒè¯ç«¯ç‚¹çš„SSL Pinningï¼Œå› æ­¤MITMä»£ç†å¦‚Burp / Charleséƒ½æ— æ³•è¯»å–å‘é€åˆ°æœåŠ¡å™¨çš„æµé‡ã€‚</p><p> Thanks to  checkra1n and  SSL Kill Switch, using their tool I was able to bypass pinning and read the traffic sent to server.</p><p> æ„Ÿè°¢Checkra1nå’ŒSSLæ€æ­»äº¤æ¢æœºï¼Œä½¿ç”¨å…¶å·¥å…·æˆ‘èƒ½å¤Ÿç»•è¿‡é’‰æ‰å¹¶è¯»å–å‘é€åˆ°æœåŠ¡å™¨çš„æµé‡ã€‚ </p><p> I figured out that Apple uses  SRP (Secure Remote Password), a  PAKE protocol to verify the user knows the right passcode without actually sending it to the server. So what the engineers said is right, they arenâ€™t sending the passcode directly to server. Instead, both server and client do some mathematical calculations using the previously known data to derive at a key (more like diffie-hellman key exchange).</p><p>æˆ‘æƒ³å‡ºï¼ŒAppleä½¿ç”¨SRPï¼ˆå®‰å…¨è¿œç¨‹å¯†ç ï¼‰ï¼Œæ¢æµ‹ç”¨æˆ·çŸ¥é“å³å¯†ç çš„å·åè®®è€Œä¸å®é™…å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚æ‰€ä»¥å·¥ç¨‹å¸ˆæ‰€è¯´çš„æ˜¯å¯¹çš„ï¼Œå®ƒä»¬æ²¡æœ‰ç›´æ¥å‘æœåŠ¡å™¨å‘é€å¯†ç ã€‚ç›¸åï¼Œä¸¤ä¸ªæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä½¿ç”¨å…ˆå‰å·²çŸ¥çš„æ•°æ®è¿›è¡Œä¸€äº›æ•°å­¦è®¡ç®—æ¥æ´¾ç”Ÿåœ¨å¯†é’¥ï¼ˆæ›´åƒDiffie-Hellmanå¯†é’¥äº¤æ¢æœºï¼‰ã€‚</p><p> Without getting into the specifics of SRP, let me get straight to what is necessary in our context.</p><p> å¦‚æœæ²¡æœ‰è¿›å…¥SRPçš„ç»†èŠ‚ï¼Œè®©æˆ‘ç›´æ¥åˆ°æˆ‘ä»¬ä¸Šä¸‹æ–‡ä¸­æœ‰å¿…è¦çš„ä¸œè¥¿ã€‚</p><p> Apple server has two stored values namely verifier and salt specific to each user created at the time of setting or updating the passcode.</p><p> AppleæœåŠ¡å™¨æœ‰ä¸¤ä¸ªå­˜å‚¨çš„å€¼ï¼Œå³éªŒè¯è€…å’Œç‰¹å®šäºè®¾ç½®æˆ–æ›´æ–°å¯†ç æ—¶åˆ›å»ºçš„æ¯ä¸ªç”¨æˆ·çš„éªŒè¯å™¨å’Œç›ã€‚</p><p> Whenever a user initiates a SRP authentication with username and a ephemeral value A, Apple server responds back with the salt of the specific user and a ephemeral value B.</p><p> æ¯å½“ç”¨æˆ·å‘èµ·ç”¨æˆ·åå’Œæˆªé˜µçŸ­æš‚å€¼Açš„SRPèº«ä»½éªŒè¯æ—¶ï¼ŒApple Serverä¼šç”¨ç‰¹å®šç”¨æˆ·çš„ç›å’ŒçŸ­æš‚å€¼Bå“åº”å›æ¥ã€‚</p><p>  SRP is known to prevent bruteforce attacks as it has user-specific salt and a verifier, so even if someone steals our database, they will still need to perform a CPU intensive bruteforce for each user to discover the password one by one. That gives enough time for the affected vendor to react to it.</p><p>  å·²çŸ¥SRPå¯é˜²æ­¢æ”»å‡»å…·æœ‰ç‰¹å®šäºç”¨æˆ·ç‰¹å®šçš„ç›å’ŒéªŒè¯è€…ï¼Œå› æ­¤å³ä½¿æœ‰äººçªƒå–æˆ‘ä»¬çš„æ•°æ®åº“ï¼Œå®ƒä»¬ä»ç„¶éœ€è¦ä¸ºæ¯ä¸ªç”¨æˆ·æ‰§è¡ŒCPUå¯†é›†å‹BruteForceï¼Œä»¥é€ä¸ªå‘ç°å¯†ç ã€‚è¿™å¯¹å—å½±å“çš„ä¾›åº”å•†æä¾›äº†è¶³å¤Ÿçš„æ—¶é—´å¯¹å…¶ä½œå‡ºååº”ã€‚</p><p> But, in our case, we donâ€™t have to bruteforce a large number of accounts. Bruteforcing single user is enough to get into their iCloud account as well as finding their passcode.</p><p> ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸å¿…è®©å¤§é‡çš„å¸æˆ·ã€‚ Bruteforcing Single Userè¶³ä»¥è¿›å…¥å…¶iCloudå¸æˆ·ä»¥åŠæŸ¥æ‰¾å¯†ç ã€‚</p><p> Brute forcing is possible only when you have both salt and verifier specific to the target user. After bypassing the SMS passcode we can easily impersonate as the target user and obtain the salt. But the problem here is verifier. We should either somehow obtain the verifier from server or bypass the rate limit on key verifying endpoint.</p><p> åªæœ‰å½“æ‚¨å…·æœ‰ç‰¹å®šäºç›®æ ‡ç”¨æˆ·çš„ç›å’ŒéªŒè¯ç¨‹åºæ—¶ï¼Œæ‰èƒ½å¼ºåˆ¶è¿«ä½¿ã€‚åœ¨ç»•è¿‡SMSå¯†ç ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½œä¸ºç›®æ ‡ç”¨æˆ·æ¨¡æ‹Ÿå¹¶è·å¾—ç›ã€‚ä½†è¿™é‡Œçš„é—®é¢˜æ˜¯éªŒè¯è€…ã€‚æˆ‘ä»¬åº”è¯¥ä»¥æŸç§æ–¹å¼ä»æœåŠ¡å™¨è·å–éªŒè¯è€…æˆ–ç»•è¿‡é”®éªŒè¯ç«¯ç‚¹ä¸Šçš„é€Ÿç‡é™åˆ¶ã€‚ </p><p> If the rate limit is bypassed, we can keep on trying different combinations of key obtained using the precomputed values of the passcode until we arrive at the matching key. Obviously, it requires a lot of computation to derive a key of each 4 or 6 digit numeric passcodes (from 0000/000000 to 9999/999999).</p><p>å¦‚æœç»•è¿‡é€Ÿç‡é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å°è¯•ä½¿ç”¨å¯†ç çš„é¢„å…ˆè®¡ç®—çš„é”®çš„ä¸åŒç»„åˆï¼Œç›´åˆ°æˆ‘ä»¬åˆ°è¾¾åŒ¹é…é”®ã€‚æ˜¾ç„¶ï¼Œå®ƒéœ€è¦å¤§é‡çš„è®¡ç®—æ¥å¯¼å‡ºæ¯ä¸ª4æˆ–6ä½æ•°å­—å¯†ç ï¼ˆä»0000/000000åˆ°9999/999999ï¼‰çš„é”®ï¼‰ã€‚</p><p>  When we enter the passcode in an iPhone / iPad during password reset, the device initiates SRP authentication by sending the user session token obtained from the successful SMS verification. The server responds back with the salt of the respective user. The passcode and the salt are hashed to then derive the final key which is sent to https://p50-escrowproxy.icloud.com/escrowproxy/api/recover to check whether it matches the key computed (using ephemeral, salt and verifier) on the server.</p><p>  å½“æˆ‘ä»¬åœ¨å¯†ç é‡ç½®æœŸé—´åœ¨iPhone / iPadä¸­è¾“å…¥å¯†ç æ—¶ï¼Œè®¾å¤‡é€šè¿‡å‘é€ä»æˆåŠŸçš„SMSéªŒè¯è·å¾—çš„ç”¨æˆ·ä¼šè¯ä»¤ç‰Œæ¥å¯åŠ¨SRPèº«ä»½éªŒè¯ã€‚æœåŠ¡å™¨éšç€å„ä¸ªç”¨æˆ·çš„ç›å“åº”ã€‚å¯†ç å’Œç›å°†è¢«æ•£åˆ—ï¼Œç„¶åæ´¾ç”Ÿå°†å‘é€åˆ°https://p50-escrowproxy.icloud.com/escrowproxy/api/rocoverçš„æœ€ç»ˆé”®ï¼Œä»¥æ£€æŸ¥å®ƒæ˜¯å¦ä¸è®¡ç®—çš„å¯†é’¥ï¼ˆä½¿ç”¨çŸ­ä¿¡ï¼Œç›å’ŒéªŒè¯å™¨ï¼‰åŒ¹é…åœ¨æœåŠ¡å™¨ä¸Šã€‚</p><p>   String tag has all the data mentioned above but are sent in DATA BLOB format. The first thing I wanted to check is rate limit before decoding the values of BLOB. I sent the request 30 times concurrently to check whether the endpoint was vulnerable.</p><p>   å­—ç¬¦ä¸²æ ‡è®°å…·æœ‰ä¸Šè¿°æ‰€æœ‰æ•°æ®ï¼Œä½†ä»¥æ•°æ®æ–‘ç‚¹æ ¼å¼å‘é€ã€‚æˆ‘æƒ³æ£€æŸ¥çš„ç¬¬ä¸€ä»¶äº‹æ˜¯è§£ç BLOBå€¼ä¹‹å‰çš„é€Ÿç‡é™åˆ¶ã€‚æˆ‘åŒæ—¶å‘é€30æ¬¡è¯·æ±‚ä»¥æ£€æŸ¥ç«¯ç‚¹æ˜¯å¦æ˜“å—æ”»å‡»ã€‚</p><p>  To my shock, it wasnâ€™t vulnerable. Out of 30 requests, 29 of them were rejected with internal server error.</p><p>  ä¸ºäº†æˆ‘çš„éœ‡æƒŠï¼Œå®ƒå¹¶ä¸è„†å¼±ã€‚åœ¨30ä¸ªè¯·æ±‚ä¸­ï¼Œå…¶ä¸­29ä¸ªè¢«æ‹’ç»å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ã€‚</p><p> Rate limiting would be performed in the Apple server itself or in HSM (hardware security module). Either way, the rate limit logic should be programmed as such to prevent race hazard. There is very bleak chance for this endpoint to be not vulnerable to race hazard before my report because all the other endpoints I tested was vulnerable â€“ SMS code validation, email code validation, two factor authentication, password validation was all vulnerable.</p><p> é€Ÿç‡é™åˆ¶å°†åœ¨AppleæœåŠ¡å™¨æœ¬èº«æˆ–HSMï¼ˆç¡¬ä»¶å®‰å…¨æ¨¡å—ï¼‰ä¸­æ‰§è¡Œã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œåº”ç¼–ç¨‹é€Ÿç‡é™åˆ¶é€»è¾‘ï¼Œä»¥é˜²æ­¢ç«äº‰å±é™©ã€‚åœ¨æˆ‘çš„æŠ¥å‘Šå‰æ²¡æœ‰æ˜“å—äº‰å¤ºå±é™©çš„æœºä¼šå¾ˆè„†å¼±ï¼Œå› ä¸ºæˆ‘æµ‹è¯•çš„æ‰€æœ‰å…¶ä»–ç«¯ç‚¹æ˜¯æ˜“å—æ”»å‡»çš„ - çŸ­ä¿¡ä»£ç éªŒè¯ï¼Œç”µå­é‚®ä»¶ä»£ç éªŒè¯ï¼Œä¸¤ä¸ªå› å­èº«ä»½éªŒè¯ï¼Œå¯†ç éªŒè¯éƒ½æ˜¯è„†å¼±çš„ã€‚</p><p> If they did patch it after my report, the vulnerability became a lot more severe than what I initially thought. Through bruteforcing the passcode, we will be able to identify the correct passcode by differentiating the responses. So we not only can takeover any iCloud account but also discover the passcode of the Apple device associated with it. Even though the attack is complex, this vulnerability could hack any iPhone / iPad that has 4 digit / 6 digit numeric passcode if my assumption is right.</p><p> å¦‚æœä»–ä»¬åœ¨æŠ¥å‘Šååšäº†è¡¥ä¸ï¼Œé‚£ä¹ˆè„†å¼±æ€§æ¯”æˆ‘æœ€åˆæƒ³åˆ°çš„æ›´ä¸¥é‡ã€‚é€šè¿‡æµè§ˆå¯†ç ï¼Œæˆ‘ä»¬å°†é€šè¿‡åŒºåˆ†å“åº”æ¥è¯†åˆ«æ­£ç¡®çš„å¯†ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æ”¶è´­ä»»ä½•iCloudå¸æˆ·ï¼Œè¿˜å¯ä»¥å‘ç°ä¸å…¶å…³è”çš„Appleè®¾å¤‡çš„å¯†ç ã€‚å³ä½¿æ”»å‡»å¾ˆå¤æ‚ï¼Œå¦‚æœæˆ‘çš„å‡è®¾æ˜¯å¯¹çš„è¯ï¼Œè¿™ä¸ªæ¼æ´å¯èƒ½ä¼šç ´åä»»ä½•å…·æœ‰4ä½/ 6ä½æ•°å­—å¯†ç çš„iPhone / iPadã€‚</p><p> Since it is now validating the concurrent requests properly, there is no way for me to verify my claim, the only way I can confirm this is by writing to Apple but they arenâ€™t giving any response in this regard.</p><p> ç”±äºç°åœ¨æ­£å¸¸éªŒè¯å¹¶å‘è¯·æ±‚ï¼Œå› æ­¤æˆ‘æ— æ³•éªŒè¯æˆ‘çš„ç´¢èµ”ï¼Œæˆ‘å¯ä»¥é€šè¿‡å†™å…¥Appleçš„å”¯ä¸€æ–¹æ³•æ¥è¯å®è¿™ä¸€ç‚¹ï¼Œä½†ä»–ä»¬åœ¨è¿™æ–¹é¢æ²¡æœ‰ç»™å‡ºä»»ä½•å›åº”ã€‚ </p><p>   The actual bounty mentioned for iCloud account takeover in Appleâ€™s website is $100,000 USD. Extracting sensitive data from locked Apple device is $250,000 USD. My report covered both the scenarios (assuming the passcode endpoint was patched after my report), so the actual bounty should be $350,0000. Even if they chose to award the maximum impact out of the two cases, it should still be $250,000 USD.</p><p>åœ¨Appleç½‘ç«™ä¸Šæåˆ°çš„iCloudå¸æˆ·æ”¶è´­çš„å®é™…èµé‡‘æ˜¯100,000ç¾å…ƒã€‚ä»é”å®šçš„Appleè®¾å¤‡ä¸­æå–æ•æ„Ÿæ•°æ®æ˜¯250,000ç¾å…ƒã€‚æˆ‘çš„æŠ¥å‘Šæ¶µç›–äº†è¿™ç§æƒ…å†µï¼ˆå‡è®¾PassCodeç«¯ç‚¹åœ¨æŠ¥å‘Šåä¿®è¡¥ï¼‰ï¼Œå› æ­¤å®é™…èµé‡‘åº”ä¸º350,0000ç¾å…ƒã€‚å³ä½¿ä»–ä»¬é€‰æ‹©å¥–åŠ±ä¸¤ç§æƒ…å†µçš„æœ€å¤§å½±å“ï¼Œå®ƒä»ç„¶åº”è¯¥æ˜¯250,000ç¾å…ƒã€‚</p><p> Selling these kind of vulnerabilities to government agencies or private bounty programs like  zerodium could have made a lot more money. But I chose the ethical way and I didnâ€™t expect anything more than the outlined bounty amounts by Apple.</p><p> å°†è¿™äº›è„†å¼±æ€§é”€å”®ç»™æ”¿åºœæœºæ„æˆ–ç§äººèµé‡‘è¯¾ç¨‹ï¼Œå¦‚é›¶åŒ–å¯èƒ½ä¼šè®©æ›´å¤šçš„èµ„é‡‘èµšæ›´å¤šã€‚ä½†æˆ‘é€‰æ‹©äº†é“å¾·æ–¹å¼ï¼Œæˆ‘æ²¡æœ‰æƒ³åˆ°ä»»ä½•è‹¹æœæ‰€æ¦‚è¿°çš„èµé‡‘æ•°é‡ã€‚</p><p>  But $18,000 USD is not even close to the actual bounty. Lets say all my assumptions are wrong and Apple passcode verifying endpoint wasnâ€™t vulnerable before my report. Even then the given bounty is not fair looking at the impact of the vulnerability as given below.</p><p>  ä½†æ˜¯18,000ç¾å…ƒçš„USDç”šè‡³æ²¡æœ‰æ¥è¿‘å®é™…çš„èµé‡‘ã€‚è®©æˆ‘ä»¬è¯´å‡ºæˆ‘çš„æ‰€æœ‰å‡è®¾æ˜¯é”™è¯¯çš„ï¼ŒApple PassCodeéªŒè¯ç«¯ç‚¹åœ¨æŠ¥å‘Šå‰æ²¡æœ‰æ˜“å—æ”»å‡»ã€‚å³ä¾¿å¦‚æ­¤ï¼Œç»™å®šçš„èµé‡‘ä¹Ÿä¸å…¬å¹³åœ°çœ‹å¾…ä¸‹é¢ç»™å‡ºçš„è„†å¼±æ€§çš„å½±å“ã€‚</p><p> Bypassed the two factor authentication. It is literally like 2FA doesnâ€™t exist due to the bypass. People who are all relying on 2FA are vulnerable. This itself is a major vulnerability.</p><p> ç»•è¿‡äº†ä¸¤ä¸ªå› å­è®¤è¯ã€‚å®ƒçœŸçš„åƒ2FAï¼Œç”±äºæ—è·¯è€Œä¸å­˜åœ¨ã€‚æ‰€æœ‰ä¾èµ–2FAçš„äººéƒ½å¾ˆè„†å¼±ã€‚è¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªé‡å¤§è„†å¼±æ€§ã€‚</p><p> Bypassed the password validation rate limits. All the Apple ID accounts that use common / weak / hacked passwords are vulnerable even if they have two factor authentication enabled. Once hacked, the attacker can track the location of the device as well as wipe the device remotely. 2014 celebrities iCloud hack is majorly because of weak passwords.</p><p> ç»•è¿‡å¯†ç éªŒè¯ç‡é™åˆ¶ã€‚å³ä½¿å¯ç”¨äº†ä¸¤ä¸ªå› ç´ èº«ä»½éªŒè¯ï¼Œä½¿ç”¨å¸¸ç”¨/å¼±/æŠ–åŠ¨å¯†ç çš„æ‰€æœ‰Apple IDå¸æˆ·éƒ½æ˜¯æ˜“å—æ”»å‡»çš„ã€‚ä¸€æ—¦è¢«é»‘æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥è·Ÿè¸ªè®¾å¤‡çš„ä½ç½®ï¼Œå¹¶è¿œç¨‹æ“¦é™¤è®¾å¤‡ã€‚ 2014å¹´åäººiCloud Hackä¸»è¦æ˜¯å› ä¸ºå¯†ç è–„å¼±ã€‚</p><p> Bypassed the SMS verification. If we know the passcode or password of the device associated with the iCloud account. Lets say any of your friends or relatives knows your device passcode, using this vulnerability, they can takeover your iCloud account and also can erase your entire device remotely over the internet without having physical access to it.</p><p> ç»•è¿‡çŸ­ä¿¡éªŒè¯ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸iCloudå¸æˆ·å…³è”çš„è®¾å¤‡çš„å¯†ç æˆ–å¯†ç ã€‚è®©æˆ‘ä»¬è¯´ï¼Œä»»ä½•æœ‹å‹æˆ–äº²æˆšéƒ½çŸ¥é“æ‚¨çš„è®¾å¤‡å¯†ç ï¼Œä½¿ç”¨æ­¤æ¼æ´ï¼Œä»–ä»¬å¯ä»¥æ¥ç®¡iCloudå¸æˆ·ï¼Œå¹¶å¯ä»¥é€šè¿‡Internetè¿œç¨‹æ“¦é™¤æ•´ä¸ªè®¾å¤‡è€Œä¸å¯¹å…¶è¿›è¡Œç‰©ç†è®¿é—®ã€‚</p><p> We can  takeover all Apple IDs that are not associated with a passcode protected Apple device due to both SMS and email verification code bypass, which means Any apple device without passcode or password, like anyone who turned off or didnâ€™t set the passcode / password.</p><p> æˆ‘ä»¬å¯ä»¥æ”¶å–ä¸å¯†ç ä¿æŠ¤çš„Appleè®¾å¤‡æ— å…³çš„æ‰€æœ‰Apple IDï¼Œç”±äºSMSå’Œç”µå­é‚®ä»¶éªŒè¯ç æ—è·¯ï¼Œè¿™æ„å‘³ç€ä»»ä½•æ²¡æœ‰å¯†ç æˆ–å¯†ç çš„Appleè®¾å¤‡ï¼Œå°±åƒä»»ä½•å…³é—­æˆ–æœªè®¾ç½®å¯†ç /å¯†ç çš„ä»»ä½•äººã€‚ </p><p> Any Apple ID created without apple device, like in browsers or in an android app and not been used in password protected apple devices</p><p>æ²¡æœ‰Appleè®¾å¤‡åˆ›å»ºçš„ä»»ä½•Apple IDï¼Œå°±åƒåœ¨æµè§ˆå™¨ä¸­æˆ–Androidåº”ç”¨ç¨‹åºä¸­ï¼Œè€Œä¸æ˜¯åœ¨å¯†ç å—ä¿æŠ¤çš„Appleè®¾å¤‡ä¸­ä½¿ç”¨</p><p> For example, 50 Million+ android users have downloaded Apple music app. In those, majority of them may not have used Apple devices. They are still Apple users and their information like credit cards, billing address, subscription details, etc could be exposed.</p><p> ä¾‹å¦‚ï¼Œ5000ä¸‡+ Androidç”¨æˆ·å·²ä¸‹è½½Apple Music Appã€‚åœ¨é‚£äº›ä¸­ï¼Œä»–ä»¬ä¸­çš„å¤§å¤šæ•°å¯èƒ½æ²¡æœ‰ä½¿ç”¨Appleè®¾å¤‡ã€‚å®ƒä»¬ä»ç„¶æ˜¯Appleç”¨æˆ·åŠå…¶ä¿¡æ¯ï¼Œå¦‚ä¿¡ç”¨å¡ï¼Œè®¡è´¹åœ°å€ï¼Œè®¢é˜…è¯¦ç»†ä¿¡æ¯ç­‰ã€‚</p><p> They need not reward the upper cap of the iCloud account takeover ($100k) but it should at least be close to it considering the impact it has created.</p><p> ä»–ä»¬ä¸éœ€è¦å¥–åŠ±iCloudè´¦æˆ·æ”¶è´­çš„ä¸Šé™ï¼ˆ$ 100kï¼‰ï¼Œä½†è€ƒè™‘åˆ°å®ƒåˆ›é€ çš„å½±å“ï¼Œå®ƒè‡³å°‘åº”è¯¥æ¥è¿‘å®ƒã€‚</p><p> After all my hard work and almost a year of waiting, I didnâ€™t get what I deserved because of Appleâ€™s unfair judgement. So I refused to receive the bounty and told them it is unfair. I asked them to reconsider the bounty decision or let me publish the report with all the information. There wasnâ€™t any response to my emails. So I have decided to publish my article without waiting for their response indefinitely.</p><p> æ¯•ç«Ÿæˆ‘çš„è¾›å‹¤å·¥ä½œå’Œè¿‘ä¸€å¹´çš„ç­‰å¾…ç€ï¼Œæˆ‘æ²¡æœ‰å¾—åˆ°æˆ‘æ‰€åº”å¾—çš„ï¼Œå› ä¸ºè‹¹æœä¸å…¬å¹³çš„åˆ¤æ–­ã€‚æ‰€ä»¥æˆ‘æ‹’ç»æ”¶åˆ°èµé‡‘å¹¶å‘Šè¯‰ä»–ä»¬å®ƒæ˜¯ä¸å…¬å¹³çš„ã€‚æˆ‘è¦æ±‚ä»–ä»¬é‡æ–°è€ƒè™‘èµé‡‘å†³å®šæˆ–è®©æˆ‘é€šè¿‡æ‰€æœ‰ä¿¡æ¯å‘å¸ƒæŠ¥å‘Šã€‚æ²¡æœ‰ä»»ä½•å¯¹æˆ‘çš„ç”µå­é‚®ä»¶çš„å›å¤ã€‚æ‰€ä»¥æˆ‘å†³å®šå‘å¸ƒæˆ‘çš„æ–‡ç« ï¼Œè€Œä¸æ— é™æœŸåœ°ç­‰å¾…ä»–ä»¬çš„å›åº”ã€‚</p><p> Therefore, I shared my research with Apple for FREE of cost instead of an unfair price.</p><p> å› æ­¤ï¼Œæˆ‘ä¸Appleå…è´¹åˆ†äº«äº†æˆ‘çš„ç ”ç©¶ï¼Œè€Œä¸æ˜¯ä¸å…¬å¹³çš„ä»·æ ¼ã€‚</p><p> I request Apple security team to be more transparent and fair at least in the future. I would like to thank Apple for patching the vulnerability.</p><p> æˆ‘è¦æ±‚Appleå®‰å…¨å›¢é˜Ÿè‡³å°‘åœ¨æœªæ¥æ›´åŠ é€æ˜å’Œå…¬å¹³ã€‚æˆ‘è¦æ„Ÿè°¢Appleä¿®è¡¥æ¼æ´ã€‚</p><p> I repeat, the vulnerability is completely fixed and the scenarios described above no longer works. Thank you for reading the article! Please let me know your thoughts in comments.</p><p> æˆ‘é‡å¤ï¼Œæ¼æ´å®Œå…¨å›ºå®šï¼Œä¸Šé¢æè¿°çš„åœºæ™¯ä¸å†æœ‰æ•ˆã€‚è°¢è°¢é˜…è¯»æ–‡ç« ï¼è¯·å‘Šè¯‰æˆ‘æ‚¨çš„æ„è§ä¸­çš„æƒ³æ³•ã€‚ </p><p>   Save my name, email, and website in this browser for the next time I comment.</p><p>ä¸‹æ¬¡è¯„è®ºä¸‹ï¼Œåœ¨æ­¤æµè§ˆå™¨ä¸­ä¿å­˜æˆ‘çš„å§“åï¼Œç”µå­é‚®ä»¶å’Œç½‘ç«™ã€‚ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://thezerohack.com/apple-vulnerability-bug-bounty">https://thezerohack.com/apple-vulnerability-bug-bounty</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/hack/">#hack</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
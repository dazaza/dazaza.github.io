<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>åœ¨GitHubä¸Šæé«˜å¤§å‹Monorepoæ€§èƒ½ Improving large monorepo performance on GitHub</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Improving large monorepo performance on GitHub<br/>åœ¨GitHubä¸Šæé«˜å¤§å‹Monorepoæ€§èƒ½ </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-17 00:45:51</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/168d96f0ae8d4bb3192916eaadbfd312.png"><img src="http://img2.diglog.com/img/2021/3/168d96f0ae8d4bb3192916eaadbfd312.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Every day, GitHub serves the needs of over 56M developers, working on over 200M code repositories. All but a tiny fraction of those repositories are served with amazing performance, for customers from around the world.</p><p>æ¯å¤©ï¼ŒGitHubéƒ½æœåŠ¡äºè¶…è¿‡56ç±³çš„å¼€å‘äººå‘˜ï¼Œå·¥ä½œè¶…è¿‡200Mçš„ä»£ç å­˜å‚¨åº“ã€‚é™¤äº†æ¥è‡ªä¸–ç•Œå„åœ°çš„å®¢æˆ·ï¼Œæ‰€æœ‰è¿™äº›å­˜å‚¨åº“çš„ä¸€å°éƒ¨åˆ†éƒ½æ˜¯å…·æœ‰æƒŠäººçš„è¡¨ç°ã€‚</p><p> Like any system as large as GitHub, some of the gaps in our coding and architecture are only discovered when theyâ€™re pushed to their limitsâ€”like having thousands of developers updating the same repo every dayâ€”and GitHub received feedback from a handful of our largest monorepo customers that they were seeing performance problems that were impacting their ability to complete push operations.</p><p> ä¸GitHubä¸€æ ·å¤§çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬çš„ç¼–ç å’Œæ¶æ„ä¸­çš„ä¸€äº›å·®è·ä»…åœ¨ä»–ä»¬è¢«æ¨åˆ°ä»–ä»¬çš„é™åˆ¶æ—¶è¢«æ¨åˆ°äº†è®¸å¤šå¼€å‘äººå‘˜æ¯å¤©æ›´æ–°ç›¸åŒçš„å›è´­ - è€ŒGitHubä»å°‘æ•°äººæ”¶åˆ°åé¦ˆæœ€å¤§çš„Monorepoå®¢æˆ·ï¼Œä»–ä»¬çœ‹åˆ°äº†å½±å“ä»–ä»¬å®Œæˆæ¨é€æ“ä½œèƒ½åŠ›çš„æ€§èƒ½é—®é¢˜ã€‚</p><p> And so was GitHub.Â  github/githubÂ isÂ  ourÂ monorepo, and we were experiencing occasional push failures ourselves.</p><p> GitHubä¹Ÿæ˜¯å¦‚æ­¤ã€‚ github / githubæ˜¯æˆ‘ä»¬çš„monorepoï¼Œæˆ‘ä»¬å¶å°”ä¼šå¶å°”æ¨åŠ¨è‡ªå·±ã€‚</p><p> To start our investigation, we worked with internal teams, and engaged with customers, to understand and optimize their usage of GitHub, including coalescing multiple pushes into single pushes, which reduced the number of locking write transactions they were incurring, and even helping with reworking some of their DevOps processes to eliminate unnecessary push operations. Still, we were seeing unusual levels of push failure.</p><p> è¦å¼€å§‹è°ƒæŸ¥ï¼Œæˆ‘ä»¬ä¸å†…éƒ¨å›¢é˜Ÿåˆä½œï¼Œå¹¶ä¸å®¢æˆ·ä¸€èµ·å‚ä¸ï¼Œäº†è§£å’Œä¼˜åŒ–ä»–ä»¬å¯¹GitHubçš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬åˆå¹¶å¤šæ¬¡æ¨åŠ¨å•ä¸€æ¨åŠ¨ï¼Œè¿™å‡å°‘äº†ä»–ä»¬æ‰€äº§ç”Ÿçš„é”å®šå†™ä½œäº¤æ˜“çš„æ•°é‡ï¼Œç”šè‡³æœ‰åŠ©äºé‡æ–°åŠ å·¥ä»–ä»¬çš„ä¸€äº›DevOpsæµç¨‹æ¥æ¶ˆé™¤ä¸å¿…è¦çš„æ¨åŠ¨æ“ä½œã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶çœ‹åˆ°äº†ä¸å¯»å¸¸çš„æ¨åŠ¨å¤±è´¥æ°´å¹³ã€‚</p><p> In response to this, GitHub Engineering created Project Cyclops. Project Cyclops has been a multi-month effort across our Git Systems org (which includes our Git Storage, Git Protocols, and Git Client teams), working with GitHubâ€™s upstream Git contributors and engineers in our Web front-end teams, to find solutions to these problems. After a lot of collaboration and hard work, and multiple improvements,Â  weâ€™ve driven push errors down to nearly zero, even for our largest monorepo customers with thousands of contributors.</p><p> å“åº”äºæ­¤ï¼ŒGithub Engineeringåˆ›å»ºäº†Project Cyclopsã€‚ Project Cyclopsåœ¨æˆ‘ä»¬çš„Git Systems Orgï¼ˆåŒ…æ‹¬æˆ‘ä»¬çš„Git Storageï¼ŒGitåè®®å’ŒGit Clientså›¢é˜Ÿï¼‰ä¸­ä¸€ç›´æ˜¯ä¸€ä¸ªå¤šæœˆä»½çš„åŠªåŠ›ï¼Œä¸GitHubçš„ä¸Šæ¸¸GITè´¡çŒ®è€…å’Œå·¥ç¨‹å¸ˆåœ¨æˆ‘ä»¬çš„ç½‘ç»œå‰ç«¯å›¢é˜Ÿä¸­ä½¿ç”¨ï¼Œæ‰¾åˆ°è§£å†³æ–¹æ¡ˆè¿™äº›é—®é¢˜ã€‚ç»è¿‡å¤§é‡çš„åä½œå’ŒåŠªåŠ›å·¥ä½œï¼Œä»¥åŠå¤šæ¬¡æ”¹è¿›ï¼Œæˆ‘ä»¬å·²ç»å°†é”™è¯¯è¯¯å·®ä¸‹é™åˆ°è¿‘é›¶ï¼Œå³ä½¿æ˜¯æˆ‘ä»¬æœ€å¤§çš„Monorepoå®¢æˆ·æ‹¥æœ‰æ•°åƒåè´¡çŒ®è€…ã€‚</p><p>  Project Cyclops resulted in many different approaches to improving our monorepo push performance. Together, they improved our ability to handle push traffic by at least an order of magnitude.</p><p>  Project Cyclopså¯¼è‡´äº†è®¸å¤šä¸åŒçš„æ–¹æ³•æ¥æé«˜æˆ‘ä»¬çš„MONOREPOæ¨é€æ€§èƒ½ã€‚å®ƒä»¬åœ¨ä¸€èµ·ï¼Œæ”¹å–„äº†æˆ‘ä»¬ä»¥è‡³å°‘ä¸€ä¸ªæ•°é‡çº§åœ°å¤„ç†æ¨é€æµé‡çš„èƒ½åŠ›ã€‚</p><p>  By default, GitHub runs a repository maintenance routine after every 50Â  git pushÂ operations, or after we receive 40MB of unpacked files, which makes sure we have up-to-date packfiles for great clone/fetch performance, and which cleans up and de-duplicates data in the repo. Depending on the size of the repository, maintenance takes anywhere from a few seconds to a few minutes.</p><p>  é»˜è®¤æƒ…å†µä¸‹ï¼ŒGitHubåœ¨æ¯50ä¸ªGitæ¨é€æ“ä½œä¹‹åè¿è¡Œå­˜å‚¨åº“ç»´æŠ¤ä¾‹ç¨‹ï¼Œæˆ–è€…åœ¨æˆ‘ä»¬æ”¶åˆ°40MBçš„æœªåŒ…è£…æ–‡ä»¶åï¼Œè¿™ä½¿æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬æœ‰æœ€æ–°çš„åŒ…è£…æ–‡ä»¶ï¼Œå¯ç”¨äºå·¨å¤§çš„å…‹éš†/è·å–æ€§èƒ½ï¼Œå¹¶æ¸…ç†å’Œè§£é‡å¤å›è´­ä¸­çš„æ•°æ®ã€‚æ ¹æ®å­˜å‚¨åº“çš„å¤§å°ï¼Œç»´æŠ¤ä»å‡ ç§’åˆ°å‡ åˆ†é’Ÿçš„ä»»ä½•åœ°æ–¹éœ€è¦ã€‚ </p><p> For large monorepos, with a lot of developers, 50 push operations doesnâ€™t take long to accumulate, and therefore maintenance gets scheduled frequently, while developers are still pushing changes to the repo. We had a number of those repos failing to complete maintenance within our maximum time window. When a repo fails maintenance, performance for both push and reference updates suffers, which can lead to manual toil for our engineers to sort out those repositories again.Â  Weâ€™ve reduced those maintenance failures to nearly zero. Specifically, we made improvements inÂ  git repack, and in how we schedule maintenance retries.</p><p>å¯¹äºå¤§å‹MONOREPOSï¼Œå…·æœ‰å¤§é‡å¼€å‘äººå‘˜ï¼Œ50ä¸ªæ¨é€æ“ä½œä¸éœ€è¦é•¿æ—¶é—´ç´¯ç§¯ï¼Œå› æ­¤é¢‘ç¹è°ƒåº¦ç»´æŠ¤ï¼Œè€Œå¼€å‘äººå‘˜ä»åœ¨æ¨åŠ¨å›è´­å˜æ›´ã€‚æˆ‘ä»¬æœ‰è®¸å¤šåœ¨æˆ‘ä»¬çš„æœ€å¤§æ—¶é—´çª—å£ä¸­æ— æ³•å®Œæˆç»´æŠ¤çš„é‚£äº›reposã€‚å½“REPOå¤±è´¥ç»´æŠ¤æ—¶ï¼Œæ¨é€å’Œå‚è€ƒæ›´æ–°çš„æ€§èƒ½ä¼šé­å—ï¼Œè¿™å¯èƒ½å¯¼è‡´æˆ‘ä»¬çš„å·¥ç¨‹å¸ˆæ‰‹åŠ¨åŠ³åŠ¨ï¼Œä»¥ä¾¿å†æ¬¡æ•´ç†è¿™äº›å­˜å‚¨åº“ã€‚æˆ‘ä»¬å°†è¿™äº›ç»´æŠ¤å¤±è´¥é™ä½åˆ°è¿‘é›¶ã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬æ”¹è¿›äº†Git Repackï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•å®‰æ’ç»´æŠ¤é‡è¯•ã€‚</p><p>  During repo maintenance, we runÂ  git repackÂ to compress loose objects and prepare for fast clones and fetches.</p><p>  åœ¨å›è´­ç»´æŠ¤æœŸé—´ï¼Œæˆ‘ä»¬è¿è¡Œgité‡æ–°åŒ…è£…ä»¥å‹ç¼©æ¾æ•£çš„ç‰©ä½“ï¼Œå¹¶ä¸ºå¿«é€Ÿå…‹éš†å‡†å¤‡å¹¶æå–ã€‚</p><p> To compress a set of objects into a single pack, Git tries to find pairs of objects which are related to one another. Instead of storing all of the objectâ€™s contents verbatim, some objects are stored as deltas against other related ones. Finding these deltas takes time, and comparing every object to every other object gets infeasible quickly. Git solves this problem by searching for delta/base pairs within a sliding window over an array of all objects being packed.</p><p> è¦å°†ä¸€ç»„å¯¹è±¡å‹ç¼©åˆ°å•ä¸ªåŒ…ä¸­ï¼ŒGitå°è¯•æŸ¥æ‰¾å½¼æ­¤ç›¸å…³çš„å¯¹è±¡ã€‚è€Œä¸æ˜¯å°†æ‰€æœ‰å¯¹è±¡çš„å†…å®¹é€å­—å­˜å‚¨ï¼Œè€ŒæŸäº›å¯¹è±¡å°†ä½œä¸ºÎ”Strtaså­˜å‚¨ä¸ºDeltasã€‚æ‰¾åˆ°è¿™äº›å¢å¾·æ‹‰æ–¯éœ€è¦æ—¶é—´ï¼Œå¹¶å°†æ¯ä¸ªå¯¹è±¡ä¸æ¯ä¸ªå…¶ä»–å¯¹è±¡è¿›è¡Œæ¯”è¾ƒå¯è¡Œã€‚ Gité€šè¿‡æœç´¢æ»‘åŠ¨çª—å£ä¸­çš„Delta / Baseå¯¹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡åŒ…è£…çš„æ‰€æœ‰å¯¹è±¡çš„æ•°ç»„ã€‚</p><p> Some delta candidates within the window can be rejected quickly by heuristics, but some require CPU-intensive comparisons.</p><p> çª—æˆ·å†…çš„ä¸€äº›ä¸‰è§’æ´²å€™é€‰äººå¯ä»¥é€šè¿‡å¯å‘å¼è¿…é€Ÿæ‹’ç»ï¼Œä½†æœ‰äº›éœ€è¦CPUå¯†é›†çš„æ¯”è¾ƒã€‚</p><p> Weâ€™ve implemented a parameter to limit the number of expensive comparisons weâ€™re willing to make. By tuning this value, weâ€™ve reduced the CPU time we spend duringÂ  git repack, while only marginally increasing the resulting packfile size. This one changeÂ  eliminated nearly all of our maintenance failures.</p><p> æˆ‘ä»¬å·²ç»å®æ–½äº†ä¸€ä¸ªå‚æ•°ï¼Œä»¥é™åˆ¶æˆ‘ä»¬æ„¿æ„åˆ¶ä½œçš„æ˜‚è´µæ¯”è¾ƒæ•°é‡ã€‚é€šè¿‡è°ƒæ•´æ­¤å€¼ï¼Œæˆ‘ä»¬é™ä½äº†åœ¨GITé‡æ–°åŒ…ä¸­èŠ±è´¹çš„CPUæ—¶é—´ï¼Œè€Œä»…ç•¥å¾®å¢åŠ ç”Ÿæˆçš„PackFileå¤§å°ã€‚è¿™ä¸€å˜åŒ–æ¶ˆé™¤äº†æˆ‘ä»¬å‡ ä¹æ‰€æœ‰çš„ç»´æŠ¤å¤±è´¥ã€‚</p><p>  Before Project Cyclops, when a repo failed maintenance for any reason, we wouldnâ€™t schedule it to run again for seven days. For many years, this rhythm served our customers well enough, but monorepos today canâ€™t wait that long. We introduced a newÂ  spurious-failure stateÂ for specific repository maintenance failuresâ€”the ones that generally come from lots of push traffic happening during maintenanceâ€”that allows us to retry maintenance every four hours, up to three times. This means that weâ€™ll get to retry during a customerâ€™s off-hours, when many fewer pushes are happening. This changeÂ  eliminated the remaining maintenance failures, and therefore eliminated more toil from our on-call engineers.</p><p>  åœ¨Project Cyclopsä¹‹å‰ï¼Œå½“ç”±äºä»»ä½•åŸå› çš„repoç»´æŠ¤å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šå®‰æ’å®ƒå†æ¬¡è¿è¡Œä¸ƒå¤©ã€‚å¤šå¹´æ¥ï¼Œè¿™ç§èŠ‚å¥ä¸ºå®¢æˆ·æä¾›äº†è¶³å¤Ÿçš„æœåŠ¡ï¼Œä½†ä»Šå¤©çš„Monoreposç­‰ä¸åŠäº†è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬ä¸ºç‰¹å®šçš„å­˜å‚¨åº“ç»´æŠ¤å¤±è´¥å¼•å…¥äº†æ–°çš„è™šå‡å¤±è´¥çŠ¶æ€ - é€šå¸¸æ¥è‡ªç»´æŠ¤æœŸé—´å‘ç”Ÿçš„å¤§é‡æ¨é€æµé‡ - è¿™ä½¿æˆ‘ä»¬å¯ä»¥æ¯å››ä¸ªå°æ—¶é‡è¯•ç»´æŠ¤ï¼Œæœ€å¤šä¸‰æ¬¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¼šåœ¨å®¢æˆ·çš„ç¦»çº¿æ—¶é—´å†…é‡è¯•ï¼Œå½“æ—¶æ›´å°‘çš„æ¨åŠ¨ã€‚è¿™ä¸€å˜åŒ–æ¶ˆé™¤äº†å‰©ä½™çš„ç»´æŠ¤å¤±è´¥ï¼Œå› æ­¤ä»æˆ‘ä»¬çš„æ¥å¬å·¥ç¨‹å¸ˆä¸­å–æ¶ˆäº†æ›´å¤šçš„åŠ³åŠ¨ã€‚</p><p>  On our file serversâ€”the servers that actually hold git repositoriesâ€”we have had a parameter in place for years that slowed down the rate of push operations we processed on each one. GitHub is a multi-tenant service, and, originally, this parameter was meant to ensure that writes from one customer wonâ€™t monopolize resources on a server, which would interfere with traffic from all of the other customers on that server. In effect, this was anÂ  artificial capÂ on the amount of work our servers could do.</p><p>  åœ¨æˆ‘ä»¬çš„æ–‡ä»¶æœåŠ¡å™¨ä¸Š - å®é™…ä¸ŠæŒæœ‰Gitå­˜å‚¨åº“çš„æœåŠ¡å™¨ - æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªå‚æ•°åˆ°ä½ï¼Œå‡æ…¢äº†æˆ‘ä»¬åœ¨æ¯ä¸ªå¤„ç†çš„æ¨é€æ“ä½œé€Ÿç‡ä¸‹å‡æ…¢äº†ã€‚ GitHubæ˜¯ä¸€ä¸ªå¤šç§Ÿæˆ·æœåŠ¡ï¼Œè€Œä¸”ï¼Œæ­¤å‚æ•°æ—¨åœ¨ç¡®ä¿ä»ä¸€ä¸ªå®¢æˆ·å†™å…¥ï¼Œä¸ä¼šå„æ–­æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œè¿™ä¼šå¹²æ‰°æ¥è‡ªè¯¥æœåŠ¡å™¨ä¸Šæ‰€æœ‰å…¶ä»–å®¢æˆ·çš„æµé‡ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯æˆ‘ä»¬æœåŠ¡å™¨å¯ä»¥åšçš„å·¥ä½œé‡çš„äººä¸ºå¸½ã€‚ </p><p> After an investigation where we slowly raised the value of this parameter to allow 100% of push operations to run immediately, we found that performance with our current architecture was more than good enough, and not only did we raise the limit, weÂ  removed the parameter from our code. This immediately improved our monorepo performance andÂ  eliminated many push-related errors.</p><p>åœ¨è°ƒæŸ¥åï¼Œæˆ‘ä»¬æ…¢æ…¢æå‡ºäº†è¿™ä¸ªå‚æ•°çš„ä»·å€¼ï¼Œå…è®¸100ï¼…çš„æ¨é€æ“ä½œç«‹å³è¿è¡Œï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨æˆ‘ä»¬å½“å‰çš„æ¶æ„çš„æ€§èƒ½è¶…è¿‡äº†è¶³å¤Ÿå¥½çš„ï¼Œè€Œä¸”ä¸ä»…æˆ‘ä»¬æé«˜äº†é™åˆ¶ï¼Œæˆ‘ä»¬åˆ é™¤äº†å‚æ•°æ¥è‡ªæˆ‘ä»¬çš„ä»£ç ã€‚è¿™ç«‹å³æ”¹å–„äº†æˆ‘ä»¬çš„MONOREPOæ€§èƒ½ï¼Œå¹¶æ¶ˆé™¤äº†è®¸å¤šä¸ä¹‹ç›¸å…³çš„é”™è¯¯ã€‚</p><p>  GitHub, by default, writes five replicas of each repository across our three data centers to protect against failures at the server, rack, network, and data center levels. When we need to update Git references, we briefly take a lock across all of the replicas in all of our data centers, and release the lock when ourÂ  three-phase-commitÂ (3PC) protocol reports success.</p><p>  é»˜è®¤æƒ…å†µä¸‹ï¼ŒGitHubå°†æ¯ä¸ªå­˜å‚¨åº“çš„äº”ä¸ªå‰¯æœ¬å†™å…¥æˆ‘ä»¬çš„ä¸‰ä¸ªæ•°æ®ä¸­å¿ƒï¼Œä»¥é˜²æ­¢æœåŠ¡å™¨ï¼Œæœºæ¶ï¼Œç½‘ç»œå’Œæ•°æ®ä¸­å¿ƒçº§åˆ«çš„æ•…éšœã€‚å½“æˆ‘ä»¬éœ€è¦æ›´æ–°GITå¼•ç”¨æ—¶ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰æ•°æ®ä¸­å¿ƒéƒ½çŸ­æš‚åœ°é”å®šæ‰€æœ‰å‰¯æœ¬ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„ä¸‰ç›¸æäº¤ï¼ˆ3PCï¼‰åè®®æŠ¥å‘ŠæˆåŠŸæ—¶é‡Šæ”¾é”å®šã€‚</p><p> During that lock, we compute a checksum on each replica, to ensure that they match and that all replicas are in sync. We use incremental checksums to make this faster, and during normal operation, this takes less than 50ms, but during repair operations, where we recompute the checksum from scratch, it takes longer. For large monorepos,Â  the lock was held for 20-30 seconds.</p><p> åœ¨è¯¥é”æœŸé—´ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªå‰¯æœ¬ä¸Šè®¡ç®—æ ¡éªŒå’Œï¼Œä»¥ç¡®ä¿å®ƒä»¬åŒ¹é…ï¼Œå¹¶ä¸”æ‰€æœ‰å‰¯æœ¬éƒ½å¤„äºåŒæ­¥çŠ¶æ€ã€‚æˆ‘ä»¬ä½¿ç”¨å¢é‡æ ¡éªŒå’Œæ›´å¿«ï¼Œåœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œè¿™éœ€è¦å°äº50msï¼Œä½†åœ¨ç»´ä¿®æ“ä½œæœŸé—´ï¼Œæˆ‘ä»¬åœ¨ä»å¤´å¼€å§‹é‡æ–°è®¡ç®—æ ¡éªŒå’Œï¼Œéœ€è¦æ›´é•¿æ—¶é—´ã€‚å¯¹äºå¤§å‹MONOREPOSï¼Œé”å®šäº†20-30ç§’ã€‚</p><p> We made a change to compute these replica checksums prior to taking the lock. By precomputing the checksums, weâ€™ve been able toÂ  reduce the lock to under 1 second, allowing more write operations to succeed immediately.</p><p> æˆ‘ä»¬åœ¨é”å®šä¹‹å‰è¿›è¡Œäº†æ›´æ”¹ä»¥è®¡ç®—è¿™äº›å‰¯æœ¬æ ¡éªŒå’Œã€‚é€šè¿‡é¢„å…ˆè®¡ç®—æ ¡éªŒå’Œï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿå°†é”å°†é”å®šåˆ°1ç§’ä»¥ä¸‹ï¼Œå…è®¸æ›´å¤šçš„å†™å…¥æ“ä½œç«‹å³æˆåŠŸã€‚</p><p>  One of our large monorepo customers keeps their own internal metrics on git performance, and their numbers show what ours do: their push operations have shown no failures for months.</p><p>  æˆ‘ä»¬çš„ä¸€ä¸ªå¤§å‹Monorepoå®¢æˆ·å¯ä»¥åœ¨Gitæ€§èƒ½ä¸Šä¿ç•™è‡ªå·±çš„å†…éƒ¨æŒ‡æ ‡ï¼Œä»–ä»¬çš„å·ç æ˜¾ç¤ºæˆ‘ä»¬çš„æ‰€ä½œæ‰€ä¸ºï¼šä»–ä»¬çš„æ¨é€æ“ä½œå·²ç»æ˜¾ç¤ºå‡ºå‡ ä¸ªæœˆçš„æ•…éšœã€‚</p><p> Another monorepo customer who was experiencing too many failures was planning a migration to start with a fresh repository, minimizing the number of references in the repo, in an attempt to improve push success. After these changes, our metrics showed their push failures at nearly zero, and a survey of their developers in December found no reports of recent push failures at all. They cancelled the migration, and continue running with great performance.</p><p> å¦ä¸€ä¸ªæ­£åœ¨é‡åˆ°å¤ªå¤šå¤±è´¥çš„Monorepoå®¢æˆ·è®¡åˆ’è¿ç§»ä»¥ç”¨æ–°é²œçš„å­˜å‚¨åº“å¼€å§‹ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘å›è´­ä¸­çš„å‚è€ƒæ•°é‡ï¼Œä»¥æé«˜æ¨åŠ¨æˆåŠŸã€‚åœ¨è¿™äº›å˜åŒ–ä¹‹åï¼Œæˆ‘ä»¬çš„æŒ‡æ ‡æ˜¾ç¤ºäº†ä»–ä»¬çš„æ¨åŠ¨å¤±è´¥ï¼Œè¿‘é›¶ï¼Œå¹¶åœ¨12æœˆå¯¹ä»–ä»¬çš„å¼€å‘å•†è¿›è¡Œäº†è°ƒæŸ¥ï¼Œæ²¡æœ‰å…³äºæœ€è¿‘æ¨åŠ¨å¤±è´¥çš„æŠ¥é“ã€‚ä»–ä»¬å–æ¶ˆäº†è¿ç§»ï¼Œå¹¶ç»§ç»­ä»¥è‰¯å¥½çš„è¡¨ç°è¿è¡Œã€‚</p><p> Want graphs? Here are graphs from these customers showing push failures dropping to nearly zero as we rolled out fixes.</p><p> æƒ³è¦å›¾è¡¨ï¼Ÿä»¥ä¸‹æ˜¯è¿™äº›å®¢æˆ·çš„å›¾è¡¨æ˜¾ç¤ºæ¨å‡ºä¿®å¤çš„æ¨å‡ºè¿‘é›¶çš„æ¨é€å¤±è´¥ã€‚ </p><p>    Like we said, weâ€™ve got push failures down toÂ  nearlyÂ zero. Some of those failures are caused by random Internet networking issues, and are beyond our control. As for the rest, weâ€™re looking at ways to eliminate those last annoying failures where we can, and to continue to make GitHub faster.</p><p>å°±åƒæˆ‘ä»¬è¯´çš„é‚£æ ·ï¼Œæˆ‘ä»¬å·²ç»å°†å¤±è´¥é™åˆ°äº†è¿‘é›¶ã€‚å…¶ä¸­ä¸€äº›å¤±è´¥æ˜¯ç”±éšæœºäº’è”ç½‘ç½‘ç»œé—®é¢˜å¼•èµ·çš„ï¼Œå¹¶ä¸”è¶…å‡ºäº†æˆ‘ä»¬çš„æ§åˆ¶ã€‚è‡³äºå…¶ä½™çš„ï¼Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾æ¶ˆé™¤æˆ‘ä»¬å¯ä»¥åœ¨é‚£é‡Œçš„æœ€åä¸€ä¸ªæ¼äººçš„å¤±è´¥ï¼Œå¹¶ç»§ç»­æ›´å¿«åœ°åˆ¶ä½œgithubã€‚</p><p> In the Git Systems world, weâ€™re refreshing our storage hardware to make it faster. Weâ€™re also in the middle of a significant refactoring effort, doing our part to decompose GitHubâ€™s famous Ruby monolith, and writing a new microservice in Go that will improve repository performance for every single user on GitHub.</p><p> åœ¨Git Systems Worldä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨åˆ·æ–°æˆ‘ä»¬çš„å­˜å‚¨ç¡¬ä»¶ï¼Œä»¥ä½¿å…¶æ›´å¿«ã€‚æˆ‘ä»¬ä¹Ÿåœ¨ä¸­é—´çš„é‡æ„åŠªåŠ›ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†è§£Githubç€åçš„Ruby Monolithï¼Œå¹¶åœ¨GOä¸­ç¼–å†™ä¸€ä¸ªæ–°çš„å¾®æœåŠ¡ï¼Œè¿™å°†æé«˜GitHubä¸Šæ¯ä¸ªç”¨æˆ·çš„å­˜å‚¨åº“æ€§èƒ½ã€‚</p><p>  Project Cyclops has led to better performance and the elimination of failures for customers with large monorepos, less wasted CPU cycles on our fleet of file servers, and has significantly improved the experience of using GitHub for thousands of developers at some of our largest customers, including our customers using GitHub Enterprise Server.</p><p>  Project Cyclopså¯¼è‡´å…·æœ‰å¤§å‹Monoreposçš„å®¢æˆ·çš„æ€§èƒ½å’Œæ¶ˆé™¤å¤±è´¥çš„æ•…éšœï¼Œæˆ‘ä»¬åœ¨æ–‡ä»¶æœåŠ¡å™¨çš„èˆ¹é˜Ÿä¸Šæµªè´¹äº†æµªè´¹çš„CPUå‘¨æœŸï¼Œå¹¶ä¸”åœ¨å…¶ä¸­ä¸€äº›æœ€å¤§çš„å®¢æˆ·ä¸­ä½¿ç”¨GitHubä»¥ä¸Šä½¿ç”¨Githubçš„ç»éªŒï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„å®¢æˆ·ä½¿ç”¨GitHub Enterprise Serverã€‚</p><p>  Weâ€™ve improved single-repository update traffic rates by at least an order of magnitude. We now have years of headroom on our current architecture to handle the growth of even the largest monorepos.</p><p>  æˆ‘ä»¬è‡³å°‘å°†å•æ¬¡å­˜å‚¨åº“æ›´æ–°æµé‡æé«˜è‡³å°‘ä¸€ä¸ªçº§åˆ«ã€‚æˆ‘ä»¬ç°åœ¨æœ‰å¤šå¹´çš„ä½™è§„æ˜¯æˆ‘ä»¬ç›®å‰çš„æ¶æ„ï¼Œä»¥å¤„ç†ç”šè‡³æœ€å¤§çš„Monoreposçš„å¢é•¿ã€‚</p><p>  We want to say how incredibly grateful ğŸ’š we are to our monorepo customers who haveÂ collaborated with us to make GitHub better. Their help in reporting, and sometimes even diagnosing, problems was instrumental to addressing them.Â âœ¨Â Sparkles all around!Â âœ¨</p><p>  æˆ‘ä»¬æƒ³è¯´æœ‰å¤šä»¤äººéš¾ä»¥ç½®ä¿¡çš„â™¥æˆ‘ä»¬æ˜¯æˆ‘ä»¬ä¸æˆ‘ä»¬åˆä½œçš„Monorepoå®¢æˆ·ï¼Œä»¥ä¾¿æ›´å¥½åœ°åˆ¶ä½œGitHubã€‚ä»–ä»¬åœ¨æŠ¥å‘Šä¸­çš„å¸®åŠ©ï¼Œæœ‰æ—¶ç”šè‡³è¯Šæ–­ï¼Œé—®é¢˜éƒ½æ˜¯æœ‰åŠ©äºè§£å†³è¿™äº›é—®é¢˜ã€‚ âœ¨å‘¨å›´é—ªè€€ï¼ âœ¨ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.blog/2021-03-16-improving-large-monorepo-performance-on-github/">https://github.blog/2021-03-16-improving-large-monorepo-performance-on-github/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/æ€§èƒ½/">#æ€§èƒ½</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/github/">#github</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/monorepo/">#monorepo</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/large/">#large</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/git/">#git</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012 - 2021 diglog.com </div></div></body></html>
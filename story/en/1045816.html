<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>å‡çº§æ‚¨çš„SSHå¯†é’¥ Upgrade Your SSH Keys</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Upgrade Your SSH Keys<br/>å‡çº§æ‚¨çš„SSHå¯†é’¥ </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-23 00:05:04</div><div class="page_narrow text-break page_content"><p>Whether you&#39;re a software developer or a sysadmin, I bet you&#39;re using SSH keys.Pushing your commits to Github or managing your Unix systems, it&#39;s best practice to do this over SSH with public key authentication rather than passwords.However, as time flies, many of you are using older keys and not aware of the need to generate fresh ones to protect your privates much better.In this post I&#39;ll demonstrate how to transition to an Ed25519 key smoothly, why you would want this and show some tips and tricks on the way there.</p><p>æ— è®ºæ‚¨æ˜¯è½¯ä»¶å¼€å‘äººå‘˜è¿˜æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ï¼Œæˆ‘æ‰“èµŒæ‚¨éƒ½åœ¨ä½¿ç”¨SSHå¯†é’¥ã€‚å°†æ‚¨çš„æäº¤æ¨é€åˆ°Githubæˆ–ç®¡ç†Unixç³»ç»Ÿï¼Œæœ€å¥½çš„åšæ³•æ˜¯é€šè¿‡SSHä½¿ç”¨å…¬é’¥è¿›è¡Œæ­¤æ“ä½œèº«ä»½éªŒè¯è€Œä¸æ˜¯å¯†ç ã€‚ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æµé€ï¼Œä½ ä»¬ä¸­çš„è®¸å¤šäººéƒ½åœ¨ä½¿ç”¨è¾ƒæ—§çš„å¯†é’¥ï¼Œå¹¶ä¸”æ²¡æœ‰æ„è¯†åˆ°éœ€è¦ç”Ÿæˆæ–°çš„å¯†é’¥æ¥æ›´å¥½åœ°ä¿æŠ¤æ‚¨çš„ç§äººè´¢äº§ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºå¦‚ä½•è¿‡æ¸¡åˆ°Ed25519é¡ºåˆ©è¾“å…¥å¯†ç ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­æ˜¾ç¤ºä¸€äº›æç¤ºå’ŒæŠ€å·§ã€‚</p><p> Generate your new key with  ssh-keygen -o -a 100 -t ed25519, specify a strong passphrase and read further if you need a smooth transition.</p><p> ä½¿ç”¨ssh-keygen -o -a 100 -t ed25519ç”Ÿæˆæ–°å¯†é’¥ï¼ŒæŒ‡å®šä¸€ä¸ªå¼ºå¯†ç çŸ­è¯­ï¼Œå¦‚æœéœ€è¦å¹³æ»‘è¿‡æ¸¡ï¼Œè¯·è¿›ä¸€æ­¥é˜…è¯»ã€‚</p><p> I&#39;m planning to publish some more posts on SSH tips &amp; tricks, so keep an eye on my blog for more.This post will focus on about SSH keys as user public key authentication.</p><p> æˆ‘è®¡åˆ’åœ¨SSHæŠ€å·§å’Œå…¬å‘Šä¸Šå‘å¸ƒæ›´å¤šä¿¡æ¯ã€‚æŠ€å·§ï¼Œå› æ­¤è¯·å…³æ³¨æˆ‘çš„åšå®¢ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚è¿™ç¯‡æ–‡ç« å°†é‡ç‚¹ä»‹ç»SSHå¯†é’¥ä½œä¸ºç”¨æˆ·å…¬å…±å¯†é’¥èº«ä»½éªŒè¯ã€‚</p><p>  If you&#39;ve created your key more than about four years ago with the default options it&#39;s probably insecure (RSA &lt; 2048 bits).Even worse, I&#39;ve seen tweeps, colleagues and friends still using DSA keys ( ssh-dss in OpenSSH format) recently.That&#39;s a key type similar to RSA, but limited to 1024 bits size and therefore  recommended against for a long time.It&#39;s plainly insecure and refused for valid reasons in recent OpenSSH versions (see also the  changelog for 7.0).</p><p>  å¦‚æœæ‚¨å¤§çº¦å››å¹´å‰ä½¿ç”¨é»˜è®¤é€‰é¡¹åˆ›å»ºäº†å¯†é’¥ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½æ˜¯ä¸å®‰å…¨çš„ï¼ˆRSAå°äº2048ä½ï¼‰ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘çœ‹åˆ°è¿‡é¸£å«å£°ï¼ŒåŒäº‹å’Œæœ‹å‹ä»åœ¨ä½¿ç”¨DSAå¯†é’¥ï¼ˆOpenSSHæ ¼å¼çš„ssh-dssï¼‰æœ€è¿‘ã€‚è¿™æ˜¯ä¸€ç§ç±»ä¼¼äºRSAçš„å¯†é’¥ç±»å‹ï¼Œä½†é™åˆ¶ä¸º1024ä½å¤§å°ï¼Œå› æ­¤å»ºè®®é•¿æ—¶é—´ä½¿ç”¨ã€‚å®ƒæ˜¾ç„¶æ˜¯ä¸å®‰å…¨çš„ï¼Œå‡ºäºæœ‰æ•ˆåŸå› è¢«æ‹’ç»åœ¨æœ€æ–°çš„OpenSSHç‰ˆæœ¬ä¸­ï¼ˆå¦è¯·å‚è§7.0çš„å˜æ›´æ—¥å¿—ï¼‰ã€‚</p><p> The sad thing about it is that I see posts on how to re-enable DSA key support rather than moving to a more secure type of key.Really, it&#39;s unwise to follow instructions to change the configuration for  PubkeyAcceptedKeyTypes or  HostKeyAlgorithms (host keys are for a later post).Instead, upgrade your keys!</p><p> ä»¤äººé—æ†¾çš„æ˜¯ï¼Œæˆ‘çœ‹åˆ°äº†æœ‰å…³å¦‚ä½•é‡æ–°å¯ç”¨DSAå¯†é’¥æ”¯æŒè€Œä¸æ˜¯è½¬å‘æ›´å®‰å…¨çš„å¯†é’¥ç±»å‹çš„å¸–å­ã€‚ç¡®å®ï¼ŒæŒ‰ç…§è¯´æ˜æ›´æ”¹PubkeyAcceptedKeyTypesæˆ–HostKeyAlgorithmsï¼ˆä¸»æœºå¯†é’¥ä¾›ä»¥åä½¿ç”¨ï¼‰ã€‚ç›¸åï¼Œè¯·å‡çº§æ‚¨çš„å¯†é’¥ï¼</p><p>  Compare DSA with the technology of locks using keys like this one.You wouldn&#39;t want this type of key to unlock your front door, right?</p><p>  å°†DSAä¸ä½¿ç”¨è¿™ç§é’¥åŒ™çš„é”æŠ€æœ¯è¿›è¡Œæ¯”è¾ƒã€‚æ‚¨ä¸ä¼šå¸Œæœ›è¿™ç§ç±»å‹çš„é’¥åŒ™æ¥è§£é”å‰é—¨å—ï¼Ÿ</p><p>       You&#39;re probably thinkingâ€¦ &#34;I&#39;m using my key for a long time, I don&#39;t want to change them everywhere now.&#34;Valid point, but you don&#39;t have to! It&#39;s good to know you can have multiple keys on your system and your SSH client will pick the right one for the right system automatically.</p><p>       æ‚¨å¯èƒ½åœ¨æƒ³â€¦â€¦æˆ‘å¾ˆé•¿æ—¶é—´ä»¥æ¥ä¸€ç›´åœ¨ä½¿ç”¨æˆ‘çš„å¯†é’¥ï¼Œæˆ‘ç°åœ¨ä¸æƒ³åœ¨ä»»ä½•åœ°æ–¹æ›´æ”¹å®ƒä»¬ã€‚æœ‰æ•ˆç‚¹ï¼Œä½†æ˜¯æ‚¨ä¸çŸ¥é“ä¸å¿…ï¼å¾ˆé«˜å…´çŸ¥é“æ‚¨çš„ç³»ç»Ÿä¸Šå¯ä»¥æœ‰å¤šä¸ªå¯†é’¥ï¼Œå¹¶ä¸”SSHå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨ä¸ºæ­£ç¡®çš„ç³»ç»Ÿé€‰æ‹©æ­£ç¡®çš„å¯†é’¥ã€‚ </p><p> It&#39;s part of the SSH protocol that it can offer multiple keys and the server picks the one your client will have to prove it has possession of the private key by a challenge.See it in action adding some verbosity to the SSH connect command ( -vvv).Also if you&#39;re using an SSH agent you can load multiple keys and it will discover them all.Easy as that.</p><p>å®ƒæ˜¯SSHåè®®çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥æä¾›å¤šä¸ªå¯†é’¥ï¼Œè€ŒæœåŠ¡å™¨ä¼šé€‰æ‹©ä¸€ä¸ªå®¢æˆ·ç«¯æ¥è¯æ˜å®ƒå…·æœ‰æŒ‘æˆ˜æ€§ï¼Œä»¥è¯æ˜å®ƒæ‹¥æœ‰ç§é’¥ã€‚åœ¨è¿è¡Œä¸­æŸ¥çœ‹å®ƒä¼šç»™SSHè¿æ¥å¢åŠ ä¸€äº›å†—é•¿çš„ç»†èŠ‚å‘½ä»¤ï¼ˆ-vvvï¼‰ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨SSHä»£ç†ï¼Œåˆ™å¯ä»¥åŠ è½½å¤šä¸ªå¯†é’¥ï¼Œå®ƒå°†å‘ç°æ‰€æœ‰å¯†é’¥ã€‚</p><p>  Most common is the RSA type of key, also known as  ssh-rsa with SSH.It&#39;s very compatible, but also slow and potentially insecure if created with a small amount of bits (&lt; 2048).We just learned that your SSH client can handle multiple keys, so enable yourself with the newest faster elliptic curve cryptography and enjoy the very compact key format it provides!</p><p>  æœ€å¸¸è§çš„æ˜¯RSAç±»å‹çš„å¯†é’¥ï¼Œä¹Ÿç§°ä¸ºSSHçš„ssh-rsaï¼Œå®ƒéå¸¸å…¼å®¹ï¼Œä½†æ˜¯å¦‚æœåˆ›å»ºçš„æ¯”ç‰¹æ•°å¾ˆå°‘ï¼ˆ<2048ï¼‰ï¼Œå®ƒä¹Ÿå¾ˆæ…¢å¹¶ä¸”å¯èƒ½ä¸å®‰å…¨ã€‚æ‚¨çš„SSHå®¢æˆ·ç«¯å¯ä»¥å¤„ç†å¤šä¸ªå¯†é’¥ï¼Œå› æ­¤è¯·ä½¿ç”¨æœ€æ–°çš„æ›´å¿«çš„æ¤­åœ†æ›²çº¿åŠ å¯†æŠ€æœ¯ï¼Œå¹¶äº«å—å®ƒæä¾›çš„éå¸¸ç´§å‡‘çš„å¯†é’¥æ ¼å¼ï¼</p><p> Ed25519 keys are short. Very short. If you&#39;re used to copy multiple lines of characters from system to system you&#39;ll be happily surprised with the size. The public key is just about 68 characters. It&#39;s also much faster in authentication compared to secure RSA (3072+ bits).</p><p> Ed25519é”®å¾ˆçŸ­ã€‚å¾ˆçŸ­ã€‚å¦‚æœä¹ æƒ¯äºåœ¨ç³»ç»Ÿä¹‹é—´å¤åˆ¶å¤šè¡Œå­—ç¬¦ï¼Œé‚£ä¹ˆæ‚¨ä¼šæƒŠè®¶äºå…¶å¤§å°ã€‚å…¬é’¥åªæœ‰68ä¸ªå­—ç¬¦ã€‚ä¸å®‰å…¨RSAï¼ˆ3072+ä½ï¼‰ç›¸æ¯”ï¼Œå®ƒçš„èº«ä»½éªŒè¯é€Ÿåº¦ä¹Ÿå¿«å¾—å¤šã€‚</p><p> Generating an Ed25519 key is done using the  -t ed25519 option to the ssh-keygen command.</p><p> ä½¿ç”¨ssh-keygenå‘½ä»¤çš„-t ed25519é€‰é¡¹å¯ä»¥ç”ŸæˆEd25519å¯†é’¥ã€‚</p><p>   When generating the keypair, you&#39;re asked for a passphrase to encrypt the private key with.If you will ever lose your private key it should protect others from impersonating you because it will be encrypted with the passphrase.To actually prevent this, one should make sure to prevent easy brute-forcing of the passphrase.</p><p>   ç”Ÿæˆå¯†é’¥å¯¹æ—¶ï¼Œç³»ç»Ÿä¼šè¦æ±‚æ‚¨è¾“å…¥ç”¨äºåŠ å¯†ç§é’¥çš„å¯†ç ã€‚å¦‚æœæ‚¨ä¸¢å¤±äº†ç§é’¥ï¼Œåˆ™åº”è¯¥ä¿æŠ¤ä»–äººä»¥é˜²ä»–äººå†’ç”¨ï¼Œå› ä¸ºå®ƒå°†ä½¿ç”¨å¯†ç è¿›è¡ŒåŠ å¯†ã€‚ä¸ºé˜²æ­¢è¿™ç§æƒ…å†µï¼Œåº”è¯¥ç¡®ä¿é˜²æ­¢å¯†ç çŸ­è¯­å®¹æ˜“è¢«å¼ºè¡Œä½¿ç”¨ã€‚</p><p> OpenSSH key generator offers two options to resistance to brute-force password cracking: using the new OpenSSH key format and increasing the amount of key derivation function rounds.It slows down the process of unlocking the key, but this is what prevents efficient brute-forcing by a malicious user too.I&#39;d say experiment with the amount of rounds on your system.Start at about 100 rounds.On my system it takes about one second to decrypt and load the key once per day using an agent.Very much acceptable, imo.</p><p> OpenSSHå¯†é’¥ç”Ÿæˆå™¨æä¾›äº†ä¸¤ç§æŠµå¾¡æš´åŠ›ç ´è§£å¯†ç çš„é€‰é¡¹ï¼šä½¿ç”¨æ–°çš„OpenSSHå¯†é’¥æ ¼å¼å’Œå¢åŠ å¯†é’¥æ´¾ç”ŸåŠŸèƒ½å›åˆçš„æ•°é‡ï¼Œè¿™ä¼šå‡æ…¢å¯†é’¥çš„è§£é”è¿‡ç¨‹ï¼Œä½†æ˜¯è¿™é˜»æ­¢äº†æœ‰æ•ˆçš„æš´åŠ›ç ´è§£æˆ‘ä¹Ÿè¯´è¿‡è¦å¯¹æ‚¨çš„ç³»ç»Ÿä¸Šçš„å›åˆæ•°é‡è¿›è¡Œå®éªŒã€‚å¤§çº¦è¦è¿›è¡Œ100è½®å›åˆã€‚åœ¨æˆ‘çš„ç³»ç»Ÿä¸Šï¼Œæ¯å¤©ä½¿ç”¨ä»£ç†è§£å¯†å’ŒåŠ è½½å¯†é’¥å¤§çº¦éœ€è¦ä¸€ç§’é’Ÿçš„æ—¶é—´ã€‚ imoã€‚</p><p> With  ssh-keygen use the  -o option for the new RFC4716 key format and the use of a modern key derivation function powered by bcrypt.Use the  -a &lt;num&gt; option for  &lt;num&gt; amount of rounds.</p><p> å¯¹äºssh-keygenï¼Œå¯¹æ–°çš„RFC4716å¯†é’¥æ ¼å¼ä½¿ç”¨-oé€‰é¡¹ï¼Œå¹¶ä½¿ç”¨ç”±bcryptæ”¯æŒçš„ç°ä»£å¯†é’¥æ´¾ç”ŸåŠŸèƒ½ã€‚-aï¼†lt; numï¼†gt; ï¼†lt; numï¼†gt;çš„é€‰é¡¹è½®æ•°ã€‚ </p><p>  The OpenSSH manpages are not really explanatory about the &#39;new&#39; format.I found this article pretty useful:  &#34;new openssh key format and bcrypt pbkdf&#34; on www.tedunangst.com.</p><p>OpenSSHè”æœºå¸®åŠ©é¡µå¹¶æ²¡æœ‰çœŸæ­£è¯´æ˜ï¼†ï¼ƒ39; newï¼†ï¼ƒ39;æ ¼å¼ã€‚æˆ‘å‘ç°æœ¬æ–‡éå¸¸æœ‰ç”¨ï¼šï¼†ï¼ƒ34;æ–°çš„opensshå¯†é’¥æ ¼å¼å’Œbcrypt pbkdfï¼†ï¼ƒ34;åœ¨www.tedunangst.comä¸Šã€‚</p><p>  Use the same passphrase on all of your key types and profit with more convenience.(See also  Multi-key aware SSH client.)</p><p>  åœ¨æ‰€æœ‰å¯†é’¥ç±»å‹ä¸Šä½¿ç”¨ç›¸åŒçš„å¯†ç çŸ­è¯­ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°è·åˆ©ï¼ˆå¦è¯·å‚è§æ”¯æŒå¤šå¯†é’¥çš„SSHå®¢æˆ·ç«¯ï¼‰ã€‚</p><p> $ ssh-keygen -o -a  100 -t ed25519 Generating public/private ed25519 key pair. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/gert/.ssh/id_ed25519. Your public key has been saved in /home/gert/.ssh/id_ed25519.pub. The key fingerprint is: SHA256: [...] gert@hostname The key&#39;s randomart image is: [...]</p><p> $ ssh-keygen -o -a 100 -t ed25519ç”Ÿæˆå…¬ç”¨/ä¸“ç”¨ed25519å¯†é’¥å¯¹ã€‚è¾“å…¥å¯†ç ï¼ˆæ— å¯†ç æ—¶ä¸ºç©ºï¼‰ï¼šå†æ¬¡è¾“å…¥ç›¸åŒçš„å¯†ç ï¼šæ‚¨çš„æ ‡è¯†å·²ä¿å­˜åœ¨/home/gert/.ssh/id_ed25519ä¸­ã€‚æ‚¨çš„å…¬é’¥å·²ä¿å­˜åœ¨/home/gert/.ssh/id_ed25519.pubä¸­ã€‚å¯†é’¥æŒ‡çº¹æ˜¯ï¼šSHA256ï¼šgert @ hostnameå¯†é’¥çš„randomartå›¾åƒæ˜¯ï¼š[...]</p><p> Note the line &#39;Your identification has been saved in /home/gert/.ssh/id_ed25519&#39;.Your current RSA/DSA keys are next to it in the same  ~/.ssh folder.As with any other key you can copy the public key in  ~/.ssh/id_ed25519.pub to target hosts for authentication.</p><p> è¯·æ³¨æ„ï¼†ï¼ƒ39;æ‚¨çš„è¡Œå·²ä¿å­˜åœ¨/home/gert/.ssh/id_ed25519&#39;ä¸­ã€‚æ‚¨å½“å‰çš„RSA / DSAå¯†é’¥ä½äºåŒä¸€ã€œ/ .sshæ–‡ä»¶å¤¹ä¸­ã€‚æ‚¨å¯ä»¥å°†ã€œ/ .ssh / id_ed25519.pubä¸­çš„å…¬é’¥å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºä»¥è¿›è¡Œèº«ä»½â€‹â€‹éªŒè¯ã€‚</p><p>  All keys available on default paths will be autodetected by SSH client applications, including the SSH agent via ssh-add.So, if you were using an application like ssh/scp/rsync before like...</p><p>  SSHå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹é»˜è®¤è·¯å¾„ä¸Šå¯ç”¨çš„æ‰€æœ‰å¯†é’¥ï¼ŒåŒ…æ‹¬é€šè¿‡ssh-addçš„SSHä»£ç†ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨ä¹‹å‰ä½¿ç”¨è¿‡ssh / scp / rsyncä¹‹ç±»çš„åº”ç”¨ç¨‹åº...</p><p>  it will now offer multiple public keys to the server and the server will request proof of possession for a matching entry for authentication.And your daily use of the  ssh-add command will not change and autodiscover the Ed25519 key:</p><p>  å®ƒç°åœ¨å°†ä¸ºæœåŠ¡å™¨æä¾›å¤šä¸ªå…¬é’¥ï¼Œå¹¶ä¸”æœåŠ¡å™¨å°†è¯·æ±‚æ‹¥æœ‰è¯æ˜ä»¥æä¾›åŒ¹é…æ¡ç›®ä»¥è¿›è¡Œèº«ä»½â€‹â€‹éªŒè¯ã€‚å¹¶ä¸”æ‚¨æ¯å¤©ä½¿ç”¨ssh-addå‘½ä»¤ä¸ä¼šæ›´æ”¹å¹¶è‡ªåŠ¨å‘ç°Ed25519å¯†é’¥ï¼š</p><p>  It not only discovered both keys, it also loaded them by entering a single passphrase (because it&#39;s the same)!</p><p>  å®ƒä¸ä»…å‘ç°äº†ä¸¤ä¸ªå¯†é’¥ï¼Œè¿˜é€šè¿‡è¾“å…¥ä¸€ä¸ªå¯†ç çŸ­è¯­æ¥åŠ è½½å®ƒä»¬ï¼ˆå› ä¸ºå®ƒç›¸åŒï¼‰ï¼ </p><p> We&#39;ve reached a very important goal now.Without any change to your daily routine we can slowly change the existing configuration on remote hosts to accept the Ed25519 key.In the meantime the RSA key will still work.Great, right!?</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªéå¸¸é‡è¦çš„ç›®æ ‡ã€‚åœ¨æ‚¨çš„æ—¥å¸¸å·¥ä½œä¸­æ— éœ€è¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼“æ…¢åœ°æ›´æ”¹è¿œç¨‹ä¸»æœºä¸Šçš„ç°æœ‰é…ç½®ä»¥æ¥å—Ed25519å¯†é’¥ã€‚ä¸æ­¤åŒæ—¶RSAå¯†é’¥ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p><p>  If you&#39;re afraid this will change your key, don&#39;t worry.The private part of your keypair is encrypted with a passphrase which only exists locally on your machine.Change it as often as you like.This is recommended to prevent abuse in case the key file gets into the wrong hands.Repeat for all your key files to ensure a new key format with 100 bcrypt KDF rounds:</p><p>  å¦‚æœæ‚¨æ‹…å¿ƒè¿™ä¼šæ›´æ”¹æ‚¨çš„å¯†é’¥ï¼Œè¯·ä¸è¦æ‹…å¿ƒã€‚å¯†é’¥å¯¹çš„ç§æœ‰éƒ¨åˆ†ä½¿ç”¨ä»…åœ¨è®¡ç®—æœºæœ¬åœ°å­˜åœ¨çš„å¯†ç åŠ å¯†ï¼Œå› æ­¤æ‚¨å¯ä»¥éšæ—¶æ›´æ”¹å®ƒã€‚å»ºè®®ä»¥é˜²ä¸‡ä¸€å¯†é’¥æ–‡ä»¶è¢«ä¸æ­£ç¡®çš„äººæ»¥ç”¨ï¼Œè¯·é‡å¤æ‰€æœ‰å¯†é’¥æ–‡ä»¶ä»¥ç¡®ä¿æ–°çš„å¯†é’¥æ ¼å¼å…·æœ‰100æ¬¡bcrypt KDFéªŒè¯ï¼š</p><p>   Using Ed25519 will (and should) work in most situations by now, but legacy systems may not support them as of yet.The best fallback is a strong RSA keypair for this.</p><p>   åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½¿ç”¨Ed25519å¯ä»¥ï¼ˆè€Œä¸”åº”è¯¥ï¼‰åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ä¼ ç»Ÿç³»ç»Ÿå¯èƒ½åˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸æ”¯æŒå®ƒä»¬ã€‚æœ€å¥½çš„åé€€æ˜¯ä¸ºæ­¤æä¾›å¼ºå¤§çš„RSAå¯†é’¥å¯¹ã€‚</p><p> While the OpenSSH client supports multiple RSA keys, it requires configuration/command line options to specify the path so it&#39;s rather error-prone.Instead, I&#39;d recommend upgrading your existing key in-place to keep things simple once this is done.Depending on the strength (key size) of your current RSA key you can migrate urgently or comfortably.</p><p> å°½ç®¡OpenSSHå®¢æˆ·ç«¯æ”¯æŒå¤šä¸ªRSAå¯†é’¥ï¼Œä½†å®ƒéœ€è¦é…ç½®/å‘½ä»¤è¡Œé€‰é¡¹æ¥æŒ‡å®šè·¯å¾„ï¼Œå› æ­¤å®ƒå¾ˆå®¹æ˜“å‡ºé”™ã€‚ç›¸åï¼Œæˆ‘å»ºè®®å°±åœ°å‡çº§ç°æœ‰å¯†é’¥ä»¥ç®€åŒ–æ“ä½œæ ¹æ®å½“å‰RSAå¯†é’¥çš„å¼ºåº¦ï¼ˆå¯†é’¥å¤§å°ï¼‰ï¼Œæ‚¨å¯ä»¥ç´§æ€¥æˆ–èˆ’é€‚åœ°è¿›è¡Œè¿ç§»ã€‚</p><p> In case you have a weak RSA key still, move it out of the way from the standard path and generate a new one of 4096 bits size:</p><p> å¦‚æœæ‚¨ä»ç„¶æœ‰ä¸€ä¸ªè¾ƒå¼±çš„RSAå¯†é’¥ï¼Œè¯·å°†å…¶ç§»å‡ºæ ‡å‡†è·¯å¾„ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª4096ä½å¤§å°çš„æ–°å¯†é’¥ï¼š</p><p> $ mv ~/.ssh/id_rsa ~/.ssh/id_rsa_legacy $ mv ~/.ssh/id_rsa.pub ~/.ssh/id_rsa_legacy.pub $ ssh-keygen -t rsa -b  4096 -o -a  100</p><p> $ mvã€œ/ .ssh / id_rsaã€œ/ .ssh / id_rsa_pubacy $ mvã€œ/ .ssh / id_rsa.pubã€œ/ .ssh / id_rsa_legacy.pub $ ssh-keygen -t rsa -b 4096 -o -a 100</p><p>   Once you are finished the transition on all remote targets you can go back to convenience and let it autodiscover your new RSA and Ed25519 keys; simply omit the keyfile arguments.</p><p>   å®Œæˆæ‰€æœ‰è¿œç¨‹ç›®æ ‡ä¸Šçš„è½¬æ¢åï¼Œæ‚¨å¯ä»¥å›åˆ°æ–¹ä¾¿çŠ¶æ€ï¼Œè®©å®ƒè‡ªåŠ¨å‘ç°æ–°çš„RSAå’ŒEd25519å¯†é’¥ï¼›åªéœ€çœç•¥keyfileå‚æ•°ã€‚ </p><p>  Support is available since OpenSSH 6.5 and well adopted in the Unix world OSs for workstations.Ubuntu 14.04+, Debian 8+, CentOS/RedHat 7+ etc. all support it already.(If you have details about Mac OS X please drop a line, couldn&#39;t find it with a quick search).Some software like custom desktop key agents may not like the new keys for several reasons (see below  about the Gnome-keyring for example).</p><p>è‡ªOpenSSH 6.5å¼€å§‹æä¾›æ”¯æŒï¼Œå¹¶å·²åœ¨Unixä¸–ç•Œæ“ä½œç³»ç»Ÿçš„å·¥ä½œç«™ä¸­å¹¿æ³›é‡‡ç”¨.Ubuntu 14.04 +ï¼ŒDebian 8 +ï¼ŒCentOS / RedHat 7+ç­‰éƒ½å·²æ”¯æŒï¼ˆå¦‚æœæ‚¨æœ‰Mac OS Xçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·ä¸‹ä¸€è¡Œï¼Œæ— æ³•é€šè¿‡å¿«é€Ÿæœç´¢æ‰¾åˆ°å®ƒï¼‰ã€‚æŸäº›è½¯ä»¶ï¼ˆä¾‹å¦‚è‡ªå®šä¹‰æ¡Œé¢å¯†é’¥ä»£ç†ï¼‰å¯èƒ½ç”±äºå¤šç§åŸå› è€Œä¸å–œæ¬¢æ–°å¯†é’¥ï¼ˆä¾‹å¦‚ï¼Œæœ‰å…³Gnomeå¯†é’¥ï¼Œè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚</p><p> Github works pretty well too, by the way.Launchpad and Gerrit code review however, seem to require RSA keys unfortunately.PuTTY on Windows? See below.</p><p> é¡ºä¾¿è¯´ä¸€å¥ï¼ŒGithubä¹Ÿè¿è¡Œå¾—å¾ˆå¥½ã€‚ä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼ŒLaunchpadå’ŒGerritä»£ç å®¡æŸ¥ä¼¼ä¹éœ€è¦RSAå¯†é’¥.Windowsä¸Šçš„PuTTYå—ï¼Ÿè§ä¸‹æ–‡ã€‚</p><p>  The Gnome-keyring, as used in Ubuntu Unity at least, fails to read the new RFC4716 format keys but reports success.It&#39;s bugged.More details here in  my AskUbuntu Q&amp;A post.I&#39;d recommend disabling the Gnome keyring for SSH agent use and use the plain OpenSSH agent instead.</p><p>  è‡³å°‘åœ¨Ubuntu Unityä¸­ä½¿ç”¨çš„Gnomeå¯†é’¥æ— æ³•è¯»å–æ–°çš„RFC4716æ ¼å¼å¯†é’¥ï¼Œä½†æŠ¥å‘ŠæˆåŠŸï¼Œè¿™æ˜¯æœ‰bugçš„ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è§æˆ‘çš„AskUbuntué—®é¢˜ä¸è§£ç­”ã€‚æˆ‘å»ºè®®ç¦ç”¨SSHä»£ç†ä½¿ç”¨çš„Gnomeå¯†é’¥ç¯ï¼Œè¯·æ”¹ç”¨æ™®é€šçš„OpenSSHä»£ç†ã€‚</p><p>  Sorry, I&#39;m not using PuTTY, but make sure to upgrade first.This page suggests Ed25519 support since a late-2015 version according to a  wishlist item.Generally speaking, I&#39;m not too excited with the speed of implementation of security features in it.</p><p>  æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨PuTTYï¼Œä½†è¯·ç¡®ä¿å…ˆè¿›è¡Œå‡çº§ã€‚æ ¹æ®æ„¿æœ›æ¸…å•çš„å†…å®¹ï¼Œæ­¤é¡µé¢å»ºè®®ä»2015å¹´æœ«ç‰ˆæœ¬å¼€å§‹æ”¯æŒEd25519ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘å¯¹è¿™æ ·çš„é€Ÿåº¦ä¸å¤ªæ»¡æ„å®æ–½å®‰å…¨åŠŸèƒ½ã€‚</p><p>  We&#39;ve taken some steps, important ones, but it&#39;s far from ultimate security.When dealing with high assurance environments I would strongly discourage key usage like described in this post as this holds the unencrypted private key in memory.Instead, use hardware security (smart cards) to avoid leaking keys even from memory dumps.It&#39;s not covered in this post, mainly because it requires a hardware device you need to buy and secondly because the limitations are device dependent.A nice cute solution would be to make use of your TPM already built-in your PC probably, but that would definitely deserve another post.</p><p>  æˆ‘ä»¬å·²ç»é‡‡å–äº†ä¸€äº›é‡è¦çš„æ­¥éª¤ï¼Œä½†æ˜¯ç¦»æœ€ç»ˆçš„å®‰å…¨æ€§è¿˜å¾ˆé¥è¿œã€‚åœ¨å¤„ç†é«˜åº¦å®‰å…¨çš„ç¯å¢ƒæ—¶ï¼Œæˆ‘ä¼šå¼ºçƒˆåå¯¹åƒæœ¬æ–‡æ‰€è¿°çš„é‚£æ ·ä½¿ç”¨å¯†é’¥ï¼Œå› ä¸ºè¿™ä¼šåœ¨å†…å­˜ä¸­ä¿å­˜æœªåŠ å¯†çš„ç§é’¥ã€‚ç›¸åï¼Œè¯·ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ€§ï¼ˆæ™ºèƒ½å¡ï¼‰æ¥é¿å…å¯†é’¥ç”šè‡³ä»å†…å­˜è½¬å‚¨ä¸­æ³„æ¼å‡ºæ¥ã€‚æœ¬æ–‡æœªå¯¹æ­¤è¿›è¡Œä»‹ç»ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒéœ€è¦æ‚¨è´­ä¹°çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå…¶æ¬¡æ˜¯å› ä¸ºé™åˆ¶å–å†³äºè®¾å¤‡ã€‚ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯åˆ©ç”¨æ‚¨PCä¸Šå·²ç»å†…ç½®çš„TPMï¼Œä½†è¿™ç»å¯¹å€¼å¾—æ‚¨å…³æ³¨ã€‚</p><p>  I&#39;m planning on writing some more on how to harden SSH a bit more; custom host keys, custom DH moduli, strong ciphers (e.g.  chacha20-poly1305) and secure KeyExchange/MACs.For now this is a great resource already:  https://stribika.github.io/2015/01/04/secure-secure-shell.html</p><p>  æˆ‘è®¡åˆ’ç¼–å†™æ›´å¤šæœ‰å…³å¦‚ä½•åŠ å¼ºSSHçš„å†…å®¹ï¼›è‡ªå®šä¹‰ä¸»æœºå¯†é’¥ï¼Œè‡ªå®šä¹‰DHæ¨¡æ•°ï¼Œå¼ºå¯†ç ï¼ˆä¾‹å¦‚chacha20-poly1305ï¼‰å’Œå®‰å…¨çš„KeyExchange / MACã€‚ç›®å‰ï¼Œè¿™å·²ç»æ˜¯ä¸€ä¸ªä¸é”™çš„èµ„æºï¼šhttps://stribika.github.io/2015/01/04/secure-secure -shell.html</p><p>    ğŸ”‘ Upgrade your SSH keys! (blog) Use Ed25519, about a transition and other tips &amp; tricks.  https://t.co/KDY2Ufh5FC</p><p>    ğŸ”‘å‡çº§æ‚¨çš„SSHå¯†é’¥ï¼ ï¼ˆåšå®¢ï¼‰ä½¿ç”¨Ed25519ï¼Œäº†è§£è¿‡æ¸¡å’Œå…¶ä»–æŠ€å·§ï¼†amp;æŠ€å·§ã€‚ https://t.co/KDY2Ufh5FC </p><p>â€” Gert van Dijk âš ï¸ (@gertvdijk)  September 23, 2016</p><p>-Gert van Dijkâš ï¸ï¼ˆ@gertvdijkï¼‰2016å¹´9æœˆ23æ—¥ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.g3rt.nl/upgrade-your-ssh-keys.html">https://blog.g3rt.nl/upgrade-your-ssh-keys.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ssh/">#ssh</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/å¯†é’¥/">#å¯†é’¥</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
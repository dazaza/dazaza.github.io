<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>åƒç´ /ä½“ç´ ç½‘æ ¼ä¸Šçš„æ¸å˜â€“å‰å‘ï¼Œä¸­å¤®å’Œå¯¹è§’çº¿å·®å¼‚ Gradients on grids of pixels/voxels â€“ forward, central, and diagonal differences</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Gradients on grids of pixels/voxels â€“ forward, central, and diagonal differences<br/>åƒç´ /ä½“ç´ ç½‘æ ¼ä¸Šçš„æ¸å˜â€“å‰å‘ï¼Œä¸­å¤®å’Œå¯¹è§’çº¿å·®å¼‚ </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-02 07:34:41</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/856f4702f67998857c343544ba945259.png"><img src="http://img2.diglog.com/img/2021/3/856f4702f67998857c343544ba945259.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In this post, I will focus on  gradients of image signals defined on grids in computer graphics and image processing. Specifically, gradients / derivatives of images, height fields, distance fields, when they are represented as discrete, uniform grids of pixels or voxels.</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»è®¡ç®—æœºå›¾å½¢å­¦å’Œå›¾åƒå¤„ç†ä¸­å®šä¹‰åœ¨ç½‘æ ¼ä¸Šçš„å›¾åƒä¿¡å·çš„æ¢¯åº¦ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯å°†å›¾åƒçš„æ¢¯åº¦/å¯¼æ•°ï¼Œé«˜åº¦åœºï¼Œè·ç¦»åœºè¡¨ç¤ºä¸ºç¦»æ•£çš„ï¼Œå‡åŒ€çš„åƒç´ æˆ–ä½“ç´ ç½‘æ ¼ã€‚</p><p> Iâ€™ll start with the very basics â€“ what do we typically mean by gradients (as itâ€™s not always â€œstandardizedâ€), what are they used for, what are the ypical methods (forward or central differences), their cons and problems, and then proceed to discuss an interesting alternative with very nice properties â€“  diagonal gradients.</p><p> æˆ‘å°†ä»æœ€åŸºæœ¬çš„å†…å®¹å¼€å§‹-æ¢¯åº¦é€šå¸¸æ˜¯ä»€ä¹ˆæ„æ€ï¼ˆå› ä¸ºå®ƒå¹¶ä¸æ€»æ˜¯â€œæ ‡å‡†åŒ–â€çš„ï¼‰ï¼Œå®ƒä»¬çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œå…¸å‹çš„æ–¹æ³•ï¼ˆæ­£å‘æˆ–ä¸­å¿ƒå·®å¼‚ï¼‰æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬çš„åˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Œä»¥åŠç„¶åç»§ç»­è®¨è®ºä¸€ä¸ªå…·æœ‰éå¸¸å¥½çš„å±æ€§çš„æœ‰è¶£æ›¿ä»£æ–¹æ³•-å¯¹è§’æ¸å˜ã€‚</p><p> My post will conclude with advice on how to use them in practice in a simple useful scheme, how to extend it with a little bit of computations to a super useful concept of a  structure tensor that can characterize dominating direction of any gradient field, and finish with some signal processing fun â€“  frequency domain analysis of forward and central differences.</p><p> æˆ‘çš„æ–‡ç« å°†ä»¥å¦‚ä½•åœ¨ç®€å•æœ‰æ•ˆçš„æ–¹æ¡ˆä¸­å®é™…ä½¿ç”¨å®ƒä»¬çš„å»ºè®®ä½œä¸ºç»“å°¾ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å°‘é‡çš„è®¡ç®—å°†å…¶æ‰©å±•ä¸ºç»“æ„å¼ é‡çš„è¶…çº§æœ‰ç”¨çš„æ¦‚å¿µï¼Œè¯¥ç»“æ„å¼ é‡å¯ä»¥è¡¨å¾ä»»ä½•æ¢¯åº¦åœºçš„ä¸»å¯¼æ–¹å‘ï¼Œå¹¶å®Œæˆå¸¦æ¥ä¸€äº›ä¿¡å·å¤„ç†ä¹è¶£â€“å‰å‘å’Œä¸­å¤®å·®å¼‚çš„é¢‘åŸŸåˆ†æã€‚</p><p>   Itâ€™s not very well defined problem on discrete signals, but the most common and useful way to think about it is inspired by signal processing and the idea of sampling:</p><p>   å¯¹äºç¦»æ•£ä¿¡å·æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½å®šä¹‰çš„é—®é¢˜ï¼Œä½†æ˜¯æœ€å¸¸è§å’Œæœ€æœ‰ç”¨çš„æ€è€ƒæ–¹å¼æ˜¯å—ä¿¡å·å¤„ç†å’Œé‡‡æ ·æ€æƒ³çš„å¯å‘ï¼š</p><p> Assuming there was some continuous signal that got discretized, what would be the partial derivative with regards to the spatial dimension of this continuous signal at gradient evaluation points?</p><p> å‡è®¾å­˜åœ¨ä¸€äº›ç¦»æ•£çš„è¿ç»­ä¿¡å·ï¼Œé‚£ä¹ˆåœ¨æ¢¯åº¦è¯„ä¼°ç‚¹ä¸Šï¼Œè¯¥è¿ç»­ä¿¡å·çš„ç©ºé—´ç»´æ•°å°†æ˜¯åå¯¼æ•°ï¼Ÿ</p><p> This interpretation is useful both for computer graphics (where we might have discretized descriptions of continuous surfaces; like voxel fields, heightmaps, or distance fields), as well as in image processing (where we often assume that images are â€œnatural imagesâ€ that got photographed).</p><p> è¿™ç§è§£é‡Šå¯¹äºè®¡ç®—æœºå›¾å½¢å­¦ï¼ˆæˆ‘ä»¬å¯èƒ½å¯¹è¿ç»­æ›²é¢è¿›è¡Œç¦»æ•£åŒ–æè¿°ï¼›ä¾‹å¦‚ä½“ç´ åœºï¼Œé«˜åº¦å›¾æˆ–è·ç¦»åœºï¼‰ä»¥åŠå›¾åƒå¤„ç†ï¼ˆæˆ‘ä»¬é€šå¸¸è®¤ä¸ºå›¾åƒæ˜¯â€œè‡ªç„¶å›¾åƒâ€ï¼‰éƒ½éå¸¸æœ‰ç”¨ã€‚æ‹ä¸‹ï¼‰ã€‚</p><p> Continuous gradients and derivatives used for things like normals of procedural SDFs are also interesting, but a different story. I will not cover those here, and instead recommend you check out  this cool post by Inigo Quilez with lots of practical tricks (re-reading it I learned about the tetrahedron trick) and advice. I am sure that no matter your level of familiarity with the topic, you will learn something new.</p><p> ç”¨äºè¿‡ç¨‹SDFçš„æ³•çº¿ä¹‹ç±»çš„è¿ç»­æ¸å˜å’Œå¯¼æ•°ä¹Ÿå¾ˆæœ‰è¶£ï¼Œä½†æƒ…å†µæœ‰æ‰€ä¸åŒã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œä»‹ç»è¿™äº›å†…å®¹ï¼Œè€Œæ˜¯å»ºè®®æ‚¨é˜…è¯»Inigo Quilezçš„è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç« ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šå®ç”¨æŠ€å·§ï¼ˆé‡æ–°é˜…è¯»æˆ‘ä»å››é¢ä½“æŠ€å·§ä¸­å­¦åˆ°çš„æŠ€å·§ï¼‰å’Œå»ºè®®ã€‚æˆ‘ç›¸ä¿¡ï¼Œæ— è®ºæ‚¨å¯¹æœ¬ä¸»é¢˜çš„ç†Ÿæ‚‰ç¨‹åº¦å¦‚ä½•ï¼Œæ‚¨éƒ½ä¼šå­¦åˆ°ä¸€äº›æ–°ä¸œè¥¿ã€‚ </p><p> In my post, I will focus on computer graphics, image processing, and basic signal processing takes on the problem. There are two much deeper connections that I havenâ€™t personally worked too much with. So I leave it as something that I wish I can expand my knowledge in the future, but also encourage my readers to explore it:</p><p>åœ¨æˆ‘çš„å¸–å­ä¸­ï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»è®¡ç®—æœºå›¾å½¢å­¦ï¼Œå›¾åƒå¤„ç†ä»¥åŠè§£å†³è¯¥é—®é¢˜çš„åŸºæœ¬ä¿¡å·å¤„ç†ã€‚æˆ‘ä¸ªäººä¹‹é—´å¹¶æ²¡æœ‰è¿›è¡Œè¿‡å¤šçš„æ·±å±‚æ¬¡çš„è”ç³»ã€‚å› æ­¤ï¼Œæˆ‘å¸Œæœ›æˆ‘å°†æ¥èƒ½æ‰©å±•è‡ªå·±çš„çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿé¼“åŠ±æˆ‘çš„è¯»è€…æ¢ç´¢å®ƒï¼š</p><p> Further reading one: The first connection is with  Partial Differential Equations and their discretization. Solving PDEs and solving discretized PDEs is something that many specialized scientific domains deal with, and computing gradients is an inherent part of numerical discretized PDE solutions. I donâ€™t know too much about those, but Iâ€™m sure literature covers this in much detail.</p><p> è¿›ä¸€æ­¥é˜…è¯»ä¸€ä¸ªï¼šç¬¬ä¸€ä¸ªå…³ç³»æ˜¯åå¾®åˆ†æ–¹ç¨‹åŠå…¶ç¦»æ•£åŒ–ã€‚è§£å†³PDEå’Œè§£å†³ç¦»æ•£PDEæ˜¯è®¸å¤šä¸“ä¸šç§‘å­¦é¢†åŸŸéƒ½éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œè®¡ç®—æ¢¯åº¦æ˜¯æ•°å­—ç¦»æ•£PDEè§£å†³æ–¹æ¡ˆçš„å›ºæœ‰éƒ¨åˆ†ã€‚æˆ‘å¯¹æ­¤ä¸å¤ªäº†è§£ï¼Œä½†æ˜¯æˆ‘æ•¢è‚¯å®šæ–‡å­¦ä¼šå¯¹æ­¤è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><p> Further reading two: The second connection is  wavelets, filter banks, and the frequency precision / localization trade-off. This is something used in communication theory, electrical engineering, radar systems, audio systems, and many more. While I read and am familiar with  some theory, I havenâ€™t found too many practical uses of wavelets (other than the simplest Gabor ones or in use for image pyramids) in my work, so again Iâ€™ll just recommend you some more specialized reading.</p><p> è¿›ä¸€æ­¥é˜…è¯»äºŒï¼šç¬¬äºŒä¸ªè¿æ¥æ˜¯å°æ³¢ï¼Œæ»¤æ³¢å™¨ç»„ä»¥åŠé¢‘ç‡ç²¾åº¦/å®šä½æƒè¡¡ã€‚è¿™æ˜¯åœ¨é€šä¿¡ç†è®ºï¼Œç”µæ°”å·¥ç¨‹ï¼Œé›·è¾¾ç³»ç»Ÿï¼ŒéŸ³é¢‘ç³»ç»Ÿç­‰ä¸­ä½¿ç”¨çš„ä¸œè¥¿ã€‚å½“æˆ‘é˜…è¯»å¹¶ç†Ÿæ‚‰ä¸€äº›ç†è®ºæ—¶ï¼Œæˆ‘åœ¨å·¥ä½œä¸­æ²¡æœ‰å‘ç°å¤ªå¤šå°æ³¢çš„å®é™…ç”¨é€”ï¼ˆé™¤äº†æœ€ç®€å•çš„Gaboræˆ–ç”¨äºå›¾åƒé‡‘å­—å¡”çš„å°æ³¢ï¼‰ï¼Œæ‰€ä»¥æˆ‘å†æ¬¡å‘æ‚¨æ¨èä¸€äº›æ›´ä¸“ä¸šçš„å°æ³¢è¯»ã€‚</p><p>   Compute surface normals â€“ when we have something like a scalar field â€“ whether distance field describing an underlying implicit surface, or simply a height field, we might want to compute its gradients to compute normals of the surface, or of the heightfield for normal mapping, evaluating BRDFs and lighting etc. Maybe even for physical simulation, collision, or animation on terrain!</p><p>   è®¡ç®—è¡¨é¢æ³•çº¿-å½“æˆ‘ä»¬å…·æœ‰æ ‡é‡åœºä¹‹ç±»çš„ä¸œè¥¿æ—¶-æ— è®ºæ˜¯æè¿°åº•å±‚éšå¼è¡¨é¢çš„è·ç¦»åœºè¿˜æ˜¯ä»…æ˜¯é«˜åº¦åœºï¼Œæˆ‘ä»¬å¯èƒ½è¦è®¡ç®—å…¶æ¢¯åº¦ä»¥è®¡ç®—è¡¨é¢æ³•çº¿æˆ–æ³•çº¿è´´å›¾çš„é«˜åº¦åœºï¼Œè¯„ä¼°BRDFå’Œç…§æ˜ç­‰ã€‚ç”šè‡³å¯ä»¥ç”¨äºåœ°å½¢ä¸Šçš„ç‰©ç†æ¨¡æ‹Ÿï¼Œç¢°æ’æˆ–åŠ¨ç”»ï¼</p><p>  Find edges, discontinuities, corners, and image features â€“ the other application that I will focus much more on is simply finding image features like edges, corners, regions of â€œdetailâ€ or texture; areas where signal changes and becomes more â€œinterestingâ€. The human visual system is actually built from many  edge detectors and local differentiators and can be thought of as a  multi-scale spatiotemporal gradient analyzer! This is biologically motivated â€“ when signal changes in space or time, it means itâ€™s a potential point of interest or a threat.</p><p>  æŸ¥æ‰¾è¾¹ç¼˜ï¼Œä¸è¿ç»­æ€§ï¼Œæ‹è§’å’Œå›¾åƒç‰¹å¾â€“æˆ‘å°†é‡ç‚¹å…³æ³¨çš„å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯ç®€å•åœ°æ‰¾åˆ°å›¾åƒç‰¹å¾ï¼Œä¾‹å¦‚è¾¹ç¼˜ï¼Œæ‹è§’ï¼Œâ€œç»†èŠ‚â€æˆ–çº¹ç†åŒºåŸŸï¼›ä¿¡å·å˜åŒ–å¹¶å˜å¾—æ›´åŠ â€œæœ‰è¶£â€çš„åŒºåŸŸã€‚äººç±»è§†è§‰ç³»ç»Ÿå®é™…ä¸Šæ˜¯ç”±è®¸å¤šè¾¹ç¼˜æ£€æµ‹å™¨å’Œå±€éƒ¨å¾®åˆ†å™¨æ„å»ºè€Œæˆçš„ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å¤šå°ºåº¦çš„æ—¶ç©ºæ¢¯åº¦åˆ†æä»ªï¼è¿™æ˜¯å‡ºäºç”Ÿç‰©å­¦åŠ¨æœºâ€“å½“ä¿¡å·åœ¨ç©ºé—´æˆ–æ—¶é—´ä¸Šå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯æ½œåœ¨çš„å…´è¶£ç‚¹æˆ–å¨èƒã€‚</p><p> The bonus use-case of just computing the gradients is finding the orientation and description of those features. This is bread and butter of any image processing, but also very common in computer graphics â€“ from morphological anti-aliasing, selectively super-sampling only edges, or special effects. I will go back to it in the description of local features in the  Structure Tensor section, but for now letâ€™s use the most common application â€“ just using the gradient vector magnitude, used for example in the  Sobel operator:  .</p><p> ä»…è®¡ç®—æ¢¯åº¦çš„é¢å¤–ç”¨ä¾‹å°±æ˜¯æ‰¾åˆ°è¿™äº›ç‰¹å¾çš„æ–¹å‘å’Œæè¿°ã€‚è¿™æ˜¯ä»»ä½•å›¾åƒå¤„ç†çš„åŸºç¡€ï¼Œä½†åœ¨è®¡ç®—æœºå›¾å½¢å­¦ä¸­ä¹Ÿå¾ˆå¸¸è§-ä»å½¢æ€å­¦æŠ—é”¯é½¿ï¼Œé€‰æ‹©æ€§åœ°ä»…å¯¹è¾¹ç¼˜è¿›è¡Œè¶…é‡‡æ ·æˆ–ç‰¹æ®Šæ•ˆæœã€‚æˆ‘å°†åœ¨â€œç»“æ„å¼ é‡â€éƒ¨åˆ†ä¸­å¯¹å±€éƒ¨ç‰¹å¾çš„æè¿°ä¸­å†æ¬¡è¿›è¡Œä»‹ç»ï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨æœ€å¸¸è§çš„åº”ç”¨ç¨‹åºâ€“ä»…ä½¿ç”¨æ¢¯åº¦çŸ¢é‡å¹…åº¦ï¼Œä¾‹å¦‚åœ¨Sobelè¿ç®—ç¬¦ä¸­ä½¿ç”¨çš„ã€‚</p><p>    Siemens star â€“ a test pattern useful to test different â€œanglesâ€ and different frequencies,</p><p>    è¥¿é—¨å­ä¹‹æ˜Ÿâ€“ä¸€ç§æµ‹è¯•æ¨¡å¼ï¼Œå¯ç”¨äºæµ‹è¯•ä¸åŒçš„â€œè§’åº¦â€å’Œä¸åŒçš„é¢‘ç‡ï¼Œ </p><p>  The Siemens star was rendered at 16x resolution and downsampled with a  sharp antialiasing filter (windowed sinc). There is some aliasing in the center, but itâ€™s ok for our use-case (we want to see a sharp signal change there and then detect it).</p><p>ä»¥16å€åˆ†è¾¨ç‡æ¸²æŸ“Siemensæ˜Ÿï¼Œå¹¶ä½¿ç”¨å°–é”çš„æŠ—æ··å æ»¤æ³¢å™¨ï¼ˆå¸¦çª—çš„sincï¼‰è¿›è¡Œé™é‡‡æ ·ã€‚ä¸­é—´æœ‰ä¸€äº›æ··å ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„ç”¨ä¾‹æ¥è¯´æ˜¯å¯ä»¥çš„ï¼ˆæˆ‘ä»¬å¸Œæœ›åœ¨é‚£é‡Œçœ‹åˆ°ä¸€ä¸ªæ€¥å‰§çš„ä¿¡å·å˜åŒ–ç„¶åæ£€æµ‹å‡ºæ¥ï¼‰ã€‚</p><p>    What I love about this solution is that it is both intuitive, naive, as well as theoretically motivated! I donâ€™t want to rephrase the wikipedia and most of readers of my blog donâ€™t care so much for formal proofs, so feel free to  have a look there, or in specialized courses ( side note: 2010s+ are amazing, with so many best professors sharing their course slides openly on the internetâ€¦). Itâ€™s basically built around the  Taylor expansion of the f(x+1) â€“ f(x).</p><p>    æˆ‘å–œæ¬¢è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„åœ°æ–¹åœ¨äºå®ƒæ—¢ç›´è§‚ï¼Œå¤©çœŸåˆå…·æœ‰ç†è®ºä¸Šçš„åŠ¨æœºï¼æˆ‘ä¸æƒ³æ”¹å†™ç»´åŸºç™¾ç§‘ï¼Œå¹¶ä¸”æˆ‘åšå®¢çš„å¤§å¤šæ•°è¯»è€…éƒ½ä¸å¤ªåœ¨ä¹å½¢å¼è¯æ˜ï¼Œå› æ­¤éšæ—¶å¯ä»¥åœ¨é‚£é‡ŒæŸ¥çœ‹æˆ–å‚åŠ ä¸“é—¨è¯¾ç¨‹ï¼ˆæ—æ³¨ï¼š2010å¹´ä»£+å¾ˆæ£’ï¼Œæœ‰å¾ˆå¤šæœ€å¥½çš„æ•™æˆåœ¨äº’è”ç½‘ä¸Šå…¬å¼€åˆ†äº«ä»–ä»¬çš„è¯¾ç¨‹å¹»ç¯ç‰‡â€¦ï¼‰ã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯å›´ç»•fï¼ˆx + 1ï¼‰â€“ fï¼ˆxï¼‰çš„æ³°å‹’å±•å¼€å»ºç«‹çš„ã€‚</p><p> This difference operator is the same as  convolving the image with a [-1, 1] filter.</p><p> æ­¤å·®åˆ†ç®—å­ä¸ä½¿ç”¨[-1ï¼Œ1]æ»¤æ³¢å™¨å¯¹å›¾åƒè¿›è¡Œå·ç§¯ç›¸åŒã€‚</p><p> Itâ€™s easy, works reasonably well, is useful. But there are two bigger problems.</p><p> è¿™å¾ˆå®¹æ˜“ï¼Œè¿ä½œå¾—ç›¸å½“å¥½ï¼Œå¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯æœ‰ä¸¤ä¸ªæ›´å¤§çš„é—®é¢˜ã€‚</p><p>  If you have  read my previous blog post â€“ on bilinear down/upsampling â€“ one of challenges might be visible right away. Convolving with an  even-sized filter,  shifts the whole image by a half a pixel.</p><p>  å¦‚æœæ‚¨å·²ç»é˜…è¯»äº†æˆ‘ä»¥å‰çš„åšå®¢æ–‡ç« -å…³äºåŒçº¿æ€§ä¸‹é‡‡æ ·/ä¸Šé‡‡æ ·-å¯èƒ½é©¬ä¸Šå°±ä¼šçœ‹åˆ°æŒ‘æˆ˜ä¹‹ä¸€ã€‚ä¸å¶æ•°å¤§å°çš„æ»¤é•œå·ç§¯ï¼Œå°†æ•´ä¸ªå›¾åƒç§»åŠ¨åŠä¸ªåƒç´ ã€‚</p><p>   Depending on the application, this can be a problem or not. â€œA solutionâ€ is simple â€“ undo it with another even sized filter. Perfect solution would be resampling, but resampling by a half pixel is surprisingly challenging (see my  another blog post), so instead we can blur it with a symmetric filter. Blurring the gradient magnitude fixes it (at the cost of blur):</p><p>   æ ¹æ®åº”ç”¨ç¨‹åºçš„ä¸åŒï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ â€œè§£å†³æ–¹æ¡ˆâ€å¾ˆç®€å•â€“ç”¨å¦ä¸€ä¸ªå¤§å°ç›¸ç­‰çš„è¿‡æ»¤å™¨å°†å…¶æ’¤æ¶ˆã€‚å®Œç¾çš„è§£å†³æ–¹æ¡ˆå°†æ˜¯é‡é‡‡æ ·ï¼Œä½†æ˜¯ä»¥åŠåƒç´ è¿›è¡Œé‡é‡‡æ ·å´å…·æœ‰ä»¤äººæƒŠè®¶çš„æŒ‘æˆ˜ï¼ˆè¯·å‚é˜…æˆ‘çš„å¦ä¸€ç¯‡åšå®¢æ–‡ç« ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯¹ç§°æ»¤é•œå¯¹å…¶è¿›è¡Œæ¨¡ç³Šå¤„ç†ã€‚æ¨¡ç³Šæ¢¯åº¦å¤§å°å¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼ˆä»¥æ¨¡ç³Šä¸ºä»£ä»·ï¼‰ï¼š</p><p>  Blurring with an even sized filter fixes the even sized shift. But one other problem might have became much more visible right now.</p><p>  ä½¿ç”¨å‡åŒ€å¤§å°çš„æ»¤é•œè¿›è¡Œæ¨¡ç³Šå¤„ç†å¯ä»¥å›ºå®šå‡åŒ€å¤§å°çš„åç§»ã€‚ä½†æ˜¯å¦ä¸€ä¸ªé—®é¢˜ç°åœ¨å¯èƒ½å·²ç»å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚ </p><p> Note: You might wonder, what would happen if we would  blur just the partial differences instead? We will see in a second.</p><p>æ³¨æ„ï¼šæ‚¨å¯èƒ½æƒ³çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬ä»…æ¨¡ç³Šéƒ¨åˆ†å·®å¼‚ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†åœ¨ä¸€ç§’é’Ÿå†…çœ‹åˆ°ã€‚</p><p>   Second problem is more severe; what happens if we compute  multiple partial derivatives; like df/dx and df/dy this way?</p><p>   ç¬¬äºŒä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚å¦‚æœæˆ‘ä»¬è®¡ç®—å¤šä¸ªåå¯¼æ•°ä¼šæ€æ ·ï¼Ÿåƒdf / dxå’Œdf / dyè¿™æ ·å—ï¼Ÿ</p><p>   Now letâ€™s have a look at the same plot again, this time focusing on â€œsymmetryâ€. This shows why itâ€™s a real, not just theoretical issue. If we look at gradients of a Siemens star and the box, we can see some  asymmetry:</p><p>   ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡çœ‹çœ‹åŒä¸€å¹…å›¾ï¼Œè¿™æ¬¡é‡ç‚¹æ˜¯â€œå¯¹ç§°æ€§â€ã€‚è¿™è¯´æ˜äº†ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸€ä¸ªç°å®çš„é—®é¢˜ï¼Œè€Œä¸ä»…ä»…æ˜¯ç†è®ºä¸Šçš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬çœ‹è¥¿é—¨å­æ˜Ÿå’Œç›’å­çš„æ¢¯åº¦ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€äº›ä¸å¯¹ç§°æ€§ï¼š</p><p>  This is definitely not good and will cause problems in image processing or computing normals, but itâ€™s even worse if we look at the gradient magnitude of a simple â€œsquareâ€ in the center of the image â€“ notice what happens to the image corners,  one corner is cut off, and another one 2x too intense!</p><p>  è¿™ç»å¯¹ä¸å¥½ï¼Œå¹¶ä¸”ä¼šåœ¨å›¾åƒå¤„ç†æˆ–è®¡ç®—æ³•çº¿ä¸­å¼•èµ·é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æŸ¥çœ‹å›¾åƒä¸­å¿ƒçš„ç®€å•â€œæ­£æ–¹å½¢â€çš„æ¢¯åº¦å¤§å°ï¼Œåˆ™æƒ…å†µæ›´ç³Ÿâ€“è¯·æ³¨æ„å›¾åƒæ‹è§’å¤„ï¼ˆä¸€ä¸ªæ‹è§’å¤„ï¼‰å‘ç”Ÿäº†ä»€ä¹ˆè¢«åˆ‡æ–­ï¼Œå¦å¤–ä¸€ä¸ª2å€å¤ªç´§ï¼</p><p> This is a big problem for any real application. We need to look at better approximations.</p><p> å¯¹äºä»»ä½•å®é™…åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦ç ”ç©¶æ›´å¥½çš„è¿‘ä¼¼å€¼ã€‚</p><p>  I mentioned that â€œblurringâ€ partial derivatives can â€œrecenterâ€ them, right? What if I told you that it is also  numerically more accurate? This is the so-called  central difference.</p><p>  æˆ‘æåˆ°â€œæ¨¡ç³Šâ€åå¯¼æ•°å¯ä»¥ä½¿å®ƒä»¬â€œå±…ä¸­â€ï¼Œå¯¹å—ï¼Ÿå¦‚æœæˆ‘å‘Šè¯‰æ‚¨å®ƒåœ¨æ•°å€¼ä¸Šä¹Ÿæ›´å‡†ç¡®æ€ä¹ˆåŠï¼Ÿè¿™å°±æ˜¯æ‰€è°“çš„ä¸­å¿ƒå·®å¼‚ã€‚</p><p> It is evaluated by  . The division by two is important and intuitively can be understood as dividing by the distance between the pixels, or the differential dx, where dx is 2x larger.</p><p> ç”±è¯„ä¼°ã€‚é™¤ä»¥2å¾ˆé‡è¦ï¼Œç›´è§‚ä¸Šå¯ä»¥ç†è§£ä¸ºé™¤ä»¥åƒç´ ä¹‹é—´çš„è·ç¦»æˆ–å·®åˆ†dxï¼Œå…¶ä¸­dxå¤§2å€ã€‚ </p><p> When forward difference was an approximation accurate to the O(h), this one is more accurate, to O(h^2). I wonâ€™t explain those terms here, but  the wikipedia has some basic intro, and in numerical methods literature you can find a more detailed explanation.</p><p>å½“å‰å‘å·®æ˜¯è¿‘ä¼¼äºOï¼ˆhï¼‰çš„è¿‘ä¼¼å€¼æ—¶ï¼Œè¯¥è¿‘ä¼¼å€¼æ›´è¿‘ä¼¼äºOï¼ˆh ^ 2ï¼‰ã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè§£é‡Šè¿™äº›æœ¯è¯­ï¼Œä½†æ˜¯ç»´åŸºç™¾ç§‘æœ‰ä¸€äº›åŸºæœ¬çš„ä»‹ç»ï¼Œåœ¨æ•°å€¼æ–¹æ³•æ–‡çŒ®ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æ›´è¯¦ç»†çš„è§£é‡Šã€‚</p><p> It is also  equivalent to â€œblurringâ€ the forward difference with a [0.5, 0.5] filter! [0.5, 0.5] o [-1, 1] leads to [-0.5, 0, 0.5]. I was initially very surprised by this connection â€“ of a more accurate, theoretically motivated Taylor expansion, and just â€œsome random ad-hoc practical blurâ€. This is even sized blur, so this also fixes the half pixel shift problem and centers both partial derivatives correctly:</p><p> è¿™ä¹Ÿç­‰æ•ˆäºç”¨[0.5ï¼Œ0.5]æ»¤æ³¢å™¨â€œæ¨¡ç³Šâ€æ­£å‘å·®å¼‚ï¼ [0.5ï¼Œ0.5] o [-1ï¼Œ1]å¯¼è‡´[-0.5ï¼Œ0ï¼Œ0.5]ã€‚æœ€åˆï¼Œæˆ‘å¯¹è¿™ç§è”ç³»æ„Ÿåˆ°éå¸¸æƒŠè®¶-æ›´ç²¾ç¡®ï¼Œç†è®ºä¸Šæœ‰åŠ¨æœºçš„æ³°å‹’å±•å¼€ï¼Œä»¥åŠâ€œä¸€äº›éšæœºçš„ä¸´æ—¶å®è·µæ¨¡ç³Šâ€ã€‚è¿™ç”šè‡³æ˜¯å¤§å°ä¸Šçš„æ¨¡ç³Šï¼Œå› æ­¤è¿™ä¹Ÿè§£å†³äº†åŠåƒç´ åç§»é—®é¢˜å¹¶ä½¿ä¸¤ä¸ªåå¯¼æ•°æ­£ç¡®å±…ä¸­ï¼š</p><p>   However, there is another problem. Notice how the gradient estimate on the pixel doesnâ€™t take pixelâ€™s value into account at all! This means that  patterns like 0 1 0 1 0 1 will haveâ€¦ zero gradient!</p><p>   ä½†æ˜¯ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚è¯·æ³¨æ„ï¼Œåƒç´ ä¸Šçš„æ¢¯åº¦ä¼°ç®—å®Œå…¨æ²¡æœ‰è€ƒè™‘åƒç´ çš„å€¼ï¼è¿™æ„å‘³ç€åƒ0 1 0 1 0 1è¿™æ ·çš„æ¨¡å¼å°†å…·æœ‰â€¦é›¶æ¢¯åº¦ï¼</p><p> This is how both methods compare on all gradients, including the â€œstripedâ€ pattern:</p><p> è¿™å°±æ˜¯ä¸¤ç§æ–¹æ³•åœ¨æ‰€æœ‰æ¢¯åº¦ï¼ˆåŒ…æ‹¬â€œæ¡çº¹â€å›¾æ¡ˆï¼‰ä¸Šè¿›è¡Œæ¯”è¾ƒçš„æ–¹å¼ï¼š</p><p>  The central difference predicts zero gradient for any 1 0 1 0-like, highest frequency (Nyquist) sequence! On Siemens star it demonstrates as missing / zero gradients just outside of the center.</p><p>  ä¸­å¿ƒå·®å¯é¢„æµ‹ä»»ä½•ç±»ä¼¼äº1 0 1 0çš„æœ€é«˜é¢‘ç‡ï¼ˆå¥ˆå¥æ–¯ç‰¹ï¼ˆNyquistï¼‰ï¼‰åºåˆ—çš„é›¶æ¢¯åº¦ï¼åœ¨è¥¿é—¨å­æ˜Ÿä¸Šï¼Œæ­£å¥½åœ¨ä¸­å¿ƒä»¥å¤–æ˜¾ç¤ºä¸ºç¼ºå°‘/é›¶æ¢¯åº¦ã€‚</p><p> We know that we have strong gradients there, and strong patterns/edges, so this is clearly not right.</p><p> æˆ‘ä»¬çŸ¥é“é‚£é‡Œæœ‰å¾ˆå¼ºçš„æ¸å˜è‰²ï¼Œè¿˜æœ‰å¾ˆå¼ºçš„å›¾æ¡ˆ/è¾¹ç¼˜ï¼Œæ‰€ä»¥è¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚</p><p> This can and will lead to some serious problems. If we look at the Siemens star, we can notice how it is nicely symmetric, but  misses gradient information in the centerâ€¦</p><p> è¿™å¯èƒ½ä¼šå¹¶ä¼šå¯¼è‡´ä¸€äº›ä¸¥é‡çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬çœ‹è¥¿é—¨å­æ˜Ÿï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°å®ƒå¾ˆå¥½åœ°å¯¹ç§°ï¼Œä½†æ˜¯å´é”™è¿‡äº†ä¸­å¿ƒçš„æ¢¯åº¦ä¿¡æ¯â€¦â€¦ </p><p>  Itâ€™s worth mentioning here what is the commonly used  Sobel filter. Sobel filter is nothing more or less than central difference that is blurred (with a binomial filter approximation of Gaussian) in the direction perpendicular to evaluated gradient, so something like:</p><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ä»€ä¹ˆæ˜¯å¸¸ç”¨çš„Sobelæ»¤æ³¢å™¨ã€‚ Sobelæ»¤æ³¢å™¨æ— éæ˜¯åœ¨å‚ç›´äºè¯„ä¼°æ¢¯åº¦çš„æ–¹å‘ä¸Šè¢«æ¨¡ç³Šï¼ˆå…·æœ‰é«˜æ–¯äºŒé¡¹å¼æ»¤æ³¢å™¨è¿‘ä¼¼ï¼‰çš„ä¸­å¿ƒå·®æ‰€å¼•èµ·çš„ï¼Œæ‰€ä»¥ç±»ä¼¼ï¼š</p><p>  The practical motivation for it in Sobel filter is a) filtering out some noise and tendency to be sensitive to single pixel gradients that are not very visible, and more importantly b)  its blurring introduces more â€œisotropicâ€ behavior (you will see below how â€œdiagonalsâ€ and â€œcornersâ€ are closer magnitude to the horizontal/vertical edges).</p><p>  åœ¨Sobelæ»¤æ³¢å™¨ä¸­è¿›è¡Œæ­¤æ“ä½œçš„å®é™…åŠ¨æœºæ˜¯ï¼šaï¼‰æ»¤é™¤ä¸€äº›å™ªå£°å’Œå¯¹ä¸å¤ªæ˜æ˜¾çš„å•ä¸ªåƒç´ æ¸å˜æ•æ„Ÿçš„è¶‹åŠ¿ï¼Œæ›´é‡è¦çš„æ˜¯bï¼‰å®ƒçš„æ¨¡ç³Šå¼•å…¥äº†æ›´å¤šçš„â€œå„å‘åŒæ€§â€è¡Œä¸ºï¼ˆæ‚¨å°†åœ¨ä¸‹é¢çœ‹åˆ°â€œå¯¹è§’çº¿â€å’Œâ€œè§’çº¿â€çš„å¹…åº¦æ›´æ¥è¿‘æ°´å¹³/å‚ç›´è¾¹ç¼˜ï¼‰ã€‚</p><p> Sobel operator would compare to the central difference (comparing those due to the largest similarity):</p><p> Sobelè¿ç®—ç¬¦å°†ä¸ä¸­å¿ƒå·®å¼‚è¿›è¡Œæ¯”è¾ƒï¼ˆæ¯”è¾ƒç›¸ä¼¼åº¦æœ€å¤§çš„å·®å¼‚ï¼‰ï¼š</p><p>   Mentioning isotropic or anisotropic response on grids is always weird to me. Why? Because the Nyquist frequencies are not isotropic or radial, they form a box. This means that we can represent higher frequencies on the diagonals than the principal axes. I have covered in  an older post of mine how  this property can be used in checkerboard rendering by rotating the sample grid (used for example in many Playstation 4 Pro to achieve 4K rendering with spatiotemporal upsampling). But any analysis becomes â€œweirdâ€ and I often see discussions of whether separable sinc is â€œthe bestâ€ filter for images, as opposed to  rotationally symmetric jinc.</p><p>   åœ¨ç½‘æ ¼ä¸Šæåˆ°å„å‘åŒæ€§æˆ–å„å‘å¼‚æ€§å“åº”å¯¹æˆ‘æ¥è¯´æ€»æ˜¯å¾ˆå¥‡æ€ªã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå¥ˆå¥æ–¯ç‰¹é¢‘ç‡ä¸æ˜¯å„å‘åŒæ€§æˆ–å¾„å‘çš„ï¼Œæ‰€ä»¥å®ƒä»¬å½¢æˆä¸€ä¸ªç›’å­ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è§’çº¿ä¸Šä»£è¡¨æ¯”ä¸»è½´æ›´é«˜çš„é¢‘ç‡ã€‚æˆ‘åœ¨æˆ‘çš„è¾ƒæ—©çš„æ–‡ç« ä¸­ä»‹ç»äº†å¦‚ä½•é€šè¿‡æ—‹è½¬ç¤ºä¾‹ç½‘æ ¼ï¼ˆä¾‹å¦‚åœ¨è®¸å¤šPlaystation 4 Proä¸­ä½¿ç”¨æ­¤å±æ€§ä»¥æ—¶ç©ºä¸Šé‡‡æ ·æ¥å®ç°4Kæ¸²æŸ“ï¼‰åœ¨æ£‹ç›˜æ ¼æ¸²æŸ“ä¸­ä½¿ç”¨æ­¤å±æ€§ã€‚ä½†æ˜¯ä»»ä½•åˆ†æéƒ½å˜å¾—â€œæ€ªå¼‚â€ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°å…³äºå¯åˆ†ç¦»Sincæ˜¯å¦æ˜¯â€œæœ€ä½³â€å›¾åƒæ»¤æ³¢å™¨çš„è®¨è®ºï¼Œè€Œä¸æ˜¯æ—‹è½¬å¯¹ç§°Jincã€‚</p><p> I donâ€™t have an easy answer for how important it is for the image gradients, and the question is â€œit dependsâ€. Do you care about detecting higher frequency diagonal gradient as stronger gradients or not? Whatâ€™s the use-case? I havenâ€™t thought about it in the context of normal mapping, as this could lead to â€œweirdâ€ curvatures, but Iâ€™m not sure. I might come back to it out of personal curiosity at some point, so please let me know in the comments what are your thoughts and/or experiences.</p><p> å¯¹äºå›¾åƒæ¸å˜çš„é‡è¦æ€§ï¼Œæˆ‘æ²¡æœ‰ä¸€ä¸ªç®€å•çš„ç­”æ¡ˆï¼Œé—®é¢˜æ˜¯â€œå–å†³äºâ€ã€‚æ‚¨æ˜¯å¦å…³å¿ƒå°†è¾ƒé«˜é¢‘ç‡çš„å¯¹è§’çº¿æ¢¯åº¦æ£€æµ‹ä¸ºè¾ƒå¼ºçš„æ¢¯åº¦ï¼Ÿç”¨ä¾‹æ˜¯ä»€ä¹ˆï¼Ÿåœ¨æ³•çº¿è´´å›¾çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘è¿˜æ²¡æœ‰è€ƒè™‘è¿‡è¿™ä¸€ç‚¹ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´â€œæ€ªå¼‚â€çš„æ›²ç‡ï¼Œä½†æˆ‘ä¸ç¡®å®šã€‚å‡ºäºä¸ªäººå¥½å¥‡å¿ƒï¼Œæˆ‘å¯èƒ½ä¼šåœ¨æŸäº›æ—¶å€™å†æ¬¡æåŠå®ƒï¼Œå› æ­¤è¯·åœ¨è¯„è®ºä¸­è®©æˆ‘çŸ¥é“æ‚¨çš„æƒ³æ³•å’Œ/æˆ–ç»å†ã€‚</p><p>  Notice that as you can use the central difference for increase of the accuracy of the forward difference / higher order approximation, you can  go even further and further,  adding more taps to your derivative-approximating filter!</p><p>  è¯·æ³¨æ„ï¼Œç”±äºæ‚¨å¯ä»¥ä½¿ç”¨ä¸­å¿ƒå·®æ¥æé«˜å‰å‘å·®/é«˜é˜¶è¿‘ä¼¼çš„ç²¾åº¦ï¼Œå› æ­¤æ‚¨å¯ä»¥èµ°å¾—æ›´è¿œï¼Œåœ¨æ´¾ç”Ÿè¿‘ä¼¼æ»¤æ³¢å™¨ä¸­æ·»åŠ æ›´å¤šæŠ½å¤´ï¼</p><p> They can help with disappearing high frequency gradients, but your gradients become less and less localized in space. This is the connection to wavelets, audio, STFT and other areas that I mentioned.</p><p> å®ƒä»¬å¯ä»¥å¸®åŠ©æ¶ˆé™¤é«˜é¢‘æ¢¯åº¦ï¼Œä½†æ˜¯æ‚¨çš„æ¢¯åº¦åœ¨ç©ºé—´ä¸­çš„ä½ç½®è¶Šæ¥è¶Šå°‘ã€‚è¿™æ˜¯æˆ‘æåˆ°çš„ä¸å°æ³¢ï¼ŒéŸ³é¢‘ï¼ŒSTFTå’Œå…¶ä»–åŒºåŸŸçš„è¿æ¥ã€‚ </p><p> I also like to think of it intuitively as half pixel resampling of the [-1, 1] filter. ğŸ™‚ For example if you were to  resample [-1, 1] with a half pixel shifting larger sinc filter, youâ€™d get similar behavior:</p><p>æˆ‘è¿˜å–œæ¬¢ç›´è§‚åœ°å°†å…¶è§†ä¸º[-1ï¼Œ1]æ»¤é•œçš„åŠåƒç´ é‡é‡‡æ ·ã€‚ ğŸ™‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¦å¯¹[-1ï¼Œ1]è¿›è¡Œé‡æ–°é‡‡æ ·ï¼Œå¹¶ç§»åŠ¨è¾ƒå¤§çš„sincæ»¤é•œåŠä¸ªåƒç´ ï¼Œåˆ™ä¼šå¾—åˆ°ç±»ä¼¼çš„è¡Œä¸ºï¼š</p><p>   With all this background, itâ€™s finally time for the main suggestion of the post.</p><p>   åœ¨æ‰€æœ‰è¿™äº›èƒŒæ™¯ä¸‹ï¼Œç°åœ¨æ˜¯è¯¥å¸–å­çš„ä¸»è¦å»ºè®®çš„æ—¶å€™äº†ã€‚</p><p> This is something I have learned from my coworkers who worked on the  BLADE project (approximating image operations with discrete learned filters), and then we used in our work that materialized as the  Handheld Multiframe Super-Resolution paper and  Super-Res Zoom Pixel 3 project that I had a pleasure of leading.</p><p> è¿™æ˜¯æˆ‘ä»BLADEé¡¹ç›®çš„åŒäº‹é‚£é‡Œå­¦åˆ°çš„ï¼ˆä½¿ç”¨ç¦»æ•£çš„å­¦ä¹ æ»¤é•œè¿‘ä¼¼å›¾åƒæ“ä½œï¼‰ï¼Œç„¶åæˆ‘ä»¬åœ¨å·¥ä½œä¸­ä½¿ç”¨äº†æ‰‹æŒå¤šå¸§è¶…åˆ†è¾¨ç‡çº¸å’ŒSuper-Res Zoom Pixel 3é¡¹ç›®ã€‚æˆ‘å¾ˆé«˜å…´é¢†å¯¼ã€‚</p><p> I get a lot of questions about this part of the paper in some emails as well, so I think itâ€™s not a very commonly known â€œtrickâ€. If you know where it might have originated and domains that use it more often, please let me know.</p><p> åœ¨ä¸€äº›ç”µå­é‚®ä»¶ä¸­ï¼Œæˆ‘ä¹Ÿå¯¹æœ¬æ–‡çš„è¿™ä¸€éƒ¨åˆ†æœ‰å¾ˆå¤šç–‘é—®ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªéå¸¸æ™®éçš„â€œæŠ€å·§â€ã€‚å¦‚æœæ‚¨çŸ¥é“å®ƒçš„èµ·æºå’Œä½¿ç”¨å®ƒçš„åŸŸè¶Šæ¥è¶Šå¤šï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p><p> Edit:  Don Williamson has noticed on twitter that itâ€™s known as  Robertâ€™s Cross and was developed in 1963!</p><p> ç¼–è¾‘ï¼šå”Â·å¨å»‰å§†æ£®ï¼ˆDon Williamsonï¼‰åœ¨æ¨ç‰¹ä¸Šæ³¨æ„åˆ°å®ƒçš„åå­—å«ç½—ä¼¯ç‰¹Â·å…‹ç½—æ–¯ï¼ˆRobertâ€™s Crossï¼‰ï¼Œå®ƒæ˜¯1963å¹´å¼€å‘çš„ï¼</p><p> The idea here is to  compute gradients on the diagonals. For example in 2D (note that it extends to higher dimensions!):</p><p> è¿™é‡Œçš„æƒ³æ³•æ˜¯è®¡ç®—å¯¹è§’çº¿ä¸Šçš„æ¢¯åº¦ã€‚ä¾‹å¦‚åœ¨2Dä¸­ï¼ˆè¯·æ³¨æ„ï¼Œå®ƒä¼šæ‰©å±•åˆ°æ›´é«˜çš„å°ºå¯¸ï¼ï¼‰ï¼š</p><p>  We can see that with the diagonal difference, both partial derivative approximations are centered in the same point. We compute those just like forward differences, but need to compensate for larger distance, sqrt(2), size of the diagonal of the pixels, so   and  .</p><p>  æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¯¹è§’çº¿å·®çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªåå¯¼æ•°è¿‘ä¼¼å€¼éƒ½ä½äºåŒä¸€ç‚¹çš„ä¸­å¿ƒã€‚æˆ‘ä»¬åƒå‰å‘å·®ä¸€æ ·è®¡ç®—å®ƒä»¬ï¼Œä½†æ˜¯éœ€è¦è¡¥å¿æ›´å¤§çš„è·ç¦»ï¼Œsqrtï¼ˆ2ï¼‰ï¼Œåƒç´ å¯¹è§’çº¿çš„å¤§å°ï¼Œæ‰€ä»¥å’Œã€‚ </p><p> If you use gradients like this you can â€œrotate itâ€ for normals. For just gradient magnitude you donâ€™t need to do anything special, itâ€™s computed the same way (length of the vector)!</p><p>å¦‚æœä½¿ç”¨è¿™æ ·çš„æ¸å˜ï¼Œåˆ™å¯ä»¥â€œæ—‹è½¬â€æ³•çº¿ã€‚å¯¹äºæ¢¯åº¦å¹…åº¦ï¼Œæ‚¨æ— éœ€æ‰§è¡Œä»»ä½•ç‰¹æ®Šæ“ä½œï¼Œå®ƒçš„è®¡ç®—æ–¹æ³•ç›¸åŒï¼ˆå‘é‡çš„é•¿åº¦ï¼‰ï¼</p><p> Gradient computed like this doesnâ€™t have missing high frequency gradients problems; nor asymmetry problems:</p><p> è¿™æ ·è®¡ç®—å‡ºæ¥çš„æ¢¯åº¦ä¸ä¼šç¼ºå°‘é«˜é¢‘æ¢¯åº¦é—®é¢˜ï¼›ä¹Ÿä¸å­˜åœ¨ä¸å¯¹ç§°é—®é¢˜ï¼š</p><p>  It has the problem of pixel shift, and some anisotropy, but the pixel shift can be easily fixed.</p><p>  å®ƒå…·æœ‰åƒç´ åç§»å’ŒæŸäº›å„å‘å¼‚æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯åƒç´ åç§»å¯ä»¥å¾ˆå®¹æ˜“åœ°å›ºå®šã€‚</p><p>    This means sum all the squared gradients, and divide by 4 (number of gradient pairs) â€“ all very efficient operations. Then you just take the square root and get the gradient magnitude.</p><p>    è¿™æ„å‘³ç€å°†æ‰€æœ‰å¹³æ–¹æ¢¯åº¦æ±‚å’Œï¼Œç„¶åé™¤ä»¥4ï¼ˆæ¢¯åº¦å¯¹çš„æ•°é‡ï¼‰ï¼Œè¿™éƒ½æ˜¯éå¸¸æœ‰æ•ˆçš„æ“ä½œã€‚ç„¶åï¼Œæ‚¨åªéœ€å–å¹³æ–¹æ ¹å¹¶è·å¾—æ¢¯åº¦é‡å€¼ã€‚</p><p> This fixes the problem of phase shift and IMO is the best of all alternatives discussed so far:</p><p> è¿™è§£å†³äº†ç›¸ç§»é—®é¢˜ï¼Œè€ŒIMOæ˜¯è¿„ä»Šä¸ºæ­¢è®¨è®ºçš„æ‰€æœ‰æ›¿ä»£æ–¹æ¡ˆä¸­æœ€å¥½çš„ï¼š</p><p>  Diagonal differences detect high frequencies properly, donâ€™t have a pixel shift problem, and while they show perfect isotropy, in practice it is often â€œgood enoughâ€.</p><p>  å¯¹è§’çº¿å·®å¼‚å¯ä»¥æ­£ç¡®æ£€æµ‹é«˜é¢‘ï¼Œä¸å­˜åœ¨åƒç´ åç§»é—®é¢˜ï¼Œå°½ç®¡å®ƒä»¬è¡¨ç°å‡ºå®Œç¾çš„å„å‘åŒæ€§ï¼Œä½†å®é™…ä¸Šé€šå¸¸â€œè¶³å¤Ÿå¥½â€ã€‚</p><p> Some blurring is on the one hand reducing the â€œlocalizationâ€, but on the other hand it can be desired and  improve robustness to noise and single pixel gradients.</p><p> ä¸€æ–¹é¢æœ‰äº›æ¨¡ç³Šä¼šé™ä½â€œå®šä½â€ï¼Œä½†å¦ä¸€æ–¹é¢è¿™å¯èƒ½æ˜¯ç†æƒ³çš„ï¼Œå®ƒå¯ä»¥æé«˜å¯¹å™ªå£°å’Œå•ä¸ªåƒç´ æ¸å˜çš„é²æ£’æ€§ã€‚ </p><p>  With just a few lines of code (and some extra computationâ€¦) we can extract even more information from it!</p><p>ä»…éœ€å‡ è¡Œä»£ç ï¼ˆä»¥åŠä¸€äº›é¢å¤–çš„è®¡ç®—â€¦â€¦ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ä¸­æå–æ›´å¤šä¿¡æ¯ï¼</p><p>  We have a â€œbagâ€ or gradient values for a bunch of pixelsâ€¦ What if we tried to  find a least squares solution to â€œwhat is the dominant gradient direction in the neighborhoodâ€?</p><p>  æˆ‘ä»¬æœ‰ä¸€å †åƒç´ çš„â€œè¢‹â€æˆ–æ¢¯åº¦å€¼â€¦â€¦å¦‚æœæˆ‘ä»¬è¯•å›¾æ‰¾åˆ°â€œé™„è¿‘çš„ä¸»è¦æ¢¯åº¦æ–¹å‘æ˜¯ä»€ä¹ˆâ€çš„æœ€å°äºŒä¹˜è§£ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p> I am not great at math derivations, but  hereâ€™s an elegant explanation of the  structure tensor. Structure tensor is a  Gram matrix of the gradients (vector of â€œstackedâ€ gradients multiplied by its transpose).</p><p> æˆ‘åœ¨æ•°å­¦æ¨å¯¼æ–¹é¢å¹¶ä¸æ“…é•¿ï¼Œä½†è¿™æ˜¯å¯¹ç»“æ„å¼ é‡çš„ä¼˜é›…è§£é‡Šã€‚ç»“æ„å¼ é‡æ˜¯æ¢¯åº¦çš„GramçŸ©é˜µï¼ˆâ€œå †å â€æ¢¯åº¦çš„çŸ¢é‡ä¹˜ä»¥å…¶è½¬ç½®ï¼‰ã€‚</p><p> Lots of difficult words, but in essence itâ€™s a very simple 2Ã—2 matrix, where entries are averages of dx^2, dy^2 on the diagonal, and dx*dy on the off diagonal:</p><p> è®¸å¤šå›°éš¾çš„å•è¯ï¼Œä½†ä»æœ¬è´¨ä¸Šè®²ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„2Ã—2çŸ©é˜µï¼Œå…¶ä¸­çš„æ¡ç›®æ˜¯dx ^ 2ï¼Œdy ^ 2åœ¨å¯¹è§’çº¿ä¸Šçš„å¹³å‡å€¼å’Œdx * dyåœ¨éå¯¹è§’çº¿ä¸Šçš„å¹³å‡å€¼ï¼š</p><p>  Now if we do  eigendecomposition of this matrix (which is always possible for a Gram matrix â€“ symmetric, positive semidefinite), we get the following  simple closed forms for the eigenvalues:</p><p>  ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å¯¹è¯¥çŸ©é˜µè¿›è¡Œç‰¹å¾åˆ†è§£ï¼ˆå¯¹äºGramçŸ©é˜µå§‹ç»ˆæ˜¯å¯èƒ½çš„â€“å¯¹ç§°ï¼Œæ­£åŠå®šæ•°ï¼‰ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹ç®€å•çš„ç‰¹å¾å€¼å°é—­å½¢å¼ï¼š</p><p>    You might want to normalize the vectors; in the case of the off-diagonal Gram matrix entry of zero, the eigenvectors are simply coordinate system principal axes (1, 0) and (0, 1) (be sure to â€œsortâ€ them in that case though , same for underdetermined systems, where the ordering doesnâ€™t matter.</p><p>    æ‚¨å¯èƒ½è¦å¯¹å‘é‡è¿›è¡Œå½’ä¸€åŒ–ï¼›åœ¨éå¯¹è§’çº¿GramçŸ©é˜µé¡¹ä¸ºé›¶çš„æƒ…å†µä¸‹ï¼Œç‰¹å¾å‘é‡ä»…æ˜¯åæ ‡ç³»ä¸»è½´ï¼ˆ1ã€0ï¼‰å’Œï¼ˆ0ã€1ï¼‰ï¼ˆå°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·åŠ¡å¿…å¯¹å®ƒä»¬è¿›è¡Œâ€œæ’åºâ€ï¼Œå¯¹äºæ¬ å®šç³»ç»Ÿä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ ï¼Œé¡ºåºæ— å…³ç´§è¦ã€‚</p><p> Larger eigenvalue and associated eigenvector describe the direction and magnitude of the gradient in dominant direction; it gives us both its orientation and how strong the gradient is in that specific direction.</p><p> è¾ƒå¤§çš„ç‰¹å¾å€¼å’Œç›¸å…³çš„ç‰¹å¾å‘é‡æè¿°äº†ä¸»å¯¼æ–¹å‘ä¸Šæ¢¯åº¦çš„æ–¹å‘å’Œå¤§å°ï¼›å®ƒæ—¢ä¸ºæˆ‘ä»¬æä¾›äº†æ–¹å‘ï¼Œåˆä¸ºæˆ‘ä»¬æä¾›äº†è¯¥ç‰¹å®šæ–¹å‘ä¸Šçš„æ¸å˜å¼ºåº¦ã€‚ </p><p> The second, smaller eigenvalue and perpendicular, second eigenvector gives us  information about the gradient in the perpendicular direction.</p><p>ç¬¬äºŒä¸ªè¾ƒå°çš„ç‰¹å¾å€¼å’Œå‚ç›´çš„ç¬¬äºŒä¸ªç‰¹å¾å‘é‡ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³å‚ç›´æ–¹å‘ä¸Šçš„æ¢¯åº¦çš„ä¿¡æ¯ã€‚</p><p> Together this is really cool, as it allows us to distinguish edges, corners, regions with texture, as well as orientation of edges. In our  Handheld Multiframe Super-Resolution paper we used two â€œderivedâ€ properties â€“  strength (simply the square root of the structure tensor dominant eigenvalue) describing how strong is the gradient locally, and  coherence computed as  . (Note: the original version of the paper had a mistake in the definition of the coherence, a result of late edits for the camera ready version of the paper that we missed. This value has to be between 0 and 1).</p><p> åœ¨ä¸€èµ·è¿™çœŸçš„å¾ˆé…·ï¼Œå› ä¸ºå®ƒä½¿æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†è¾¹ç¼˜ï¼Œæ‹è§’ï¼Œå…·æœ‰çº¹ç†çš„åŒºåŸŸä»¥åŠè¾¹ç¼˜çš„æ–¹å‘ã€‚åœ¨æˆ‘ä»¬çš„ã€Šæ‰‹æŒå¼å¤šå¸§è¶…åˆ†è¾¨ç‡ã€‹è®ºæ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªâ€œæ´¾ç”Ÿâ€å±æ€§-å¼ºåº¦ï¼ˆä»…æ˜¯ç»“æ„å¼ é‡ä¸»å¯¼ç‰¹å¾å€¼çš„å¹³æ–¹æ ¹ï¼‰æè¿°äº†å±€éƒ¨æ¢¯åº¦çš„å¼ºåº¦ï¼Œè€Œç›¸å¹²æ€§è®¡ç®—ä¸ºã€‚ ï¼ˆæ³¨æ„ï¼šè®ºæ–‡çš„åŸå§‹ç‰ˆæœ¬åœ¨è¿è´¯æ€§çš„å®šä¹‰ä¸Šæœ‰è¯¯ï¼Œè¿™æ˜¯ç”±äºæˆ‘ä»¬é”™è¿‡äº†å¯¹ç›¸æœºå‡†å¤‡å¥½çš„ç‰ˆæœ¬çš„åæœŸç¼–è¾‘è€Œå¯¼è‡´çš„ç»“æœã€‚è¯¥å€¼å¿…é¡»åœ¨0åˆ°1ä¹‹é—´ï¼‰ã€‚</p><p> Coherence is a bit more uncommon; it describes how much stronger is the dominant direction over the perpendicular one.</p><p> è¿è´¯æ€§ä¸å¸¸è§ã€‚å®ƒæè¿°äº†ä¸»å¯¼æ–¹å‘æ¯”å‚ç›´æ–¹å‘å¼ºå¤šå°‘ã€‚</p><p> By analyzing the eigenvector (any of them is fine, since they are perpendicular), we can get information about the dominant gradient orientation.</p><p> é€šè¿‡åˆ†æç‰¹å¾å‘é‡ï¼ˆç”±äºå®ƒä»¬æ˜¯å‚ç›´çš„ï¼Œå®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½æ˜¯å¾ˆå¥½çš„ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æœ‰å…³ä¸»å¯¼æ¢¯åº¦æ–¹å‘çš„ä¿¡æ¯ã€‚</p><p> In the case of our test signals that are comprised of simple frequencies, those look as follow (please ignore the behavior on borders/boundaries between images in my quick and dirty implementation):</p><p> åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¿¡å·ç”±ç®€å•é¢‘ç‡ç»„æˆçš„æƒ…å†µä¸‹ï¼Œè¿™äº›ä¿¡å·å¦‚ä¸‹æ‰€ç¤ºï¼ˆåœ¨æˆ‘å¿«é€Ÿè€Œè‚®è„çš„å®ç°ä¸­ï¼Œè¯·å¿½ç•¥å›¾åƒä¹‹é—´çš„è¾¹ç•Œ/è¾¹ç•Œä¸Šçš„è¡Œä¸ºï¼‰ï¼š</p><p>  Hereâ€™s some other example on an actual image, with a remapping often used for displaying vectors â€“ hue defined by the angle, and saturation by the gradient strength:</p><p>  è¿™æ˜¯å®é™…å›¾åƒä¸Šçš„å…¶ä»–ç¤ºä¾‹ï¼Œé€šå¸¸ä½¿ç”¨é‡æ˜ å°„æ¥æ˜¾ç¤ºçŸ¢é‡-ç”±è§’åº¦å®šä¹‰çš„è‰²ç›¸ï¼Œç”±æ¢¯åº¦å¼ºåº¦å®šä¹‰çš„é¥±å’Œåº¦ï¼š</p><p>  Such analysis is important for both edge-aware, non-linear image processing, as well as in computer vision. Structure tensor is a part of  Harris corner detector, which used to be probably the most common computer vision question prior to the whole deep learning revolution. ğŸ™‚ (Still, if youâ€™re looking for a job in the field even today, I suggest not skipping on such fundamentals as interviewers can still ask for classic approaches to verify how much of the background you understand!)</p><p>  è¿™æ ·çš„åˆ†æå¯¹äºè¾¹ç¼˜æ„ŸçŸ¥çš„éçº¿æ€§å›¾åƒå¤„ç†ä»¥åŠè®¡ç®—æœºè§†è§‰éƒ½éå¸¸é‡è¦ã€‚ç»“æ„å¼ é‡æ˜¯Harrisè§’ç‚¹æ£€æµ‹å™¨çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ›¾ç»æ˜¯æ•´ä¸ªæ·±åº¦å­¦ä¹ é©å‘½ä¹‹å‰æœ€å¸¸è§çš„è®¡ç®—æœºè§†è§‰é—®é¢˜ã€‚ ğŸ™‚ï¼ˆä¸è¿‡ï¼Œå³ä½¿æ‚¨ä»Šå¤©ä»åœ¨å®åœ°å¯»æ‰¾å·¥ä½œï¼Œæˆ‘è¿˜æ˜¯å»ºè®®æ‚¨ä¸è¦è·³è¿‡ä¸€äº›åŸºæœ¬çŸ¥è¯†ï¼Œå› ä¸ºé¢è¯•å®˜ä»ç„¶å¯ä»¥è¦æ±‚é‡‡ç”¨ç»å…¸æ–¹æ³•æ¥éªŒè¯æ‚¨äº†è§£å¤šå°‘èƒŒæ™¯çŸ¥è¯†ï¼ï¼‰ </p><p>  One thing that is worth mentioning is how to â€œfixâ€ the rotation of  structure tensor from diagonal gradients. If you compute the angle through arctan, this is not something youâ€™d care about (just add value to your angle), but in scenarios where you need higher computational efficiency,  you donâ€™t want to be doing any inverse trigonometry, and this matters a lot. Luckily, rotating Gram or covariance matrices is super easy! Formula for rotating a covariance matrix is simply  . Constructing a rotation matrix by 45 degree from angle formula, we get first:</p><p>å€¼å¾—ä¸€æçš„æ˜¯å¦‚ä½•ä»å¯¹è§’çº¿æ¸å˜â€œå›ºå®šâ€ç»“æ„å¼ é‡çš„æ—‹è½¬ã€‚å¦‚æœé€šè¿‡arctanè®¡ç®—è§’åº¦ï¼Œè¿™ä¸æ˜¯æ‚¨å…³å¿ƒçš„é—®é¢˜ï¼ˆåªéœ€ä¸ºè§’åº¦æ·»åŠ å€¼ï¼‰ï¼Œä½†æ˜¯åœ¨éœ€è¦æ›´é«˜è®¡ç®—æ•ˆç‡çš„æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦è¿›è¡Œä»»ä½•åä¸‰è§’è¿ç®—ï¼Œå¹¶ä¸”è‡³å…³é‡è¦ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ—‹è½¬Gramæˆ–åæ–¹å·®çŸ©é˜µéå¸¸ç®€å•ï¼æ—‹è½¬åæ–¹å·®çŸ©é˜µçš„å…¬å¼å¾ˆç®€å•ã€‚ä»è§’åº¦å…¬å¼ä»¥45åº¦æ„é€ æ—‹è½¬çŸ©é˜µï¼Œæˆ‘ä»¬é¦–å…ˆå¾—åˆ°ï¼š</p><p>    ( Note: worth double checking my math. But it makes sense that having exactly the same 4 diagonal elements cancels them and suggests a vertical only or diagonal only gradient!)</p><p>    ï¼ˆæ³¨æ„ï¼šå€¼å¾—ä»”ç»†æ£€æŸ¥ä¸€ä¸‹æˆ‘çš„æ•°å­¦ã€‚ä½†æ˜¯ï¼Œå…·æœ‰å®Œå…¨ç›¸åŒçš„4ä¸ªå¯¹è§’çº¿å…ƒç´ ä¼šå–æ¶ˆå®ƒä»¬ï¼Œå¹¶å»ºè®®ä½¿ç”¨ä»…å‚ç›´æˆ–ä»…å¯¹è§’çº¿æ¸å˜ï¼ï¼‰</p><p>  Before I conclude the post, I couldnâ€™t resist looking at comparing the forward differences and central differences from the perspective of signal processing.</p><p>  åœ¨ç»“æŸæœ¬æ–‡ä¹‹å‰ï¼Œæˆ‘ä¸ç¦ä»ä¿¡å·å¤„ç†çš„è§’åº¦æ¯”è¾ƒå‰å‘å·®å¼‚å’Œä¸­å¿ƒå·®å¼‚ã€‚</p><p> Itâ€™s probably a bit unorthodox and most people donâ€™t look at it this way, but I couldnâ€™t stop thinking about the disappearing high frequencies;  ideal differentiator of continuous signals should have â€œinfiniteâ€ frequency response as frequencies go to infinity!</p><p> è¿™å¯èƒ½æœ‰ç‚¹ä¸åˆå¸¸è§„ï¼Œå¹¶ä¸”å¤§å¤šæ•°äººä¸æ˜¯è¿™æ ·çœ‹çš„ï¼Œä½†æ˜¯æˆ‘ä¸èƒ½åœæ­¢æ€è€ƒé«˜é¢‘æ¶ˆå¤±çš„é—®é¢˜ã€‚å½“é¢‘ç‡è¾¾åˆ°æ— ç©·å¤§æ—¶ï¼Œç†æƒ³çš„è¿ç»­ä¿¡å·å¾®åˆ†å™¨åº”å…·æœ‰â€œæ— é™â€çš„é¢‘ç‡å“åº”ï¼</p><p> Obviously frequencies can go only up to Nyquist in the discrete domain. But letâ€™s have a look at the frequency response of the forward difference convolution filter and the central difference:</p><p> æ˜¾ç„¶ï¼Œåœ¨ç¦»æ•£åŸŸä¸­ï¼Œé¢‘ç‡åªèƒ½ä¸Šå‡åˆ°å¥ˆå¥æ–¯ç‰¹ã€‚ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å‰å‘å·®åˆ†å·ç§¯æ»¤æ³¢å™¨çš„é¢‘ç‡å“åº”å’Œä¸­å¿ƒå·®åˆ†ï¼š</p><p>  The central difference convolution filter has zero frequency response at Nyquist and seems to match the frequency response worse than a simple forward difference filter with increasing frequencies.  This is the â€œcostâ€ we pay for compensating for the phase shift.</p><p>  ä¸­å¤®å·®åˆ†å·ç§¯æ»¤æ³¢å™¨åœ¨Nyquistå¤„çš„é¢‘ç‡å“åº”ä¸ºé›¶ï¼Œå¹¶ä¸”ä¼¼ä¹æ¯”ç®€å•çš„å‰å‘å·®åˆ†æ»¤æ³¢å™¨éšé¢‘ç‡å¢åŠ è€Œä½¿é¢‘ç‡å“åº”æ›´å·®ã€‚è¿™æ˜¯æˆ‘ä»¬ä¸ºè¡¥å¿ç›¸ç§»è€Œä»˜å‡ºçš„â€œæˆæœ¬â€ã€‚</p><p> But given this frequency response, it makes sense that a sequence of 1 0 1 0 completely â€œdisappearsâ€, as it is exactly at Nyquist, where the response is zero!</p><p> ä½†æ˜¯ç»™å®šè¯¥é¢‘ç‡å“åº”ï¼Œæœ‰æ„ä¹‰çš„æ˜¯å®Œå…¨â€œæ¶ˆå¤±â€äº†ä¸€ä¸ª1 0 1 0åºåˆ—ï¼Œæ­£å¥½åœ¨å¥ˆå¥æ–¯ç‰¹ï¼ˆNyquistï¼‰ï¼Œå“åº”ä¸ºé›¶ï¼ </p><p> Finally, if we look at higher order / more filter tap gradient approximations, we can see that it definitely improves for most mid-high frequencies, but the behavior when approaching Nyquist is still a problem:</p><p>æœ€åï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹æ›´é«˜é˜¶/æ›´å¤šé˜¶çš„æ»¤æ³¢å™¨æŠ½å¤´æ¢¯åº¦è¿‘ä¼¼å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒå¯¹äºå¤§å¤šæ•°ä¸­é«˜é¢‘è‚¯å®šæœ‰æ‰€æ”¹å–„ï¼Œä½†æ˜¯æ¥è¿‘å¥ˆå¥æ–¯ç‰¹æ—¶çš„è¡Œä¸ºä»ç„¶æ˜¯ä¸€ä¸ªé—®é¢˜ï¼š</p><p>  Ok, with 9 taps we get better and better behavior and closer to the differentiator line.</p><p>  å¥½çš„ï¼Œé€šè¿‡9æ¬¡æŠ½å¤´ï¼Œæˆ‘ä»¬å°†è·å¾—è¶Šæ¥è¶Šå¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”æ›´åŠ æ¥è¿‘å¾®åˆ†çº¿ã€‚</p><p> At the same time, the convergence is slow and we wonâ€™t be able to recover the exact Nyquist:</p><p> åŒæ—¶ï¼Œæ”¶æ•›é€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å°†æ— æ³•æ¢å¤ç¡®åˆ‡çš„å¥ˆå¥æ–¯ç‰¹ï¼š</p><p>  This is due to â€œperfectâ€ resampling having frequency response of 0 at Nyquist. Whether this is a problem or not depends on your use-case. In both photography, as well as computer graphics we get get sequences occurring at perfect Nyquist (from rasterization or sampling photographic signals). Anyway, I highly recommend the diagonal filters which donâ€™t have this issue!</p><p>  è¿™æ˜¯ç”±äºåœ¨Nyquistçš„é¢‘ç‡å“åº”ä¸º0çš„â€œå®Œç¾â€é‡é‡‡æ ·æ‰€è‡´ã€‚è¿™æ˜¯å¦æ˜¯ä¸€ä¸ªé—®é¢˜å–å†³äºæ‚¨çš„ç”¨ä¾‹ã€‚åœ¨æ‘„å½±ä»¥åŠè®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œæˆ‘ä»¬éƒ½è·å¾—äº†å‘ç”Ÿåœ¨å®Œç¾å¥ˆå¥æ–¯ç‰¹ä¸Šçš„åºåˆ—ï¼ˆé€šè¿‡å…‰æ …åŒ–æˆ–é‡‡æ ·æ‘„å½±ä¿¡å·ï¼‰ã€‚æ— è®ºå¦‚ä½•ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä¸è¦ä½¿ç”¨å¯¹è§’çº¿æ»¤é•œï¼</p><p>  In my post, I only skimmed the surface of the deep topic of grid (image, voxel) gradients, but covered a bunch of related topics and connections:</p><p>  åœ¨æˆ‘çš„å¸–å­ä¸­ï¼Œæˆ‘åªæµè§ˆäº†ç½‘æ ¼ï¼ˆå›¾åƒï¼Œä½“ç´ ï¼‰æ¸å˜çš„æ·±å±‚ä¸»é¢˜ï¼Œä½†æ¶µç›–äº†ä¸€ç³»åˆ—ç›¸å…³ä¸»é¢˜å’Œè”ç³»ï¼š</p><p> I discussed differences between the  forward and central differences, how to address some of their problems, and some reasons for the classic  Sobel operator.</p><p> æˆ‘è®¨è®ºäº†å‰å‘å·®å¼‚å’Œä¸­å¤®å·®å¼‚ä¹‹é—´çš„å·®å¼‚ï¼Œå¦‚ä½•è§£å†³å®ƒä»¬çš„ä¸€äº›é—®é¢˜ï¼Œä»¥åŠä½¿ç”¨ç»å…¸Sobelç®—å­çš„ä¸€äº›åŸå› ã€‚</p><p> I presented a neat â€œtrickâ€ of using  diagonal gradients that fixes some of the shortcomings of the alternatives and Iâ€™d suggest it to you as the go-to one. Try it out with other signal sources like voxels, or for co</p><p> æˆ‘æå‡ºäº†ä½¿ç”¨å¯¹è§’çº¿æ¸å˜çš„å·§å¦™â€œæŠ€å·§â€ï¼Œå¯è§£å†³å…¶ä»–æ›¿ä»£æ–¹å¼çš„ä¸€äº›ç¼ºç‚¹ï¼Œå¹¶å»ºè®®æ‚¨ä½¿ç”¨å®ƒã€‚å°è¯•ä½¿ç”¨å…¶ä»–ä¿¡å·æºï¼ˆä¾‹å¦‚ä½“ç´ ï¼‰ï¼Œæˆ–ç”¨äº </p><p>......</p><p>...... </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://bartwronski.com/2021/02/28/computing-gradients-on-grids-forward-central-and-diagonal-differences/">https://bartwronski.com/2021/02/28/computing-gradients-on-grids-forward-central-and-diagonal-differences/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ä½“ç´ /">#ä½“ç´ </a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/grids/">#grids</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/æ¢¯åº¦/">#æ¢¯åº¦</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>JDKé£è¡Œè®°å½•å™¨æ–‡ä»¶æ ¼å¼The JDK Flight Recorder File Format</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">The JDK Flight Recorder File Format<br/>JDKé£è¡Œè®°å½•å™¨æ–‡ä»¶æ ¼å¼</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-21 22:29:00</div><div class="page_narrow text-break page_content"><p>The  JDK Flight Recorder (JFR) is one of Javaâ€™s secret weapons;deeply integrated into the Hotspot VM, itâ€™s a high-performance event collection framework,which lets you collect metrics on runtime aspects like object allocation and garbage collection,class loading, file and network I/O, and lock contention, do method profiling, and much more.</p><p>JDKé£è¡Œè®°å½•ä»ªï¼ˆJFRï¼‰æ˜¯Javaçš„ç§˜å¯†æ­¦å™¨ä¹‹ä¸€ï¼›å®ƒæ·±å…¥é›†æˆåˆ°Hotspot VMä¸­ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„äº‹ä»¶æ”¶é›†æ¡†æ¶ï¼Œå¯ç”¨äºæ”¶é›†è¿è¡Œæ—¶æ–¹é¢çš„æŒ‡æ ‡ï¼Œå¦‚å¯¹è±¡åˆ†é…å’Œåƒåœ¾æ”¶é›†ã€ç±»åŠ è½½ã€æ–‡ä»¶å’Œç½‘ç»œI/Oã€é”äº‰ç”¨ã€æ‰§è¡Œæ–¹æ³•åˆ†æç­‰ã€‚</p><p> JFR data is persisted in recording files(since Java 14, also  &#34;realtime&#34; event streaming is supported),which can be loaded for analysis into tools like JDK Mission Control (JMC),or the  jfr utility coming with OpenJDK itself.</p><p>JFRæ•°æ®ä¿å­˜åœ¨è®°å½•æ–‡ä»¶ä¸­ï¼ˆå› ä¸ºJava 14ä¹Ÿæ”¯æŒå®æ—¶äº‹ä»¶æµï¼‰ï¼Œå¯ä»¥å°†å…¶åŠ è½½åˆ°JDKä»»åŠ¡æ§åˆ¶ï¼ˆJMCï¼‰æˆ–OpenJDKè‡ªå¸¦çš„JFRå®ç”¨ç¨‹åºä¸­è¿›è¡Œåˆ†æã€‚</p><p> While thereâ€™s lots of blog posts, conference talks, and other coverage on JFR itself,information about the format of recording files is surprisingly heard to come by.There is no official specification,so the only way to actually understand the JFR file format is to read the source code for writing recordings in the JDK itself,which is a combination of  Java and  C++ code.Alternatively, you can study the code for  parsing recordings in JMC (an official JDK project).Btw., JMC comes with a pure Java-based JFR file  writer implementation too.</p><p>è™½ç„¶æœ‰å¾ˆå¤šå…³äºJFRæœ¬èº«çš„åšå®¢å¸–å­ã€ä¼šè®®æ¼”è®²å’Œå…¶ä»–æŠ¥é“ï¼Œä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå…³äºè®°å½•æ–‡ä»¶æ ¼å¼çš„ä¿¡æ¯å´å±‚å‡ºä¸ç©·ã€‚æ²¡æœ‰æ­£å¼çš„è§„èŒƒï¼Œæ‰€ä»¥çœŸæ­£ç†è§£JFRæ–‡ä»¶æ ¼å¼çš„å”¯ä¸€æ–¹æ³•æ˜¯è¯»å–æºä»£ç ï¼Œç”¨äºç¼–å†™JDKæœ¬èº«çš„å½•éŸ³ï¼Œè¿™æ˜¯javaå’ŒC++ä»£ç çš„ç»„åˆã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨JMCï¼ˆä¸€ä¸ªæ­£å¼çš„JDKé¡¹ç›®ï¼‰ä¸­å­¦ä¹ è§£æè®°å½•çš„ä»£ç ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼ŒJMCè¿˜æä¾›äº†ä¸€ä¸ªçº¯åŸºäºJavaçš„JFRæ–‡ä»¶ç¼–å†™å™¨å®ç°ã€‚</p><p> Apart from the source code itself,the only other somewhat related resources are several  JFR-related blog posts by Marcus Hirt,and a post  about JFR event sizes by Richard Startin.But thereâ€™s no in-depth discussion or explanation of the file format.As it turns out, all this by design;the OpenJDK team shied away  from creating a spec,&#34;because of the overhead of maintaining and staying compatible with it&#34;.I.e. the JFR file format is an implementation detail of OpenJDK,and as such the only stable contract for interacting with it are the APIs provided by JFR.</p><p>é™¤äº†æºä»£ç æœ¬èº«ï¼Œå”¯ä¸€å…¶ä»–ä¸€äº›ç›¸å…³çš„èµ„æºæ˜¯Marcus Hirtçš„å‡ ç¯‡ä¸JFRç›¸å…³çš„åšå®¢æ–‡ç« ï¼Œä»¥åŠRichard Startinçš„ä¸€ç¯‡å…³äºJFRäº‹ä»¶å¤§å°çš„æ–‡ç« ã€‚ä½†å¯¹æ–‡ä»¶æ ¼å¼æ²¡æœ‰æ·±å…¥çš„è®¨è®ºæˆ–è§£é‡Šã€‚äº‹å®è¯æ˜ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯æœ‰æ„ä¸ºä¹‹ï¼›OpenJDKå›¢é˜Ÿå›é¿åˆ›å»ºè§„èŒƒ&34ï¼›å› ä¸ºç»´æŠ¤å’Œä¿æŒå…¼å®¹çš„å¼€é”€&#34ï¼›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJFRæ–‡ä»¶æ ¼å¼æ˜¯OpenJDKçš„ä¸€ä¸ªå®ç°ç»†èŠ‚ï¼Œå› æ­¤ä¸ä¹‹äº¤äº’çš„å”¯ä¸€ç¨³å®šå¥‘çº¦æ˜¯JFRæä¾›çš„APIã€‚</p><p> Now, also if it is an implementation detail, knowing more about the JFR file format would certainly be useful;for instance, you could use this to implement tools for analyzing and visualizing JFR data in non-JVM programming languages,say Python, or to patch corrupted recording files.So my curiosity was piqued and I thought itâ€™d be fun to try and find out how JFR recording files are structured.In particular, I was curious about which techniques are used for keeping files relatively small,also with hundreds of thousands or even millions of recoreded events.</p><p>ç°åœ¨ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ï¼Œäº†è§£æ›´å¤šå…³äºJFRæ–‡ä»¶æ ¼å¼çš„ä¿¡æ¯è‚¯å®šä¼šå¾ˆæœ‰ç”¨ï¼›ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å®ç°å·¥å…·ï¼Œç”¨éJVMç¼–ç¨‹è¯­è¨€ï¼ˆæ¯”å¦‚Pythonï¼‰åˆ†æå’Œå¯è§†åŒ–JFRæ•°æ®ï¼Œæˆ–è€…ä¿®è¡¥æŸåçš„è®°å½•æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘çš„å¥½å¥‡å¿ƒè¢«æ¿€å‘äº†ï¼Œæˆ‘æƒ³å°è¯•äº†è§£JFRå½•éŸ³æ–‡ä»¶æ˜¯å¦‚ä½•æ„é€ çš„ä¼šå¾ˆæœ‰è¶£ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘æƒ³çŸ¥é“å“ªäº›æŠ€æœ¯ç”¨äºä¿æŒæ–‡ä»¶ç›¸å¯¹è¾ƒå°ï¼Œä»¥åŠæ•°åä¸‡ç”šè‡³æ•°ç™¾ä¸‡è®°å½•çš„äº‹ä»¶ã€‚</p><p> I grabbed a hex editor, the source code of JMCâ€™s recording parser(which I found a bit easier to grasp than the Java/C++ hybrid in the JDK itself),and loaded several example recordings from my  JFR Analytics project,stepping through the parser code in debug mode(fun fact: while doing so, I noticed JMC currently fails to parse events with   char attributes).</p><p>æˆ‘æŠ“å–äº†ä¸€ä¸ªåå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼Œè¿™æ˜¯JMCå½•éŸ³è§£æå™¨çš„æºä»£ç ï¼ˆæˆ‘å‘ç°å®ƒæ¯”JDKä¸­çš„Java/C++æ··åˆç‰ˆæœ¬æ›´å®¹æ˜“æŒæ¡ï¼‰ï¼Œå¹¶ä»æˆ‘çš„JFR Analyticsé¡¹ç›®ä¸­åŠ è½½äº†å‡ ä¸ªç¤ºä¾‹å½•éŸ³ï¼Œåœ¨è°ƒè¯•æ¨¡å¼ä¸‹é€æ­¥åˆ†æè§£æå™¨ä»£ç ï¼ˆæœ‰è¶£çš„äº‹å®ï¼šåœ¨è¿™æ ·åšæ—¶ï¼Œæˆ‘æ³¨æ„åˆ°JMCç›®å‰æ— æ³•è§£æå…·æœ‰charå±æ€§çš„äº‹ä»¶ï¼‰ã€‚</p><p> Just a feeew hours later, and I largely understood how the thing works.As an image says more than a thousand words,and Iâ€™ll never say no to an opportunity to draw something in the fabuluous  Excalidraw,so I proudly present to you this visualization of the JFR file format as per my understanding(click to enlarge):</p><p>ä»…ä»…å‡ ä¸ªå°æ—¶åï¼Œæˆ‘åŸºæœ¬ä¸Šç†è§£äº†å®ƒçš„å·¥ä½œåŸç†ã€‚æ­£å¦‚ä¸€å¼ å›¾ç‰‡æ‰€è¯´çš„åƒè¨€ä¸‡è¯­ï¼Œæˆ‘æ°¸è¿œä¸ä¼šæ‹’ç»åœ¨ç¥å¥‡çš„Excalidrawä¸­ç»˜åˆ¶æŸäº›ä¸œè¥¿çš„æœºä¼šï¼Œå› æ­¤ï¼Œæ ¹æ®æˆ‘çš„ç†è§£ï¼Œæˆ‘è‡ªè±ªåœ°å‘å¤§å®¶å±•ç¤ºJFRæ–‡ä»¶æ ¼å¼çš„å¯è§†åŒ–ï¼ˆç‚¹å‡»æ”¾å¤§ï¼‰ï¼š</p><p>  Itâ€™s best viewed on a big screen ğŸ˜.Alternatively, hereâ€™s a  SVG version.Now this doesnâ€™t go into all the finest aspects,so you probably couldnâ€™t go off and implement a clean-room JFR file parser solely based on this.But it does show the relevant concepts and mechanisms.I suggest you spend some time going through sections one to five in the picture,and dive into the sections for header, metadata, constant pool, and actual recorded events.Studying the image should give you a good understanding of the JFR file format and its structure.</p><p>æœ€å¥½åœ¨å¤§å±å¹•ä¸Šè§‚çœ‹ğŸ˜.æˆ–è€…ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªSVGç‰ˆæœ¬ã€‚ç°åœ¨ï¼Œè¿™å¹¶æ²¡æœ‰æ¶‰åŠåˆ°æ‰€æœ‰æœ€å¥½çš„æ–¹é¢ï¼Œæ‰€ä»¥æ‚¨å¯èƒ½æ— æ³•å•ç‹¬åŸºäºæ­¤å®ç°ä¸€ä¸ªå¹²å‡€çš„JFRæ–‡ä»¶è§£æå™¨ã€‚ä½†å®ƒç¡®å®å±•ç¤ºäº†ç›¸å…³çš„æ¦‚å¿µå’Œæœºåˆ¶ã€‚æˆ‘å»ºè®®æ‚¨èŠ±ä¸€äº›æ—¶é—´æµè§ˆå›¾ç‰‡ä¸­çš„ç¬¬ä¸€åˆ°ç¬¬äº”éƒ¨åˆ†ï¼Œç„¶åæ·±å…¥äº†è§£æ ‡é¢˜ã€å…ƒæ•°æ®ã€å¸¸é‡æ± å’Œå®é™…è®°å½•çš„äº‹ä»¶ã€‚ç ”ç©¶å›¾åƒå¯ä»¥è®©ä½ å¾ˆå¥½åœ°ç†è§£JFRæ–‡ä»¶æ ¼å¼åŠå…¶ç»“æ„ã€‚</p><p> Here are some observations I made as I found my way through the file format:</p><p>ä»¥ä¸‹æ˜¯æˆ‘åœ¨æµè§ˆæ–‡ä»¶æ ¼å¼æ—¶æ‰€åšçš„ä¸€äº›è§‚å¯Ÿï¼š</p><p> JFR recordings are organized in chunks: Chunks are self-contained independent containers of recorded events and all the metadata required for interpreting these events.Thereâ€™s no additional content in recordings besides the chunks, i.e.  concat several chunk files, and youâ€™ll have a JFR recording file.A multi-chunk recording file can be split up into the individual chunks using the   jfr utility which comes with OpenJDK:</p><p>JFRè®°å½•è¢«ç»„ç»‡æˆå—ï¼šå—æ˜¯è®°å½•çš„äº‹ä»¶ä»¥åŠè§£é‡Šè¿™äº›äº‹ä»¶æ‰€éœ€çš„æ‰€æœ‰å…ƒæ•°æ®çš„ç‹¬ç«‹å®¹å™¨ã€‚é™¤äº†åŒºå—ä¹‹å¤–ï¼Œå½•åˆ¶ä¸­æ²¡æœ‰å…¶ä»–å†…å®¹ï¼Œä¾‹å¦‚ï¼Œconcatå‡ ä¸ªåŒºå—æ–‡ä»¶ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªJFRå½•åˆ¶æ–‡ä»¶ã€‚ä½¿ç”¨OpenJDKé™„å¸¦çš„jfrå®ç”¨ç¨‹åºï¼Œå¯ä»¥å°†å¤šå—è®°å½•æ–‡ä»¶æ‹†åˆ†ä¸ºå„ä¸ªå—ï¼š</p><p>  The default chunksize is 12MB, but if needed, you can override this, e.g. using the  -XX:FlightRecorderOptions:maxchunksize=1MB option when starting a recording.A smaller chunk size can come in handy if for instance you only want to transmit a specific section of a long-running recording.On the other hand, many small chunks will increase the overall size of a recording,due to the repeatedly stored metadata and constant pools</p><p>é»˜è®¤chunksizeä¸º12MBï¼Œä½†å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥è¦†ç›–å®ƒï¼Œä¾‹å¦‚åœ¨å¼€å§‹å½•åˆ¶æ—¶ä½¿ç”¨-XX:FlightRecorderOptions:maxchunksize=1MBé€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªæƒ³ä¼ è¾“é•¿æ—¶é—´è¿è¡Œçš„å½•éŸ³çš„ç‰¹å®šéƒ¨åˆ†ï¼Œåˆ™è¾ƒå°çš„æ•°æ®å—å¤§å°ä¼šå¾ˆæœ‰ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºé‡å¤å­˜å‚¨å…ƒæ•°æ®å’Œå¸¸é‡æ± ï¼Œè®¸å¤šå°æ•°æ®å—ä¼šå¢åŠ è®°å½•çš„æ•´ä½“å¤§å°</p><p> The event format is self-descriptive: The metadata part of each chunk describes the structure of the contained events, all referenced types, their attributes, etc.; by means of JFR  metadata annotations, such as  @Label,  @Description,  @Timestamp etc., further metadata like human-readable names and description as well as units of measurements are expressed,allowing to consume and parse an event stream without a-priori knowledge of specific event types. In particular, this allows for the definition of  custom event types and displaying them in the generic event browser of JMC (of course, bespoke views such as the &#34;Memory&#34; view rely on type-specific interpretations of individual event types)</p><p>äº‹ä»¶æ ¼å¼æ˜¯è‡ªæè¿°æ€§çš„ï¼šæ¯ä¸ªå—çš„å…ƒæ•°æ®éƒ¨åˆ†æè¿°æ‰€åŒ…å«äº‹ä»¶çš„ç»“æ„ã€æ‰€æœ‰å¼•ç”¨çš„ç±»å‹åŠå…¶å±æ€§ç­‰ã€‚ï¼›é€šè¿‡JFRå…ƒæ•°æ®æ³¨é‡Šï¼Œå¦‚@Labelã€@Descriptionã€@Timestampç­‰ï¼Œè¿›ä¸€æ­¥çš„å…ƒæ•°æ®ï¼Œå¦‚äººç±»å¯è¯»çš„åç§°å’Œæè¿°ä»¥åŠåº¦é‡å•ä½è¢«è¡¨è¾¾å‡ºæ¥ï¼Œå…è®¸åœ¨ä¸é¢„å…ˆçŸ¥é“ç‰¹å®šäº‹ä»¶ç±»å‹çš„æƒ…å†µä¸‹ä½¿ç”¨å’Œè§£æäº‹ä»¶æµã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿™å…è®¸å®šä¹‰è‡ªå®šä¹‰äº‹ä»¶ç±»å‹ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºåœ¨JMCçš„é€šç”¨äº‹ä»¶æµè§ˆå™¨ä¸­ï¼ˆå½“ç„¶ï¼Œè¯¸å¦‚&#34ï¼›å†…å­˜&#34ï¼›è§†å›¾ç­‰å®šåˆ¶è§†å›¾ä¾èµ–äºå•ä¸ªäº‹ä»¶ç±»å‹çš„ç‰¹å®šç±»å‹è§£é‡Šï¼‰</p><p> The format is geared towards space efficiency: Integer values are stored in a variable-length encoded way ( LEB128), which will safe lots of space when storing small values.A constant pool is used to store repeatedly referenced objects, such as String literals,stack traces, class and method names, etc.;for each usage of such constant in a recorded event, only the constant pool index is stored(a var-length encoded  long).Note that Strings can either be stored as raw values within events themselves, or in the constant pool. Unfortunately, no control is provided for choosing between the two; strings with a length between 16 and 128 will be stored in the constant pool, any others as raw value. It could be a nice extension to give event authors more control here, e.g. by means of an annotation on the event attribute definition</p><p>è¯¥æ ¼å¼æ—¨åœ¨æé«˜ç©ºé—´æ•ˆç‡ï¼šæ•´æ•°å€¼ä»¥å¯å˜é•¿åº¦ç¼–ç æ–¹å¼ï¼ˆLEB128ï¼‰å­˜å‚¨ï¼Œè¿™å°†åœ¨å­˜å‚¨å°æ•°å€¼æ—¶ä¿æŠ¤å¤§é‡ç©ºé—´ã€‚å¸¸é‡æ± ç”¨äºå­˜å‚¨é‡å¤å¼•ç”¨çš„å¯¹è±¡ï¼Œå¦‚å­—ç¬¦ä¸²æ–‡å­—ã€å †æ ˆè·Ÿè¸ªã€ç±»å’Œæ–¹æ³•åç­‰ã€‚ï¼›å¯¹äºè®°å½•çš„äº‹ä»¶ä¸­æ¯æ¬¡ä½¿ç”¨æ­¤ç±»å¸¸é‡ï¼Œåªå­˜å‚¨å¸¸é‡æ± ç´¢å¼•ï¼ˆvaré•¿åº¦ç¼–ç ä¸ºlongï¼‰ã€‚è¯·æ³¨æ„ï¼Œå­—ç¬¦ä¸²å¯ä»¥ä½œä¸ºåŸå§‹å€¼å­˜å‚¨åœ¨äº‹ä»¶æœ¬èº«ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰æä¾›åœ¨ä¸¤è€…ä¹‹é—´è¿›è¡Œé€‰æ‹©çš„æ§åˆ¶ï¼›é•¿åº¦åœ¨16åˆ°128ä¹‹é—´çš„å­—ç¬¦ä¸²å°†å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå…¶ä»–å­—ç¬¦ä¸²å°†ä½œä¸ºåŸå§‹å€¼å­˜å‚¨ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ‰©å±•ï¼Œå¯ä»¥è®©äº‹ä»¶ä½œè€…åœ¨è¿™é‡Œæ‹¥æœ‰æ›´å¤šçš„æ§åˆ¶æƒï¼Œä¾‹å¦‚é€šè¿‡äº‹ä»¶å±æ€§å®šä¹‰ä¸Šçš„æ³¨é‡Š</p><p> When using the  jdk.OldObjectSample event type,beware of bug  JDK-8277919,which may cause a bloat of the constant pool,as the same entry is duplicated in the pool many times.This will be fixed in Java 17.0.3 and 18.</p><p>å½“ä½¿ç”¨jdkæ—¶ã€‚OldObjectSampleäº‹ä»¶ç±»å‹ï¼Œè¯·æ³¨æ„é”™è¯¯JDK-8277919ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¸¸é‡æ± è†¨èƒ€ï¼Œå› ä¸ºåŒä¸€ä¸ªæ¡ç›®åœ¨æ± ä¸­é‡å¤å¤šæ¬¡ã€‚è¿™å°†åœ¨Java 17.0.3å’Œ18ä¸­ä¿®å¤ã€‚</p><p> The format is row-based: Events are stored sequentially one after another in recording files; this means that for instance boolean attributes will consume one full byte, also if actually eight boolean values could be stored in a single byte.It could be interesting to explore a columnar format as an alternative,which may help to further reduce recording size,for instance also allowing to efficiently compress event timestamps values using  delta-encoding</p><p>è¯¥æ ¼å¼åŸºäºè¡Œï¼šäº‹ä»¶åœ¨è®°å½•æ–‡ä»¶ä¸­é¡ºåºå­˜å‚¨ï¼›è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œå¸ƒå°”å±æ€§å°†æ¶ˆè€—ä¸€ä¸ªå®Œæ•´å­—èŠ‚ï¼Œå¦‚æœä¸€ä¸ªå­—èŠ‚ä¸­å¯ä»¥å­˜å‚¨å…«ä¸ªå¸ƒå°”å€¼çš„è¯ã€‚æ¢ç´¢æŸ±çŠ¶æ ¼å¼ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆå¯èƒ½ä¼šå¾ˆæœ‰è¶£ï¼Œè¿™å¯èƒ½æœ‰åŠ©äºè¿›ä¸€æ­¥å‡å°‘è®°å½•å¤§å°ï¼Œä¾‹å¦‚ï¼Œè¿˜å…è®¸ä½¿ç”¨å¢é‡ç¼–ç æœ‰æ•ˆåœ°å‹ç¼©äº‹ä»¶æ—¶é—´æˆ³å€¼</p><p> Compression support in JMC reader implementation: The JFR parser implementation of JMC transparently unpacks recording files which are compressed using GZip, ZIP, or LZ4(Marcus Hirt discusses the compression of JFR recordings in  this post).Interestingly, JMC 8.1 still failed to open such compressed recording with an error message.The  jfr utility doesnâ€™t support compressed recording files, and I suppose the JFR writer in the JDK doesnâ€™t produce compressed recordings either</p><p>JMCé˜…è¯»å™¨å®ç°ä¸­çš„å‹ç¼©æ”¯æŒï¼šJMCçš„JFRè§£æå™¨å®ç°é€æ˜åœ°è§£å‹ä½¿ç”¨GZipã€ZIPæˆ–LZ4å‹ç¼©çš„è®°å½•æ–‡ä»¶ï¼ˆMarcus Hirtåœ¨æœ¬æ–‡ä¸­è®¨è®ºäº†JFRè®°å½•çš„å‹ç¼©ï¼‰ã€‚æœ‰è¶£çš„æ˜¯ï¼ŒJMC 8.1ä»ç„¶æ— æ³•æ‰“å¼€è¿™æ ·çš„å‹ç¼©è®°å½•ï¼Œå¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚jfrå®ç”¨ç¨‹åºä¸æ”¯æŒå‹ç¼©å½•éŸ³æ–‡ä»¶ï¼Œæˆ‘æƒ³JDKä¸­çš„jfrç¼–å†™å™¨ä¹Ÿä¸ä¼šç”Ÿæˆå‹ç¼©å½•éŸ³</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/é£è¡Œ/">#é£è¡Œ</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/flight/">#flight</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/jfr/">#jfr</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
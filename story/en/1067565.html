<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CILIUM 1.10ç‰ˆæœ¬å¢åŠ äº†WIGUARDé€æ˜åŠ å¯†çš„æ”¯æŒ Cilium 1.10 release adds support for WireGuard Transparent Encryption</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Cilium 1.10 release adds support for WireGuard Transparent Encryption<br/>CILIUM 1.10ç‰ˆæœ¬å¢åŠ äº†WIGUARDé€æ˜åŠ å¯†çš„æ”¯æŒ </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-23 06:01:07</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/d799dbaf1f8884276cf6117820893d90.png"><img src="http://img2.diglog.com/img/2021/6/d799dbaf1f8884276cf6117820893d90.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>The Cilium core team are excited to announce the Cilium 1.10 release. A totalof 2042 new commits have been contributed by a growing community of 280developers. Contributions have come from a wide list of different companiesincluding Alibaba, Datadog, Google, Isovalent, SuSE, Palantir among manyothers. We heard from users who are increasingly interested in betterintegration with the broader network, whether you&#39;re running Cilium in your owndatacenter environments or in the cloud. Thus, a major focus of this releasewas ensuring a seamless integration between the Kubernetes network andenterprise on-prem infrastructure.</p><p>Cilium Coreå›¢é˜Ÿå¾ˆé«˜å…´åœ°å®£å¸ƒCilium 1.10é‡Šæ”¾ã€‚ä¸º280åè¶Šæ¥è¶Šå¤šçš„ç¤¾åŒºè´¡çŒ®äº†2042åæ–°çŠ¯ç½ªã€‚è´¡çŒ®æ¥è‡ªä¸åŒçš„å…¬å¸åˆ—è¡¨ï¼ŒåŒ…æ‹¬é˜¿é‡Œå·´å·´ï¼ŒDataDogï¼Œè°·æ­Œï¼ŒIsovalentï¼ŒSuseï¼ŒWallantirä¹‹é—´çš„è®¸å¤šäººã€‚æˆ‘ä»¬å¬è¯´è¿‡ä¸æ›´å¹¿æ³›çš„ç½‘ç»œè¶Šæ¥è¶Šæ„Ÿå…´è¶£çš„ç”¨æˆ·ï¼Œæ— è®ºæ‚¨æ˜¯ï¼†ï¼ƒ39;åœ¨æ‚¨çš„overdaterç¯å¢ƒä¸­æˆ–äº‘ä¸­è¿è¡Œçº¤æ¯›ã€‚å› æ­¤ï¼Œè¯¥å‘è¡Œç‰ˆçš„ä¸»è¦ç„¦ç‚¹ç¡®ä¿äº†Kubernetesç½‘ç»œå’Œé¢„å”®çš„åŸºç¡€è®¾æ–½ä¹‹é—´çš„æ— ç¼é›†æˆã€‚</p><p> Egress IP Gateway: When integrating cloud-native applications with legacycounterparts operating outside the Kubernetes cluster, IP Address Managementcan be a pain point as Pod IPs are more dynamic than traditional networkendpoints. Through a new Kubernetes CRD, static IPs can now be associatedwith traffic as the packets egress the Kubernetes cluster. This allowsexternal firewalls to see consistent IPs and filter traffic for specific podspurely using the assigned static IP address.( More details)</p><p> EIGRES IPç½‘å…³ï¼šåœ¨å°†äº‘æœ¬æœºåº”ç”¨ç¨‹åºä¸åœ¨Kubernetesé›†ç¾¤å¤–éƒ¨æ“ä½œçš„LefacyCounterparté›†æˆæ—¶ï¼ŒIPåœ°å€ç®¡ç†ç¨‹åºæ˜¯æ­¢ç‚¹ï¼Œå› ä¸ºPOD IPæ¯”ä¼ ç»Ÿçš„ç½‘ç»œå‘½ä»¤æ›´åŠ åŠ¨æ€ã€‚é€šè¿‡ä¸€ä¸ªæ–°çš„Kubernetes CRDï¼Œé™æ€IPSç°åœ¨å¯ä»¥éšç€Kubernetesé›†ç¾¤çš„æ•°æ®åŒ…å‡ºå£è€Œä¸æµé‡ç›¸å…³è”ã€‚æ­¤å…è®¸ä½¿ç”¨æŒ‡å®šçš„é™æ€IPåœ°å€ï¼ŒæŸ¥çœ‹ä¸€è‡´çš„IPSå’Œè¿‡æ»¤æµé‡çš„ä¸€è‡´æ€§IPSå’Œè¿‡æ»¤æµé‡ã€‚ï¼ˆæ›´å¤šç»†èŠ‚ï¼‰</p><p> Integrated BGP Support: Weâ€™ve simplified the ability to advertiseKubernetes service IPs via BGP to allow workloads outside the Kubernetesenvironment to easily communicate with Cloud Native applications. With 1.10we&#39;ve incorporated BGP service announcement support directly into Ciliumso that these services can be exposed without the need for any additionalexternal components.( More details)</p><p> é›†æˆçš„BGPæ”¯æŒï¼šæˆ‘ä»¬ç®€åŒ–äº†é€šè¿‡BGPå‘ŠçŸ¥Kubernetes Service IPSçš„èƒ½åŠ›ï¼Œä»¥å…è®¸KubernetEnvironmentå¤–éƒ¨çš„å·¥ä½œè´Ÿè½½ï¼Œä»¥ä¾¿ä¸äº‘æœ¬æœºåº”ç”¨ç¨‹åºè½»æ¾é€šä¿¡ã€‚ä¸1.10weï¼†ï¼ƒ39; veå°†BGPæœåŠ¡å…¬å‘Šç›´æ¥çº³å…¥CILIUMSOï¼Œå³æ— éœ€ä»»ä½•é¢å¤–çš„é¢å¤–ç»„ä»¶å°±å¯ä»¥æ›å…‰è¿™äº›æœåŠ¡ã€‚ï¼ˆæ›´å¤šç»†èŠ‚ï¼‰</p><p> Standalone Load Balancer: Cilium&#39;s high performance, robustload balancing implementation is tuned for the scale and churn ofcloud native environments. Now you can replace expensive legacy boxes inyour network with Cilium as a standalone load balancer. This unlocks thepotential of DSR and Maglev for handling north/south traffic inon-premises environments without requiring Kubernetes to manage the networkborder.( More details)</p><p> ç‹¬ç«‹è´Ÿè½½å¹³è¡¡å™¨ï¼šçº¤è¥¿ï¼†ï¼ƒ39; Sé«˜æ€§èƒ½ï¼ŒRobustLoadå¹³è¡¡å®ç°è¢«è°ƒæ•´ä¸ºåºå¤§çš„æœ¬æœºç¯å¢ƒçš„è§„æ¨¡å’Œæµå¤±ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ç”¨çº¤è¥¿ä½œä¸ºç‹¬ç«‹è´Ÿè½½å¹³è¡¡å™¨æ¥æ›´æ¢æ˜‚è´µçš„ç½‘ç»œä¸­çš„æ˜‚è´µç›’å­ã€‚è¿™è§£é”äº†DSRå’ŒMaglevçš„æ”¯æŒï¼Œç”¨äºå¤„ç†åŒ—/å—äº¤é€šinonæ¥¼å®‡ç¯å¢ƒï¼Œè€Œæ— éœ€kubernetesç®¡ç†ç½‘ç»œè®¢å•ã€‚ï¼ˆæ›´å¤šç»†èŠ‚ï¼‰</p><p> PCAP Recorder provides network observability into theStandalone Load Balancer by enabling full or partial packet capture fortraffic matching specific n-tuple filters. ( More details)</p><p> é€šè¿‡å¯ç”¨å®Œæ•´æˆ–éƒ¨åˆ†æ•°æ®åŒ…æ•è·FortrafficåŒ¹é…ç‰¹å®šçš„Nç»„æ»¤æ³¢å™¨ï¼ŒPCAP Recorderå°†ç½‘ç»œå¯è§‚å¯Ÿæ€§æä¾›ç»™TheStandaloneè´Ÿè½½å¹³è¡¡å™¨ã€‚ ï¼ˆ æ›´å¤šç»†èŠ‚ï¼‰</p><p> Beyond the focus on integrating better with the broader network, weâ€™ve investedin making it  easier to install and run Cilium regardless of environment,further  improved performance, and added a whole set of highly requestedfeatures:</p><p> é™¤äº†é€šè¿‡æ›´å¹¿æ³›çš„ç½‘ç»œé›†æˆæ›´å¥½çš„å…³æ³¨ï¼Œæˆ‘ä»¬æŠ•å…¥äº†ä¸ç®¡ç¯å¢ƒï¼Œè¿›ä¸€æ­¥æé«˜æ€§èƒ½ï¼Œå¹¶å¢åŠ äº†ä¸€æ•´å¥—é«˜åº¦è¦æ±‚çš„çº¤è¥¿ï¼Œæ›´å®¹æ˜“å®‰è£…å’Œè¿è¡Œçº¤è¥¿ï¼š</p><p> WireGuardÂ® Support: One of the most hotly requested features, Cilium nowsupports encrypting traffic between pods in the cluster using the modernWireGuard protocol as an alternative to the existing IPsec implementation.( More details)</p><p> WireguardÂ®æ”¯æŒï¼šæœ€å¸¸è§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œiciliumç°åœ¨ä½¿ç”¨ç°ä»£è¡Œè¡Œåè®®ä½œä¸ºç°æœ‰IPSecå®ç°çš„æ›¿ä»£æ–¹æ¡ˆæ¥åŠ å¯†ç¾¤é›†ä¸­çš„PODä¹‹é—´çš„æµé‡ã€‚ï¼ˆæ›´å¤šç»†èŠ‚ï¼‰ </p><p> New Cluster Administration CLI: An experimental new Cilium command-lineinterface simplifies installation, troubleshooting and feature enablementby automatically detecting your environment constraints and configuringCilium with the best set of options.( More details)</p><p>æ–°çš„ç¾¤é›†ç®¡ç†CLIï¼šä¸€ä¸ªå®éªŒæ–°çš„çº¤æ¯›å‘½ä»¤-Lineæ¥å£ç®€åŒ–äº†å®‰è£…ï¼Œæ•…éšœæ’é™¤å’ŒåŠŸèƒ½å¯ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ‚¨çš„ç¯å¢ƒçº¦æŸå’Œé…ç½®æœ€ä½³é€‰é¡¹çš„é…ç½®ã€‚ï¼ˆæ›´å¤šç»†èŠ‚ï¼‰</p><p> Better performance than ever: Cilium now has the ability to skipNetfilter connection tracking where it is not needed, has improvedNorth/South service handling, and we&#39;ve doubled throughput performancethrough improved Linux tunneling. Check all this out together with the new tuning guide to help you get the most from your network!( More details)</p><p> æ¯”ä»¥å¾€æ›´å¥½çš„è¡¨ç°ï¼šCILIUMç°åœ¨æœ‰èƒ½åŠ›SKIPNETFILTERè¿æ¥è·Ÿè¸ªï¼Œåœ¨ä¸éœ€è¦çš„åœ°æ–¹ï¼Œå…·æœ‰æ”¹å–„/å—æ–¹æœåŠ¡å¤„ç†ï¼Œæˆ‘ä»¬ï¼†ï¼ƒ39; VEåŠ å€çš„ååé‡æ€§èƒ½æ”¹è¿›äº†Linuxéš§é“ã€‚å°†æ‰€æœ‰è¿™äº›ä¸æ–°çš„è°ƒæ•´æŒ‡å—ä¸€èµ·æ£€æŸ¥ï¼Œä»¥å¸®åŠ©æ‚¨ä»ç½‘ç»œä¸­è·å¾—æœ€å¤§é™åº¦ï¼ï¼ˆæ›´å¤šç»†èŠ‚ï¼‰</p><p> Lots of other improvements: This release brings support for  KubernetesDual-Stack Services,  Native IPAM for Alibaba Cloud,and is the first release to distribute  official images for ARM64.New guides for Rancher and Rancher Kubernetes Engine make it easierto deploy Cilium in on-prem Kubernetes environments.</p><p> è®¸å¤šå…¶ä»–æ”¹è¿›ï¼šæ­¤ç‰ˆæœ¬ä¸ºkubernetesdual-stackæœåŠ¡ï¼Œé˜¿é‡Œå·´å·´äº‘çš„æœ¬æœºIpamå¸¦æ¥äº†æ”¯æŒï¼Œå¹¶ä¸”æ˜¯ç¬¬ä¸€ä¸ªä¸ºArm64åˆ†å‘å®˜æ–¹å›¾åƒçš„ç‰ˆæœ¬ã€‚ç”¨äºç‰§åœºä¸»å’Œç‰§åœºä¸»Kubernetes Engineçš„æ–°å¯¼æ¸¸ä½¿å…¶æˆä¸ºåœ¨é¢„å¢ƒä¸­éƒ¨ç½²çš„çº¤æ¯›Kubernetesç¯å¢ƒã€‚</p><p>  Cilium is open source software for transparently providing and securing thenetwork and API connectivity between application services deployed using Linuxcontainer management platforms such as Kubernetes.</p><p>  CILIUMæ˜¯å¼€æ”¾çš„æºè½¯ä»¶ï¼Œç”¨äºé€æ˜æä¾›å’Œç¡®ä¿ä½¿ç”¨LinuxContainerç®¡ç†å¹³å°ï¼ˆå¦‚Kubernetesï¼‰éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæœåŠ¡ä¹‹é—´çš„APIè¿æ¥ã€‚</p><p> At the foundation of Cilium is a new Linux kernel technology called eBPF, whichenables the dynamic insertion of powerful security, visibility, and networkingcontrol logic within Linux itself. eBPF is utilized to provide functionalitysuch as multi-cluster routing, load balancing to replace kube-proxy,transparent encryption as well as network and service security. Besidesproviding traditional network-level security, the flexibility of eBPF enablessecurity with the context of application protocols and DNS requests/responses.Cilium is tightly integrated with Envoy and provides an extension frameworkbased on Go. Because eBPF runs inside the Linux kernel, all Ciliumfunctionality can be applied without any changes to the application code orcontainer configuration.</p><p> åœ¨Ciliumçš„åŸºç¡€ä¸Šæ˜¯ä¸€ä¸ªåä¸ºEBPFçš„æ–°çš„Linuxå†…æ ¸æŠ€æœ¯ï¼Œä¾èµ–äºLinuxæœ¬èº«å†…çš„å¼ºå¤§å®‰å…¨æ€§ï¼Œå¯è§æ€§å’ŒNetworkingControlé€»è¾‘çš„åŠ¨æ€æ’å…¥ã€‚ EBPFç”¨äºæä¾›å‡½æ•°ä¸ºå¤šç°‡è·¯ç”±ï¼Œè´Ÿè½½å¹³è¡¡ä»¥æ›¿æ¢Kube-Proxyï¼Œé€æ˜åŠ å¯†ä»¥åŠç½‘ç»œå’ŒæœåŠ¡å®‰å…¨æ€§ã€‚é™¤äº†æä¾›ä¼ ç»Ÿçš„ç½‘ç»œçº§å®‰å…¨æ€§ï¼ŒEBPF EnableSecurityçš„çµæ´»æ€§ä¸åº”ç”¨ç¨‹åºåè®®å’ŒDNSè¯·æ±‚/å“åº”çš„å†…å®¹éƒ½ä¸Envoyç´§å¯†é›†æˆï¼Œå¹¶æä¾›äº†Goçš„æ‰©å±•æ¡†æ¶ã€‚ç”±äºEBPFåœ¨Linuxå†…æ ¸å†…è¿è¡Œï¼Œå› æ­¤å¯ä»¥åº”ç”¨æ‰€æœ‰CileiumåŠŸèƒ½ï¼Œè€Œæ— éœ€å¯¹åº”ç”¨ç¨‹åºä»£ç æˆ–é€šé“é…ç½®çš„ä»»ä½•æ›´æ”¹ã€‚</p><p>     As Kubernetes became the de facto standard platform to containerize andmodernize application workloads, a significant pain point became connectingthese new services to components in the legacy environments. Traditionalworkloads have a fixed and unique IP that can be recognized by a firewall.Traffic coming from a containerized application will come from many differentIPs as containers spin up and down as needed and will most often present as theIP of the node on which each container sits. This makes it hard to set upsecurity boundaries for applications and to audit their behavior.</p><p>     éšç€Kubernetesæˆä¸ºContainize AndModernizeåº”ç”¨ç¨‹åºå·¥ä½œè´Ÿè½½çš„äº‹å®ä¸Šæ ‡å‡†å¹³å°ï¼Œå®ƒçš„æ˜¾ç€ç—›ç‚¹æˆä¸ºé—ç•™ç¯å¢ƒä¸­çš„ç»„ä»¶çš„æ–°æœåŠ¡ã€‚ä¼ ç»Ÿçš„Workenloadså…·æœ‰å›ºå®šå’Œå”¯ä¸€çš„IPï¼Œå¯ä»¥ç”±é˜²ç«å¢™è¯†åˆ«ã€‚æ¥è‡ªé›†è£…ç®±åŒ–åº”ç”¨çš„è¿è¾“å·¥å…·å°†æ¥è‡ªè®¸å¤šoversï¼Œå› ä¸ºå®¹å™¨æ ¹æ®éœ€è¦å‘ä¸Šå’Œå‘ä¸‹æ—‹è½¬ï¼Œå¹¶ä¸”æœ€å¸¸ç”¨ä¸ºæ¯ä¸ªå®¹å™¨ååœ¨çš„èŠ‚ç‚¹ä¸Šçš„æŒç‚¹ã€‚è¿™ä½¿å¾—éš¾ä»¥ä¸ºåº”ç”¨ç¨‹åºè®¾å®šupsecurityè¾¹ç•Œå¹¶å®¡æ ¸å…¶è¡Œä¸ºã€‚</p><p> The 1.10 release brings the egress gateway capability to Cilium. Cilium nowallows users to specify an egress NAT policy, such that egress traffic for theselected pods will be masqueraded with a consistent, user-defined IP address.As the following diagram shows, instead of directly egressing via eth0, trafficfrom pods running in the worker node egress the cluster via the gateway node.At this node, SNAT is applied to provide the consistent external IP foroutbound traffic. From there, networking components can be configured to treattraffic differently depending on the source IP address. For instance, a legacyfirewall is able to filter traffic that originates from pods with particularlabels, by matching purely on the source IP address of the inbound traffic.</p><p> 1.10é‡Šæ”¾å°†å‡ºå£ç½‘å…³èƒ½åŠ›å¸¦ç»™çº¤æ¯›ã€‚ Cilium Nowallowsç”¨æˆ·æŒ‡å®šå‡ºEORTERNAT NATç­–ç•¥ï¼Œä½¿å¾—TheSelected Podsçš„å‡ºå£æµé‡å°†ç”¨ä¸€è‡´çš„ç”¨æˆ·å®šä¹‰çš„IPåœ°å€ä¼ªè£…æˆä¸€è‡´çš„ç”¨æˆ·å®šä¹‰çš„IPåœ°å€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè€Œä¸æ˜¯é€šè¿‡eth0ç›´æ¥å‡ºå£ï¼Œè€Œä¸æ˜¯åœ¨å·¥ä½œèŠ‚ç‚¹ä¸­è¿è¡Œçš„PODé€šè¿‡GatewayèŠ‚ç‚¹å‡ºå£ç¾¤é›†ã€‚æ­¤èŠ‚ç‚¹ï¼ŒSNATåº”ç”¨äºæä¾›ä¸€è‡´çš„å¤–éƒ¨IPå‡ºå‘æµé‡ã€‚ä»é‚£é‡Œï¼Œç½‘ç»œç»„ä»¶å¯ä»¥é…ç½®ä¸ºæ ¹æ®æºIPåœ°å€çš„ä¸åŒæ–¹å¼è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼ŒLegacyFireWALLèƒ½å¤Ÿé€šè¿‡çº¯ç²¹åœ¨å…¥ç«™æµé‡çš„æºIPåœ°å€åŒ¹é…ï¼Œè¿‡æ»¤æºè‡ªå…·æœ‰ç‰¹å®šæ ‡ç­¾çš„æµé‡ã€‚ </p><p>  As an example, the following policy instructs Cilium to use egress IP 192.168.33.100 for traffic from all pods in  default namespace and destinedto the external CIDR  192.168.33.13/32. That egress traffic will be redirectedto the (gateway) node to which  192.168.33.100 was assigned. More informationabout the egress gateway can be found in the getting started guide.</p><p>ä½œä¸ºç¤ºä¾‹ï¼Œä»¥ä¸‹ç­–ç•¥æŒ‡ç¤ºçº¤ç»†ç”¨äºä½¿ç”¨é»˜è®¤å‘½åç©ºé—´ä¸­æ‰€æœ‰PODçš„æµé‡EIL IP 192.168.33.100ï¼Œå¹¶å‘å‡ºå¤–éƒ¨CIDR 192.168.33.13/32ã€‚å°†é‡å®šå‘åˆ°å‡ºå£æµé‡å°†è¢«é‡å®šå‘åˆ°ï¼ˆç½‘å…³ï¼‰èŠ‚ç‚¹ï¼Œä¸ºåˆ†é…192.168.33.100çš„èŠ‚ç‚¹ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨å…¥é—¨æŒ‡å—ä¸­æ‰¾åˆ°å‡ºå£ç½‘å…³ã€‚</p><p> apiVersion : cilium.io/v2alpha1 kind : CiliumEgressNATPolicy metadata :  name : egress -sample spec :  egress :  -  podSelector :  matchLabels :  # The following label selects default namespace  io.kubernetes.pod.namespace : default  destinationCIDRs :  - 192.168.33.13/32  egressSourceIP :  &#34;192.168.33.100&#34;</p><p> apierionï¼šcilium.io/v2alpha1ç§ç±»ï¼šciliumegressnatpolicyå…ƒæ•°æ®ï¼šåç§°ï¼šEgress -sample specï¼šå‡ºå£ï¼š -  podselectorï¼šmatchlabelsï¼šï¼ƒä¸‹é¢çš„æ ‡ç­¾é€‰æ‹©é»˜è®¤å‘½åç©ºé—´io.kubernetes.pod.namespaceï¼šé»˜è®¤ç›®çš„åœ°cidrsï¼š -  192.168.33.13/32 EIGRESSOURCEIPï¼šï¼†ï¼ƒ34; 192.168.33.100ï¼†ï¼ƒ34;</p><p>    As Kubernetes becomes more pervasive in on-premise environments, usersincreasingly have both traditional applications and Cloud Native applicationsin their environments. In order to connect them together and allow outsideaccess, a mechanism to integrate Kubernetes and the existing networkinfrastructure running BGP is needed.</p><p>    ç”±äºKubernetesåœ¨å†…éƒ¨å†…éƒ¨ç¯å¢ƒä¸­å˜å¾—æ›´åŠ æ™®éï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„åº”ç”¨ç¨‹åºå’Œäº‘æœ¬æœºåº”ç”¨ç¨‹åºã€‚ä¸ºäº†å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·å¹¶å…è®¸OutsideAccessï¼Œéœ€è¦ä¸€ç§é›†æˆKuberneteså’Œè¿è¡ŒBGPçš„ç°æœ‰ç½‘ç»œå¸§çš„æœºåˆ¶ã€‚</p><p> The 1.10 release of Cilium brings integrated support for BGP, exposingKubernetes to the outside and all the while simplifying users&#39; deployments.The integration is done via  MetalLB, leveragingthe effective implementation of the service IP allocator and the L3 protocolsupport for BGP. With this, Cilium is now able to allocate service IPs forservices of type  LoadBalancer and announce them via BGP to their BGProuters. Now, services are able to be reached externally from traffic outsideof the cluster, without any additional components.</p><p> 1.10çº¤æ¯›é‡Šæ”¾ä¸ºBGPå¸¦æ¥äº†ä¸€ä½“åŒ–æ”¯æŒï¼Œå°†kubernetesæ›å…‰åˆ°å¤–éƒ¨ï¼ŒåŒæ—¶ç®€åŒ–ç”¨æˆ·ï¼†ï¼ƒ39;éƒ¨ç½²ã€‚é›†æˆé€šè¿‡MetallBå®Œæˆï¼Œåˆ©ç”¨â€œæœåŠ¡IPåˆ†é…å™¨çš„æœ‰æ•ˆå®ç°â€å’Œâ€œBGPçš„L3 ProtocalSupportâ€ã€‚æœ‰äº†è¿™ä¸ªï¼ŒCiliumç°åœ¨èƒ½å¤Ÿåˆ†é…LoadBalancerç±»å‹çš„æœåŠ¡IPSæœåŠ¡ï¼Œå¹¶é€šè¿‡BGPå‘å…¶BGProuterså®£å¸ƒå®ƒä»¬ã€‚ç°åœ¨ï¼Œèƒ½å¤Ÿä»é›†ç¾¤å¤–éƒ¨çš„æµé‡å¤–éƒ¨è¾¾åˆ°æœåŠ¡ï¼Œè€Œæ— éœ€ä»»ä½•å…¶ä»–ç»„ä»¶ã€‚</p><p>  In the future, we plan to support announcing Pod CIDRs and the  EgressIP Gateway via BGP as well. This will further improve thebridging between Cloud Native and traditional environments.</p><p>  æœªæ¥ï¼Œæˆ‘ä»¬ä¹Ÿè®¡åˆ’é€šè¿‡BGPæ”¯æŒå®£å¸ƒPOD CIDRå’ŒEIGRINGEIPç½‘å…³ã€‚è¿™å°†è¿›ä¸€æ­¥æ”¹å–„äº‘æœ¬æœºå’Œä¼ ç»Ÿç¯å¢ƒä¹‹é—´çš„ç»‡å¸ƒã€‚</p><p> The following is an example  ConfigMap that&#39;s used to configure Cilium&#39;s BGPfeature. The two main aspects of the configuration are  peers and address-pools. The former is for connecting with the existing BGP routersin the network, so an IP address and an ASN are required. The latter is thepool from which Cilium will allocate an IP to a  LoadBalancer service. For abit of background, services of type  LoadBalancer in Kubernetes rely onanother component to fill the gap of allocating external IPs, which is whyCilium needs to be configured with that information.</p><p> ä»¥ä¸‹æ˜¯ï¼†ï¼ƒ39; sç”¨äºé…ç½®çº¤æ¯›çš„ç¤ºä¾‹configmapå’Œï¼ƒ39; s bgpfeatureã€‚é…ç½®çš„ä¸¤ä¸ªä¸»è¦æ–¹é¢æ˜¯å¯¹ç­‰ä½“å’Œåœ°å€æ± ã€‚å‰è€…ç”¨äºä¸ç°æœ‰çš„BGPè·¯ç”±å™¨è¿æ¥ç½‘ç»œï¼Œå› æ­¤éœ€è¦IPåœ°å€å’ŒASNã€‚åè€…æ˜¯Ciliumå°†IPåˆ†é…ç»™LoadBalanceræœåŠ¡çš„æ± ã€‚å¯¹äºBubber of Backgroundï¼ŒKubernetesä¸­çš„LoadBalancerç±»å‹çš„æœåŠ¡ä¾é OnAlotherç»„ä»¶æ¥å¡«å……åˆ†é…å¤–éƒ¨IPçš„é—´éš™ï¼Œè¿™æ˜¯éœ€è¦é…ç½®è¯¥ä¿¡æ¯çš„WhiConiumã€‚</p><p> apiVersion : v1 kind : ConfigMap metadata :  name : bgp -config  namespace : kube -system data :  config.yaml :  |  peers: - peer-address: 10.0.0.1 peer-asn: 64512 my-asn: 64512 address-pools: - name: default protocol: bgp addresses: - 192.0.2.0/24</p><p> apiersionï¼šv1ç§ï¼šconfigmapå…ƒæ•°æ®ï¼šåç§°ï¼šbgp -configå‘½åç©ºé—´ï¼škube -system dataï¼šconfig.yamlï¼š|åŒè¡Œï¼š -  PEER-Addressï¼š10.0.0.1 PEER-ASNï¼š64512 MY-ASNï¼š64512åœ°å€æ± ï¼š - åç§°ï¼šé»˜è®¤åè®®ï¼šBGPåœ°å€ï¼š -  192.0.2.0/24 </p><p>     Cilium has been progressively adding support for allocating IP addressesdirectly from cloud APIs, notably from  AWS ENI (v1.6) and  Azure (v1.8).This release adds an IPAM mode for Alibaba Cloud, allowing Cilium to utilizeAlibaba Cloud ENI (Elastic Network Interface) for Pod IPs.The architectureensures that only a single operator communicates with the Alibaba Cloud APIsto avoid rate-limiting issues in large clusters.</p><p>Ciliumä¸€ç›´åœ¨é€æ­¥å¢åŠ ç”¨äºä»äº‘APIåˆ†é…IPåœ°å€çš„æ”¯æŒï¼Œç‰¹åˆ«æ˜¯ä»AWS ENIï¼ˆv1.6ï¼‰å’ŒAzureï¼ˆv1.8ï¼‰ã€‚è¿™ä¸€ç‰ˆæœ¬ä¸ºé˜¿é‡Œå·´å·´äº‘æ·»åŠ äº†IPAMæ¨¡å¼ï¼Œå…è®¸çº¤æ¯›åˆ°UtilizeAlibabaäº‘ENIï¼ˆå¼¹æ€§ç½‘ç»œPOD IPSçš„æ¥å£ï¼‰ã€‚åªæœ‰å•ä¸ªæ“ä½œå‘˜ä¸é˜¿é‡Œå·´å·´äº‘APISTOé€šä¿¡çš„æ¶æ„ï¼Œé¿å…äº†å¤§é›†ç¾¤ä¸­çš„é€Ÿç‡é™åˆ¶é—®é¢˜ã€‚</p><p>  In this mode, pods are assigned with ENI IPs, which are directly routable in theAlibabaCloud VPC. This simplifies communication of pod traffic within VPCs andavoids the need for SNAT. With the cloud-native network solution, user caneasily use cloud resource like Cloud Enterprise Network (CEN) or VPN gateway toconnect to your on-premises data centers.</p><p>  åœ¨æ­¤æ¨¡å¼ä¸‹ï¼ŒPODSä¸ENI IPSåˆ†é…ï¼Œå¯åœ¨Thealababacloud VPCä¸­ç›´æ¥è·¯ç”±ã€‚è¿™ç®€åŒ–äº†VPCSä¸­PODæµé‡çš„é€šä¿¡anavoidså¯¹SNATçš„éœ€æ±‚ã€‚ä½¿ç”¨äº‘æœ¬æœºç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°ä½¿ç”¨äº‘ä¼ä¸šç½‘ç»œï¼ˆCENï¼‰æˆ–VPNç½‘å…³çš„äº‘èµ„æºï¼Œæˆ–è€…å°†VPNç½‘å…³è¿æ¥åˆ°æ‚¨çš„æœ¬åœ°æ•°æ®ä¸­å¿ƒã€‚</p><p>      With the 1.10 release, we are adding support for transparent encryption viathe  WireGuard protocol. Transparent encryptionis a feature which ensures that traffic between Cilium-managed pods is alwayssent through a secure tunnel, thereby allowing users to run Kubernetes inuntrusted networks.</p><p>      é€šè¿‡1.10ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ­£åœ¨é€šè¿‡Wiguardåè®®å¢åŠ å¯¹é€æ˜åŠ å¯†çš„æ”¯æŒã€‚é€æ˜åŠ å¯†å¯ä»¥é€šè¿‡å®‰å…¨çš„éš§é“å§‹ç»ˆé€æ˜åœ°ï¼Œç¡®ä¿çº¤æ¯›ç®¡ç†çš„PODä¹‹é—´çš„æµé‡ï¼Œä»è€Œå…è®¸ç”¨æˆ·è¿è¡ŒKubernetes inntrustedç½‘ç»œã€‚</p><p> Cilium had support for transparent encryption via IPSec already since version1.4, but we were motivated to add WireGuard as an alternative option formultiple reasons. Firstly, WireGuard is a very opinionated protocol and doesnot allow the tuning of parameters such as the key size and cipher suite,which makes it very easy to use and simplifies deployment and operations.The encryption key pair for each node is automatically generated by Cilium andkey rotation is performed transparently by the WireGuard kernel module.</p><p> Ciliumå·²æ”¯æŒè‡ªç‰ˆæœ¬1.4ä»¥æ¥ï¼Œé€šè¿‡IPsecæä¾›äº†é€æ˜åŠ å¯†ï¼Œä½†æˆ‘ä»¬è¢«æ¿€åŠ±æ·»åŠ Wieguardä½œä¸ºæ›¿ä»£é€‰é¡¹çš„æˆåˆ†åŸå› ã€‚é¦–å…ˆï¼ŒWioguardæ˜¯ä¸€ä¸ªéå¸¸è‡ªä»¥ä¸ºæ´¾çš„åè®®ï¼Œå¹¶ä¸”ä¸å…è®¸è°ƒæ•´é”®å¤§å°å’Œå¯†ç å¥—ä»¶çš„å‚æ•°ï¼Œè¿™ä½¿å¾—å¯ä»¥æ˜“äºä½¿ç”¨å’Œç®€åŒ–éƒ¨ç½²å’Œæ“ä½œã€‚æ¯ä¸ªèŠ‚ç‚¹çš„åŠ å¯†å¯†é’¥å¯¹è‡ªåŠ¨ç”Ÿæˆicilium andkeyç”Ÿæˆã€‚æ—‹è½¬ç”±Wioguardå†…æ ¸æ¨¡å—é€æ˜åœ°æ‰§è¡Œã€‚</p><p>  WireGuard also has performance advantages over IPSec for certain workloads. Inour recent  CNI performance analysis blog post,we evaluated both protocols and found that WireGuard can achieve very highthroughput for streaming workloads, but IPSec still can achieve better latency,and the encryption algorithm can be offloaded to the CPU in certain cases.The graph above shows a short excerpt from our experiments, make sureto read the full blog post for more details and explanations.</p><p>  WIREGUARDè¿˜å…·æœ‰åœ¨IPSecä¸Šå…·æœ‰ç‰¹å®šå·¥ä½œè´Ÿè½½çš„æ€§èƒ½ä¼˜åŠ¿ã€‚ Inouræœ€è¿‘çš„CNIæ€§èƒ½åˆ†æåšå®¢æ–‡ç« ï¼Œæˆ‘ä»¬è¯„ä¼°äº†ä¸¤ä¸ªåè®®ï¼Œå‘ç°Wioguardå¯ä»¥å®ç°æµåŠ¨å·¥ä½œè´Ÿè½½çš„éå¸¸ç¨³ä¹…åŒ–ï¼Œä½†IPSecä»ç„¶å¯ä»¥å®ç°æ›´å¥½çš„å»¶è¿Ÿï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥å°†åŠ å¯†ç®—æ³•å¸è½½åˆ°CPUã€‚ä¸Šé¢çš„å›¾è¡¨æˆ‘ä»¬çš„å®éªŒä¸­çš„ç®€çŸ­æ‘˜å½•ï¼Œè®©SureToé˜…è¯»å®Œæ•´åšå®¢å¸–å­ä»¥è·å–æ›´å¤šç»†èŠ‚å’Œè§£é‡Šã€‚</p><p> Another technical advantage of WireGuard is that it integrates well into thearchitecture of the Cilium datapath. Because the secure tunnel is exposed asa Linux network interface, WireGuard makes it very easy to mark packetsoriginating from containers for encryption and subsequently forward them tothe secure tunnel device. The animation below shows the life of a WireGuardencrypted packet in Cilium:</p><p> Wioguardçš„å¦ä¸€ä¸ªæŠ€æœ¯ä¼˜åŠ¿åœ¨äºå®ƒé›†æˆäº†çº¤æ¯›æ•°æ®åº“çš„åˆ’çº¿éƒ¨ä»¶ã€‚ç”±äºå®‰å…¨éš§é“æš´éœ²ASA Linuxç½‘ç»œæ¥å£ï¼Œå› æ­¤WIREGUARDä½¿å¾—ä»å®¹å™¨ä¸­ç²—ç•¥åœ°æ ‡è®°ä¸ºåŠ å¯†ï¼Œç„¶åè½¬å‘å®ƒä»¬çš„å®‰å…¨éš§é“è®¾å¤‡ã€‚ä¸‹é¢çš„åŠ¨ç”»æ˜¾ç¤ºäº†Ciliumä¸­çš„Wireguardencrypted Packetçš„ç”Ÿæ´»ï¼š</p><p>  WireGuard encryption in Cilium 1.10 is supported both in direct routing andtunneling mode, and may also be enabled in managed Kubernetes environments ifthe underlying Linux kernel supports it. Support for host-level encryptionand Cilium&#39;s L7 policy enforcement and visibility features is currently lackingand will be added in an upcoming Cilium releases.</p><p>  åœ¨ç›´æ¥è·¯ç”±å’Œç‰¹éš§é“æ¨¡å¼ä¸‹ï¼ŒCilium 1.10ä¸­çš„WioguardåŠ å¯†æ”¯æŒï¼Œå¦‚æœåº•å±‚Linuxå†…æ ¸æ”¯æŒå®ƒï¼Œä¹Ÿå¯ä»¥åœ¨æ‰˜ç®¡çš„Kubernetesç¯å¢ƒä¸­å¯ç”¨ã€‚åœ¨å³å°†ä¸¾è¡Œçš„çº¤ç»†å‘å¸ƒä¸­ï¼Œç›®å‰ç¼ºå°‘å¯¹ä¸»æœºçº§åŠ å¯†å’Œçº¤ç»†çš„çº¤ç»†ï¼†ï¼ƒ39; S L7ç­–ç•¥æ‰§è¡Œå’Œå¯è§æ€§åŠŸèƒ½ã€‚ </p><p> If you want to know more about the WireGuard integration in Cilium, make sureto watch to the recording of the   eCHO episode 3 livestreamand read our   getting started guidein the Cilium documentation.</p><p>å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºCiliumä¸­çš„Wioguardé›†æˆï¼Œè¯·å°†SureTo Watchå½•åˆ¶åˆ°å›å£°é›†ç¬¬3é›†Livestreamå’Œè¯»å–æˆ‘ä»¬å…¥é—¨æŒ‡å—çš„å½•éŸ³ã€‚</p><p>    Cilium has IPv4/v6 dual-stack support since it was created. In fact, in Cilium&#39;s very early prototype, we started out with an IPv6-only implementation. GivenKubernetes was lacking official dual-stack integration for some time now, theCilium IPv6 support for Pods and Services was a bit cumbersome to operate.With the last Kubernetes stable version that was released this has changed now:Kubernetes 1.21 introduced  beta support for dual-stack enabled by default.With Cilium 1.10, we integrated the Kubernetes dual-stack support, so thatPods are now properly integrated to allow for dual-stack IP address allocationand, similarly, Service IPv4/v6 addressing propagates down into the CiliumeBPF kube-proxy-replacement.</p><p>    Ciliumå…·æœ‰IPv4 / V6åŒå †æ ˆæ”¯æŒï¼Œå› ä¸ºå®ƒåˆ›å»ºã€‚äº‹å®ä¸Šï¼Œåœ¨çº¤æ¯›ä¸­ï¼Œåœ¨éå¸¸æ—©æœŸçš„åŸå‹ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹ä½¿ç”¨IPv6å®ç°ã€‚é‰´äºkubernetesä¸€æ®µæ—¶é—´ç¼ºä¹å®˜æ–¹åŒå †æ ˆé›†æˆï¼ŒIPv6å¯¹è±†èšå’ŒæœåŠ¡çš„æ”¯æŒæœ‰ç‚¹ç¹çã€‚éšç€é‡Šæ”¾çš„æœ€åä¸€ä¸ªKubernetesç¨³å®šçš„ç‰ˆæœ¬ï¼Œç°åœ¨å·²ç»æ”¹å˜äº†ï¼šKubernetes 1.21å¼•å…¥äº†åŒå †æ ˆçš„æµ‹è¯•ç‰ˆæ”¯æŒé»˜è®¤æƒ…å†µä¸‹å¯ç”¨.WithCilium 1.10ï¼Œæˆ‘ä»¬é›†æˆäº†KubernetesåŒå †æ ˆæ”¯æŒï¼Œå› æ­¤ç°åœ¨å¯ä»¥æ­£ç¡®åœ°é›†æˆPiliumeBPF Kube-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxyæ›¿æ¢æ—¶é›†æˆäº†kubernetesåŒå †æ ˆæ”¯æŒï¼Œä»¥ä¾¿å…è®¸å¯¹åŒå †æ ˆIPåœ°å€allocationandè¿›è¡Œäº†æ­£ç¡®é›†æˆã€‚ ã€‚</p><p>  $  helm  install cilium cilium/cilium --version  1.10.0  \ --namespace kube-system \ --set ipv4.enabled=true \ --set ipv6.enabled=true  $  kubectl get cep -n kube-system NAME ENDPOINT ID IDENTITY ID ENDPOINT STATE IPV4 IPV6coredns-755cd654d4-msqgm 2205 11023 ready 10.16.115.242 fd02::71cf</p><p>  $ Helm Install Cilium cilium / cilium -version 1.10.0 \  -  innespace kube-system \ --set ipv4.enabled = true \ --set ipv6.enabled = true $ kubectl get cep-n kube-system nameç«¯ç‚¹IDèº«ä»½IDç«¯ç‚¹çŠ¶æ€IPv4 IPv6coreDNS-755CD654D4-MSQGM 2205 11023 Ready 10.16.115.242 FD02 :: 71CF</p><p>    In previous releases, the Cilium core team have made snapshots available onARM64 platform for initial testing. However, until now the official images forCilium have not yet been prepared for this platform. During this developmentcycle, we worked on several improvements to the image build infrastructure forthe project to allow automatic build of multi-arch docker images for bothlinux/amd64 and linux/arm64 platforms. Beginning with Cilium 1.10, the officialCilium repositories on Docker Hub and Quay.io will host these multi-archimages.</p><p>    åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒCilium Coreå›¢é˜Ÿå·²ç»ä¸ºåˆå§‹æµ‹è¯•æä¾›äº†Snapshots Onarm64å¹³å°ã€‚ä½†æ˜¯ï¼Œç›´åˆ°ç°åœ¨ç°åœ¨å°šæœªä¸ºè¿™ä¸ªå¹³å°åšå¥½å‡†å¤‡å®˜æ–¹å½¢è±¡ã€‚åœ¨æ­¤å¼€å‘å¾ªç¯æœŸé—´ï¼Œæˆ‘ä»¬åœ¨è‹¥å¹²å·¥ç¨‹ä¸­å¯¹å›¾åƒæ„å»ºåŸºç¡€è®¾æ–½è¿›è¡Œäº†å‡ ç§æ”¹è¿›ï¼Œå…è®¸è‡ªåŠ¨æ„å»ºç”¨äºåŒæ—/ amd64å’ŒLinux / ARM64å¹³å°çš„å¤šæ‹±å½¢Dockerå›¾åƒã€‚ä»Cilium 1.10å¼€å§‹ï¼ŒDocker Hubå’ŒQuay.IOä¸Šçš„Nexternciliumå­˜å‚¨åº“å°†æ‰˜ç®¡è¿™äº›å¤šæ‹±åƒé˜€ã€‚</p><p> Installing Cilium on ARM64 works similarly to the setup on other platforms,using the same image tags and digests as the AMD64 docker images. This unlocks theability to run Cilium on a range of new hardware including AWS Gravitoninstances and Azure Linux/ARM64 pipelines. Cilium has even been spotted in thewild, running on a smartphone!</p><p> åœ¨ARM64ä¸Šå®‰è£…CILIUMä¸å…¶ä»–å¹³å°ä¸Šçš„è®¾ç½®ç±»ä¼¼ï¼Œä½¿ç”¨ç›¸åŒçš„å›¾åƒæ ‡ç­¾å’Œæ‘˜è¦ä½œä¸ºAMD64 Dockerå›¾åƒã€‚è¿™ä½¿å¾—åœ¨åŒ…æ‹¬AWS Gravitonistanceså’ŒAzure Linux / ARM64ç®¡é“çš„ä¸€ç³»åˆ—æ–°ç¡¬ä»¶ä¸Šè¿è¡Œçº¤æ¯›çš„æˆå‰§æ€§ã€‚çº¤æ¯›ç”šè‡³åœ¨å¨å°”èµ›ä¸­å‘ç°äº†æ™ºèƒ½æ‰‹æœºï¼</p><p> Armbian trunk on a Snapdragon 835 (OnePlus 5) running k8s and Cilium eBPF  @armbian  @ciliumproject  @kubernetesio ğŸ‰  pic.twitter.com/QXMCiox12X</p><p> åœ¨Snapdragon 835ï¼ˆoneplus 5ï¼‰ä¸Šè¿è¡ŒK8så’ŒCilium EBPF @Ambian @ciliumproject @kubernetesioğŸ‰pic.twitter.com/qxmciox12x</p><p>â€” Ricardo Pardini (@SilvioSantoZ)  May 12, 2021</p><p> -  Ricardo Pardiniï¼ˆ@Silviosantozï¼‰2021å¹´5æœˆ12æ—¥ </p><p>     A new  CLI is available that can be usedto install and manage Cilium clusters. The CLI talks directly to the KubernetesAPI and offers a variety of functionality to manage different aspects ofCilium. The CLI is backward compatible to older versions of Cilium.</p><p>å¯ä»¥ä½¿ç”¨æ–°çš„CLIï¼Œå¯ç”¨äºå®‰è£…å’Œç®¡ç†çº¤ç»†é›†ç¾¤ã€‚ CLIç›´æ¥ä¸Kubernetesapiè¿›è¡Œè°ˆè¯ï¼Œæä¾›å„ç§åŠŸèƒ½æ¥ç®¡ç†ysciliumçš„ä¸åŒæ–¹é¢ã€‚ CLIå‘åå…¼å®¹æ—§ç‰ˆæœ¬çš„çº¤æ¯›ã€‚</p><p>   The  cilium status command allows to quickly determine the status of anyCilium installation. It will indicate the number of unhealthy Cilium componentsand quickly expose failure states in any of the nodes:</p><p>   Cilium Statuså‘½ä»¤å…è®¸å¿«é€Ÿç¡®å®šAnyCilliumå®‰è£…çš„çŠ¶æ€ã€‚å®ƒå°†æŒ‡ç¤ºä¸å¥åº·çš„çº¤æ¯›ç»„ä»¶æ•°é‡ï¼Œå¹¶åœ¨ä»»ä½•èŠ‚ç‚¹ä¸­å¿«é€Ÿå…¬å¼€å¤±è´¥çŠ¶æ€ï¼š</p><p> $ cilium status /Â¯Â¯\ /Â¯Â¯\__/Â¯Â¯\ Cilium: OK \__/Â¯Â¯\__/ Operator: OK /Â¯Â¯\__/Â¯Â¯\ Hubble: disabled \__/Â¯Â¯\__/ ClusterMesh: disabled \__/Deployment cilium-operator Desired: 2, Ready: 2/2, Available: 2/2DaemonSet cilium Desired: 2, Ready: 2/2, Available: 2/2Containers: cilium Running: 2 cilium-operator Running: 2Image versions cilium quay.io/cilium/cilium:v1.10.0: 2 cilium-operator quay.io/cilium/operator-generic:v1.10.0: 2</p><p> $ cilium status / miliumï¼š__ \ ciliumï¼šå¥½çš„\ __ /Â¯\ __ /è¿ç®—ç¬¦ï¼šOK / \ \ __ /Â¯Â¯\ï¼šç¦ç”¨\ __ /Â¯\ __ / ClusterMeshï¼šç¦ç”¨\ __ /éƒ¨ç½²çº¤è¥¿è¿ç®—ç¬¦æ‰€éœ€ï¼š2ï¼Œå‡†å¤‡ï¼š2/2ï¼Œå¯ç”¨ï¼š2 / 2daemonset Ciliumæ‰€éœ€ï¼š2ï¼Œå‡†å¤‡ï¼š2/2ï¼Œå¯ç”¨ï¼š2/2 Containersï¼šCiliumè¿è¡Œï¼š2å˜ç±³è¿è¡Œï¼š2Imageç‰ˆæœ¬ç•ªè”æQuay.io/cilium/cilium :v1.10.0ï¼š2 icilium-operator quay.io/cilium/operator-generic :v1.10.0ï¼š2</p><p>  A new connectivity test can be run with a single command ( cilium connectivitytest). It ensures correctness in networking, Kubernetes services andNetworkPolicy enforcement and is ideal to validate whether Cilium has beencorrectly installed.</p><p>  å¯ä»¥ä½¿ç”¨å•ä¸ªå‘½ä»¤ï¼ˆCilium ConnectiveTtestï¼‰è¿è¡Œæ–°çš„è¿æ¥æµ‹è¯•ã€‚å®ƒç¡®ä¿ç½‘ç»œä¸­çš„æ­£ç¡®æ€§ï¼ŒKubernetes Serviceså’ŒNetworkpolicyå¼ºåˆ¶ï¼Œéå¸¸é€‚äºéªŒè¯CILIUMæ˜¯å¦å·²å®‰è£…ã€‚</p><p> $ cilium connectivity testâœ¨ [gke_cilium-dev_us-west2-a_test-21504] Creating namespace for connectivity check...âœ¨ [gke_cilium-dev_us-west2-a_test-21504] Deploying echo-same-node service...[...]---------------------------------------------------------------------------------------------------------------------ğŸ”Œ [pod-to-pod] Testing cilium-test/client-68c6675687-tcw9f -&gt; cilium-test/echo-other-node-588bf78fbb-84fvc...---------------------------------------------------------------------------------------------------------------------âœ… [pod-to-pod] cilium-test/client-68c6675687-tcw9f (10.96.6.173) -&gt; cilium-test/echo-other-node-588bf78fbb-84fvc (10.96.5.226)[...]---------------------------------------------------------------------------------------------------------------------ğŸ“‹ Test Report---------------------------------------------------------------------------------------------------------------------âœ… 9/9 tests successful (0 warnings)</p><p> $ ciliumè¿æ¥æµ‹è¯•Â¶[gke_cilium-dev_us-west2-a_test-21504]åˆ›å»ºè¿æ¥çš„å‘½åç©ºé—´ï¼Œç”¨äºè¿æ¥æ£€æŸ¥......âœ¨[gke_cilium-dev_us-west2-a_test-21504]éƒ¨ç½²å›å£°ç›¸åŒèŠ‚ç‚¹æœåŠ¡... [... ... ] --------------------------------------------- ---------------------------------------------------------------- ----------------ğŸ”Œ[Pod-to-pod]æµ‹è¯•çº¤æ¯›æµ‹è¯•/ client-68c6675687-tcw9f  - ï¼†gt;çº¤æ¯› - æµ‹è¯•/å›å£° - å…¶ä»– - èŠ‚ç‚¹-588bf78fbb-84fvc ... ---------------------------------------------------------------- ---------------------------------------------------------------- ------------------------------ [Pod-to-pod]çº¤æ¯› - æµ‹è¯•/å®¢æˆ·ç«¯-68C6675687-TCW9F ï¼ˆ10.96.6.173ï¼‰ - ï¼†gt;çº¤æ¯› - æµ‹è¯•/å›å£° - å…¶ä»– - èŠ‚ç‚¹-588bf78fbb-84fvcï¼ˆ10.96.5.226ï¼‰[...] ------------------------- ---------------------------------------------------------------- ---------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------âœ…9/9æµ‹è¯•æˆåŠŸï¼ˆ0è­¦å‘Šï¼‰</p><p>    Following up work from previous releases,we continued to rigorously evaluate Cilium&#39;s networking performance. Our latestfindings were recently summarized in a blog post as well as integratedinto Cilium&#39;s  documentation,where we provided numbers for different types of direct routing workloads, showedhow eBPF enables for low-latency as well as high CNI throughput performance, andcompared WireGuard to IPsec.</p><p>    ä»ä»¥å‰çš„ç‰ˆæœ¬å¼€å§‹å·¥ä½œï¼Œæˆ‘ä»¬ç»§ç»­ä¸¥æ ¼è¯„ä¼°çº¤é’™ï¼†ï¼ƒ39; Sç½‘ç»œæ€§èƒ½ã€‚æˆ‘ä»¬çš„æœ€æ–°åŠŸèƒ½æœ€è¿‘è¢«æ¦‚è¿°åœ¨ä¸€ä¸ªåšå®¢å¸–å­ä»¥åŠindodationInto ciliumï¼†ï¼ƒ39; sæ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸åŒç±»å‹çš„ç›´æ¥è·¯ç”±å·¥ä½œè´Ÿè½½æä¾›äº†æ•°å­—ï¼Œæ˜¾ç¤ºäº†eBPFï¼Œç”¨äºä½å»¶è¿Ÿä»¥åŠé«˜CNIååé‡æ€§èƒ½ï¼Œå¹¶ä¸ä¹‹è®¡ç®—çš„Wineoguard IPsecã€‚</p><p> Guided by our in-depth performance evaluation, Cilium 1.10 includes a number ofdatapath improvements, this time mainly focussed on the VXLAN/Geneve tunnelingperformance as well as reduction of Netfilter overhead. Most notably:</p><p> é€šè¿‡æˆ‘ä»¬æ·±å…¥çš„ç»©æ•ˆè¯„ä¼°ï¼ŒCilium 1.10åŒ…æ‹¬ä¸€ä¸ªæ•°é‡çš„atdatapathæ”¹è¿›ï¼Œè¿™æ¬¡ä¸»è¦é›†ä¸­åœ¨Vxlan / Geneve TunneDingperforcanceä»¥åŠNetFilterå¼€é”€çš„å‡å°‘ã€‚æœ€ä¸ºæ˜¾ç€åœ°ï¼š </p><p> BPF host routingwas extended to support encapsulation. This means that maximizing performanceusing eBPF can now be achieved in both direct routing and tunneling modes. Inparticular, this improves the north-south service handling to be on par withthe direct routing mode since network traffic does not need to be processed bythe upper host stack anymore.</p><p>BPFä¸»æœºRoutingwasæ‰©å±•åˆ°æ”¯æŒå°è£…ã€‚è¿™æ„å‘³ç€ç°åœ¨å¯ä»¥åœ¨ç›´æ¥è·¯ç”±å’Œéš§é“æ¨¡å¼ä¸­å®ç°æœ€å¤§åŒ–æ€§èƒ½EBPFã€‚ä¸çº¯ï¼Œè¿™æ”¹å–„äº†å—åŒ—æœåŠ¡å¤„ç†ä¸ç›´æ¥è·¯ç”±æ¨¡å¼ç›¸æ¥çš„åŒ—æ–¹æœåŠ¡å¤„ç†ï¼Œå› ä¸ºç½‘ç»œæµé‡ä¸éœ€è¦é€šè¿‡ä¸Šä¸»å †ä¸å†å¤„ç†ã€‚</p><p> We identified and fixeda performance issue in the Linux kernel, where the GRO aggregation of encapsulatedUDP packets for VXLAN and Geneve was delayed, leading to suboptimal performancewhen using encapsulation with Cilium. The fix has been backported to all stablekernels (e.g., 4.9)as well as integrated into downstream distributions such as Ubuntu LTS variants.In our test environment, this more than doubled the Gbit/s TCP single-streamthroughput rate for traffic subject to VXLAN and Geneve encapsulation.</p><p> æˆ‘ä»¬åœ¨Linuxå†…æ ¸ä¸­è¯†åˆ«å’Œå›ºå®šçš„æ€§èƒ½é—®é¢˜ï¼Œå…¶ä¸­vxlanå’Œgeneveçš„CencapsulateDPæ•°æ®åŒ…çš„Groèšåˆè¢«å»¶è¿Ÿï¼Œå¯¼è‡´ä½¿ç”¨çº¤æ¯›å°è£…çš„å°è£…æ€§èƒ½ã€‚è¯¥ä¿®å¤ç¨‹åºå·²è¢«è¿”å›åˆ°æ‰€æœ‰ç¨³å®šæ€§åº“ï¼ˆä¾‹å¦‚ï¼Œ4.9ï¼‰ä»¥åŠé›†æˆåˆ°ä¸‹æ¸¸åˆ†å¸ƒä¸­ï¼Œå¦‚Ubuntu LTSå˜ä½“ã€‚åœ¨æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼Œè¿™å¢åŠ äº†Gbit / S TCPå•æµç¨‹ç‡ï¼Œå¯¹VXLANçš„æµé‡å¢åŠ äº†ä¸€å€ä»¥ä¸Šçš„æµé‡Geneveå°è£…ã€‚</p><p> Finally, Cilium can now be configured to skip Netfilter conntrack: we introduced a newagent option,  --install-no-conntrack-iptables-rules, which allows to skipNetfilter connection tracking whenever possible. You can read more in the tuning guide.</p><p> æœ€åï¼ŒCiliumç°åœ¨å¯ä»¥é…ç½®ä¸ºè·³è¿‡NetFilter Conntrackï¼šæˆ‘ä»¬æ¨å‡ºäº†ä¸€ç§æ–°çš„é€‰é¡¹ - â€œç¦æ­¢Conntrack-Iptables-Truelâ€ï¼Œå®ƒå…è®¸åœ¨å°½å¯èƒ½è·³è¿‡XTIPNETFilterè¿æ¥è·Ÿè¸ªã€‚æ‚¨å¯ä»¥åœ¨è°ƒä¼˜æŒ‡å—ä¸­é˜…è¯»æ›´å¤šã€‚</p><p> We will follow-up and publish in-depth results of our performance evaluation for thetunneling setups in an upcoming blog post. Preliminary results from our  test environment yield significant improvements as shown below for the threementioned areas.</p><p> æˆ‘ä»¬å°†åœ¨å³å°†ä»‹ç»çš„åšå®¢æ–‡ç« ä¸­è¿›è¡Œè·Ÿè¿›å¹¶å‘å¸ƒæˆ‘ä»¬çš„ç»©æ•ˆè¯„ä¼°çš„ç»©æ•ˆè¯„ä¼°ç»“æœã€‚æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒçš„åˆæ­¥ç»“æœäº§ç”Ÿäº†æ˜¾ç€çš„æ”¹è¿›ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„å»¶è¿ŸåŒºåŸŸã€‚</p><p>  For the regular Pod to Pod case where traffic needs to traverse through theVXLAN/Geneve tunnel we were able to significantly improve the bulk performancefor large data transfers, typically benchmarked through netperf TCP_STREAM tests.We added a small improvement to the Linux kernel&#39;s GRO engine which is responsibleto optimize the Linux&#39; stack traversal by aggregating MTU-sized packets up to64k super-packets in order to reduce the per-packet processing cost for thestack. We found that the aggregation would happen only inside the VXLAN/Genevedriver&#39;s GRO cell instead of the physical device right upon receive, meaning,packets had to traverse individually through the UDP stack to only be aggregatedthere. Moving the aggregation to the physical device significantly boosted the performance.</p><p>  å¯¹äºå¸¸è§„PODåˆ°Podçš„æƒ…å†µï¼Œå…¶ä¸­æµé‡éœ€è¦é€šè¿‡VXLAN / Geneveéš§é“éå†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ˜¾ç€æé«˜å¤§é‡æ•°æ®ä¼ è¾“çš„æ‰¹é‡æ€§èƒ½ï¼Œé€šå¸¸é€šè¿‡Netperf TCP_Stream Testsè¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚æˆ‘ä»¬ä¸ºLinuxå†…æ ¸æ·»åŠ äº†ä¸€ä¸ªå°çš„æ”¹è¿›ã€‚ GRO Engineï¼Œå®ƒæ˜¯Orkingibletoä¼˜åŒ–Linuxï¼†ï¼ƒ39;é€šè¿‡èšåˆMTUå¤§å°çš„æ•°æ®åŒ…æ¥è·¨è¶Šé«˜è¾¾64Kè¶…çº§æ•°æ®åŒ…çš„å †æ ˆéå†ï¼Œä»¥å‡å°‘å†å²çš„æ¯åŒ…å¤„ç†æˆæœ¬ã€‚æˆ‘ä»¬å‘ç°èšåˆå°†ä»…å‘ç”Ÿåœ¨VXLAN / Genevedriverï¼†ï¼ƒ39; S Groå°åŒºè€Œä¸æ˜¯æ¥æ”¶æ—¶çš„ç‰©ç†è®¾å¤‡ï¼Œæ„æ€ï¼Œå¿…é¡»é€šè¿‡UDPå †æ ˆå•ç‹¬éå†ä»¥æ±‡æ€»ã€‚å°†èšåˆç§»åŠ¨åˆ°ç‰©ç†è®¾å¤‡æ˜¾ç€æé«˜äº†æ€§èƒ½ã€‚</p><p>    For the case where an external client is connecting to a Pod on a Cilium-managednode, for example, through a NodePort service, then the same improvements can beapplied  as done earlierfor the direct routing case. Meaning, forwarding can be performed right in thetc eBPF layer instead of having to push packets up the host stack. This resultsin significant gains in single stream throughput (TCP_STREAM) as well as significantreductions in latency for request/response-type workloads (TCP_RR and TCP_CRR).The gains in such scenarios are less visible when packets have to traverse thetunnel (e.g. for plain Pod to Pod case) since this mandates going through the upperUDP stack, but this is not the case for services where, for example, the backendsare local on the node. A typical use case is NodePort under  externalTrafficPolicy=Local.</p><p>    å¯¹äºå¤–éƒ¨å®¢æˆ·ç«¯åœ¨çº¤æ¯›ç®¡ç†ç¼–ç ä¸Šè¿æ¥åˆ°PODçš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡NodePortæœåŠ¡ï¼Œé‚£ä¹ˆä¸ç›´æ¥è·¯ç”±æ¡ˆä¹‹å‰çš„é‚£æ ·å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ”¹è¿›ã€‚å«ä¹‰ï¼Œè½¬å‘å¯ä»¥åœ¨Thetc EBPFå±‚ä¸­æ‰§è¡Œï¼Œè€Œä¸æ˜¯å¿…é¡»å°†æ•°æ®åŒ…æ¨é€åˆ°ä¸»å †æ ˆã€‚è¯¥ç»“æœåœ¨å•æµååé‡ï¼ˆTCP_STREAMï¼‰ä¸­çš„æ˜¾ç€æå‡ä»¥åŠè¯·æ±‚/å“åº”ç±»å‹å·¥ä½œè´Ÿè½½ï¼ˆTCP_RRå’ŒTCP_CRRï¼‰çš„å»¶è¿Ÿä¸­çš„æ˜¾ç€å»¶è¿Ÿã€‚å½“æ•°æ®åŒ…å¿…é¡»éå†THETUNNELæ—¶ï¼Œè¿™ç§æƒ…å†µçš„å¢ç›Šä¸å¤ªå¯è§ï¼ˆä¾‹å¦‚ï¼Œç”¨äºæ™®é€šè±†èšPOD CASEï¼‰ç”±äºæ­¤ä»»åŠ¡é€šè¿‡uppeudpå †æ ˆï¼Œä½†æ˜¯ï¼Œå¯¹äºèŠ‚ç‚¹ä¸Šçš„åé€€æœ¬åœ°çš„æœåŠ¡ï¼Œè¿™ä¸æ˜¯æœåŠ¡ã€‚å…¸å‹ç”¨ä¾‹æ˜¯NoderTrafficpolicy = Localä¸‹çš„NodePortã€‚</p><p>    For the last case we investigated the direct routing performance when users dohave the constraint of having to pass through the Netfilter subsystem in the hoststack, be it due to running an older kernel or simply due to having Cilium deployedwith custom Netfilter rules. In particular the Netfilter connection tracker canadd a significant cost to the fast-path and might not be needed in all deploymentsituations, especially since we added eBPF-based masquerading that can be used asan alternative already. This traversal cost can then be minimized by disabling theconnection tracking requirement for all Pod traffic, thus bypassing the Net</p><p>    å¯¹äºæœ€åä¸€ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬è°ƒæŸ¥äº†ç›´æ¥è·¯ç”±æ€§èƒ½ï¼Œå½“ç”¨æˆ·æœ‰å¿…è¦é€šè¿‡Hoststackä¸­çš„NetFilterå­ç³»ç»Ÿæ—¶ï¼Œå®ƒæ˜¯ç”±äºè¿è¡Œæ—§çš„å†…æ ¸ï¼Œæˆ–è€…åªæ˜¯ç”±äºå…·æœ‰è‡ªå®šä¹‰NetFilterè§„åˆ™çš„Ciliumã€‚ç‰¹åˆ«æ˜¯NetFilterè¿æ¥è·Ÿè¸ªå™¨CANADDåœ¨æ‰€æœ‰éƒ¨ç½²ä¸­å¯èƒ½ä¸éœ€è¦åœ¨å¿«é€Ÿè·¯å¾„ä¸­ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæˆ‘ä»¬æ·»åŠ äº†åŸºäºEBPFçš„ä¼ªè£…ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ASANæ›¿ä»£å“ã€‚ç„¶åå¯ä»¥é€šè¿‡ç¦ç”¨æ‰€æœ‰PODæµé‡çš„è¿æ¥è·Ÿè¸ªè¦æ±‚æ¥æœ€å°åŒ–è¿™ç§éå†æˆæœ¬ï¼Œä»è€Œç»•è¿‡ç½‘ç»œ </p><p>......</p><p>...... </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://cilium.io/blog/2021/05/20/cilium-110">https://cilium.io/blog/2021/05/20/cilium-110</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/å¢åŠ /">#å¢åŠ </a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/adds/">#adds</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cilium/">#cilium</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
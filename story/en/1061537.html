<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>æˆ‘å¦‚ä½•å»ºé€ ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªè¶…å£°æ³¢æ‰«æä»ª How I built the world's first 3D ultrasonic scanner</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">How I built the world's first 3D ultrasonic scanner<br/>æˆ‘å¦‚ä½•å»ºé€ ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªè¶…å£°æ³¢æ‰«æä»ª </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-10 07:44:27</div><div class="page_narrow text-break page_content"><p>Here&#39;s how I built the first ultrasonic 3d scanner in the world that works in the air, using off-the-shelf components (&lt; $100).   1</p><p>è¿™é‡Œï¼†ï¼ƒ39;æˆ‘å¦‚ä½•åœ¨ç©ºä¸­å·¥ä½œçš„ä¸–ç•Œä¸­å»ºç«‹ç¬¬ä¸€ä¸ªè¶…å£°æ³¢3Dæ‰«æä»ªï¼Œä½¿ç”¨ææ¿çš„ç»„ä»¶ï¼ˆï¼†lt; $ 100ï¼‰ã€‚ 1</p><p> Four years ago, I was 15 and wanted to build an autonomous drone to deliver me Coke cans. For that, I needed an accurate 3D map of the surroundings of my drone to avoid walls and objects in its way. Lidars were too expensive and SLAM  2 didn&#39;t work well. There were ultrasonic sensors, but they could only give out the distance to the nearest object in a 40Â° cone, which wasn&#39;t enough for me.</p><p> å››å¹´å‰ï¼Œæˆ‘15å²ï¼Œæƒ³è¦å»ºç«‹ä¸€ä¸ªè‡ªä¸»çš„æ— äººæœºæ¥æä¾›ç„¦ç‚­ç½å¤´ã€‚ä¸ºæ­¤ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªå‡†ç¡®çš„3Dåœ°å›¾ï¼Œæˆ‘çš„æ— äººæœºå‘¨å›´ç¯å¢ƒé¿å…å¢™å£å’Œç‰©ä½“ã€‚ Lidarså¤ªæ˜‚è´µäº†ï¼ŒçŒ›çƒˆ2ç‚¹ï¼†ï¼ƒ39; Tè‰¯å¥½ã€‚æœ‰è¶…å£°æ³¢ä¼ æ„Ÿå™¨ï¼Œä½†å®ƒä»¬åªèƒ½åœ¨40Â°é”¥å½¢ä¸­å±•å¼€åˆ°æœ€è¿‘ç‰©ä½“çš„è·ç¦»ï¼Œè¿™å¯¹æˆ‘æ¥è¯´æ˜¯è¶³å¤Ÿçš„ã€‚</p><p> But, if humans can locate the exact direction of a sound, why can&#39;t an ultrasonic sensor do it too? That would allow me to scan in 3d.</p><p> ä½†æ˜¯ï¼Œå¦‚æœäººç±»å¯ä»¥æ‰¾åˆ°å£°éŸ³çš„ç¡®åˆ‡æ–¹å‘ï¼Œä¸ºä»€ä¹ˆå¯ä»¥ï¼†ï¼ƒ39; tä¸€ä¸ªè¶…å£°æ³¢ä¼ æ„Ÿå™¨ä¹Ÿè¿™æ ·åšï¼Ÿè¿™å°†å…è®¸æˆ‘æ‰«æ3Dã€‚</p><p>  A transmitter emits a wave, which bounces on objects, and two receivers triangulate the echo to put it on a map. But, this only works well for one object. As soon as there&#39;s a second one at the wrong spot, you can&#39;t tell apart one&#39;s echo from the other&#39;s.  3</p><p>  å‘å°„æœºå‘å‡ºæ³¢æµªï¼Œå®ƒåœ¨å¯¹è±¡ä¸Šåå¼¹ï¼Œä¸¤ä¸ªæ¥æ”¶å™¨ä¸‰è§’å½¢è½¬å‘å°†å…¶æ”¾åœ¨åœ°å›¾ä¸Šã€‚ä½†æ˜¯ï¼Œè¿™å¯¹äºä¸€ä¸ªå¯¹è±¡æ¥è¯´æ‰èƒ½å¾ˆå¥½ã€‚ä¸€æ—¦åœ¨é”™è¯¯çš„åœ°æ–¹ï¼Œä½ å°±å¯ä»¥ï¼†ï¼ƒ39; tï¼†ï¼ƒ39; tï¼†ï¼ƒ39;ä»å¦ä¸€ä¸ªï¼†ï¼ƒ39; sçš„å›å£°ã€‚ 3.</p><p> A few guys built scanners based on that. They work well for spotting fingers for a virtual keyboard, but can&#39;t handle more than a few objects.</p><p> ä¸€äº›äººå»ºç«‹äº†æ‰«æä»ªã€‚å®ƒä»¬é€‚ç”¨äºè™šæ‹Ÿé”®ç›˜çš„æ‰‹æŒ‡ï¼Œä½†å¯ä»¥ï¼†ï¼ƒ39; tå¤„ç†å¤šäºå‡ ä¸ªç‰©ä½“ã€‚</p><p>  What saved me was the principle of interference. Let&#39;s say we have two sound waves in space, let&#39;s call them        F 1 ( M ) F_1(M)     F        1 â€‹    ( M ) and        F 2 ( M ) F_2(M)     F        2 â€‹    ( M ), where        F 1 ( M ) F_1(M)     F        1 â€‹    ( M ) returns how far the first wave moves the particles at point M.</p><p>  æ‹¯æ•‘äº†æˆ‘çš„æ˜¯å¹²æ‰°åŸåˆ™ã€‚å‡è®¾æˆ‘ä»¬åœ¨ç©ºé—´ä¸­æœ‰ä¸¤ä¸ªå£°æ³¢ï¼Œè®©ï¼†ï¼ƒ39; sè°ƒç”¨å®ƒä»¬f 1ï¼ˆmï¼‰f_1ï¼ˆmï¼‰f 1ï¼ˆmï¼‰å’Œf 2ï¼ˆmï¼‰f_2ï¼ˆmï¼‰f 2ï¼‰ï¼ˆ mï¼‰ï¼Œå…¶ä¸­f 1ï¼ˆmï¼‰f_1ï¼ˆmï¼‰f 1ï¼ˆmï¼‰è¿”å›ç¬¬ä¸€æ³¢åœ¨ç‚¹Må¤„ç§»åŠ¨ç²’å­çš„è·ç¦»ã€‚</p><p> F 1 ( M ) F_1(M)     F        1 â€‹    ( M ) can be positive or negative. When you see waves on the water, there are places where the water line is below its averageâ€”       F 1 ( M ) F_1(M)     F        1 â€‹    ( M ) negativeâ€”and places where the water line is above the averageâ€”       F 1 ( M ) F_1(M)     F        1 â€‹    ( M ) positive. Now, if we call F(M) the &#34;final&#34; displacement of the particles at the point M, we&#39;re going to have       F ( M ) =  F 1 ( M ) +  F 2 ( M ) F(M) = F_1(M) + F_2(M)    F ( M )  =     F        1 â€‹    ( M )  +     F        2 â€‹    ( M ).</p><p> f 1ï¼ˆmï¼‰f_1ï¼ˆmï¼‰f 1ï¼ˆmï¼‰å¯ä»¥æ˜¯æ­£çš„æˆ–é˜´æ€§çš„ã€‚å½“æ‚¨çœ‹åˆ°æ°´ä¸Šçš„æ³¢æµªæ—¶ï¼Œæœ‰æ°´çº¿ä½äºå…¶å¹³å‡-f 1ï¼ˆmï¼‰f_1ï¼ˆmï¼‰f 1ï¼ˆmï¼‰è´Ÿçš„åœ°æ–¹ï¼Œå¹¶ä¸”æ°´ç®¡çº¿é«˜äºå¹³å‡-f 1çš„åœ°æ–¹ï¼ˆmï¼‰f_1ï¼ˆmï¼‰f 1ï¼ˆmï¼‰é˜³æ€§ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ‰“ç”µè¯ç»™fï¼ˆmï¼‰ï¼†ï¼ƒ34;æœ€ç»ˆï¼†ï¼ƒ34;é¢—ç²’åœ¨ç‚¹mï¼Œweï¼†ï¼ƒ39;é‡æ–°è¿›å…¥fï¼ˆmï¼‰= f 1ï¼ˆmï¼‰+ f 2ï¼ˆmï¼‰fï¼ˆmï¼‰= f_1ï¼ˆmï¼‰+ f_2ï¼ˆmï¼‰fï¼ˆmï¼‰ï¼ˆmï¼‰ ï¼‰= f 1ï¼ˆmï¼‰+ f 2ï¼ˆmï¼‰ã€‚ </p><p> But what happens in a situation where        F 1 ( M ) = âˆ’  F 2 ( M ) F_1(M) = -F_2(M)     F        1 â€‹    ( M )  =    âˆ’  F        2 â€‹    ( M )? Well       F ( M ) = 0 F(M) = 0    F ( M )  =    0! Particles don&#39;t move in M even though there are two non-zero waves there. This phenomenon is called destructive interference. Interferences rule how all wave sources radiate in space. The lightning patterns on the surface of the water, the equations ruling mirrors, lenses and antennas all derive from this superposition principle.</p><p>ä½†æ˜¯åœ¨f 1ï¼ˆmï¼‰=  -  f 2ï¼ˆmï¼‰f_1ï¼ˆmï¼‰= -f_2ï¼ˆmï¼‰f 1ï¼ˆmï¼‰=  -  f 2ï¼ˆmï¼‰çš„æƒ…å†µä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå—¯fï¼ˆmï¼‰= 0 fï¼ˆmï¼‰= 0 fï¼ˆmï¼‰= 0ï¼é¢—ç²’åœ¨ï¼†ï¼ƒ39; tåœ¨mä¸­ç§»åŠ¨ï¼Œå³ä½¿å­˜åœ¨ä¸¤ä¸ªéé›¶æ³¢ã€‚è¿™ç§ç°è±¡ç§°ä¸ºç ´åæ€§å¹²æ‰°ã€‚å¹²æ‰°ç»Ÿæ²»æ‰€æœ‰æ³¢æºåœ¨ç©ºé—´ä¸­çš„è¾å°„ã€‚æ°´é¢ä¸Šçš„é—ªç”µæ¨¡å¼ï¼Œç­‰å¼ç»Ÿæ²»é•œï¼Œé€é•œå’Œå¤©çº¿éƒ½æ¥è‡ªè¯¥å åŠ åŸç†ã€‚</p><p> Now it turns out that if you arrange a lot of emitters regularly in a plane, the wave will stay constrained inside of a beam like the one of a lighthouse.The following arrangement of emitters, all in phase:</p><p> äº‹å®è¯æ˜ï¼Œå¦‚æœæ‚¨åœ¨å¹³é¢ä¸­å®šæœŸå®‰æ’å¤§é‡å‘å°„å™¨ï¼Œåˆ™æ³¢æµªå°†ä¿æŒåƒç¯å¡”ä¹‹ä¸€çš„æ¢å†…éƒ¨çš„é™åˆ¶ã€‚ä»¥ä¸‹æ’é™¤è€…çš„æ’åˆ—ï¼Œæ‰€æœ‰ç›¸ä½ï¼š</p><p>    The real miracle is that if you delay each emitter&#39;s emission time by a linear amount       n Ï• n\phi    n Ï•, for instance like that:</p><p>    çœŸæ­£çš„å¥‡è¿¹æ˜¯ï¼Œå¦‚æœä½ å»¶è¿Ÿæ¯ä¸ªå‘å°„å™¨ï¼†ï¼ƒ39; sçš„çº¿æ€§é‡nÏ†n \ phinÏ†ï¼Œä¾‹å¦‚ï¼š</p><p> [ E ( t + Ï• ) ] [E(t+\phi)]    [ E ( t  +    Ï• )]       [ E ( t + 2 Ï• ) ] [E(t+2\phi)]    [ E ( t  +    2 Ï• )]       [ E ( t + 3 Ï• ) ] [E(t+3\phi)]    [ E ( t  +    3 Ï• )]       [ E ( t + 4 Ï• ) ] [E(t+4\phi)]    [ E ( t  +    4 Ï• )]       [ E ( t + 5 Ï• ) ] [E(t+5\phi)]    [ E ( t  +    5 Ï• )]</p><p> [Eï¼ˆt +Ï†ï¼‰] [eï¼ˆt +Ï†ï¼‰] [eï¼ˆt +2Ï†ï¼‰] [eï¼ˆt + 2 \ phiï¼‰] [eï¼ˆt + 2Ï† ï¼‰[eï¼ˆt + 3Ï†ï¼‰] [eï¼ˆt +3Ï†ï¼‰] [eï¼ˆt +4Ï†ï¼‰] [eï¼ˆt + 4 \ phiï¼‰] [ Eï¼ˆt +4Ï†ï¼‰] [eï¼ˆt +5Ï†ï¼‰] [eï¼ˆt + 5 \ phiï¼‰] [eï¼ˆt +5Ï†ï¼‰]</p><p> Then, the angle at which the beam will point will be proportional to       Ï• \phi    Ï•!If we control       Ï• \phi    Ï•, we control where the beam points at!</p><p> ç„¶åï¼Œå…‰æŸå°†ç‚¹çš„è§’åº¦å°†ä¸Ï†\phiÏ†æˆæ¯”ä¾‹ï¼å¦‚æœæˆ‘ä»¬æ§åˆ¶Ï†\phiÏ†ï¼Œæˆ‘ä»¬æ§åˆ¶å…‰æŸç‚¹çš„ä½ç½®ï¼</p><p>      The problem is that if the emitters are too far apart, there won&#39;t be one but three beams. With three beams, scanning is impossible. The emitters have to be as close as half the wavelength to avoid sending sound to the wrong place.</p><p>      é—®é¢˜æ˜¯ï¼Œå¦‚æœå‘å°„å™¨ç›¸è·å¤ªè¿œï¼Œé‚£ä¹ˆèµ¢å¾—ï¼†ï¼ƒ39; tæ˜¯ä¸‰ä¸ªæ¢ã€‚æœ‰ä¸‰ä¸ªå…‰æŸï¼Œæ‰«ææ˜¯ä¸å¯èƒ½çš„ã€‚å‘å°„å™¨å¿…é¡»å°½å¯èƒ½é è¿‘æ³¢é•¿çš„ä¸€åŠï¼Œä»¥é¿å…å‘é”™è¯¯çš„åœ°æ–¹å‘é€å£°éŸ³ã€‚</p><p> But, commercial ultrasonic transducers are made larger than a wavelength to &#34;pinch&#34; the radiation pattern. They&#39;re mostly used for car parking sensors.</p><p> ä½†æ˜¯ï¼Œå•†ä¸šè¶…å£°æ¢èƒ½å™¨æ¯”æ³¢é•¿å¤§äºï¼†ï¼ƒ34;æï¼†ï¼ƒ34;è¾å°„æ¨¡å¼ã€‚ä»–ä»¬ä¸»è¦ç”¨äºåœè½¦ä¼ æ„Ÿå™¨ã€‚ </p><p> I searched on Aliexpress and Banggood for hours, there was no way to find ultrasonic transducers small enough.</p><p>æˆ‘åœ¨Aliexpresså’ŒBanggoodä¸Šæœç´¢äº†å‡ ä¸ªå°æ—¶ï¼Œæ²¡æœ‰åŠæ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¶…å£°æ³¢ä¼ æ„Ÿå™¨ã€‚</p><p> After entire evenings spent trying to understand why two additional beams would appear when the emitters were too far apart, some blinking flash of intuition stroke me.</p><p> åœ¨æ•´ä¸ªæ™šä¸Šéƒ½èŠ±äº†è¯•å›¾ç†è§£ä¸ºä»€ä¹ˆå½“å‘å°„å™¨ç›¸è·å¤ªè¿œæ—¶ä¼šå‡ºç°ä¸¤ä¸ªé¢å¤–çš„æ¢ï¼Œä¸€äº›é—ªçƒçš„ç›´è§‰é—ªç°äº†æˆ‘ã€‚</p><p> If I imagine my emitters as plates all touching each other, the wave that they produce can only go in the direction of the beam. There can be no second and third beams on the sides. It&#39;s one of these intuitions that are hard to explain.</p><p> å¦‚æœæˆ‘æƒ³è±¡æˆ‘çš„å‘å°„å™¨å°±åƒäº’ç›¸æ¥è§¦ä¸€æ ·ï¼Œå®ƒä»¬äº§ç”Ÿçš„æ³¢æµªå°±å¯ä»¥æœç€æ¢çš„æ–¹å‘æœå‘æ¢ã€‚ä¾§é¢å¯ä»¥æ²¡æœ‰ç¬¬äºŒå’Œç¬¬ä¸‰æ¢ã€‚å®ƒï¼†ï¼ƒ39;éš¾ä»¥è§£é‡Šçš„è¿™äº›ç›´è§‰ä¹‹ä¸€ã€‚</p><p> Until now, my simulation and almost all the ones you can find online assume that the emitters are dots with zero radii. And by simulating these sources not as dots but as &#34;plates&#34; (ie, 10 dots in phase put next to each other), the sonar works!</p><p> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘çš„æ¨¡æ‹Ÿå’Œå‡ ä¹æ‰€æœ‰æ‚¨å¯ä»¥åœ¨çº¿æ‰¾åˆ°çš„æ¨¡æ‹Ÿå‡è®¾å‘å°„å™¨æ˜¯é›¶åŠå¾„çš„ç‚¹ã€‚å¹¶é€šè¿‡æ¨¡æ‹Ÿè¿™äº›æ¥æºï¼Œè€Œä¸æ˜¯åƒï¼†ï¼ƒ34;ç›˜å­ï¼†ï¼ƒ34; ï¼ˆå³ï¼Œ10ä¸ªå•ä½å½¼æ­¤æ”¾åœ¨å½¼æ­¤ç›¸é‚»ï¼‰ï¼Œå£°çº³å·¥ä½œï¼</p><p> There&#39;s still a second beam that appears at high angles, and the max scanning angle is lower than if my emitters were closer than half a wavelength. But it should be able to work!</p><p> ï¼†ï¼ƒ39; sä»ç„¶æ˜¯é«˜è§’åº¦çš„ç¬¬äºŒæ¢ï¼Œå¹¶ä¸”æœ€å¤§æ‰«æè§’åº¦ä½äºå¦‚æœæˆ‘çš„å‘å°„å™¨æ›´è¿‘äºåŠæ³¢é•¿ã€‚ä½†å®ƒåº”è¯¥èƒ½å¤Ÿå·¥ä½œï¼</p><p>   I planned to make a 10x10 grid of 10mm transducers. I thought that driving a phased array would be similar to driving an array of LEDs.</p><p>   æˆ‘è®¡åˆ’åˆ¶ä½œ10æ¯«ç±³æ¢èƒ½å™¨çš„10x10æ ¼ã€‚æˆ‘è®¤ä¸ºé©¾é©¶ç›¸æ§é˜µå°†ç±»ä¼¼äºé©¾é©¶é˜µåˆ—LEDã€‚</p><p> I bought hundreds of transducers for $50 on Aliexpress.To me, all I needed was 74HC595 Shift Registers (that&#39;s what they use for driving many LEDs) and an NPN transistor to convert the 5V of the shift registers to the 40V of the ultrasonic transducers. Then, I&#39;ll solder hundreds of these components on a protoboard. I had already built rocket parachute timers on protoboards. I thought it would be the same ğŸ™„.</p><p> æˆ‘åœ¨Aliexpressä¸Šè´­ä¹°äº†æ•°ç™¾ç¾å…ƒçš„æ¢èƒ½å™¨ã€‚åœ¨æˆ‘èº«ä¸Šï¼Œæˆ‘æ‰€éœ€è¦çš„æ‰€æœ‰æƒ…å†µæ˜¯74å°æ—¶595ç­æ¬¡å¯„å­˜å™¨ï¼ˆå®ƒä»¬ç”¨äºé©±åŠ¨è®¸å¤šLEDçš„ä¸œè¥¿ï¼‰å’ŒNPNæ™¶ä½“ç®¡ï¼Œä»¥å°†ç§»ä½å¯„å­˜å™¨çš„5Vè½¬æ¢ä¸º40Vè¶…å£°æ¢èƒ½å™¨ã€‚ç„¶åï¼Œæˆ‘ï¼†ï¼ƒ39; LLç„Šæ–™æ•°ç™¾ç§è¿™äº›ç»„ä»¶åœ¨Protoboardä¸Šã€‚æˆ‘å·²ç»åœ¨Protoboardsä¸Šå»ºé€ äº†ç«ç®­é™è½ä¼å®šæ—¶å™¨ã€‚æˆ‘ä»¥ä¸ºå®ƒä¼šæ˜¯ä¸€æ ·çš„ã€‚ </p><p> After I received my components, I tried to make an ultrasonic transducer work. When D13 is HIGH, current flows in the transistor and opens it to the alimentation next to it.</p><p>æˆ‘æ”¶åˆ°äº†æˆ‘çš„ç»„ä»¶åï¼Œæˆ‘è¯•å›¾åˆ¶ä½œè¶…å£°æ³¢ä¼ æ„Ÿå™¨å·¥ä½œã€‚å½“D13é«˜ç”µå¹³æ—¶ï¼Œç”µæµåœ¨æ™¶ä½“ç®¡ä¸­æµåŠ¨ï¼Œå¹¶æ‰“å¼€å®ƒåˆ°å®ƒæ—è¾¹çš„å…±æ¿€èŠ‚ã€‚</p><p> If you&#39;ve already done electronics before, you&#39;ve probably laughed out very hard.An ultrasonic transducer is roughly equivalent to a capacitor.A capacitor is like a water reservoir, except for electrons.Therefore, to drive it the circuit needs to empty and to fill that capacitor 40 000 times per second. The NPN capacitor here only cuts out the alimentation of the capacitor, but there&#39;s nothing to discharge it.</p><p> å¦‚æœä½ ä¹‹å‰å·²ç»åšè¿‡ç”µå­äº§å“ï¼Œä½ å¯èƒ½å¾ˆéš¾ç¬‘ã€‚è¶…å£°æ¢èƒ½å™¨å¤§è‡´ç›¸å½“äºç”µå®¹å™¨ã€‚ç”µå®¹å™¨å°±åƒä¸€ä¸ªæ°´åº“ï¼Œé™¤äº†ç”µå­ã€‚å› æ­¤ï¼Œæ¨åŠ¨å®ƒç”µè·¯éœ€è¦ç©ºï¼Œå¹¶å¡«å……æ¯ç§’40 000æ¬¡ç”µå®¹å™¨ã€‚è¿™é‡Œçš„NPNç”µå®¹å™¨ä»…åˆ‡å‡ºç”µå®¹å™¨çš„æ¶ˆè§£ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥æ’å‡ºå®ƒã€‚</p><p> It took me a few days to understand the issue, I then tried another circuit, the half-bridge: When D13 is HIGH, the top transistor is open and the bottom transistor is closed. Current goes from the capacitor to the ground, the capacitor gets discharged.When D13 is LOW, the top transistor is closed and the bottom transistor is open. Current goes from the 40V to the capacitor.</p><p> æˆ‘èŠ±äº†å‡ å¤©äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œç„¶åå°è¯•äº†å¦ä¸€ä¸ªç”µè·¯ï¼ŒåŠæ¡¥ï¼šå½“D13é«˜æ—¶ï¼Œé¡¶éƒ¨æ™¶ä½“ç®¡æ‰“å¼€ï¼Œåº•éƒ¨æ™¶ä½“ç®¡å…³é—­ã€‚ç”µæµä»ç”µå®¹åˆ°åœ°ï¼Œç”µå®¹å™¨æ”¾ç”µã€‚å½“D13ä½æ—¶ï¼Œé¡¶éƒ¨æ™¶ä½“ç®¡é—­åˆï¼Œåº•éƒ¨æ™¶ä½“ç®¡æ‰“å¼€ã€‚ç”µæµä»40Våˆ°ç”µå®¹å™¨ã€‚</p><p> But, In practice, this circuit only works with supply voltages lower than the voltage of the Arduino signal, 5V in my case. The reason for that (and it took me 5 days to figure it out) is that PNP transistors (the kind of the top transistor) are closed when current flows from the top pin to the left pin, and 5V (my Arduino&#39;s voltage) isn&#39;t enough to stop a voltage from a 40V source to induce a current. I needed to drive it with a 40V signal, which meant ANOTHER transistor!   5</p><p> ä½†æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œè¯¥ç”µè·¯ä»…é€‚ç”¨äºç”µæºç”µå‹ä½äºArduinoä¿¡å·çš„ç”µå‹ï¼Œåœ¨æˆ‘çš„æƒ…å†µä¸‹ä¸º5Vã€‚å…¶ä¸­ï¼ˆå®ƒèŠ±äº†5å¤©çš„åŸå› ï¼‰æ˜¯PNPæ™¶ä½“ç®¡ï¼ˆé¡¶æ™¶ä½“ç®¡çš„ç§ç±»ï¼‰å½“ç”µæµä»é¡¶éƒ¨å¼•è„šæµåˆ°å·¦é”€æ—¶ï¼Œ5Vï¼ˆæˆ‘çš„Arduinoï¼†ï¼ƒ39; Sç”µå‹ï¼‰ISNï¼†ï¼ƒ39; tè¶³ä»¥é˜»æ­¢40Væºçš„ç”µå‹è¯±å¯¼ç”µæµã€‚æˆ‘éœ€è¦ç”¨40Vä¿¡å·é©±åŠ¨å®ƒï¼Œè¿™æ„å‘³ç€å¦ä¸€ä¸ªæ™¶ä½“ç®¡ï¼ 5.</p><p> Here, the leftmost NPN transistor drives the PNP. The consequence of that is that I need three transistors, three resistors and two Arduino pins for each transducer. That&#39;s 300 transistors and 200 Arduino pins ie 200/8 = 25 shift register pins. That&#39;s too much to fit close to the transducers.</p><p> è¿™é‡Œï¼Œæœ€å·¦ä¾§çš„NPNæ™¶ä½“ç®¡é©±åŠ¨PNPã€‚ç»“æœæ˜¯æˆ‘éœ€è¦ä¸‰ä¸ªæ™¶ä½“ç®¡ï¼Œä¸‰ä¸ªç”µé˜»å’Œä¸¤ä¸ªæ¢èƒ½å™¨çš„ä¸¤ä¸ªarduinoå¼•è„šã€‚é‚£ä¸ªï¼†ï¼ƒ39; s 300æ™¶ä½“ç®¡å’Œ200 arduinoå¼•è„šï¼Œå³200/8 = 25æ¡£å¯„å­˜å™¨é”€ã€‚é‚£ä¸ªï¼†ï¼ƒ39;å¤ªå¤šï¼Œä»¥é è¿‘æ¢èƒ½å™¨ã€‚</p><p>  Though, with a functional transmitter, I could get my first beam. I connected 8 emitters in parallel to a half-bridge and got a beam! The emitter is the green light on the bottom. Blue is low signal, white/red/purple is high signal.I used a Teensy 3.2 which shows the signal intensity as a color on a LED. Then, I took a long-exposure photo while making the teensy travel in the beam.   6</p><p>  è™½ç„¶ï¼Œä½¿ç”¨åŠŸèƒ½å˜é€å™¨ï¼Œæˆ‘å¯ä»¥å¾—åˆ°æˆ‘çš„ç¬¬ä¸€æŸã€‚æˆ‘è¿æ¥8ä¸ªå‘å°„å™¨å¹¶è”åˆ°åŠæ¡¥å¹¶è·å¾—æ¢ï¼å‘å°„å™¨æ˜¯åº•éƒ¨çš„ç»¿ç¯ã€‚è“è‰²æ˜¯ä½ä¿¡å·ï¼Œç™½è‰²/çº¢è‰²/ç´«è‰²æ˜¯é«˜ä¿¡å·ã€‚æˆ‘ä½¿ç”¨äº†Teensy 3.2ï¼Œå®ƒæ˜¾ç¤ºäº†ä¿¡å·å¼ºåº¦ä½œä¸ºLEDä¸Šçš„é¢œè‰²ã€‚ç„¶åï¼Œæˆ‘åœ¨æŸä¸­çš„é’é“œè¡Œé©¶æ—¶æ‹äº†ä¸€å¼ é•¿æ—¶é—´çš„ç…§ç‰‡ã€‚ 6.</p><p>    Then, I tried to build a half-bridge directly from shift registers. I bought shift registers to replace the PNP transistors and shift registers to replace the NPNs. Those were respectively TPIC9B585Ns and MIC5891s.</p><p>    ç„¶åï¼Œæˆ‘è¯•å›¾ç›´æ¥ä»ç§»ä½å¯„å­˜å™¨æ„å»ºåŠæ¡¥ã€‚æˆ‘è´­ä¹°äº†ç§»ä½å¯„å­˜å™¨ä»¥æ›¿æ¢PNPæ™¶ä½“ç®¡å’Œç§»ä½å¯„å­˜å™¨ä»¥æ›¿æ¢NPNã€‚é‚£äº›åˆ†åˆ«æ˜¯TPIC9B585NSå’ŒMIC5891Sã€‚ </p><p> It sort of worked, but the timings were different between both shift registers. Because of that, there would be times were both shift registers would be allowing current to pass, which resulted in a short circuit. The MIC5891s had bad timings at high frequencies, so I got back to the drawing board.</p><p>å®ƒæœ‰ç‚¹å·¥ä½œï¼Œä½†ä¸¤ä¸ªç­æ¬¡å¯„å­˜å™¨ä¹‹é—´çš„æ—¶é—´ä¸åŒã€‚å› æ­¤ï¼Œæœ‰æ—¶æ¢æ¡£å¯„å­˜å™¨éƒ½ä¼šå…è®¸ç”µæµé€šè¿‡ï¼Œä»è€Œå¯¼è‡´çŸ­è·¯ã€‚ MIC5891Såœ¨é«˜é¢‘ä¸‹å…·æœ‰å·®çš„å®šæ—¶ï¼Œå› æ­¤æˆ‘å›åˆ°äº†ç»˜å›¾æ¿ã€‚</p><p>  Finally, I realized that both NPNs (the one driving the top PNP and the one putting the capacitor to the ground to empty it) could be replaced by an open-drain shift register (which worked well in my latest experiment). So I finally settled on that. I would only need two shift register pins, a transistor and a resistor for each transducer. That amounts to 25 shift registers, 100 transistors and 100 resistors to solder.</p><p>  æœ€åï¼Œæˆ‘æ„è¯†åˆ°ï¼Œä¸¤ä¸ªNPNSï¼ˆé©±åŠ¨é¡¶éƒ¨PNPçš„ä¸€ä¸ªé©±åŠ¨ç”µå®¹å™¨åˆ°æ¥åœ°ä¸ºæ¸…ç©ºå™¨çš„ä¸€ä¸ªé©±åŠ¨ç”µå®¹å™¨ï¼‰å¯ä»¥ç”±å¼€æ¼æ¢æ¡£å¯„å­˜å™¨ï¼ˆåœ¨æˆ‘æœ€æ–°çš„å®éªŒä¸­å·¥ä½œå¾—å¾ˆå¥½ï¼‰å–ä»£ã€‚æ‰€ä»¥æˆ‘ç»ˆäºè§£å†³äº†è¿™ä¸€ç‚¹ã€‚å¯¹äºæ¯ä¸ªæ¢èƒ½å™¨ï¼Œæˆ‘åªéœ€è¦ä¸¤ä¸ªç§»ä½å¯„å­˜å™¨å¼•è„šï¼Œæ™¶ä½“ç®¡å’Œç”µé˜»å™¨ã€‚è¯¥é‡ä¸º25æ¬¡ç§»ä½å¯„å­˜å™¨ï¼Œ100ä¸ªæ™¶ä½“ç®¡å’Œ100ä¸ªç„Šæ–™ç”µé˜»ã€‚</p><p> I quickly realized that there would be way too many components to manually solder. I had to design a PCB.</p><p> æˆ‘å¾ˆå¿«æ„è¯†åˆ°æœ‰å¤ªå¤šçš„ç»„ä»¶æ¥æ‰‹åŠ¨ç„Šæ¥ã€‚æˆ‘å¿…é¡»è®¾è®¡ä¸€ä¸ªPCBã€‚</p><p> I had never done any EDA before, so I started to learn and use KiCad. Two days later, I had my PCB ready to be manufactured!</p><p> æˆ‘ä»¥å‰ä»æœªåšè¿‡ä»»ä½•EDAï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å­¦ä¹ å’Œä½¿ç”¨KICADã€‚ä¸¤å¤©åï¼Œæˆ‘çš„PCBå‡†å¤‡è¢«åˆ¶é€ ï¼</p><p> With jlcpcb.com I had my 10 PCBs a week later for $20, including $18 for the fast shipping.I hated using a Chinese company for a job that could be done in France, but no local companies were offering the same service.</p><p> ä½¿ç”¨JLCPCB.COMæˆ‘æ¯å‘¨æœ‰10ä¸ªPCBï¼Œä»¥20ç¾å…ƒçš„ä»·æ ¼ä¸º20ç¾å…ƒï¼ŒåŒ…æ‹¬å¿«é€Ÿé€è´§çš„18ç¾å…ƒã€‚æˆ‘è®¨åŒåœ¨æ³•å›½å¯ä»¥åœ¨æ³•å›½å®Œæˆçš„å·¥ä½œï¼Œä½†æ²¡æœ‰å½“åœ°å…¬å¸æä¾›ç›¸åŒçš„æœåŠ¡ã€‚</p><p>  After an evening of soldering the       8 âˆ— 25 + 2 âˆ— 100 + 3 âˆ— 100 = 700 8*25+2*100+3*100=700    8  âˆ—    25  +    2  âˆ—    100  +    3  âˆ—    100  =    700 pins of my PCBs, I hooked up the Teensy and... It didn&#39;t work.I had forgotten to set a pin to the ground on each of the TPICs ğŸ˜. After adding 25 wires to my PCBs, it worked!</p><p>  åœ¨ä¸€ä¸ªæ™šä¸Šç„Šæ¥8 * 25 + 2 * 100 + 3 * 100 = 700 8 * 25 + 2 * 100 + 3 * 100 = 700 8 * 25 + 2 * 100 + 3 * 100 = 700 =æˆ‘çš„PCBçš„700é”€ï¼Œæˆ‘æŒ‚äº†teensyå’Œ...å®ƒæ²¡æœ‰å·¥ä½œã€‚æˆ‘å·²ç»å¿˜è®°å°†PINæ”¾åœ¨æ¯ä¸ªTPICSä¸Šçš„åœ°é¢ä¸Šã€‚åœ¨æˆ‘çš„PCBä¸­åŠ å…¥25ä¸ªç”µçº¿åï¼Œå®ƒè¿ä½œäº†ï¼</p><p>  Then, I had to tightly pack my 100 emitters in a 10x10 grid and connect all of them to my half-bridges. I started with only 40.  From bottom to top: Teensy 3.6 which generates the signals, TS1080 to convert the 3.3V signals to 5V, half-bridge PCBs, transducers. All wires are soldered a l&#39;arrache to the transducers through headers so I can replace or change the polarity of individual transducers easily.</p><p>  ç„¶åï¼Œæˆ‘ä¸å¾—ä¸å°†æˆ‘çš„100ä¸ªå‘å°„å™¨ç´§ç´§åœ°åŒ…è£…åœ¨10x10ç½‘æ ¼ä¸­ï¼Œå¹¶å°†æ‰€æœ‰æ’æ”¾ç‰©è¿æ¥åˆ°æˆ‘çš„åŠæ¡¥ã€‚æˆ‘ä»åº•éƒ¨åˆ°é¡¶éƒ¨å¼€å§‹ï¼šé’å°‘å¹´3.6ï¼Œå®ƒäº§ç”Ÿä¿¡å·ï¼ŒTS1080å°†3.3Vä¿¡å·è½¬æ¢ä¸º5Vï¼ŒåŠæ¡¥PCBï¼Œä¼ æ„Ÿå™¨ã€‚æ‰€æœ‰å¯¼çº¿éƒ½ç„Šæ¥äº†Lï¼†ï¼ƒ39;é€šè¿‡æ ‡å¤´åˆ°æ¢èƒ½å™¨åˆ°æ¢èƒ½å™¨ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥è½»æ¾æ›¿æ¢æˆ–æ”¹å˜å„ä¸ªæ¢èƒ½å™¨çš„ææ€§ã€‚ </p><p>  I started doing experiments with beamforming on the reception side for additional precision. I googled for &#34;audio amplifier&#34; and used the first schematic I found. I removed the caps because they&#39;re always useless and built this 9x directional receiver with LM386s.  Of course, the signal it gave was too noisy to be used. I had a couple of spare HC-SR04. I wired one and used an oscilloscope probe to look for the analog signal after amplification. I found it and soldered it to the teensy.</p><p>æˆ‘å¼€å§‹åœ¨æ¥å¾…ä¾§è¿›è¡Œå…‰æŸæˆå½¢è¿›è¡Œå®éªŒä»¥è·å¾—é¢å¤–çš„ç²¾åº¦ã€‚æˆ‘ä¸ºï¼†ï¼ƒ34 Googled;éŸ³é¢‘æ”¾å¤§å™¨ï¼†ï¼ƒ34;å¹¶ä½¿ç”¨äº†æˆ‘å‘ç°çš„ç¬¬ä¸€ä¸ªåŸç†å›¾ã€‚æˆ‘åˆ é™¤äº†å¸½å­ï¼Œå› ä¸ºå®ƒä»¬ï¼†ï¼ƒ39;é‡æ–°æ¯«æ— ç”¨å¤„ï¼Œå¹¶ç”¨LM386Så»ºç«‹è¿™ä¸ª9xå®šå‘æ¥æ”¶å™¨ã€‚å½“ç„¶ï¼Œå®ƒç»™å‡ºçš„ä¿¡å·å¤ªåµäº†ã€‚æˆ‘æœ‰å‡ ä¸ªå¤‡ç”¨çš„HC-SR04ã€‚æˆ‘æœ‰çº¿äº†ä¸€ä¸ªå¹¶ä½¿ç”¨ç¤ºæ³¢å™¨æ¢å¤´åœ¨æ”¾å¤§åå¯»æ‰¾æ¨¡æ‹Ÿä¿¡å·ã€‚æˆ‘å‘ç°å®ƒå¹¶å°†å…¶ç„Šæ¥åˆ°äº†teensyã€‚</p><p>   My transducers are directly driven by 25 shift registers. To drive a shift register, there are three pins: CLOCK, LATCH and DATA. To write a series of bits to a shift register, the algorithm is the following:</p><p>   æˆ‘çš„ä¼ æ„Ÿå™¨ç›´æ¥ç”±25æ¬¡ç§»ä½å¯„å­˜å™¨é©±åŠ¨ã€‚è¦é©±åŠ¨ç§»ä½å¯„å­˜å™¨ï¼Œæœ‰ä¸‰ä¸ªå¼•è„šï¼šæ—¶é’Ÿï¼Œé”å­˜å™¨å’Œæ•°æ®ã€‚è¦å°†ä¸€ç³»åˆ—ä½å†™å…¥ç§»ä½å¯„å­˜å™¨ï¼Œè¯¥ç®—æ³•å¦‚ä¸‹ï¼š</p><p> Write the first bit on the DATA pin (+5V if you want the first pin of the shift register to be connected to the ground, +0V otherwise)</p><p> åœ¨æ•°æ®å¼•è„šä¸Šå†™å…¥ç¬¬ä¸€ä½ï¼ˆå¦‚æœå¸Œæœ›å°†ç§»ä½å¯„å­˜å™¨çš„ç¬¬ä¸€ä¸ªå¼•è„šè¿æ¥åˆ°åœ°é¢ï¼Œåˆ™å¦åˆ™è¿”å›è¿”å›å¯„å­˜å™¨ï¼Œå¦åˆ™ï¼‰</p><p>             LATCH HIGH (this tells the shift register to change its output, sort of like a buffer swap in a video game.</p><p>             é”å­˜é«˜ï¼ˆè¿™å‘Šè¯‰Shiftå¯„å­˜å™¨æ›´æ”¹å…¶è¾“å‡ºï¼Œç±»ä¼¼äºè§†é¢‘æ¸¸æˆä¸­çš„ç¼“å†²åŒºäº¤æ¢ã€‚</p><p> Therefore to change the values in a shift register, I need       8 âˆ— 3 + 2 = 26 8*3+2=26    8  âˆ—    3  +    2  =    26 writes on pins.My transducers work at 40khz, but I&#39;d like to have 40 positions for my beam, which means an update rate of       40 k h z âˆ— 40 = 1.6 M h z 40khz*40=1.6Mhz    40 kh z  âˆ—    40  =    1.6 M h z. I need 21 Teensy writes for 1 shift register write, which is       1.6 M h z âˆ— 21 = 33.6 M h z 1.6Mhz*21=33.6Mhz    1.6 M h z  âˆ—    21  =    33.6 M h zThere are 25 shift registers, so I need to update my output pins at       33.6 M h z âˆ— 25 = 840 M h z 33.6Mhz*25=840Mhz    33.6 M h z  âˆ—    25  =    840 M h z.</p><p> å› æ­¤è¦åœ¨ç§»ä½å¯„å­˜å™¨ä¸­æ›´æ”¹å€¼ï¼Œæˆ‘éœ€è¦8 * 3 + 2 = 26 8 * 3 + 2 = 26 8 * 3 + 2 = 26åœ¨å¼•è„šä¸Šå†™å…¥ã€‚æ¢èƒ½å™¨åœ¨40khzå·¥ä½œï¼Œä½†æ˜¯æˆ‘å–œæ¬¢å¯¹äºæˆ‘çš„å…‰æŸæœ‰40ä¸ªä½ç½®ï¼Œè¿™æ„å‘³ç€æ›´æ–°ç‡ä¸º40kHz * 40 = 1.6 M Hz 40kHz * 40 = 1.6MHz 40kH Z * 40 = 1.6 m H zã€‚æˆ‘éœ€è¦21ä¸ªTeensyå†™å…¥1ä¸ªç§»ä½å¯„å­˜å™¨å†™å…¥ï¼Œå³1.6 M Hz * 21 = 33.6 M Hz 1.6MHz * 21 = 33.6MHz 1.6 M Hz * 21 = 33.6 M H ZTHEREæ˜¯25æ¬¡ç§»ä½å¯„å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘éœ€è¦æ›´æ–°æˆ‘çš„è¾“å‡ºå¼•è„š33.6 M Hz * 25 = 840 M Hz 33.6MHz * 25 = 840MHz 33.6 M Hz * 25 = 840 m H Z.</p><p> Ouch! That&#39;s going to be hard for a 600Mhz microcontroller! For that sort of requirement, engineers usually use FPGAs. An FPGA is a programmable logic chip that goes much faster for that kind of work. But, I had none on hand so I stayed with the Teensy 3.6.</p><p> å“å“Ÿ!é‚£ä¸ªï¼†ï¼ƒ39;å¯¹äº600MHzå¾®æ§åˆ¶å™¨æ¥è¯´å°†å¾ˆéš¾ï¼å¯¹äºé‚£ç§è¦æ±‚ï¼Œå·¥ç¨‹å¸ˆé€šå¸¸ä½¿ç”¨FPGAã€‚ FPGAæ˜¯ä¸€ç§å¯ç¼–ç¨‹é€»è¾‘èŠ¯ç‰‡ï¼Œå¯¹äºè¿™ç§å·¥ä½œæ›´å¿«ã€‚ä½†æ˜¯ï¼Œæˆ‘æ‰‹å¤´æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä½åœ¨teensy 3.6ã€‚</p><p> The advantage of the Teensy is that the digital output values are stored in 32bits registers. I can change all of the pins in parallel using just a couple of instructions. By changing all pins in parrallel, my code &#34;only&#34; needs to run at 33.6Mhz. By pre-computing and storing the register values, I was able to go to that speed easily.</p><p> é’å°‘å¹´çš„ä¼˜ç‚¹æ˜¯æ•°å­—è¾“å‡ºå€¼å­˜å‚¨åœ¨32bitså¯„å­˜å™¨ä¸­ã€‚æˆ‘å¯ä»¥ä½¿ç”¨å‡ ä¸ªæŒ‡ä»¤å¹¶è¡Œæ›´æ”¹æ‰€æœ‰å¼•è„šã€‚é€šè¿‡æ”¹å˜æ‰€æœ‰å¼•è„šï¼Œä»¥å¹³è¡Œï¼Œæˆ‘çš„ä»£ç ï¼†ï¼ƒ34;åªæœ‰ï¼†ï¼ƒ34;éœ€è¦åœ¨33.6MHzä¸Šè¿è¡Œã€‚é€šè¿‡é¢„å…ˆè®¡ç®—å’Œå­˜å‚¨å¯„å­˜å™¨å€¼ï¼Œæˆ‘èƒ½å¤Ÿè½»æ¾åœ°è½¬åˆ°è¯¥é€Ÿåº¦ã€‚ </p><p>    The PC tells through the serial port to the Emitter to emit in a specific place (ex: 40Â° vertical, -20Â° horizontal), and at the same time tells the receiver to start listening.Once the receiver hears the emitter&#39;s PING, it starts recording. After a few milliseconds, it dumps the data on the serial port.</p><p>PCé€šè¿‡ä¸²è¡Œç«¯å£åˆ°å‘å°„å™¨ä¸­çš„ç‰¹å®šä½ç½®å‘å°„ï¼ˆä¾‹å¦‚ï¼š40Â°å‚ç›´ï¼Œæ°´å¹³-20Â°ï¼‰ï¼Œå¹¶ä¸”åŒæ—¶å‘Šè¯‰æ¥æ”¶å™¨å¼€å§‹æ”¶å¬ã€‚æ¥æ”¶å™¨å¬åˆ°å‘å°„å™¨ï¼†ï¼ƒ39; s pingï¼Œå®ƒå¼€å§‹å½•åˆ¶ã€‚åœ¨å‡ æ¯«ç§’ä¹‹åï¼Œå®ƒå°†æ•°æ®è½¬å‚¨ä¸²è¡Œç«¯å£ä¸Šçš„æ•°æ®ã€‚</p><p>  S i g n a l â†¦ B a n d p a s s â€‰ f i l t e r â†¦ H i l b e r t â€…â€Š T r a n s f o r m â†¦ S ( t ) = t âˆ— S ( t ) â†¦ T h r e s h o l d i n g Signal \mapsto Bandpass\,filter \mapsto Hilbert\;Transform \mapsto S(t) = t*S(t) \mapsto Thresholding    S i g na l  â†¦    B an d p a ss  f i lt er  â†¦    H i l b er t  T r an s f or m  â†¦    S ( t )  =    t  âˆ—    S ( t )  â†¦    T h res h o l d in g</p><p>  S IGNALâ†¦Bandpassæ»¤æ³¢å™¨â†¦HILBERTt ransformâ†¦sï¼ˆtï¼‰= t * sï¼ˆtï¼‰â†¦t hresholdä¿¡å·\ mapstoå¸¦é€š\ï¼Œè¿‡æ»¤å™¨\ mapsto hilbert \;å˜æ¢\ mapsto sï¼ˆtï¼‰= t * sï¼ˆ tï¼‰\ Mapstoé˜ˆå€¼S Ig NaLâ†¦Bä¸€ç§DPA SS FI LT ERâ†¦HILBERT r A SFæˆ–M = Sï¼ˆtï¼‰= t * sï¼ˆtï¼‰â†¦â†¦â†¦â†¦res</p><p> Afterward, all points above a threshold are written as echos and are saved to a file.After launching gnuplot, I got my first 3D Images  Here, the receiver is on top at the left  The room roughly as I scanned it for the first time  Close up on that bird, viewed from the right side  3D Scan of the whole room. We can see the bird on the front, the wall behind and elements of the wall. The emitter is the red circle on the left  Zoom on the bird. The legs and most of the torso aren&#39;t visible because they&#39;re out of the sensor&#39;s field of view</p><p> ä¹‹åï¼Œé˜ˆå€¼ä¸Šæ–¹çš„æ‰€æœ‰ç‚¹éƒ½è¢«å†™ä¸ºå›å£°ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚åœ¨å¯åŠ¨Gnuplotæ—¶ï¼Œæˆ‘åœ¨æ­¤å¤„è·å¾—äº†æˆ‘çš„ç¬¬ä¸€ä¸ª3Då›¾åƒï¼Œæ¥æ”¶å™¨åœ¨å·¦ä¾§æˆ¿é—´çš„é¡¶éƒ¨ï¼Œå› ä¸ºæˆ‘ç¬¬ä¸€æ¬¡æ‰«æå®ƒç¬¬ä¸€æ¬¡æ‰«æå®ƒä»æ•´ä¸ªæˆ¿é—´çš„å³ä¾§3Dæ‰«æä»å³ä¾§3Dæ‰«æä¸­æŸ¥çœ‹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢çš„é¸Ÿï¼Œå¢™åé¢å’Œå¢™çš„å…ƒç´ ã€‚å‘å°„å™¨æ˜¯å·¦è¾¹çš„çº¢è‰²åœ†åœˆæ”¾å¤§é¸Ÿã€‚è…¿å’Œå¤§å¤šæ•°èº¯å¹²arenï¼†ï¼ƒ39; tå¯è§ï¼Œå› ä¸ºå®ƒä»¬ï¼†ï¼ƒ39;ä»ä¼ æ„Ÿå™¨ä¸­é€€å‡ºå’Œï¼ƒ39;çš„è§†é‡</p><p>  Sometimes the acoustic wave does Emitter -&gt; First Object -&gt; Second Object -&gt; Receiver, so there is sometimes a &#34;ghost echo&#34; behind objects.</p><p>  æœ‰æ—¶å£°æ³¢æ˜¯å‘å°„å™¨ - ï¼†gt;ç¬¬ä¸€ä¸ªå¯¹è±¡ - ï¼†gt;ç¬¬äºŒä¸ªå¯¹è±¡ - ï¼†gt;æ¥æ”¶å™¨ï¼Œæ‰€ä»¥æœ‰æ—¶å€™æœ‰ä¸€ä¸ªï¼†ï¼ƒ34;é¬¼å›å£°ï¼†ï¼ƒ34;èƒŒåçš„ç‰©ä½“ã€‚</p><p> The scan speed is a few milliseconds for a single point, a minute for a full room at full resolution and a second for a 2D plane at full resolution. While enough for a drone that only needs 2D maps most of the time, it could be too slow for some applications.</p><p> æ‰«æé€Ÿåº¦ä¸ºå•ç‚¹å‡ æ¯«ç§’ï¼Œä¸ºå…¨éƒ¨åˆ†è¾¨ç‡ä¸ºä¸€åˆ†é’Ÿï¼Œä¸ºå…¨éƒ¨åˆ†è¾¨ç‡ä¸ºä¸€ç§’é’Ÿï¼Œå…¨åˆ†è¾¨ç‡ä¸º2Då¹³é¢ã€‚è™½ç„¶è¶³å¤Ÿæ— äººæœºåªéœ€è¦2Dåœ°å›¾â€‹â€‹çš„æ— äººæœºï¼Œä½†å¯¹äºæŸäº›åº”ç”¨æ¥è¯´ï¼Œå®ƒå¯èƒ½å¤ªæ…¢äº†ã€‚</p><p> I have solutions for each one of these problems but will keep them for myself ğŸ˜‰. I plan to develop this scanner into a useful commercial solution next year.</p><p> æˆ‘å¯¹è¿™äº›é—®é¢˜ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰è§£å†³æ–¹æ¡ˆï¼Œä½†ä¼šè®©ä»–ä»¬æˆä¸ºè‡ªå·±â™¥ã€‚æˆ‘è®¡åˆ’æ˜å¹´å°†æ­¤æ‰«æä»ªå‘å±•æˆä¸ºä¸€ä¸ªæœ‰ç”¨çš„å•†ä¸šè§£å†³æ–¹æ¡ˆã€‚</p><p>  Getting there was not easy, but could have been doable for a long time. Here are still a few hypotheses:</p><p>  åˆ°è¾¾é‚£é‡Œå¹¶ä¸å®¹æ˜“ï¼Œä½†å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½å¯èƒ½æ˜¯å¯è¡Œçš„ã€‚è¿™ä»ç„¶æ˜¯ä¸€äº›å‡è®¾ï¼š </p><p> Many who tried to build ultrasonic scanners had only two receivers and tried to correlate the signals. I didn&#39;t go that route because the maths were too complicated and because of its topological limitations. here, not being good enough at maths helped me.</p><p>è®¸å¤šè¯•å›¾æ„å»ºè¶…å£°æ³¢æ‰«æä»ªçš„äººåªæœ‰ä¸¤ä¸ªæ¥æ”¶å™¨ï¼Œå¹¶è¯•å›¾å°†ä¿¡å·ç›¸å…³è”ã€‚æˆ‘æ²¡æœ‰å»é‚£æ¡è·¯çº¿ï¼Œå› ä¸ºæ•°å­¦å¤ªå¤æ‚ï¼Œå› ä¸ºå®ƒçš„æ‹“æ‰‘é™åˆ¶ã€‚åœ¨è¿™é‡Œï¼Œåœ¨æ•°å­¦ä¸Šä¸å¤Ÿå¥½ï¼Œå¸®åŠ©äº†æˆ‘ã€‚</p><p> The phased array beamforming seems impossible when you do the usual calculations. But as I didn&#39;t know how to do the usual calculations I did a computer model. It allowed me to be more precise than the usual calculations. This computer model helped me see something the math guys couldn&#39;t.</p><p> å½“æ‚¨æ‰§è¡Œé€šå¸¸çš„è®¡ç®—æ—¶ï¼Œç›¸ä½é˜µåˆ—æ³¢æŸæˆå½¢ä¼¼ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ä½†æ­£å¦‚æˆ‘æ‰€è¯´çš„é‚£æ ·ï¼Œæˆ‘çŸ¥é“å¦‚ä½•åšæˆ‘åšç”µè„‘æ¨¡å‹çš„å¹³æ—¶è®¡ç®—ã€‚å®ƒå…è®¸æˆ‘æ¯”é€šå¸¸çš„è®¡ç®—æ›´ç²¾ç¡®ã€‚è¿™å°è®¡ç®—æœºæ¨¡å‹å¸®åŠ©æˆ‘çœ‹åˆ°æ•°å­¦å®¶ä¼™æ— æ³•ï¼†ï¼ƒ39; tã€‚</p><p> For those who still went the phased array route, none of them was crazy enough to go 3D and go from 10 to 100 transducers. My lack of electronics knowledge helped me here. The &#34;usual&#34; solutions weren&#39;t small enough. But because I didn&#39;t know how hard it would be, I still started. And once I started building the thing, I had to finish it. It pushed me to come up with quite innovative designs that I&#39;m proud of. If I had stayed at the first thinking stage where I designed the circuits to power the transmitter, I would never have built it. When doing new projects or when your knowledge is limited you can&#39;t predict how things will turn out. It&#39;s better to start working on the easy things and move forward bit by bit. Planning everything is impossible.</p><p> å¯¹äºé‚£äº›ä»ç„¶å»åºåˆ—çš„é˜µåˆ—è·¯çº¿çš„äººæ¥è¯´ï¼Œä»–ä»¬éƒ½æ²¡æœ‰è¶³å¤Ÿç–¯ç‹‚çš„æ—¶é—´å»3Dï¼Œä»10åˆ°100ä¸ªä¼ æ„Ÿå™¨ã€‚æˆ‘ç¼ºä¹ç”µå­çŸ¥è¯†å¸®åŠ©æˆ‘è¿™é‡Œã€‚ ï¼†ï¼ƒ34;å¸¸è§çš„ï¼†ï¼ƒ34;è§£å†³æ–¹æ¡ˆWerenï¼†ï¼ƒ39; tå°ã€‚ä½†æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰çŸ¥é“å®ƒæ˜¯å¤šä¹ˆåŠªåŠ›ï¼Œæˆ‘ä»ç„¶å¼€å§‹äº†ã€‚ä¸€æ—¦æˆ‘å¼€å§‹å»ºé€ è¿™ä»¶äº‹ï¼Œæˆ‘å¿…é¡»å®Œæˆå®ƒã€‚å®ƒè®©æˆ‘æƒ³å‡ºäº†æˆ‘éª„å‚²çš„ç›¸å½“åˆ›æ–°çš„è®¾è®¡ã€‚å¦‚æœæˆ‘ç•™åœ¨ç¬¬ä¸€æ¬¾èˆå°ä¸Šï¼Œæˆ‘è®¾è®¡äº†ç”µè·¯ä¾›ç”µçš„ç”µè·¯ï¼Œæˆ‘æ°¸è¿œä¸ä¼šå»ºé€ å®ƒã€‚åœ¨è¿›è¡Œæ–°é¡¹ç›®æˆ–å½“æ‚¨çš„çŸ¥è¯†é™åˆ¶æ—¶ï¼Œæ‚¨å¯ä»¥ï¼†ï¼ƒ39; té¢„æµ‹äº‹æƒ…å°†å¦‚ä½•ç»“æœã€‚å®ƒæ›´å¥½åœ°å¼€å§‹åœ¨ç®€å•çš„äº‹æƒ…ä¸Šå·¥ä½œå¹¶æŒ‰æ¯”ç‰¹å‘å‰ç§»åŠ¨ã€‚è§„åˆ’ä¸€åˆ‡éƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚</p><p> Because I&#39;m alone, I don&#39;t have to ask anyone&#39;s opinion before trying less-traveled roads. I guess that if I had been working at a company, no manager would have approved any of my technical choices.</p><p> å› ä¸ºæˆ‘å•ç‹¬ï¼Œæˆ‘ä¸å¿…åœ¨å°è¯•è¾ƒå°‘çš„é“è·¯ä¹‹å‰é—®ä»»ä½•äººå’Œï¼ƒ39;ï¼†ï¼ƒ39;æˆ‘æƒ³å¦‚æœæˆ‘ä¸€ç›´åœ¨å…¬å¸å·¥ä½œï¼Œé‚£ä¹ˆæ²¡æœ‰ç»ç†å°†æ‰¹å‡†æˆ‘çš„ä»»ä½•æŠ€æœ¯é€‰æ‹©ã€‚</p><p> If you&#39;ve built something similar, reach out to me! I&#39;ll add you to the article to correct my lie.</p><p> å¦‚æœä½ å»ºé€ äº†ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå°±å¯ä»¥äº†è§£æˆ‘ï¼æˆ‘ï¼†ï¼ƒ39; llå°†æ‚¨æ·»åŠ åˆ°æ–‡ç« ä¸­ä»¥çº æ­£æˆ‘çš„è°è¨€ã€‚</p><p>  I&#39;ve published all code and schematics  on github. If you need any help building the device, email me or open a github issue and I&#39;ll write documentation.</p><p>  æˆ‘åœ¨githubä¸Šå‘è¡¨äº†æ‰€æœ‰ä»£ç å’ŒåŸç†å›¾ã€‚å¦‚æœæ‚¨éœ€è¦ä»»ä½•å¸®åŠ©æ„å»ºè®¾å¤‡ï¼Œè¯·å‘é€ç”µå­é‚®ä»¶ç»™æˆ‘æˆ–æ‰“å¼€GitHubé—®é¢˜å’Œiï¼†ï¼ƒ39; llå†™æ–‡æ¡£ã€‚</p><p> My device can help with experiments around radars, beamforming and phased arrays. If you want me to send you one, email me!</p><p> æˆ‘çš„è®¾å¤‡å¯ä»¥å¸®åŠ©é›·è¾¾ï¼Œæ³¢æŸå½¢æˆå’Œç›¸æ§é˜µçš„å®éªŒã€‚å¦‚æœä½ æƒ³è®©æˆ‘å¯„ç»™ä½ ä¸€ä¸ªï¼Œç»™æˆ‘å‘ç”µå­é‚®ä»¶ï¼ </p><p> I searched a bit online for people who did close things. A few guys investigated the principle on hackaday.io, but only a few of them succeeded to build a 2D scanner. None could handle two objects in the same sphere though. There are a few researchers who did articles on the subject, including a team that built a working 2d scanner. Email me if I&#39;m wrong on this.Â  â†©</p><p>æˆ‘åœ¨çº¿æœç´¢äº†é è¿‘äº‹æƒ…çš„äººã€‚å‡ ä¸ªäººè°ƒæŸ¥äº†Hackaday.ioçš„åŸåˆ™ï¼Œä½†å…¶ä¸­åªæœ‰ä¸€äº›äººæˆåŠŸåœ°å»ºé€ äº†ä¸€ä¸ª2Dæ‰«æä»ªã€‚æ— å¯ä»¥åœ¨åŒä¸€ä¸ªé¢†åŸŸä¸­å¤„ç†ä¸¤ä¸ªç‰©ä½“ã€‚æœ‰ä¸€äº›ç ”ç©¶äººå‘˜æ˜¯å…³äºè¯¥ä¸»é¢˜çš„æ–‡ç« ï¼ŒåŒ…æ‹¬å»ºç«‹å·¥ä½œ2Dæ‰«æä»ªçš„å›¢é˜Ÿã€‚å¦‚æœæˆ‘åœ¨è¿™ä¸ªé—®é¢˜ä¸Šç»™æˆ‘å‘ç”µå­é‚®ä»¶ã€‚ â†©</p><p> Simultaneous Localization and Mapping, basically using a camera to compute a 3D map of the world.Â  â†©</p><p> åŒæ—¶æœ¬åœ°åŒ–å’Œæ˜ å°„ï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨ç›¸æœºæ¥è®¡ç®—ä¸–ç•Œçš„3Dåœ°å›¾ã€‚ â†©</p><p> I was proud of my billion-dollar idea, so I showed a drawing of the principle to one of my friends. In a minute, he destroyed it all. &#34;Hey, what happens if a second duck comes here, how do you know if the ducks are side by side or one in front of the other??&#34;. I was pissed. I was thinking of doing it for a school project. Instead, we built an acoustic levitation rig.Â  â†©</p><p> æˆ‘ä¸ºåäº¿ç¾å…ƒçš„æƒ³æ³•æ„Ÿåˆ°éª„å‚²ï¼Œæ‰€ä»¥æˆ‘å‘æˆ‘çš„ä¸€ä¸ªæœ‹å‹å±•ç¤ºäº†ä¸€ä¸ªåŸåˆ™ã€‚åœ¨ä¸€åˆ†é’Ÿå†…ï¼Œä»–æ‘§æ¯äº†è¿™ä¸€åˆ‡ã€‚ ï¼†ï¼ƒ34;å˜¿ï¼Œå¦‚æœä¸€åªç¬¬äºŒåªé¸­å­æ¥åˆ°è¿™é‡Œï¼Œä½ æ€ä¹ˆçŸ¥é“é¸­å­æ˜¯ä¾§é¢è¿˜æ˜¯åœ¨å¦ä¸€é¸­å­å‰é¢çš„ä¸€ä¸ªï¼Ÿï¼†ï¼ƒ34;æˆ‘ç”Ÿæ°”äº†ã€‚æˆ‘æ­£åœ¨è€ƒè™‘ä¸ºå­¦æ ¡é¡¹ç›®åšè¿™ä»¶äº‹ã€‚ç›¸åï¼Œæˆ‘ä»¬å»ºé€ äº†ä¸€ä¸ªå£°å­¦æ‚¬æµ®é’»æœºã€‚ â†©</p><p>  Courtesy of the Arduino forums and the electronics section of StackOverflow for providing wrong schematics. Don&#39;t trust everything you see on the internet :SÂ  â†©</p><p>  ç”±Arduinoè®ºå›å’ŒSackoverflowçš„ç”µå­éƒ¨åˆ†æä¾›æä¾›é”™è¯¯çš„åŸç†å›¾ã€‚ä¸è¦ç›¸ä¿¡ä½ åœ¨äº’è”ç½‘ä¸Šçœ‹åˆ°çš„ä¸€åˆ‡ï¼šsâ†©</p><p> Credits to  CNLohr for this technique, which he used to visualize Wifi signals with an ESP8226.Â  â†©</p><p> å¯¹è¿™ç§æŠ€æœ¯çš„CNLOHRå­¦åˆ†ï¼Œä»–ç”¨äºç”¨ESP8226å¯è§†åŒ–WiFiä¿¡å·ã€‚ â†© </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.alextoussaint.com/2021-04-28_How-I-built-an-ultrasonic-3d-scanner.html">https://www.alextoussaint.com/2021-04-28_How-I-built-an-ultrasonic-3d-scanner.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/å»ºé€ /">#å»ºé€ </a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/built/">#built</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/å¯„å­˜å™¨/">#å¯„å­˜å™¨</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¶æ/">#æ¶æ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å·¥å…·/">#å·¥å…·</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ†äº«/">#åˆ†äº«</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
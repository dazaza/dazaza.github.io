<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>å‘Šåˆ«è·¨ç«™ç‚¹å’ŒåŸŸçš„èµ„æºç¼“å­˜</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">å‘Šåˆ«è·¨ç«™ç‚¹å’ŒåŸŸçš„èµ„æºç¼“å­˜</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-26 21:53:35</div><div class="page_narrow text-break page_content"><p>When I started doing web development, we all loaded jQuery from the official global jQuery CDN.</p><p>å½“æˆ‘å¼€å§‹åšwebå¼€å‘æ—¶ï¼Œæˆ‘ä»¬éƒ½ä»å®˜æ–¹çš„å…¨çƒjQuery CDNåŠ è½½äº†jQueryã€‚</p><p> The idea was straightforward: if everybody loads the same jQuery script file ( cdn.jquery.com/jquery.latest.js â€“ or whatever URL it was back then), then the script file would be cached by the browsers, and other sites requesting the same script would benefit from the speedup of already cached resources. Users would have popular libraries like jQuery already sitting in their browser cache because earlier visited sites requested them.</p><p>è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šå¦‚æœæ¯ä¸ªäººéƒ½åŠ è½½ç›¸åŒçš„jQueryè„šæœ¬æ–‡ä»¶(cdn.jquery.com/jquery.latest.js-æˆ–å½“æ—¶çš„ä»»ä½•URL)ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬æ–‡ä»¶å°†ç”±æµè§ˆå™¨ç¼“å­˜ï¼Œè€Œå…¶ä»–è¯·æ±‚ç›¸åŒè„šæœ¬çš„ç«™ç‚¹å°†å—ç›Šäºå·²ç¼“å­˜èµ„æºçš„åŠ é€Ÿã€‚ç”¨æˆ·å¯èƒ½å·²ç»åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­æ‹¥æœ‰åƒjQueryè¿™æ ·çš„å—æ¬¢è¿çš„åº“ï¼Œå› ä¸ºä¹‹å‰è®¿é—®è¿‡çš„ç«™ç‚¹éœ€è¦å®ƒä»¬ã€‚</p><p> This caching behavior was possible because, at the time, the browser&#39;s HTTP caches used the asset URL ( cdn.jquery.com/jquery.latest.js) as a single cache key. Browsers use cache keys to figure out if and how to cache a resource. If these keys only consist of the resource URL, it allows the reuse of resources across sites and domains.</p><p>è¿™ç§ç¼“å­˜è¡Œä¸ºä¹‹æ‰€ä»¥å¯èƒ½ï¼Œæ˜¯å› ä¸ºå½“æ—¶æµè§ˆå™¨çš„HTTPç¼“å­˜ä½¿ç”¨èµ„äº§URL(cdn.jquery.com/jquery.latest.js)ä½œä¸ºå•ä¸ªç¼“å­˜é”®ã€‚æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜é”®æ¥ç¡®å®šæ˜¯å¦ä»¥åŠå¦‚ä½•ç¼“å­˜èµ„æºã€‚å¦‚æœè¿™äº›é”®ä»…ç”±èµ„æºURLç»„æˆï¼Œåˆ™å…è®¸è·¨ç«™ç‚¹å’ŒåŸŸé‡ç”¨èµ„æºã€‚</p><p> All this worked great, but as it is with many great inventions in web technology,  cross-site resource caching enabled new ways to track users across different sites.</p><p>æ‰€æœ‰è¿™äº›éƒ½å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†å°±åƒç½‘ç»œæŠ€æœ¯ä¸­çš„è®¸å¤šä¼Ÿå¤§å‘æ˜ä¸€æ ·ï¼Œè·¨ç«™ç‚¹èµ„æºç¼“å­˜å®ç°äº†è·¨ä¸åŒç«™ç‚¹è·Ÿè¸ªç”¨æˆ·çš„æ–°æ–¹æ³•ã€‚</p><p> As an example, let&#39;s assume Facebook loads a unique file in their logged-in area ( fb-logo-ajgdmaks839â€“as.svg â€“ I totally made that file path up); if I would know the file path to such a file, request it on  stefanjudis.com and see a rapid response coming from the browser cache, I can almost be sure that the user has logged into Facebook lately.</p><p>ä¾‹å¦‚ï¼Œå‡è®¾Facebookåœ¨ä»–ä»¬çš„ç™»å½•åŒºåŠ è½½äº†ä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶(fb-logo-ajgdmaks839-as.svg-Iå®Œå…¨åˆ›å»ºäº†è¯¥æ–‡ä»¶è·¯å¾„)ï¼›å¦‚æœæˆ‘çŸ¥é“è¿™æ ·ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ï¼Œåœ¨stefan Judis.comä¸Šè¯·æ±‚å®ƒï¼Œå¹¶çœ‹åˆ°æ¥è‡ªæµè§ˆå™¨ç¼“å­˜çš„å¿«é€Ÿå“åº”ï¼Œæˆ‘å‡ ä¹å¯ä»¥ç¡®å®šç”¨æˆ·æœ€è¿‘ç™»å½•è¿‡Facebookã€‚</p><p>  Webkit (Safari) changed its caching strategy already in 2013 to prevent user tracking via the browser cache. Its cache keys are a combination of the requested resource URL and the top-level-domain requesting the resource.</p><p>WebKit(Safari)æ—©åœ¨2013å¹´å°±æ”¹å˜äº†ç¼“å­˜ç­–ç•¥ï¼Œä»¥é˜»æ­¢é€šè¿‡æµè§ˆå™¨ç¼“å­˜è¿›è¡Œç”¨æˆ·è·Ÿè¸ªã€‚å…¶ç¼“å­˜é”®æ˜¯è¯·æ±‚çš„èµ„æºURLå’Œè¯·æ±‚èµ„æºçš„é¡¶çº§åŸŸçš„ç»„åˆã€‚</p><p>  On the bright side, this key structure prevents the mentioned tracking possibilities; unfortunately, it also leads to duplicated resources in the browser cache.</p><p>å¥½çš„ä¸€é¢æ˜¯ï¼Œè¿™ç§é”®ç»“æ„é˜»æ­¢äº†å‰é¢æåˆ°çš„è·Ÿè¸ªå¯èƒ½æ€§ï¼›ä¸å¹¸çš„æ˜¯ï¼Œå®ƒè¿˜ä¼šå¯¼è‡´æµè§ˆå™¨ç¼“å­˜ä¸­çš„é‡å¤èµ„æºã€‚</p><p>   Starting with v86, Chrome will be using combined cache keys, too. This change means that it&#39;s time to say goodbye to third-party resource-sharing across the web.  With Chrome&#39;s market share of roughly 70%, most browsers hitting our sites will use partitioned browser caches from now on. Chrome went for combining the top-level site URL, the current frame site URL, and the resource URL. This approach is more granular than what Safari does, but the result is the same.</p><p>ä»v86å¼€å§‹ï¼ŒChromeä¹Ÿå°†ä½¿ç”¨ç»„åˆç¼“å­˜é”®ã€‚è¿™ä¸€å˜åŒ–æ„å‘³ç€ï¼Œæ˜¯æ—¶å€™å‘Šåˆ«ç½‘ç»œä¸Šçš„ç¬¬ä¸‰æ–¹èµ„æºå…±äº«äº†ã€‚ç”±äºChromeçš„å¸‚åœºä»½é¢çº¦ä¸º70%ï¼Œä»ç°åœ¨å¼€å§‹ï¼Œè®¿é—®æˆ‘ä»¬ç½‘ç«™çš„å¤§å¤šæ•°æµè§ˆå™¨éƒ½å°†ä½¿ç”¨åˆ†åŒºçš„æµè§ˆå™¨ç¼“å­˜ã€‚Chromeå°†é¡¶çº§ç«™ç‚¹URLã€å½“å‰æ¡†æ¶ç«™ç‚¹URLå’Œèµ„æºURLç»„åˆåœ¨ä¸€èµ·ã€‚è¿™ç§æ–¹æ³•æ¯”Safariåšçš„æ›´ç²¾ç»†ï¼Œä½†ç»“æœæ˜¯ç›¸åŒçš„ã€‚</p><p> If your sites request the global jQuery, modules from  unpkg.com, font files from  Google fonts or GA&#39;s (Google Analytics)  analytics.js,  users will redownload the resources no matter if they downloaded and cached them for other sites already.</p><p>å¦‚æœæ‚¨çš„ç«™ç‚¹è¯·æ±‚å…¨å±€jQueryã€æ¥è‡ªunpkg.comçš„æ¨¡å—ã€æ¥è‡ªGoogle Fontsæˆ–GA&#39ï¼›s(Google Analytics)analytics.jsçš„å­—ä½“æ–‡ä»¶ï¼Œç”¨æˆ·å°†é‡æ–°ä¸‹è½½è¿™äº›èµ„æºï¼Œæ— è®ºä»–ä»¬æ˜¯å¦å·²ç»ä¸‹è½½å¹¶ç¼“å­˜åˆ°å…¶ä»–ç«™ç‚¹ã€‚</p><p> What does this change mean for you? If your sites live on modern hosting that provides a CDN and supports HTTP/2, you can drop the third-parties and should ship all resources yourself. Relying on a third-party provides little value in 2020.</p><p>è¿™ä¸€å˜åŒ–å¯¹æ‚¨æ„å‘³ç€ä»€ä¹ˆï¼Ÿå¦‚æœæ‚¨çš„ç«™ç‚¹ä¾èµ–äºæä¾›CDNå¹¶æ”¯æŒHTTP/2çš„ç°ä»£ä¸»æœºï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ”¾å¼ƒç¬¬ä¸‰æ–¹ï¼Œè€Œåº”è¯¥è‡ªå·±äº¤ä»˜æ‰€æœ‰èµ„æºã€‚åœ¨2020å¹´ï¼Œä¾èµ–ç¬¬ä¸‰æ–¹å‡ ä¹æ²¡æœ‰ä»€ä¹ˆä»·å€¼ã€‚</p><p> If you&#39;re interested in learning more on this topic you can give  Terence Eden&#39;s post &#34;Please stop using CDNs for external Javascript libraries&#34; a read, too.</p><p>å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æœ‰å…³æ­¤ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é˜…è¯»Terence Edençš„å¸–å­ï¼šè¯·åœæ­¢ä½¿ç”¨å¤–éƒ¨Javascriptåº“çš„CDNã€‚</p><p>  I have mixed feelings about these changes. It&#39;s excellent that browsers consider privacy, but it looks like anything can be misused for tracking purposes these days. I wonder where we&#39;re going with this... ğŸ˜¢</p><p>æˆ‘å¯¹è¿™äº›å˜åŒ–çš„æ„Ÿè§‰å¾ˆå¤æ‚ã€‚æµè§ˆå™¨è€ƒè™‘éšç§æ˜¯ä»¶å¥½äº‹ï¼Œä½†ç°åœ¨çœ‹æ¥ï¼Œä»»ä½•ä¸œè¥¿éƒ½å¯èƒ½è¢«æ»¥ç”¨äºè¿½è¸ªç›®çš„ã€‚æˆ‘æƒ³çŸ¥é“è¿™ä»¶äº‹æˆ‘ä»¬è¦å»å“ªé‡Œâ€¦â€¦ã€‚ğŸ˜¢</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.stefanjudis.com/notes/say-goodbye-to-resource-caching-across-sites-and-domains/">https://www.stefanjudis.com/notes/say-goodbye-to-resource-caching-across-sites-and-domains/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ç¼“å­˜/">#ç¼“å­˜</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/èµ„æº/">#èµ„æº</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/resource/">#resource</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ç«™ç‚¹/">#ç«™ç‚¹</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è®¾è®¡/">#è®¾è®¡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ¸¸æˆ/">#æ¸¸æˆ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åˆ›æ„/">#åˆ›æ„</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‹¹æœ/">#è‹¹æœ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‘„å½±/">#æ‘„å½±</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è½¯ä»¶/">#è½¯ä»¶</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¾å›½/">#ç¾å›½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å›¾ç‰‡/">#å›¾ç‰‡</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/æ‰‹æœº/">#æ‰‹æœº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è§†é¢‘/">#è§†é¢‘</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¹¿å‘Š/">#å¹¿å‘Š</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å…è´¹/">#å…è´¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è°·æ­Œ/">#è°·æ­Œ</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç½‘ç«™/">#ç½‘ç«™</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/å¾®è½¯/">#å¾®è½¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ä¸‹è½½/">#ä¸‹è½½</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/éŸ³ä¹/">#éŸ³ä¹</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/åšå®¢/">#åšå®¢</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/ç¨‹åº/">#ç¨‹åº</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/è‰ºæœ¯/">#è‰ºæœ¯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>
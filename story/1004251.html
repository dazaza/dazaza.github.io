<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何使用Node-RED将家庭音量级别正常化</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">如何使用Node-RED将家庭音量级别正常化</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-29 22:48:34</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/5/40017bcd42c7d2139a70fa651df20947.png"><img src="http://img.diglog.com/img/2020/5/40017bcd42c7d2139a70fa651df20947.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>这篇文章将介绍使用Home Assistant和Node-RED正常化所有media_player音量级别。如果您还没有，我建议您阅读我上一篇关于发送文本到语音通知的博客文章，其中更深入地介绍了此流消耗的可选辅助功能子流。</p><p>使用Amazon Alexa媒体播放器集成功能，此自动化功能可根据一天中的不同时间对我家中的所有音量级别进行标准化，以便将我所有的Amazon Echoand Ecobe Switch+设备带入Home Assistant。</p><p>这是我家里我最喜欢的自动化产品之一，我想你也会喜欢的！我写这个自动化有几个原因：</p><p>我希望所有的演讲者在就寝时间都保持安静。这样可以防止有人在凌晨2点被炸死。</p><p>早上喝完咖啡后，我想把音量调到可以接受的水平。</p><p>自动化允许通过子流进行重用。这意味着你可以在其他情况下触发它，比如朋友结束了，音乐正在播放，增加音量或降低音量。</p><p>少了一件我必须思考的事情，或者不断触摸才能改变的事情。在大流行的今天，这也是你可能要清理的一件事！</p><p>如果您还没有安装Alexa Media Player自定义组件，如果您使用的是Alexa，请安装该组件，否则跳过此部分。</p><p>这个插件令人惊叹，因为它将所有支持Alexa的设备(如Amazon Echoor ecobe Switch+)正常化为可供家庭助理使用的媒体播放器。</p><p>此自动化流通过调用media_player.volume_set服务控制音量级别。我建议您先打开Home Assistant开发人员工具并导航到“服务”选项卡，然后对其进行测试。</p><p>接下来，开始在media_player上播放一些音乐，并使用以下有效负载调用media_player.volume_set服务：</p><p>如果您没有听到音量变化，请尝试使用不同的VOLUME_LEVEL，以防设备已处于该音量级别。如果没有，则停止并检查日志。这将有助于诊断设备无法工作的原因，并在继续之前为您节省大量时间。</p><p>我强烈建议添加多个输入布尔来控制特定自动化或所有自动化是否可以运行。在维护的情况下，能够打开或关闭特定的自动化或所有的自动化总是很好的。下面是此Automation流中使用的三个INPUT_BOOLEAN。</p><p>AUTOMATION_ENABLE：名称：启用自动化图标：mdi:home-automationautomation_normalize_volume：名称：AUTOMATION-全天自动规格化音量图标：mdi：VOLUME-HUTOMATION_NOTIFICATIONS：名称：触发自动化时通知图标：mdi：HOME-AUTOMANIZATION。</p><p>此子流程将获得当前设备的音量级别，比较当前状态和所需状态。如果需要更改，它将调用所需的服务来更改设备音量级别。</p><p>然后，我创建了一个具有状态节点、一个输入和一个输出的新子流。此子流程(可选)取决于“发送自动语音通知”子流程。</p><p>Graph TDInputNode(Input)--&gt；ACurrentStateNode(FAS：FA-数据库获取当前音量级别)ACurrentStateNode--&gt；BFunctionNode(FAS：FA-代码设置音量级别有效负载)BFunctionNode--&gt；CCallServiceNode(FAS：FA-PLAY设置音量级别)BFunctionNode--&gt；DCallSubflowNode。StatusOutputNode(Status)style StatusNode Fill：#ECF5Fstyle StatusOutputNode Fill：#FAFBstyle InputNode Fill：#FAFBstyle ACurrentStateNode Fill：#66ACFDstyle BFunctionNode Fill：#FBB68Fstyle CCallServiceNode Fill：#66ACFDstyle DCallSubflowNode Fill：#FF75A1 style OutputNode Fill：#FAFAFB。</p><p>让我们分解一下子流。传入的消息被传递到Get Current Volume Level Current State节点，以使用实体填充msg.data。然后将其传递到设置音量级别有效负载节点，该节点检查是否需要进行任何更改以满足所需的音量级别，并输出文本到语音(TTS)状态消息。如果需要更改，设置音量级别节点将调用media_player.volume_set服务。</p><p>以下是Set Volume Level PayloadFunction节点中包含的JavaScript代码，用于仅在需要时智能调整音量。</p><p>const entity=msg.payload&amp；&amp；msg.payload.entity_id；const Attributes=msg.data&amp；&amp；msg.data.tributesif(！entity||！tributes){node.status({Fill：&#34；red&#34；，Shape：&#34；dot&#34；，text：&#34；Invalid Volume payload&#34；})；返回[null，null]；}const desired_({填充：&#34；红色&#34；，形状：&#34；点&#34；，文本：&#34；无效卷有效负载&#34；})；返回[null，null]；}const desired_。0.0||desired_volume_level&gt；1.0){let message=&#34；音量级别必须在0到1之间。&#34；；node.status({Fill：&#34；red&#34；，Shape：&#34；dot&#34；，text：message})；node.error(Message)；return[null，{payload：{entity_id：entity，message：message}}]；}if(desired_volume_level==属性.volume_level)。音量级别已处于所需级别。&#34；；node.status({填充：&#34；灰色&#34；，形状：&#34；点&#34；，文本：消息})；node.log(Message)；return[null，{payload：{entity_id：entity，message：message}}]；}const volumePayload={payload：{data：{entity_id：entity，volume_level：desired_volume_level}；let message=。+(RESENDED_VOLUME_LEVEL*100)+&#34；百分比.&#34；；const Speech Payload={payload：{entity_id：entity，message：message}}；node.status({Fill：&#34；green&#34；，form：&#34；dot&#34；，text：message})；return[volumePayload，talk Payload]；</p><p>正如您所看到的，它将输出一个友好的语音通知有效负载，该负载将被发送到Send Automation Speech Notification子流。如果您没有使用Alexa_MEDIA_Player Home Assistant插件，您可能需要更新“设置音量级别有效负载”功能节点以获取您期望的音量范围。</p><p>您可以通过传递具有以下有效负载的消息对象来触发此子流。我建议使用Inject Node来测试这一点。</p><p>请注意，对于我的Alexa演讲者。我使用介于[0.0..0.10]之间的音量级别。要静音，请传递0.0。</p><p>该子流程将获取所有MEDIA_Player‘，然后将它们逐个发送到设置的音量级子流程。</p><p>如果您没有使用Alexa，您可能需要调整获取所有媒体播放器节点，因为它将返回具有特定功能属性的所有设备，该属性表示我支持更改音量级别。</p><p>Graph TDInputNode(Input)--&gt；AFunctionNode(FAS：FA代码解析音量级别)AFunctionNode--&gt；BGetEntiesNode(FAS：FA-搜索获取所有媒体播放器)BGetEntiesNode--&gt；CChangeNode(FAS：FA-随机设置音量级别有效负载)CChangeNode--&gt；DSubflowNode(FAS：FA-随机设置音量级别有效负载)CChangeNode--&gt；DSubflowNode(FAS：FA-随机设置音量级别有效负载)CChangeNode--&gt；DSubflowNode(FAS。StatusOutputNode(Status)style StatusNode Fill：#ECF5Fstyle StatusOutputNode Fill：#FAFBstyle InputNode Fill：#FAFBstyle AFunctionNode Fill：#FBB68Fstyle BGetEntiesNode Fill：#66ACFDstyle CChangeNode Fill：#FEA530style DSubflowNode Fill：#FF75A1 style OutputNode Fill：#FAFAFBlinkStingNode Fill。</p><p>您可以通过传递具有以下浮点(例如0.1)有效负载的消息对象来触发此子流。我建议使用Inject Node来测试这一点。</p><p>此流将前面的两个子流结合在一起，以基于一天中的时间将所有成交量级别正常化。在我家，我把早上9点到晚上9点的水平设置为30%，否则我设置为10%。</p><p>为了让流在一天中的不同时间设置音量级别，我使用BigTimer节点，打开时间为09：00，关闭时间为21：00。然后我将开味精设为0.3，关味精设为1。当计时器打开和关闭时，它将检查我的自动化标志是否打开。如果是，它将枚举所有媒体设备，并根据计时器输出消息(例如，.1或.3)设置音量。</p><p>Graph TDABigTimerNode(FAS：FA-Clock Normize Volume)--&gt；B CurrentStateNode(FAS：FA-启用数据库自动化？)B CurrentStateNode--&gt；CCurrentStateNode(FAS：FA-数据库标准化音量级别？)CCurrentStateNode--&gt；DRbeNode(FAS：FA-滚动只允许更改的值)DRbeNode--&。StatusOutputNode(Status)style StatusNode Fill：#ECF5FFstyle StatusOutputNode Fill：#FAFBstyle ABigTimerNode Fill：#3DB39Fstyle B CurrentStateNode Fill：#66ACFDstyle CCurrentStateNode Fill：#66ACFDDbeNode Fill：#FEB95Estyle ECallSubflow Fill：#FF75A1 linkStyle默认笔划宽度：2px，Fill。</p><p>[{&#34；id&#34；：&#34；7a62a2d3.c0f4a4&#34；，&#34；类型&#34；子流&#34；，&#34；名称&#34；：&#34；发送自动化语音通知&#34；，&#34；信息&#34；：&#34；&#34；，&#34；类别&#34；：&#34；&#34；，&。：[{&#34；x&#34；：60，&#34；y&#34；：100，&#34；y&#34；：[{&#34；id&#34；：&#34；87411254.a6ed18&#34；}]}]，&#34；out&#34；：[{&#34；x&#34；：1120，&#34；y&#34；：100，&#34；wire&#34；：[{&#34；id&#34；：&#34；d44cc51a.be0668&#34；，&#34；port&#34；：0}]}]，&#34；状态&#34；：{&#34；x&#34；：220，&#34；y&#34；：40，&#34；wire&#34；：：[{&#34；id&#34；：&#34；aef53056.742438。port&#34；：0}]}}，{&#34；id&#34；：&#34；89300b1.595bcf8&#34；，&#34；类型&#34；：&#34；函数&#34；，&#34；z&#34；：：&#34；7a62a2d3.c0f4a4&#34；，&#34；名称&#34；：&#34；设置语音负载&#34；，&。Const Entity=flow.get(\&#34；$parent.speech_entity_id\&#34；)||(msg.payload&amp；&amp；msg.payload.entity_id)||\&#34；media_player.office_echo_plus\&#34；；\nconst消息=(msg.payload&amp；&amp；msg.payload.message)||\&#34；自动化未提供消息\&#34；；\nconst公告=msg.payload&amp；&amp；msg.payload.宣告；\n\n如果(公告){\n node.status({填充：\&#34；绿色\&#34；，形状：\&#34；点\&#34；，文本：\&#34；公告消息：\&#34；+消息})；\n返回{\n有效负载：{\n数据：{\n消息：消息，\n数据：{\&#34；类型\&#34；：\&#34；公告\&#34；，\&#34；方法\&#34；：\&#34；全部\&#34；}，\n目标：！！实体？[实体]：[]\n}\n}\n}；\n}\n\nnode.status({填充：\&#34；绿色\&#34；，形状：\&#34；点\&#34；，文本：\&#34；TTS消息：\&#34；+消息})；\n返回{\n负载：{\n数据：{\n消息：消息，\n数据：{type：\&#34；TTS\&#34；}，\n目标：[实体]\n}\n}\n}；&#34；，&#34；输出&#34；：1，&#34；noerr&#34；：0，&#34；x&#34；：700，&#34；y&#34；：100，&#34；wire&#34；：[[&#34；d44cc51a.be0668&#34；]]}，{&#34；id&#34；：d44cc51a.be0668&#34；，&#34；类型&#34；：&#34；api-call-service&#34；，&#34；7a62a2d3.c0f4a4&#34；，&#34；name&#34；：&#34；发送语音通知&#34；，&#34；server&#34；：&#34；61956bd4.93dff。：false，&#34；service_domain&#34；：&#34；Notify&#34；，&#34；service&#34；：&#34；Alexa_media&#34；，&#34；entityId&#34；：&#34；&#34；，&#34；data&#34；：&#34；&#34；，&#34；dataType&#34；：&#34；json&#34；，&#34；mergecontext。&#34；，&#34；output_location&#34；：&#34；payload&#34；，&#34；output_location_type&#34；：&#34；msg&#34；，&#34；mustack heAltTags&#34；：false，&#34；x&#34；：950，&#34；y&#34；：100，&#34；wire&#34；：[[]]}，{&#34；id&34；：&#34；6add9bc6.4c3624&#34；，&#34；类型&#34；：&#34；api-c</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blakeniemyjski.com/blog/how-to-normalize-home-volume-levels-with-node-red/">https://blakeniemyjski.com/blog/how-to-normalize-home-volume-levels-with-node-red/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/node/">#node</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/home/">#home</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fill/">#fill</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1002890.html"><img src="http://img.diglog.com/img/2020/5/thumb_ca137f8b1df814fb050b2cd4982d640e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002890.html">Node.js-v14.3.0</a></div><span class="my_story_list_date">2020-5-20 6:40</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002853.html"><img src="http://img.diglog.com/img/2020/5/thumb_2be1fa220d0e1f49155961475dbad32b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002853.html">Node.js快要死了吗？</a></div><span class="my_story_list_date">2020-5-20 3:34</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002533.html"><img src="http://img.diglog.com/img/2020/5/thumb_c8ce40af901c64c85bdf410cc6032ca1.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002533.html">从Node到Deno</a></div><span class="my_story_list_date">2020-5-17 23:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1000781.html"><img src="http://img.diglog.com/img/2020/5/thumb_e143cdc76004a381ee210eb9db2ac105.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000781.html">Reaction-Flow：创建基于节点的交互式图形的库</a></div><span class="my_story_list_date">2020-5-5 23:54</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>
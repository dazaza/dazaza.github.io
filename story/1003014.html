<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Xbox One开发控制台上的权限提升-通过“按设计”的功能</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Xbox One开发控制台上的权限提升-通过“按设计”的功能</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-21 03:11:26</div><div class="page_narrow text-break page_content"><p>“UnattenddedUtilties”是在XboxDevService.exe中注册的Windows运行时类对象，XboxDevService.exe驻留在Xbox One的SRA分区中。此服务仅在授权的Xbox One在开发人员模式下运行时注册和执行，不会在零售环境中执行。最初，这是在注意到“Dev Home”应用程序文件列表中添加了一个名为“unattendent”的工具部分后发现的，该工具部分包含工具页面的脚本以及位于系统工具驱动器上的*.xboxunattendent文件。查看这些*.xboxunattend文件可以发现，它们只是带有重命名扩展名的批处理脚本。</p><p>奇怪的是，这些页面几乎没有一个实际上在标准的UWA开发人员模式下可用。它们在运行时根本不会出现在应用程序中。这些是故意藏起来的吗？它们还能用吗？</p><p>//版权所有(C)Microsoft Corporation。版权所有。_runScriptOnUsb：function(){尝试{//禁用该按钮以防止多次按下。这个。_runScriptOnUsbButton。DISABLED=TRUE；此。_closeConfigureUnattendButton。Focus()；unattendUtils。runUnattenddedScriptOnUsbAsync()；}catch(E){//不执行任何操作。这通常不会失败，但如果用户在正确的时间移除USB//驱动器，则可能会失败。}}，</p><p>最突出的代码当然是‘unattendUtils.runUnattendedScriptOnUsbAsync()’，它达到了我的兴趣的顶峰，因为我很好奇这些“脚本”是基于调用的应用程序执行的，还是它是否是系统服务。接下来，我查看了函数所属的位置，这是一个简单的任务-‘unattendUtils’引用的名称空间是‘Microsoft.Xbox.Development.UnattendedUtilities’.。通常，在Dev Home应用程序的根目录中有一个“microsoft.xbox.development.winmd”文件！当然，如果您已经熟悉，这是Windows运行时系统使用的Windows元数据文件，其中包含驻留在另一个进程中的接口的信息。</p><p>这些文件类型可以简单地放入.NET反汇编程序(例如JetBrains dotPeek)中，并且能够查看类定义和其他类型。</p><p>哈！我们已经定义了一个接口，其中包含一些有趣的函数。但由于这些Windows元数据文件的性质，这意味着主机二进制文件与Dev Home是分开的。然而，这很容易发现，因为当客户端调用应用程序创建类对象的实例时，通常会有加载到所述应用程序中的“ProxyStub”。通过远程调试Dev Home应用程序，我们可以查看加载的模块并确定可能由哪个模块负责。由于我们在开发人员模式下运行，我怀疑它只需要与有限的可执行文件子集相关，因此，当发现Dev Home进程中加载的‘XboxDevService.ProxyStub.dll’时，我立即决定反汇编服务器本身。</p><p>由于这些脚本看起来只是批处理脚本，我认为XboxDevService将需要调用“CreateProcess”API，因此我查看了可执行文件导入并对CreateProcessW导入进行了外部引用，直到我遇到一个函数，该函数无疑为该服务提供了足够的基础。</p><p>hInput=GetStdHandle(0xFFFFFFF6)；targ_Handle=hTarget；lpCmdLine=WindowsGetStringRawBuffer(scriptPath，0)；//函数参数(A2)v31=(__Int64)&amp；v31；//如果((Unsign Int)CreateProcessW(0，lpCmdLine，0，0，1))，则通过完整路径执行脚本。//.//如果((Int)WindowsCreateStringReference(L&#34；请参阅日志文件的SystemScratch\\boot\\logs目录)，&#34；，55，&amp；hSTR_HDR_LOG_DIR，&amp；hSTR_LOG_DIR)&lt；0)RaiseException(0xC000000D，1，0，0)；hSTR_LOG_DIR，则创建带有吐司通知消息的字符串引用(0xC000000D，1，0，0)；hSTR_LOG_。无人参与脚本完成。&#34；，27，&amp；hSTR_HDR_COMPLETE_MSG，&amp；HSTR_CLASS_FRONTPANEL_UTILS)&lt；0){RaiseException(0xC000000D，1，0，0)；res=CreateToast(HSTR_CLASS_FRONTPANEL_UTILS，hSTR_LOG_DIR_2，v25，v24)；如果。//如果((Int)WindowsCreateStringReference(L&#34；Microsoft.Xbox.Development.FrontPanelDisplayUtilities&#34；，53，&amp；hSTR_HDR_COMPLETE_MSG，&amp；HSTR_CLASS_FRONTPANEL_UTILS)&lt；0)RaiseException(0xC000000D，1，0，0)；hClassID=HSTR_CLASS_FRONTPANEL_UTILS；v28，则创建包含可激活类id的字符串引用。self_ret(*(__int64(**)(Void))(*(_QWORD*)v28+16))；}//注册Windows运行时对象环</p><p>伪代码允许我们得出结论，这个特定的函数负责执行无人参与的脚本，因为它提供了弹出吐司通知的方式，而对于chuckwalla工具包，它将使用前面板，同时引用日志输出目录。通过确定前面找到的Windows元数据的宿主进程，我们现在可以开始尝试创建“UnattenddedUtilities”类的实例，并尝试执行我们自己的脚本。我在网上和Windows SDK中搜索了有关Windows Runtime类通常是如何指定的参考资料，找到了几个概述类定义的资源，但我仍然不确定。因此，我决定四处寻找其他可能依赖于UnattenddedUtilities类的二进制文件--那就是Windows设备门户。这使我走上了手动定义带有存根的接口的道路，以确保正确的偏移量…。</p><p>我很快就发现了Windows SDK中提供的实用程序，它可以帮我完成繁重的工作。</p><p>这将生成定义我们所需的所有内容的头文件。我是…。一团糟，所以我决定整理一下结果，清楚地定义我们需要什么。</p><p>MIDL_INTERFACE(&#34；DE87AD07-75DC-4EEC-9226-5628E98B9914&#34；)I无人参与实用工具Statics：PUBLIC IInspectable{PUBLIC：虚拟HRESULT STDMETHODCALLTYPE RemoveUnattenddScript(Void)=0；Virtual HRESULT STDMETHODCALTYPE RetrieveUnattenddScript(Void)=0；Virtual HRESULT STDMETHODCALLTYPE RetrieveAndRunUnde。virtual HRESULT STDMETHODCALLTYPE SendToastNotification(HSTRING title，HSTRING message)=0；virtual HRESULT STDMETHODCALLTYPE IsScriptRunning(boolean*isRunning)=0；virtual HRESULT STDMETHODCALLTYPE ShouldRunOobeScript(boolean*shouldRun)=0；virtual HRESULT STDMETHODCALLTYPE ShouldRunOobeScript(Boolean ShouldRun)=0；virtual HRESULT STDMETHODCALLTYPE ShouldBlockUsbScripts(boolean*shouldBlock)=0；virtual HRESULT STDMETHODCALLTYPE ShouldBlockUsbScripts(Boolean ShouldBlock)=0；virtual HRESULT STDMETHODCALLTYPE ShouldSkipAbortToast(boolean*skip)=0；virtual HRESULT STDMETHODCALLTYPE ShouldSkipAbortToast(Boolean Skip)=0；virtual HRESULT STDMETHODCALLTYPE ShouldCallDevCenter(boolean*shouldCall)=0；虚拟HRESULT STDMETHODCALLTYPE ShouldCallDevCenter(布尔值应调用)=0；虚拟HRESULT STDMETHODCALLTYPE ShouldBlockUnattendScripts(布尔值*应为块)=0；虚拟HRESULT STDMETHHODCALTYPE应为块未参加脚本(布尔值应为块)=0；虚拟HRESULT。</p><p>在编写了一个小的控制台程序并简单地使用了‘RetrieveAndRunUnattenddedScriptAsync()’函数之后，我编写了一个运行telnet的脚本，并创建了一个控制台通知来通知更明显的结果。在通过SSH部署和连接之后，我使用指定的脚本插入U盘，打开Xbox设备门户以监控进程，然后执行我的程序…。</p><p>是!。我们已经成功地运行了一个无人参与的脚本，并且还达到了最高权限级别！一旦有一个telnet实例在最高权限级别上运行，我们就可以利用从Windows Core内部版本中继承下来的‘net1.exe’，并添加一个具有管理员角色的新用户，还可以启用内置管理员帐户。只要您在切换回零售模式时避免清除数据，这些帐户在开发者模式下的重启过程中将持续存在。</p><p>利用无人值守实用程序，我们可以提升SRA分区中的现有用户权限，这也赋予了我们更大的灵活性和访问权，以便继续研究操作系统并对其进行反向工程。</p><p>由于该功能被隐藏起来，并且在做了一些调查之后，人们了解到“无人参与”功能是为了在“ERA”授权的开发工具包上使用的，并且在Xbox one XDK上有文档记录。由于这一功能在水声上起作用，我负责任地整理了一份POC和小写，并通知了MSRC。然而，反应并不是我所期待的，因为他们声称这是“故意的”，而我</p><p>由于锁定的功能要成功工作有点痛苦，我决定公开发布我的程序，使更多的人能够使用这些特权，而不仅仅是我自己和团队，希望能看到个人在做他们自己的研究。我决定公开发布我的程序，让更多的人能够使用这些特权，希望看到个人进行自己的研究。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://billyhulbert.github.io/priv-esc-the-unintended-UnattendedUtilities/">https://billyhulbert.github.io/priv-esc-the-unintended-UnattendedUtilities/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开发/">#开发</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/脚本/">#脚本</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1002934.html"><img src="http://img.diglog.com/img/2020/5/thumb_e21e09533e1794f43f6532c9f8b20d49.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002934.html">哪个是最好的Web开发Python框架？</a></div><span class="my_story_list_date">2020-5-20 14:44</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002906.html"><img src="http://img.diglog.com/img/2020/5/thumb_b75b93ce34f7fdb21ba02f06cb5b9c17.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002906.html">Microsoft为您的开发环境首次推出Windows软件包管理器</a></div><span class="my_story_list_date">2020-5-20 8:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002771.html"><img src="http://img.diglog.com/img/2020/5/thumb_5ee940fee3bbb459294046c9c1b0fcc8.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002771.html">如果您想成为高级开发人员，请停止关注语法</a></div><span class="my_story_list_date">2020-5-19 21:0</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002612.html"><img src="http://img.diglog.com/img/2020/5/thumb_cce2d8cee1e3242083cde1f863c9bc5c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002612.html">Python开发者调查2019年结果-JetBrains</a></div><span class="my_story_list_date">2020-5-18 17:22</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>